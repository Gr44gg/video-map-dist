(function(){const p=document.createElement("link").relList;if(p&&p.supports&&p.supports("modulepreload"))return;for(const t of document.querySelectorAll('link[rel="modulepreload"]'))l(t);new MutationObserver(t=>{for(const D of t)if(D.type==="childList")for(const g of D.addedNodes)g.tagName==="LINK"&&g.rel==="modulepreload"&&l(g)}).observe(document,{childList:!0,subtree:!0});function C(t){const D={};return t.integrity&&(D.integrity=t.integrity),t.referrerpolicy&&(D.referrerPolicy=t.referrerpolicy),t.crossorigin==="use-credentials"?D.credentials="include":t.crossorigin==="anonymous"?D.credentials="omit":D.credentials="same-origin",D}function l(t){if(t.ep)return;t.ep=!0;const D=C(t);fetch(t.href,D)}})();const ys="modulepreload",Ts=function(e,p){return new URL(e,p).href},Rn={},ii=function(p,C,l){return!C||C.length===0?p():Promise.all(C.map(t=>{if(t=Ts(t,l),t in Rn)return;Rn[t]=!0;const D=t.endsWith(".css"),g=D?'[rel="stylesheet"]':"";if(document.querySelector(`link[href="${t}"]${g}`))return;const E=document.createElement("link");if(E.rel=D?"stylesheet":ys,D||(E.as="script",E.crossOrigin=""),E.href=t,document.head.appendChild(E),D)return new Promise((F,_)=>{E.addEventListener("load",F),E.addEventListener("error",()=>_(new Error(`Unable to preload CSS for ${t}`)))})})).then(()=>p())};function Zr(e,p){const C=Object.create(null),l=e.split(",");for(let t=0;t<l.length;t++)C[l[t]]=!0;return p?t=>!!C[t.toLowerCase()]:t=>!!C[t]}const xs="itemscope,allowfullscreen,formnovalidate,ismap,nomodule,novalidate,readonly",Ss=Zr(xs);function si(e){return!!e||e===""}function qr(e){if(fe(e)){const p={};for(let C=0;C<e.length;C++){const l=e[C],t=Re(l)?As(l):qr(l);if(t)for(const D in t)p[D]=t[D]}return p}else{if(Re(e))return e;if(xe(e))return e}}const Ls=/;(?![^(]*\))/g,Ds=/:(.+)/;function As(e){const p={};return e.split(Ls).forEach(C=>{if(C){const l=C.split(Ds);l.length>1&&(p[l[0].trim()]=l[1].trim())}}),p}function en(e){let p="";if(Re(e))p=e;else if(fe(e))for(let C=0;C<e.length;C++){const l=en(e[C]);l&&(p+=l+" ")}else if(xe(e))for(const C in e)e[C]&&(p+=C+" ");return p.trim()}const Os=e=>Re(e)?e:e==null?"":fe(e)||xe(e)&&(e.toString===ui||!ce(e.toString))?JSON.stringify(e,ai,2):String(e),ai=(e,p)=>p&&p.__v_isRef?ai(e,p.value):Pt(p)?{[`Map(${p.size})`]:[...p.entries()].reduce((C,[l,t])=>(C[`${l} =>`]=t,C),{})}:oi(p)?{[`Set(${p.size})`]:[...p.values()]}:xe(p)&&!fe(p)&&!fi(p)?String(p):p,ye={},Rt=[],Ve=()=>{},Is=()=>!1,Rs=/^on[^a-z]/,fr=e=>Rs.test(e),tn=e=>e.startsWith("onUpdate:"),Ce=Object.assign,rn=(e,p)=>{const C=e.indexOf(p);C>-1&&e.splice(C,1)},Ps=Object.prototype.hasOwnProperty,ve=(e,p)=>Ps.call(e,p),fe=Array.isArray,Pt=e=>dr(e)==="[object Map]",oi=e=>dr(e)==="[object Set]",ce=e=>typeof e=="function",Re=e=>typeof e=="string",nn=e=>typeof e=="symbol",xe=e=>e!==null&&typeof e=="object",li=e=>xe(e)&&ce(e.then)&&ce(e.catch),ui=Object.prototype.toString,dr=e=>ui.call(e),Cs=e=>dr(e).slice(8,-1),fi=e=>dr(e)==="[object Object]",sn=e=>Re(e)&&e!=="NaN"&&e[0]!=="-"&&""+parseInt(e,10)===e,er=Zr(",key,ref,ref_for,ref_key,onVnodeBeforeMount,onVnodeMounted,onVnodeBeforeUpdate,onVnodeUpdated,onVnodeBeforeUnmount,onVnodeUnmounted"),cr=e=>{const p=Object.create(null);return C=>p[C]||(p[C]=e(C))},Ms=/-(\w)/g,Mt=cr(e=>e.replace(Ms,(p,C)=>C?C.toUpperCase():"")),bs=/\B([A-Z])/g,Bt=cr(e=>e.replace(bs,"-$1").toLowerCase()),di=cr(e=>e.charAt(0).toUpperCase()+e.slice(1)),Rr=cr(e=>e?`on${di(e)}`:""),jt=(e,p)=>!Object.is(e,p),Pr=(e,p)=>{for(let C=0;C<e.length;C++)e[C](p)},sr=(e,p,C)=>{Object.defineProperty(e,p,{configurable:!0,enumerable:!1,value:C})},_s=e=>{const p=parseFloat(e);return isNaN(p)?e:p};let Pn;const Fs=()=>Pn||(Pn=typeof globalThis<"u"?globalThis:typeof self<"u"?self:typeof window<"u"?window:typeof global<"u"?global:{});let Qe;class ci{constructor(p=!1){this.detached=p,this.active=!0,this.effects=[],this.cleanups=[],this.parent=Qe,!p&&Qe&&(this.index=(Qe.scopes||(Qe.scopes=[])).push(this)-1)}run(p){if(this.active){const C=Qe;try{return Qe=this,p()}finally{Qe=C}}}on(){Qe=this}off(){Qe=this.parent}stop(p){if(this.active){let C,l;for(C=0,l=this.effects.length;C<l;C++)this.effects[C].stop();for(C=0,l=this.cleanups.length;C<l;C++)this.cleanups[C]();if(this.scopes)for(C=0,l=this.scopes.length;C<l;C++)this.scopes[C].stop(!0);if(!this.detached&&this.parent&&!p){const t=this.parent.scopes.pop();t&&t!==this&&(this.parent.scopes[this.index]=t,t.index=this.index)}this.parent=void 0,this.active=!1}}}function hi(e){return new ci(e)}function Bs(e,p=Qe){p&&p.active&&p.effects.push(e)}const an=e=>{const p=new Set(e);return p.w=0,p.n=0,p},vi=e=>(e.w&dt)>0,gi=e=>(e.n&dt)>0,Us=({deps:e})=>{if(e.length)for(let p=0;p<e.length;p++)e[p].w|=dt},Ns=e=>{const{deps:p}=e;if(p.length){let C=0;for(let l=0;l<p.length;l++){const t=p[l];vi(t)&&!gi(t)?t.delete(e):p[C++]=t,t.w&=~dt,t.n&=~dt}p.length=C}},Ur=new WeakMap;let wt=0,dt=1;const Nr=30;let Ge;const St=Symbol(""),wr=Symbol("");class on{constructor(p,C=null,l){this.fn=p,this.scheduler=C,this.active=!0,this.deps=[],this.parent=void 0,Bs(this,l)}run(){if(!this.active)return this.fn();let p=Ge,C=lt;for(;p;){if(p===this)return;p=p.parent}try{return this.parent=Ge,Ge=this,lt=!0,dt=1<<++wt,wt<=Nr?Us(this):Cn(this),this.fn()}finally{wt<=Nr&&Ns(this),dt=1<<--wt,Ge=this.parent,lt=C,this.parent=void 0,this.deferStop&&this.stop()}}stop(){Ge===this?this.deferStop=!0:this.active&&(Cn(this),this.onStop&&this.onStop(),this.active=!1)}}function Cn(e){const{deps:p}=e;if(p.length){for(let C=0;C<p.length;C++)p[C].delete(e);p.length=0}}let lt=!0;const mi=[];function Ut(){mi.push(lt),lt=!1}function Nt(){const e=mi.pop();lt=e===void 0?!0:e}function Ne(e,p,C){if(lt&&Ge){let l=Ur.get(e);l||Ur.set(e,l=new Map);let t=l.get(C);t||l.set(C,t=an()),pi(t)}}function pi(e,p){let C=!1;wt<=Nr?gi(e)||(e.n|=dt,C=!vi(e)):C=!e.has(Ge),C&&(e.add(Ge),Ge.deps.push(e))}function nt(e,p,C,l,t,D){const g=Ur.get(e);if(!g)return;let E=[];if(p==="clear")E=[...g.values()];else if(C==="length"&&fe(e))g.forEach((F,_)=>{(_==="length"||_>=l)&&E.push(F)});else switch(C!==void 0&&E.push(g.get(C)),p){case"add":fe(e)?sn(C)&&E.push(g.get("length")):(E.push(g.get(St)),Pt(e)&&E.push(g.get(wr)));break;case"delete":fe(e)||(E.push(g.get(St)),Pt(e)&&E.push(g.get(wr)));break;case"set":Pt(e)&&E.push(g.get(St));break}if(E.length===1)E[0]&&kr(E[0]);else{const F=[];for(const _ of E)_&&F.push(..._);kr(an(F))}}function kr(e,p){const C=fe(e)?e:[...e];for(const l of C)l.computed&&Mn(l);for(const l of C)l.computed||Mn(l)}function Mn(e,p){(e!==Ge||e.allowRecurse)&&(e.scheduler?e.scheduler():e.run())}const ws=Zr("__proto__,__v_isRef,__isVue"),Ei=new Set(Object.getOwnPropertyNames(Symbol).filter(e=>e!=="arguments"&&e!=="caller").map(e=>Symbol[e]).filter(nn)),ks=ln(),Ks=ln(!1,!0),Ws=ln(!0),bn=js();function js(){const e={};return["includes","indexOf","lastIndexOf"].forEach(p=>{e[p]=function(...C){const l=me(this);for(let D=0,g=this.length;D<g;D++)Ne(l,"get",D+"");const t=l[p](...C);return t===-1||t===!1?l[p](...C.map(me)):t}}),["push","pop","shift","unshift","splice"].forEach(p=>{e[p]=function(...C){Ut();const l=me(this)[p].apply(this,C);return Nt(),l}}),e}function ln(e=!1,p=!1){return function(l,t,D){if(t==="__v_isReactive")return!e;if(t==="__v_isReadonly")return e;if(t==="__v_isShallow")return p;if(t==="__v_raw"&&D===(e?p?ia:Li:p?Si:xi).get(l))return l;const g=fe(l);if(!e&&g&&ve(bn,t))return Reflect.get(bn,t,D);const E=Reflect.get(l,t,D);return(nn(t)?Ei.has(t):ws(t))||(e||Ne(l,"get",t),p)?E:Se(E)?g&&sn(t)?E:E.value:xe(E)?e?Di(E):vr(E):E}}const Gs=yi(),Hs=yi(!0);function yi(e=!1){return function(C,l,t,D){let g=C[l];if(bt(g)&&Se(g)&&!Se(t))return!1;if(!e&&(!ar(t)&&!bt(t)&&(g=me(g),t=me(t)),!fe(C)&&Se(g)&&!Se(t)))return g.value=t,!0;const E=fe(C)&&sn(l)?Number(l)<C.length:ve(C,l),F=Reflect.set(C,l,t,D);return C===me(D)&&(E?jt(t,g)&&nt(C,"set",l,t):nt(C,"add",l,t)),F}}function Vs(e,p){const C=ve(e,p);e[p];const l=Reflect.deleteProperty(e,p);return l&&C&&nt(e,"delete",p,void 0),l}function Ys(e,p){const C=Reflect.has(e,p);return(!nn(p)||!Ei.has(p))&&Ne(e,"has",p),C}function zs(e){return Ne(e,"iterate",fe(e)?"length":St),Reflect.ownKeys(e)}const Ti={get:ks,set:Gs,deleteProperty:Vs,has:Ys,ownKeys:zs},$s={get:Ws,set(e,p){return!0},deleteProperty(e,p){return!0}},Xs=Ce({},Ti,{get:Ks,set:Hs}),un=e=>e,hr=e=>Reflect.getPrototypeOf(e);function Xt(e,p,C=!1,l=!1){e=e.__v_raw;const t=me(e),D=me(p);C||(p!==D&&Ne(t,"get",p),Ne(t,"get",D));const{has:g}=hr(t),E=l?un:C?cn:Gt;if(g.call(t,p))return E(e.get(p));if(g.call(t,D))return E(e.get(D));e!==t&&e.get(p)}function Qt(e,p=!1){const C=this.__v_raw,l=me(C),t=me(e);return p||(e!==t&&Ne(l,"has",e),Ne(l,"has",t)),e===t?C.has(e):C.has(e)||C.has(t)}function Jt(e,p=!1){return e=e.__v_raw,!p&&Ne(me(e),"iterate",St),Reflect.get(e,"size",e)}function _n(e){e=me(e);const p=me(this);return hr(p).has.call(p,e)||(p.add(e),nt(p,"add",e,e)),this}function Fn(e,p){p=me(p);const C=me(this),{has:l,get:t}=hr(C);let D=l.call(C,e);D||(e=me(e),D=l.call(C,e));const g=t.call(C,e);return C.set(e,p),D?jt(p,g)&&nt(C,"set",e,p):nt(C,"add",e,p),this}function Bn(e){const p=me(this),{has:C,get:l}=hr(p);let t=C.call(p,e);t||(e=me(e),t=C.call(p,e)),l&&l.call(p,e);const D=p.delete(e);return t&&nt(p,"delete",e,void 0),D}function Un(){const e=me(this),p=e.size!==0,C=e.clear();return p&&nt(e,"clear",void 0,void 0),C}function Zt(e,p){return function(l,t){const D=this,g=D.__v_raw,E=me(g),F=p?un:e?cn:Gt;return!e&&Ne(E,"iterate",St),g.forEach((_,b)=>l.call(t,F(_),F(b),D))}}function qt(e,p,C){return function(...l){const t=this.__v_raw,D=me(t),g=Pt(D),E=e==="entries"||e===Symbol.iterator&&g,F=e==="keys"&&g,_=t[e](...l),b=C?un:p?cn:Gt;return!p&&Ne(D,"iterate",F?wr:St),{next(){const{value:R,done:L}=_.next();return L?{value:R,done:L}:{value:E?[b(R[0]),b(R[1])]:b(R),done:L}},[Symbol.iterator](){return this}}}}function st(e){return function(...p){return e==="delete"?!1:this}}function Qs(){const e={get(D){return Xt(this,D)},get size(){return Jt(this)},has:Qt,add:_n,set:Fn,delete:Bn,clear:Un,forEach:Zt(!1,!1)},p={get(D){return Xt(this,D,!1,!0)},get size(){return Jt(this)},has:Qt,add:_n,set:Fn,delete:Bn,clear:Un,forEach:Zt(!1,!0)},C={get(D){return Xt(this,D,!0)},get size(){return Jt(this,!0)},has(D){return Qt.call(this,D,!0)},add:st("add"),set:st("set"),delete:st("delete"),clear:st("clear"),forEach:Zt(!0,!1)},l={get(D){return Xt(this,D,!0,!0)},get size(){return Jt(this,!0)},has(D){return Qt.call(this,D,!0)},add:st("add"),set:st("set"),delete:st("delete"),clear:st("clear"),forEach:Zt(!0,!0)};return["keys","values","entries",Symbol.iterator].forEach(D=>{e[D]=qt(D,!1,!1),C[D]=qt(D,!0,!1),p[D]=qt(D,!1,!0),l[D]=qt(D,!0,!0)}),[e,C,p,l]}const[Js,Zs,qs,ea]=Qs();function fn(e,p){const C=p?e?ea:qs:e?Zs:Js;return(l,t,D)=>t==="__v_isReactive"?!e:t==="__v_isReadonly"?e:t==="__v_raw"?l:Reflect.get(ve(C,t)&&t in l?C:l,t,D)}const ta={get:fn(!1,!1)},ra={get:fn(!1,!0)},na={get:fn(!0,!1)},xi=new WeakMap,Si=new WeakMap,Li=new WeakMap,ia=new WeakMap;function sa(e){switch(e){case"Object":case"Array":return 1;case"Map":case"Set":case"WeakMap":case"WeakSet":return 2;default:return 0}}function aa(e){return e.__v_skip||!Object.isExtensible(e)?0:sa(Cs(e))}function vr(e){return bt(e)?e:dn(e,!1,Ti,ta,xi)}function oa(e){return dn(e,!1,Xs,ra,Si)}function Di(e){return dn(e,!0,$s,na,Li)}function dn(e,p,C,l,t){if(!xe(e)||e.__v_raw&&!(p&&e.__v_isReactive))return e;const D=t.get(e);if(D)return D;const g=aa(e);if(g===0)return e;const E=new Proxy(e,g===2?l:C);return t.set(e,E),E}function ut(e){return bt(e)?ut(e.__v_raw):!!(e&&e.__v_isReactive)}function bt(e){return!!(e&&e.__v_isReadonly)}function ar(e){return!!(e&&e.__v_isShallow)}function Ai(e){return ut(e)||bt(e)}function me(e){const p=e&&e.__v_raw;return p?me(p):e}function _t(e){return sr(e,"__v_skip",!0),e}const Gt=e=>xe(e)?vr(e):e,cn=e=>xe(e)?Di(e):e;function Oi(e){lt&&Ge&&(e=me(e),pi(e.dep||(e.dep=an())))}function Ii(e,p){e=me(e),e.dep&&kr(e.dep)}function Se(e){return!!(e&&e.__v_isRef===!0)}function hn(e){return la(e,!1)}function la(e,p){return Se(e)?e:new ua(e,p)}class ua{constructor(p,C){this.__v_isShallow=C,this.dep=void 0,this.__v_isRef=!0,this._rawValue=C?p:me(p),this._value=C?p:Gt(p)}get value(){return Oi(this),this._value}set value(p){const C=this.__v_isShallow||ar(p)||bt(p);p=C?p:me(p),jt(p,this._rawValue)&&(this._rawValue=p,this._value=C?p:Gt(p),Ii(this))}}function Ze(e){return Se(e)?e.value:e}const fa={get:(e,p,C)=>Ze(Reflect.get(e,p,C)),set:(e,p,C,l)=>{const t=e[p];return Se(t)&&!Se(C)?(t.value=C,!0):Reflect.set(e,p,C,l)}};function Ri(e){return ut(e)?e:new Proxy(e,fa)}function da(e){const p=fe(e)?new Array(e.length):{};for(const C in e)p[C]=ha(e,C);return p}class ca{constructor(p,C,l){this._object=p,this._key=C,this._defaultValue=l,this.__v_isRef=!0}get value(){const p=this._object[this._key];return p===void 0?this._defaultValue:p}set value(p){this._object[this._key]=p}}function ha(e,p,C){const l=e[p];return Se(l)?l:new ca(e,p,C)}var Pi;class va{constructor(p,C,l,t){this._setter=C,this.dep=void 0,this.__v_isRef=!0,this[Pi]=!1,this._dirty=!0,this.effect=new on(p,()=>{this._dirty||(this._dirty=!0,Ii(this))}),this.effect.computed=this,this.effect.active=this._cacheable=!t,this.__v_isReadonly=l}get value(){const p=me(this);return Oi(p),(p._dirty||!p._cacheable)&&(p._dirty=!1,p._value=p.effect.run()),p._value}set value(p){this._setter(p)}}Pi="__v_isReadonly";function ga(e,p,C=!1){let l,t;const D=ce(e);return D?(l=e,t=Ve):(l=e.get,t=e.set),new va(l,t,D||!t,C)}function ft(e,p,C,l){let t;try{t=l?e(...l):e()}catch(D){gr(D,p,C)}return t}function Ke(e,p,C,l){if(ce(e)){const D=ft(e,p,C,l);return D&&li(D)&&D.catch(g=>{gr(g,p,C)}),D}const t=[];for(let D=0;D<e.length;D++)t.push(Ke(e[D],p,C,l));return t}function gr(e,p,C,l=!0){const t=p?p.vnode:null;if(p){let D=p.parent;const g=p.proxy,E=C;for(;D;){const _=D.ec;if(_){for(let b=0;b<_.length;b++)if(_[b](e,g,E)===!1)return}D=D.parent}const F=p.appContext.config.errorHandler;if(F){ft(F,null,10,[e,g,E]);return}}ma(e,C,t,l)}function ma(e,p,C,l=!0){console.error(e)}let Ht=!1,Kr=!1;const Pe=[];let qe=0;const Ct=[];let rt=null,yt=0;const Ci=Promise.resolve();let vn=null;function Mi(e){const p=vn||Ci;return e?p.then(this?e.bind(this):e):p}function pa(e){let p=qe+1,C=Pe.length;for(;p<C;){const l=p+C>>>1;Vt(Pe[l])<e?p=l+1:C=l}return p}function gn(e){(!Pe.length||!Pe.includes(e,Ht&&e.allowRecurse?qe+1:qe))&&(e.id==null?Pe.push(e):Pe.splice(pa(e.id),0,e),bi())}function bi(){!Ht&&!Kr&&(Kr=!0,vn=Ci.then(Fi))}function Ea(e){const p=Pe.indexOf(e);p>qe&&Pe.splice(p,1)}function ya(e){fe(e)?Ct.push(...e):(!rt||!rt.includes(e,e.allowRecurse?yt+1:yt))&&Ct.push(e),bi()}function Nn(e,p=Ht?qe+1:0){for(;p<Pe.length;p++){const C=Pe[p];C&&C.pre&&(Pe.splice(p,1),p--,C())}}function _i(e){if(Ct.length){const p=[...new Set(Ct)];if(Ct.length=0,rt){rt.push(...p);return}for(rt=p,rt.sort((C,l)=>Vt(C)-Vt(l)),yt=0;yt<rt.length;yt++)rt[yt]();rt=null,yt=0}}const Vt=e=>e.id==null?1/0:e.id,Ta=(e,p)=>{const C=Vt(e)-Vt(p);if(C===0){if(e.pre&&!p.pre)return-1;if(p.pre&&!e.pre)return 1}return C};function Fi(e){Kr=!1,Ht=!0,Pe.sort(Ta);const p=Ve;try{for(qe=0;qe<Pe.length;qe++){const C=Pe[qe];C&&C.active!==!1&&ft(C,null,14)}}finally{qe=0,Pe.length=0,_i(),Ht=!1,vn=null,(Pe.length||Ct.length)&&Fi()}}function xa(e,p,...C){if(e.isUnmounted)return;const l=e.vnode.props||ye;let t=C;const D=p.startsWith("update:"),g=D&&p.slice(7);if(g&&g in l){const b=`${g==="modelValue"?"model":g}Modifiers`,{number:R,trim:L}=l[b]||ye;L&&(t=C.map(I=>I.trim())),R&&(t=C.map(_s))}let E,F=l[E=Rr(p)]||l[E=Rr(Mt(p))];!F&&D&&(F=l[E=Rr(Bt(p))]),F&&Ke(F,e,6,t);const _=l[E+"Once"];if(_){if(!e.emitted)e.emitted={};else if(e.emitted[E])return;e.emitted[E]=!0,Ke(_,e,6,t)}}function Bi(e,p,C=!1){const l=p.emitsCache,t=l.get(e);if(t!==void 0)return t;const D=e.emits;let g={},E=!1;if(!ce(e)){const F=_=>{const b=Bi(_,p,!0);b&&(E=!0,Ce(g,b))};!C&&p.mixins.length&&p.mixins.forEach(F),e.extends&&F(e.extends),e.mixins&&e.mixins.forEach(F)}return!D&&!E?(xe(e)&&l.set(e,null),null):(fe(D)?D.forEach(F=>g[F]=null):Ce(g,D),xe(e)&&l.set(e,g),g)}function mr(e,p){return!e||!fr(p)?!1:(p=p.slice(2).replace(/Once$/,""),ve(e,p[0].toLowerCase()+p.slice(1))||ve(e,Bt(p))||ve(e,p))}let Fe=null,pr=null;function or(e){const p=Fe;return Fe=e,pr=e&&e.type.__scopeId||null,p}function Sa(e){pr=e}function La(){pr=null}function tr(e,p=Fe,C){if(!p||e._n)return e;const l=(...t)=>{l._d&&zn(-1);const D=or(p);let g;try{g=e(...t)}finally{or(D),l._d&&zn(1)}return g};return l._n=!0,l._c=!0,l._d=!0,l}function Cr(e){const{type:p,vnode:C,proxy:l,withProxy:t,props:D,propsOptions:[g],slots:E,attrs:F,emit:_,render:b,renderCache:R,data:L,setupState:I,ctx:A,inheritAttrs:O}=e;let S,T;const a=or(e);try{if(C.shapeFlag&4){const u=t||l;S=Je(b.call(u,u,R,D,I,L,A)),T=F}else{const u=p;S=Je(u.length>1?u(D,{attrs:F,slots:E,emit:_}):u(D,null)),T=p.props?F:Da(F)}}catch(u){Kt.length=0,gr(u,e,1),S=Oe(We)}let r=S;if(T&&O!==!1){const u=Object.keys(T),{shapeFlag:h}=r;u.length&&h&7&&(g&&u.some(tn)&&(T=Aa(T,g)),r=ct(r,T))}return C.dirs&&(r=ct(r),r.dirs=r.dirs?r.dirs.concat(C.dirs):C.dirs),C.transition&&(r.transition=C.transition),S=r,or(a),S}const Da=e=>{let p;for(const C in e)(C==="class"||C==="style"||fr(C))&&((p||(p={}))[C]=e[C]);return p},Aa=(e,p)=>{const C={};for(const l in e)(!tn(l)||!(l.slice(9)in p))&&(C[l]=e[l]);return C};function Oa(e,p,C){const{props:l,children:t,component:D}=e,{props:g,children:E,patchFlag:F}=p,_=D.emitsOptions;if(p.dirs||p.transition)return!0;if(C&&F>=0){if(F&1024)return!0;if(F&16)return l?wn(l,g,_):!!g;if(F&8){const b=p.dynamicProps;for(let R=0;R<b.length;R++){const L=b[R];if(g[L]!==l[L]&&!mr(_,L))return!0}}}else return(t||E)&&(!E||!E.$stable)?!0:l===g?!1:l?g?wn(l,g,_):!0:!!g;return!1}function wn(e,p,C){const l=Object.keys(p);if(l.length!==Object.keys(e).length)return!0;for(let t=0;t<l.length;t++){const D=l[t];if(p[D]!==e[D]&&!mr(C,D))return!0}return!1}function Ia({vnode:e,parent:p},C){for(;p&&p.subTree===e;)(e=p.vnode).el=C,p=p.parent}const Ra=e=>e.__isSuspense;function Pa(e,p){p&&p.pendingBranch?fe(e)?p.effects.push(...e):p.effects.push(e):ya(e)}function Ca(e,p){if(Ie){let C=Ie.provides;const l=Ie.parent&&Ie.parent.provides;l===C&&(C=Ie.provides=Object.create(l)),C[e]=p}}function rr(e,p,C=!1){const l=Ie||Fe;if(l){const t=l.parent==null?l.vnode.appContext&&l.vnode.appContext.provides:l.parent.provides;if(t&&e in t)return t[e];if(arguments.length>1)return C&&ce(p)?p.call(l.proxy):p}}const kn={};function nr(e,p,C){return Ui(e,p,C)}function Ui(e,p,{immediate:C,deep:l,flush:t,onTrack:D,onTrigger:g}=ye){const E=Ie;let F,_=!1,b=!1;if(Se(e)?(F=()=>e.value,_=ar(e)):ut(e)?(F=()=>e,l=!0):fe(e)?(b=!0,_=e.some(T=>ut(T)||ar(T)),F=()=>e.map(T=>{if(Se(T))return T.value;if(ut(T))return It(T);if(ce(T))return ft(T,E,2)})):ce(e)?p?F=()=>ft(e,E,2):F=()=>{if(!(E&&E.isUnmounted))return R&&R(),Ke(e,E,3,[L])}:F=Ve,p&&l){const T=F;F=()=>It(T())}let R,L=T=>{R=S.onStop=()=>{ft(T,E,4)}};if(zt)return L=Ve,p?C&&Ke(p,E,3,[F(),b?[]:void 0,L]):F(),Ve;let I=b?[]:kn;const A=()=>{if(!!S.active)if(p){const T=S.run();(l||_||(b?T.some((a,r)=>jt(a,I[r])):jt(T,I)))&&(R&&R(),Ke(p,E,3,[T,I===kn?void 0:I,L]),I=T)}else S.run()};A.allowRecurse=!!p;let O;t==="sync"?O=A:t==="post"?O=()=>be(A,E&&E.suspense):(A.pre=!0,E&&(A.id=E.uid),O=()=>gn(A));const S=new on(F,O);return p?C?A():I=S.run():t==="post"?be(S.run.bind(S),E&&E.suspense):S.run(),()=>{S.stop(),E&&E.scope&&rn(E.scope.effects,S)}}function Ma(e,p,C){const l=this.proxy,t=Re(e)?e.includes(".")?Ni(l,e):()=>l[e]:e.bind(l,l);let D;ce(p)?D=p:(D=p.handler,C=p);const g=Ie;Ft(this);const E=Ui(t,D.bind(l),C);return g?Ft(g):Lt(),E}function Ni(e,p){const C=p.split(".");return()=>{let l=e;for(let t=0;t<C.length&&l;t++)l=l[C[t]];return l}}function It(e,p){if(!xe(e)||e.__v_skip||(p=p||new Set,p.has(e)))return e;if(p.add(e),Se(e))It(e.value,p);else if(fe(e))for(let C=0;C<e.length;C++)It(e[C],p);else if(oi(e)||Pt(e))e.forEach(C=>{It(C,p)});else if(fi(e))for(const C in e)It(e[C],p);return e}function ba(){const e={isMounted:!1,isLeaving:!1,isUnmounting:!1,leavingVNodes:new Map};return Tr(()=>{e.isMounted=!0}),Wi(()=>{e.isUnmounting=!0}),e}const ke=[Function,Array],_a={name:"BaseTransition",props:{mode:String,appear:Boolean,persisted:Boolean,onBeforeEnter:ke,onEnter:ke,onAfterEnter:ke,onEnterCancelled:ke,onBeforeLeave:ke,onLeave:ke,onAfterLeave:ke,onLeaveCancelled:ke,onBeforeAppear:ke,onAppear:ke,onAfterAppear:ke,onAppearCancelled:ke},setup(e,{slots:p}){const C=Sn(),l=ba();let t;return()=>{const D=p.default&&ki(p.default(),!0);if(!D||!D.length)return;let g=D[0];if(D.length>1){for(const O of D)if(O.type!==We){g=O;break}}const E=me(e),{mode:F}=E;if(l.isLeaving)return Mr(g);const _=Kn(g);if(!_)return Mr(g);const b=Wr(_,E,l,C);jr(_,b);const R=C.subTree,L=R&&Kn(R);let I=!1;const{getTransitionKey:A}=_.type;if(A){const O=A();t===void 0?t=O:O!==t&&(t=O,I=!0)}if(L&&L.type!==We&&(!Tt(_,L)||I)){const O=Wr(L,E,l,C);if(jr(L,O),F==="out-in")return l.isLeaving=!0,O.afterLeave=()=>{l.isLeaving=!1,C.update()},Mr(g);F==="in-out"&&_.type!==We&&(O.delayLeave=(S,T,a)=>{const r=wi(l,L);r[String(L.key)]=L,S._leaveCb=()=>{T(),S._leaveCb=void 0,delete b.delayedLeave},b.delayedLeave=a})}return g}}},Fa=_a;function wi(e,p){const{leavingVNodes:C}=e;let l=C.get(p.type);return l||(l=Object.create(null),C.set(p.type,l)),l}function Wr(e,p,C,l){const{appear:t,mode:D,persisted:g=!1,onBeforeEnter:E,onEnter:F,onAfterEnter:_,onEnterCancelled:b,onBeforeLeave:R,onLeave:L,onAfterLeave:I,onLeaveCancelled:A,onBeforeAppear:O,onAppear:S,onAfterAppear:T,onAppearCancelled:a}=p,r=String(e.key),u=wi(C,e),h=(n,i)=>{n&&Ke(n,l,9,i)},y=(n,i)=>{const m=i[1];h(n,i),fe(n)?n.every(o=>o.length<=1)&&m():n.length<=1&&m()},s={mode:D,persisted:g,beforeEnter(n){let i=E;if(!C.isMounted)if(t)i=O||E;else return;n._leaveCb&&n._leaveCb(!0);const m=u[r];m&&Tt(e,m)&&m.el._leaveCb&&m.el._leaveCb(),h(i,[n])},enter(n){let i=F,m=_,o=b;if(!C.isMounted)if(t)i=S||F,m=T||_,o=a||b;else return;let f=!1;const v=n._enterCb=c=>{f||(f=!0,c?h(o,[n]):h(m,[n]),s.delayedLeave&&s.delayedLeave(),n._enterCb=void 0)};i?y(i,[n,v]):v()},leave(n,i){const m=String(e.key);if(n._enterCb&&n._enterCb(!0),C.isUnmounting)return i();h(R,[n]);let o=!1;const f=n._leaveCb=v=>{o||(o=!0,i(),v?h(A,[n]):h(I,[n]),n._leaveCb=void 0,u[m]===e&&delete u[m])};u[m]=e,L?y(L,[n,f]):f()},clone(n){return Wr(n,p,C,l)}};return s}function Mr(e){if(Er(e))return e=ct(e),e.children=null,e}function Kn(e){return Er(e)?e.children?e.children[0]:void 0:e}function jr(e,p){e.shapeFlag&6&&e.component?jr(e.component.subTree,p):e.shapeFlag&128?(e.ssContent.transition=p.clone(e.ssContent),e.ssFallback.transition=p.clone(e.ssFallback)):e.transition=p}function ki(e,p=!1,C){let l=[],t=0;for(let D=0;D<e.length;D++){let g=e[D];const E=C==null?g.key:String(C)+String(g.key!=null?g.key:D);g.type===_e?(g.patchFlag&128&&t++,l=l.concat(ki(g.children,p,E))):(p||g.type!==We)&&l.push(E!=null?ct(g,{key:E}):g)}if(t>1)for(let D=0;D<l.length;D++)l[D].patchFlag=-2;return l}const kt=e=>!!e.type.__asyncLoader,Er=e=>e.type.__isKeepAlive;function Ba(e,p){Ki(e,"a",p)}function Ua(e,p){Ki(e,"da",p)}function Ki(e,p,C=Ie){const l=e.__wdc||(e.__wdc=()=>{let t=C;for(;t;){if(t.isDeactivated)return;t=t.parent}return e()});if(yr(p,l,C),C){let t=C.parent;for(;t&&t.parent;)Er(t.parent.vnode)&&Na(l,p,C,t),t=t.parent}}function Na(e,p,C,l){const t=yr(p,e,l,!0);mn(()=>{rn(l[p],t)},C)}function yr(e,p,C=Ie,l=!1){if(C){const t=C[e]||(C[e]=[]),D=p.__weh||(p.__weh=(...g)=>{if(C.isUnmounted)return;Ut(),Ft(C);const E=Ke(p,C,e,g);return Lt(),Nt(),E});return l?t.unshift(D):t.push(D),D}}const it=e=>(p,C=Ie)=>(!zt||e==="sp")&&yr(e,(...l)=>p(...l),C),wa=it("bm"),Tr=it("m"),ka=it("bu"),Ka=it("u"),Wi=it("bum"),mn=it("um"),Wa=it("sp"),ja=it("rtg"),Ga=it("rtc");function Ha(e,p=Ie){yr("ec",e,p)}function mt(e,p,C,l){const t=e.dirs,D=p&&p.dirs;for(let g=0;g<t.length;g++){const E=t[g];D&&(E.oldValue=D[g].value);let F=E.dir[l];F&&(Ut(),Ke(F,C,8,[e.el,E,e,p]),Nt())}}const Va=Symbol();function Ya(e,p,C={},l,t){if(Fe.isCE||Fe.parent&&kt(Fe.parent)&&Fe.parent.isCE)return Oe("slot",p==="default"?null:{name:p},l&&l());let D=e[p];D&&D._c&&(D._d=!1),Be();const g=D&&ji(D(C)),E=Tn(_e,{key:C.key||g&&g.key||`_${p}`},g||(l?l():[]),g&&e._===1?64:-2);return!t&&E.scopeId&&(E.slotScopeIds=[E.scopeId+"-s"]),D&&D._c&&(D._d=!0),E}function ji(e){return e.some(p=>Zi(p)?!(p.type===We||p.type===_e&&!ji(p.children)):!0)?e:null}const Gr=e=>e?es(e)?Ln(e)||e.proxy:Gr(e.parent):null,lr=Ce(Object.create(null),{$:e=>e,$el:e=>e.vnode.el,$data:e=>e.data,$props:e=>e.props,$attrs:e=>e.attrs,$slots:e=>e.slots,$refs:e=>e.refs,$parent:e=>Gr(e.parent),$root:e=>Gr(e.root),$emit:e=>e.emit,$options:e=>pn(e),$forceUpdate:e=>e.f||(e.f=()=>gn(e.update)),$nextTick:e=>e.n||(e.n=Mi.bind(e.proxy)),$watch:e=>Ma.bind(e)}),za={get({_:e},p){const{ctx:C,setupState:l,data:t,props:D,accessCache:g,type:E,appContext:F}=e;let _;if(p[0]!=="$"){const I=g[p];if(I!==void 0)switch(I){case 1:return l[p];case 2:return t[p];case 4:return C[p];case 3:return D[p]}else{if(l!==ye&&ve(l,p))return g[p]=1,l[p];if(t!==ye&&ve(t,p))return g[p]=2,t[p];if((_=e.propsOptions[0])&&ve(_,p))return g[p]=3,D[p];if(C!==ye&&ve(C,p))return g[p]=4,C[p];Hr&&(g[p]=0)}}const b=lr[p];let R,L;if(b)return p==="$attrs"&&Ne(e,"get",p),b(e);if((R=E.__cssModules)&&(R=R[p]))return R;if(C!==ye&&ve(C,p))return g[p]=4,C[p];if(L=F.config.globalProperties,ve(L,p))return L[p]},set({_:e},p,C){const{data:l,setupState:t,ctx:D}=e;return t!==ye&&ve(t,p)?(t[p]=C,!0):l!==ye&&ve(l,p)?(l[p]=C,!0):ve(e.props,p)||p[0]==="$"&&p.slice(1)in e?!1:(D[p]=C,!0)},has({_:{data:e,setupState:p,accessCache:C,ctx:l,appContext:t,propsOptions:D}},g){let E;return!!C[g]||e!==ye&&ve(e,g)||p!==ye&&ve(p,g)||(E=D[0])&&ve(E,g)||ve(l,g)||ve(lr,g)||ve(t.config.globalProperties,g)},defineProperty(e,p,C){return C.get!=null?e._.accessCache[p]=0:ve(C,"value")&&this.set(e,p,C.value,null),Reflect.defineProperty(e,p,C)}};let Hr=!0;function $a(e){const p=pn(e),C=e.proxy,l=e.ctx;Hr=!1,p.beforeCreate&&Wn(p.beforeCreate,e,"bc");const{data:t,computed:D,methods:g,watch:E,provide:F,inject:_,created:b,beforeMount:R,mounted:L,beforeUpdate:I,updated:A,activated:O,deactivated:S,beforeDestroy:T,beforeUnmount:a,destroyed:r,unmounted:u,render:h,renderTracked:y,renderTriggered:s,errorCaptured:n,serverPrefetch:i,expose:m,inheritAttrs:o,components:f,directives:v,filters:c}=p;if(_&&Xa(_,l,null,e.appContext.config.unwrapInjectedRef),g)for(const P in g){const M=g[P];ce(M)&&(l[P]=M.bind(C))}if(t){const P=t.call(C,C);xe(P)&&(e.data=vr(P))}if(Hr=!0,D)for(const P in D){const M=D[P],B=ce(M)?M.bind(C,C):ce(M.get)?M.get.bind(C,C):Ve,N=!ce(M)&&ce(M.set)?M.set.bind(C):Ve,U=rs({get:B,set:N});Object.defineProperty(l,P,{enumerable:!0,configurable:!0,get:()=>U.value,set:w=>U.value=w})}if(E)for(const P in E)Gi(E[P],l,C,P);if(F){const P=ce(F)?F.call(C):F;Reflect.ownKeys(P).forEach(M=>{Ca(M,P[M])})}b&&Wn(b,e,"c");function x(P,M){fe(M)?M.forEach(B=>P(B.bind(C))):M&&P(M.bind(C))}if(x(wa,R),x(Tr,L),x(ka,I),x(Ka,A),x(Ba,O),x(Ua,S),x(Ha,n),x(Ga,y),x(ja,s),x(Wi,a),x(mn,u),x(Wa,i),fe(m))if(m.length){const P=e.exposed||(e.exposed={});m.forEach(M=>{Object.defineProperty(P,M,{get:()=>C[M],set:B=>C[M]=B})})}else e.exposed||(e.exposed={});h&&e.render===Ve&&(e.render=h),o!=null&&(e.inheritAttrs=o),f&&(e.components=f),v&&(e.directives=v)}function Xa(e,p,C=Ve,l=!1){fe(e)&&(e=Vr(e));for(const t in e){const D=e[t];let g;xe(D)?"default"in D?g=rr(D.from||t,D.default,!0):g=rr(D.from||t):g=rr(D),Se(g)&&l?Object.defineProperty(p,t,{enumerable:!0,configurable:!0,get:()=>g.value,set:E=>g.value=E}):p[t]=g}}function Wn(e,p,C){Ke(fe(e)?e.map(l=>l.bind(p.proxy)):e.bind(p.proxy),p,C)}function Gi(e,p,C,l){const t=l.includes(".")?Ni(C,l):()=>C[l];if(Re(e)){const D=p[e];ce(D)&&nr(t,D)}else if(ce(e))nr(t,e.bind(C));else if(xe(e))if(fe(e))e.forEach(D=>Gi(D,p,C,l));else{const D=ce(e.handler)?e.handler.bind(C):p[e.handler];ce(D)&&nr(t,D,e)}}function pn(e){const p=e.type,{mixins:C,extends:l}=p,{mixins:t,optionsCache:D,config:{optionMergeStrategies:g}}=e.appContext,E=D.get(p);let F;return E?F=E:!t.length&&!C&&!l?F=p:(F={},t.length&&t.forEach(_=>ur(F,_,g,!0)),ur(F,p,g)),xe(p)&&D.set(p,F),F}function ur(e,p,C,l=!1){const{mixins:t,extends:D}=p;D&&ur(e,D,C,!0),t&&t.forEach(g=>ur(e,g,C,!0));for(const g in p)if(!(l&&g==="expose")){const E=Qa[g]||C&&C[g];e[g]=E?E(e[g],p[g]):p[g]}return e}const Qa={data:jn,props:Et,emits:Et,methods:Et,computed:Et,beforeCreate:Me,created:Me,beforeMount:Me,mounted:Me,beforeUpdate:Me,updated:Me,beforeDestroy:Me,beforeUnmount:Me,destroyed:Me,unmounted:Me,activated:Me,deactivated:Me,errorCaptured:Me,serverPrefetch:Me,components:Et,directives:Et,watch:Za,provide:jn,inject:Ja};function jn(e,p){return p?e?function(){return Ce(ce(e)?e.call(this,this):e,ce(p)?p.call(this,this):p)}:p:e}function Ja(e,p){return Et(Vr(e),Vr(p))}function Vr(e){if(fe(e)){const p={};for(let C=0;C<e.length;C++)p[e[C]]=e[C];return p}return e}function Me(e,p){return e?[...new Set([].concat(e,p))]:p}function Et(e,p){return e?Ce(Ce(Object.create(null),e),p):p}function Za(e,p){if(!e)return p;if(!p)return e;const C=Ce(Object.create(null),e);for(const l in p)C[l]=Me(e[l],p[l]);return C}function qa(e,p,C,l=!1){const t={},D={};sr(D,xr,1),e.propsDefaults=Object.create(null),Hi(e,p,t,D);for(const g in e.propsOptions[0])g in t||(t[g]=void 0);C?e.props=l?t:oa(t):e.type.props?e.props=t:e.props=D,e.attrs=D}function eo(e,p,C,l){const{props:t,attrs:D,vnode:{patchFlag:g}}=e,E=me(t),[F]=e.propsOptions;let _=!1;if((l||g>0)&&!(g&16)){if(g&8){const b=e.vnode.dynamicProps;for(let R=0;R<b.length;R++){let L=b[R];if(mr(e.emitsOptions,L))continue;const I=p[L];if(F)if(ve(D,L))I!==D[L]&&(D[L]=I,_=!0);else{const A=Mt(L);t[A]=Yr(F,E,A,I,e,!1)}else I!==D[L]&&(D[L]=I,_=!0)}}}else{Hi(e,p,t,D)&&(_=!0);let b;for(const R in E)(!p||!ve(p,R)&&((b=Bt(R))===R||!ve(p,b)))&&(F?C&&(C[R]!==void 0||C[b]!==void 0)&&(t[R]=Yr(F,E,R,void 0,e,!0)):delete t[R]);if(D!==E)for(const R in D)(!p||!ve(p,R)&&!0)&&(delete D[R],_=!0)}_&&nt(e,"set","$attrs")}function Hi(e,p,C,l){const[t,D]=e.propsOptions;let g=!1,E;if(p)for(let F in p){if(er(F))continue;const _=p[F];let b;t&&ve(t,b=Mt(F))?!D||!D.includes(b)?C[b]=_:(E||(E={}))[b]=_:mr(e.emitsOptions,F)||(!(F in l)||_!==l[F])&&(l[F]=_,g=!0)}if(D){const F=me(C),_=E||ye;for(let b=0;b<D.length;b++){const R=D[b];C[R]=Yr(t,F,R,_[R],e,!ve(_,R))}}return g}function Yr(e,p,C,l,t,D){const g=e[C];if(g!=null){const E=ve(g,"default");if(E&&l===void 0){const F=g.default;if(g.type!==Function&&ce(F)){const{propsDefaults:_}=t;C in _?l=_[C]:(Ft(t),l=_[C]=F.call(null,p),Lt())}else l=F}g[0]&&(D&&!E?l=!1:g[1]&&(l===""||l===Bt(C))&&(l=!0))}return l}function Vi(e,p,C=!1){const l=p.propsCache,t=l.get(e);if(t)return t;const D=e.props,g={},E=[];let F=!1;if(!ce(e)){const b=R=>{F=!0;const[L,I]=Vi(R,p,!0);Ce(g,L),I&&E.push(...I)};!C&&p.mixins.length&&p.mixins.forEach(b),e.extends&&b(e.extends),e.mixins&&e.mixins.forEach(b)}if(!D&&!F)return xe(e)&&l.set(e,Rt),Rt;if(fe(D))for(let b=0;b<D.length;b++){const R=Mt(D[b]);Gn(R)&&(g[R]=ye)}else if(D)for(const b in D){const R=Mt(b);if(Gn(R)){const L=D[b],I=g[R]=fe(L)||ce(L)?{type:L}:L;if(I){const A=Yn(Boolean,I.type),O=Yn(String,I.type);I[0]=A>-1,I[1]=O<0||A<O,(A>-1||ve(I,"default"))&&E.push(R)}}}const _=[g,E];return xe(e)&&l.set(e,_),_}function Gn(e){return e[0]!=="$"}function Hn(e){const p=e&&e.toString().match(/^\s*function (\w+)/);return p?p[1]:e===null?"null":""}function Vn(e,p){return Hn(e)===Hn(p)}function Yn(e,p){return fe(p)?p.findIndex(C=>Vn(C,e)):ce(p)&&Vn(p,e)?0:-1}const Yi=e=>e[0]==="_"||e==="$stable",En=e=>fe(e)?e.map(Je):[Je(e)],to=(e,p,C)=>{if(p._n)return p;const l=tr((...t)=>En(p(...t)),C);return l._c=!1,l},zi=(e,p,C)=>{const l=e._ctx;for(const t in e){if(Yi(t))continue;const D=e[t];if(ce(D))p[t]=to(t,D,l);else if(D!=null){const g=En(D);p[t]=()=>g}}},$i=(e,p)=>{const C=En(p);e.slots.default=()=>C},ro=(e,p)=>{if(e.vnode.shapeFlag&32){const C=p._;C?(e.slots=me(p),sr(p,"_",C)):zi(p,e.slots={})}else e.slots={},p&&$i(e,p);sr(e.slots,xr,1)},no=(e,p,C)=>{const{vnode:l,slots:t}=e;let D=!0,g=ye;if(l.shapeFlag&32){const E=p._;E?C&&E===1?D=!1:(Ce(t,p),!C&&E===1&&delete t._):(D=!p.$stable,zi(p,t)),g=p}else p&&($i(e,p),g={default:1});if(D)for(const E in t)!Yi(E)&&!(E in g)&&delete t[E]};function Xi(){return{app:null,config:{isNativeTag:Is,performance:!1,globalProperties:{},optionMergeStrategies:{},errorHandler:void 0,warnHandler:void 0,compilerOptions:{}},mixins:[],components:{},directives:{},provides:Object.create(null),optionsCache:new WeakMap,propsCache:new WeakMap,emitsCache:new WeakMap}}let io=0;function so(e,p){return function(l,t=null){ce(l)||(l=Object.assign({},l)),t!=null&&!xe(t)&&(t=null);const D=Xi(),g=new Set;let E=!1;const F=D.app={_uid:io++,_component:l,_props:t,_container:null,_context:D,_instance:null,version:Ao,get config(){return D.config},set config(_){},use(_,...b){return g.has(_)||(_&&ce(_.install)?(g.add(_),_.install(F,...b)):ce(_)&&(g.add(_),_(F,...b))),F},mixin(_){return D.mixins.includes(_)||D.mixins.push(_),F},component(_,b){return b?(D.components[_]=b,F):D.components[_]},directive(_,b){return b?(D.directives[_]=b,F):D.directives[_]},mount(_,b,R){if(!E){const L=Oe(l,t);return L.appContext=D,b&&p?p(L,_):e(L,_,R),E=!0,F._container=_,_.__vue_app__=F,Ln(L.component)||L.component.proxy}},unmount(){E&&(e(null,F._container),delete F._container.__vue_app__)},provide(_,b){return D.provides[_]=b,F}};return F}}function zr(e,p,C,l,t=!1){if(fe(e)){e.forEach((L,I)=>zr(L,p&&(fe(p)?p[I]:p),C,l,t));return}if(kt(l)&&!t)return;const D=l.shapeFlag&4?Ln(l.component)||l.component.proxy:l.el,g=t?null:D,{i:E,r:F}=e,_=p&&p.r,b=E.refs===ye?E.refs={}:E.refs,R=E.setupState;if(_!=null&&_!==F&&(Re(_)?(b[_]=null,ve(R,_)&&(R[_]=null)):Se(_)&&(_.value=null)),ce(F))ft(F,E,12,[g,b]);else{const L=Re(F),I=Se(F);if(L||I){const A=()=>{if(e.f){const O=L?ve(R,F)?R[F]:b[F]:F.value;t?fe(O)&&rn(O,D):fe(O)?O.includes(D)||O.push(D):L?(b[F]=[D],ve(R,F)&&(R[F]=b[F])):(F.value=[D],e.k&&(b[e.k]=F.value))}else L?(b[F]=g,ve(R,F)&&(R[F]=g)):I&&(F.value=g,e.k&&(b[e.k]=g))};g?(A.id=-1,be(A,C)):A()}}}const be=Pa;function ao(e){return oo(e)}function oo(e,p){const C=Fs();C.__VUE__=!0;const{insert:l,remove:t,patchProp:D,createElement:g,createText:E,createComment:F,setText:_,setElementText:b,parentNode:R,nextSibling:L,setScopeId:I=Ve,insertStaticContent:A}=e,O=(k,K,V,Y=null,z=null,Q=null,Z=!1,J=null,ee=!!K.dynamicChildren)=>{if(k===K)return;k&&!Tt(k,K)&&(Y=$(k),w(k,z,Q,!0),k=null),K.patchFlag===-2&&(ee=!1,K.dynamicChildren=null);const{type:X,ref:se,shapeFlag:re}=K;switch(X){case yn:S(k,K,V,Y);break;case We:T(k,K,V,Y);break;case br:k==null&&a(K,V,Y,Z);break;case _e:f(k,K,V,Y,z,Q,Z,J,ee);break;default:re&1?h(k,K,V,Y,z,Q,Z,J,ee):re&6?v(k,K,V,Y,z,Q,Z,J,ee):(re&64||re&128)&&X.process(k,K,V,Y,z,Q,Z,J,ee,q)}se!=null&&z&&zr(se,k&&k.ref,Q,K||k,!K)},S=(k,K,V,Y)=>{if(k==null)l(K.el=E(K.children),V,Y);else{const z=K.el=k.el;K.children!==k.children&&_(z,K.children)}},T=(k,K,V,Y)=>{k==null?l(K.el=F(K.children||""),V,Y):K.el=k.el},a=(k,K,V,Y)=>{[k.el,k.anchor]=A(k.children,K,V,Y,k.el,k.anchor)},r=({el:k,anchor:K},V,Y)=>{let z;for(;k&&k!==K;)z=L(k),l(k,V,Y),k=z;l(K,V,Y)},u=({el:k,anchor:K})=>{let V;for(;k&&k!==K;)V=L(k),t(k),k=V;t(K)},h=(k,K,V,Y,z,Q,Z,J,ee)=>{Z=Z||K.type==="svg",k==null?y(K,V,Y,z,Q,Z,J,ee):i(k,K,z,Q,Z,J,ee)},y=(k,K,V,Y,z,Q,Z,J)=>{let ee,X;const{type:se,props:re,shapeFlag:ie,transition:ae,dirs:le}=k;if(ee=k.el=g(k.type,Q,re&&re.is,re),ie&8?b(ee,k.children):ie&16&&n(k.children,ee,null,Y,z,Q&&se!=="foreignObject",Z,J),le&&mt(k,null,Y,"created"),re){for(const ue in re)ue!=="value"&&!er(ue)&&D(ee,ue,null,re[ue],Q,k.children,Y,z,H);"value"in re&&D(ee,"value",null,re.value),(X=re.onVnodeBeforeMount)&&Xe(X,Y,k)}s(ee,k,k.scopeId,Z,Y),le&&mt(k,null,Y,"beforeMount");const de=(!z||z&&!z.pendingBranch)&&ae&&!ae.persisted;de&&ae.beforeEnter(ee),l(ee,K,V),((X=re&&re.onVnodeMounted)||de||le)&&be(()=>{X&&Xe(X,Y,k),de&&ae.enter(ee),le&&mt(k,null,Y,"mounted")},z)},s=(k,K,V,Y,z)=>{if(V&&I(k,V),Y)for(let Q=0;Q<Y.length;Q++)I(k,Y[Q]);if(z){let Q=z.subTree;if(K===Q){const Z=z.vnode;s(k,Z,Z.scopeId,Z.slotScopeIds,z.parent)}}},n=(k,K,V,Y,z,Q,Z,J,ee=0)=>{for(let X=ee;X<k.length;X++){const se=k[X]=J?at(k[X]):Je(k[X]);O(null,se,K,V,Y,z,Q,Z,J)}},i=(k,K,V,Y,z,Q,Z)=>{const J=K.el=k.el;let{patchFlag:ee,dynamicChildren:X,dirs:se}=K;ee|=k.patchFlag&16;const re=k.props||ye,ie=K.props||ye;let ae;V&&pt(V,!1),(ae=ie.onVnodeBeforeUpdate)&&Xe(ae,V,K,k),se&&mt(K,k,V,"beforeUpdate"),V&&pt(V,!0);const le=z&&K.type!=="foreignObject";if(X?m(k.dynamicChildren,X,J,V,Y,le,Q):Z||M(k,K,J,null,V,Y,le,Q,!1),ee>0){if(ee&16)o(J,K,re,ie,V,Y,z);else if(ee&2&&re.class!==ie.class&&D(J,"class",null,ie.class,z),ee&4&&D(J,"style",re.style,ie.style,z),ee&8){const de=K.dynamicProps;for(let ue=0;ue<de.length;ue++){const he=de[ue],Te=re[he],Le=ie[he];(Le!==Te||he==="value")&&D(J,he,Te,Le,z,k.children,V,Y,H)}}ee&1&&k.children!==K.children&&b(J,K.children)}else!Z&&X==null&&o(J,K,re,ie,V,Y,z);((ae=ie.onVnodeUpdated)||se)&&be(()=>{ae&&Xe(ae,V,K,k),se&&mt(K,k,V,"updated")},Y)},m=(k,K,V,Y,z,Q,Z)=>{for(let J=0;J<K.length;J++){const ee=k[J],X=K[J],se=ee.el&&(ee.type===_e||!Tt(ee,X)||ee.shapeFlag&70)?R(ee.el):V;O(ee,X,se,null,Y,z,Q,Z,!0)}},o=(k,K,V,Y,z,Q,Z)=>{if(V!==Y){if(V!==ye)for(const J in V)!er(J)&&!(J in Y)&&D(k,J,V[J],null,Z,K.children,z,Q,H);for(const J in Y){if(er(J))continue;const ee=Y[J],X=V[J];ee!==X&&J!=="value"&&D(k,J,X,ee,Z,K.children,z,Q,H)}"value"in Y&&D(k,"value",V.value,Y.value)}},f=(k,K,V,Y,z,Q,Z,J,ee)=>{const X=K.el=k?k.el:E(""),se=K.anchor=k?k.anchor:E("");let{patchFlag:re,dynamicChildren:ie,slotScopeIds:ae}=K;ae&&(J=J?J.concat(ae):ae),k==null?(l(X,V,Y),l(se,V,Y),n(K.children,V,se,z,Q,Z,J,ee)):re>0&&re&64&&ie&&k.dynamicChildren?(m(k.dynamicChildren,ie,V,z,Q,Z,J),(K.key!=null||z&&K===z.subTree)&&Qi(k,K,!0)):M(k,K,V,se,z,Q,Z,J,ee)},v=(k,K,V,Y,z,Q,Z,J,ee)=>{K.slotScopeIds=J,k==null?K.shapeFlag&512?z.ctx.activate(K,V,Y,Z,ee):c(K,V,Y,z,Q,Z,ee):d(k,K,ee)},c=(k,K,V,Y,z,Q,Z)=>{const J=k.component=yo(k,Y,z);if(Er(k)&&(J.ctx.renderer=q),To(J),J.asyncDep){if(z&&z.registerDep(J,x),!k.el){const ee=J.subTree=Oe(We);T(null,ee,K,V)}return}x(J,k,K,V,z,Q,Z)},d=(k,K,V)=>{const Y=K.component=k.component;if(Oa(k,K,V))if(Y.asyncDep&&!Y.asyncResolved){P(Y,K,V);return}else Y.next=K,Ea(Y.update),Y.update();else K.el=k.el,Y.vnode=K},x=(k,K,V,Y,z,Q,Z)=>{const J=()=>{if(k.isMounted){let{next:se,bu:re,u:ie,parent:ae,vnode:le}=k,de=se,ue;pt(k,!1),se?(se.el=le.el,P(k,se,Z)):se=le,re&&Pr(re),(ue=se.props&&se.props.onVnodeBeforeUpdate)&&Xe(ue,ae,se,le),pt(k,!0);const he=Cr(k),Te=k.subTree;k.subTree=he,O(Te,he,R(Te.el),$(Te),k,z,Q),se.el=he.el,de===null&&Ia(k,he.el),ie&&be(ie,z),(ue=se.props&&se.props.onVnodeUpdated)&&be(()=>Xe(ue,ae,se,le),z)}else{let se;const{el:re,props:ie}=K,{bm:ae,m:le,parent:de}=k,ue=kt(K);if(pt(k,!1),ae&&Pr(ae),!ue&&(se=ie&&ie.onVnodeBeforeMount)&&Xe(se,de,K),pt(k,!0),re&&oe){const he=()=>{k.subTree=Cr(k),oe(re,k.subTree,k,z,null)};ue?K.type.__asyncLoader().then(()=>!k.isUnmounted&&he()):he()}else{const he=k.subTree=Cr(k);O(null,he,V,Y,k,z,Q),K.el=he.el}if(le&&be(le,z),!ue&&(se=ie&&ie.onVnodeMounted)){const he=K;be(()=>Xe(se,de,he),z)}(K.shapeFlag&256||de&&kt(de.vnode)&&de.vnode.shapeFlag&256)&&k.a&&be(k.a,z),k.isMounted=!0,K=V=Y=null}},ee=k.effect=new on(J,()=>gn(X),k.scope),X=k.update=()=>ee.run();X.id=k.uid,pt(k,!0),X()},P=(k,K,V)=>{K.component=k;const Y=k.vnode.props;k.vnode=K,k.next=null,eo(k,K.props,Y,V),no(k,K.children,V),Ut(),Nn(),Nt()},M=(k,K,V,Y,z,Q,Z,J,ee=!1)=>{const X=k&&k.children,se=k?k.shapeFlag:0,re=K.children,{patchFlag:ie,shapeFlag:ae}=K;if(ie>0){if(ie&128){N(X,re,V,Y,z,Q,Z,J,ee);return}else if(ie&256){B(X,re,V,Y,z,Q,Z,J,ee);return}}ae&8?(se&16&&H(X,z,Q),re!==X&&b(V,re)):se&16?ae&16?N(X,re,V,Y,z,Q,Z,J,ee):H(X,z,Q,!0):(se&8&&b(V,""),ae&16&&n(re,V,Y,z,Q,Z,J,ee))},B=(k,K,V,Y,z,Q,Z,J,ee)=>{k=k||Rt,K=K||Rt;const X=k.length,se=K.length,re=Math.min(X,se);let ie;for(ie=0;ie<re;ie++){const ae=K[ie]=ee?at(K[ie]):Je(K[ie]);O(k[ie],ae,V,null,z,Q,Z,J,ee)}X>se?H(k,z,Q,!0,!1,re):n(K,V,Y,z,Q,Z,J,ee,re)},N=(k,K,V,Y,z,Q,Z,J,ee)=>{let X=0;const se=K.length;let re=k.length-1,ie=se-1;for(;X<=re&&X<=ie;){const ae=k[X],le=K[X]=ee?at(K[X]):Je(K[X]);if(Tt(ae,le))O(ae,le,V,null,z,Q,Z,J,ee);else break;X++}for(;X<=re&&X<=ie;){const ae=k[re],le=K[ie]=ee?at(K[ie]):Je(K[ie]);if(Tt(ae,le))O(ae,le,V,null,z,Q,Z,J,ee);else break;re--,ie--}if(X>re){if(X<=ie){const ae=ie+1,le=ae<se?K[ae].el:Y;for(;X<=ie;)O(null,K[X]=ee?at(K[X]):Je(K[X]),V,le,z,Q,Z,J,ee),X++}}else if(X>ie)for(;X<=re;)w(k[X],z,Q,!0),X++;else{const ae=X,le=X,de=new Map;for(X=le;X<=ie;X++){const Ee=K[X]=ee?at(K[X]):Je(K[X]);Ee.key!=null&&de.set(Ee.key,X)}let ue,he=0;const Te=ie-le+1;let Le=!1,we=0;const pe=new Array(Te);for(X=0;X<Te;X++)pe[X]=0;for(X=ae;X<=re;X++){const Ee=k[X];if(he>=Te){w(Ee,z,Q,!0);continue}let ge;if(Ee.key!=null)ge=de.get(Ee.key);else for(ue=le;ue<=ie;ue++)if(pe[ue-le]===0&&Tt(Ee,K[ue])){ge=ue;break}ge===void 0?w(Ee,z,Q,!0):(pe[ge-le]=X+1,ge>=we?we=ge:Le=!0,O(Ee,K[ge],V,null,z,Q,Z,J,ee),he++)}const De=Le?lo(pe):Rt;for(ue=De.length-1,X=Te-1;X>=0;X--){const Ee=le+X,ge=K[Ee],Ae=Ee+1<se?K[Ee+1].el:Y;pe[X]===0?O(null,ge,V,Ae,z,Q,Z,J,ee):Le&&(ue<0||X!==De[ue]?U(ge,V,Ae,2):ue--)}}},U=(k,K,V,Y,z=null)=>{const{el:Q,type:Z,transition:J,children:ee,shapeFlag:X}=k;if(X&6){U(k.component.subTree,K,V,Y);return}if(X&128){k.suspense.move(K,V,Y);return}if(X&64){Z.move(k,K,V,q);return}if(Z===_e){l(Q,K,V);for(let re=0;re<ee.length;re++)U(ee[re],K,V,Y);l(k.anchor,K,V);return}if(Z===br){r(k,K,V);return}if(Y!==2&&X&1&&J)if(Y===0)J.beforeEnter(Q),l(Q,K,V),be(()=>J.enter(Q),z);else{const{leave:re,delayLeave:ie,afterLeave:ae}=J,le=()=>l(Q,K,V),de=()=>{re(Q,()=>{le(),ae&&ae()})};ie?ie(Q,le,de):de()}else l(Q,K,V)},w=(k,K,V,Y=!1,z=!1)=>{const{type:Q,props:Z,ref:J,children:ee,dynamicChildren:X,shapeFlag:se,patchFlag:re,dirs:ie}=k;if(J!=null&&zr(J,null,V,k,!0),se&256){K.ctx.deactivate(k);return}const ae=se&1&&ie,le=!kt(k);let de;if(le&&(de=Z&&Z.onVnodeBeforeUnmount)&&Xe(de,K,k),se&6)G(k.component,V,Y);else{if(se&128){k.suspense.unmount(V,Y);return}ae&&mt(k,null,K,"beforeUnmount"),se&64?k.type.remove(k,K,V,z,q,Y):X&&(Q!==_e||re>0&&re&64)?H(X,K,V,!1,!0):(Q===_e&&re&384||!z&&se&16)&&H(ee,K,V),Y&&W(k)}(le&&(de=Z&&Z.onVnodeUnmounted)||ae)&&be(()=>{de&&Xe(de,K,k),ae&&mt(k,null,K,"unmounted")},V)},W=k=>{const{type:K,el:V,anchor:Y,transition:z}=k;if(K===_e){j(V,Y);return}if(K===br){u(k);return}const Q=()=>{t(V),z&&!z.persisted&&z.afterLeave&&z.afterLeave()};if(k.shapeFlag&1&&z&&!z.persisted){const{leave:Z,delayLeave:J}=z,ee=()=>Z(V,Q);J?J(k.el,Q,ee):ee()}else Q()},j=(k,K)=>{let V;for(;k!==K;)V=L(k),t(k),k=V;t(K)},G=(k,K,V)=>{const{bum:Y,scope:z,update:Q,subTree:Z,um:J}=k;Y&&Pr(Y),z.stop(),Q&&(Q.active=!1,w(Z,k,K,V)),J&&be(J,K),be(()=>{k.isUnmounted=!0},K),K&&K.pendingBranch&&!K.isUnmounted&&k.asyncDep&&!k.asyncResolved&&k.suspenseId===K.pendingId&&(K.deps--,K.deps===0&&K.resolve())},H=(k,K,V,Y=!1,z=!1,Q=0)=>{for(let Z=Q;Z<k.length;Z++)w(k[Z],K,V,Y,z)},$=k=>k.shapeFlag&6?$(k.component.subTree):k.shapeFlag&128?k.suspense.next():L(k.anchor||k.el),te=(k,K,V)=>{k==null?K._vnode&&w(K._vnode,null,null,!0):O(K._vnode||null,k,K,null,null,null,V),Nn(),_i(),K._vnode=k},q={p:O,um:w,m:U,r:W,mt:c,mc:n,pc:M,pbc:m,n:$,o:e};let ne,oe;return p&&([ne,oe]=p(q)),{render:te,hydrate:ne,createApp:so(te,ne)}}function pt({effect:e,update:p},C){e.allowRecurse=p.allowRecurse=C}function Qi(e,p,C=!1){const l=e.children,t=p.children;if(fe(l)&&fe(t))for(let D=0;D<l.length;D++){const g=l[D];let E=t[D];E.shapeFlag&1&&!E.dynamicChildren&&((E.patchFlag<=0||E.patchFlag===32)&&(E=t[D]=at(t[D]),E.el=g.el),C||Qi(g,E))}}function lo(e){const p=e.slice(),C=[0];let l,t,D,g,E;const F=e.length;for(l=0;l<F;l++){const _=e[l];if(_!==0){if(t=C[C.length-1],e[t]<_){p[l]=t,C.push(l);continue}for(D=0,g=C.length-1;D<g;)E=D+g>>1,e[C[E]]<_?D=E+1:g=E;_<e[C[D]]&&(D>0&&(p[l]=C[D-1]),C[D]=l)}}for(D=C.length,g=C[D-1];D-- >0;)C[D]=g,g=p[g];return C}const uo=e=>e.__isTeleport,_e=Symbol(void 0),yn=Symbol(void 0),We=Symbol(void 0),br=Symbol(void 0),Kt=[];let He=null;function Be(e=!1){Kt.push(He=e?null:[])}function fo(){Kt.pop(),He=Kt[Kt.length-1]||null}let Yt=1;function zn(e){Yt+=e}function Ji(e){return e.dynamicChildren=Yt>0?He||Rt:null,fo(),Yt>0&&He&&He.push(e),e}function Ye(e,p,C,l,t,D){return Ji(ze(e,p,C,l,t,D,!0))}function Tn(e,p,C,l,t){return Ji(Oe(e,p,C,l,t,!0))}function Zi(e){return e?e.__v_isVNode===!0:!1}function Tt(e,p){return e.type===p.type&&e.key===p.key}const xr="__vInternal",qi=({key:e})=>e!=null?e:null,ir=({ref:e,ref_key:p,ref_for:C})=>e!=null?Re(e)||Se(e)||ce(e)?{i:Fe,r:e,k:p,f:!!C}:e:null;function ze(e,p=null,C=null,l=0,t=null,D=e===_e?0:1,g=!1,E=!1){const F={__v_isVNode:!0,__v_skip:!0,type:e,props:p,key:p&&qi(p),ref:p&&ir(p),scopeId:pr,slotScopeIds:null,children:C,component:null,suspense:null,ssContent:null,ssFallback:null,dirs:null,transition:null,el:null,anchor:null,target:null,targetAnchor:null,staticCount:0,shapeFlag:D,patchFlag:l,dynamicProps:t,dynamicChildren:null,appContext:null};return E?(xn(F,C),D&128&&e.normalize(F)):C&&(F.shapeFlag|=Re(C)?8:16),Yt>0&&!g&&He&&(F.patchFlag>0||D&6)&&F.patchFlag!==32&&He.push(F),F}const Oe=co;function co(e,p=null,C=null,l=0,t=null,D=!1){if((!e||e===Va)&&(e=We),Zi(e)){const E=ct(e,p,!0);return C&&xn(E,C),Yt>0&&!D&&He&&(E.shapeFlag&6?He[He.indexOf(e)]=E:He.push(E)),E.patchFlag|=-2,E}if(Do(e)&&(e=e.__vccOpts),p){p=ho(p);let{class:E,style:F}=p;E&&!Re(E)&&(p.class=en(E)),xe(F)&&(Ai(F)&&!fe(F)&&(F=Ce({},F)),p.style=qr(F))}const g=Re(e)?1:Ra(e)?128:uo(e)?64:xe(e)?4:ce(e)?2:0;return ze(e,p,C,l,t,g,D,!0)}function ho(e){return e?Ai(e)||xr in e?Ce({},e):e:null}function ct(e,p,C=!1){const{props:l,ref:t,patchFlag:D,children:g}=e,E=p?mo(l||{},p):l;return{__v_isVNode:!0,__v_skip:!0,type:e.type,props:E,key:E&&qi(E),ref:p&&p.ref?C&&t?fe(t)?t.concat(ir(p)):[t,ir(p)]:ir(p):t,scopeId:e.scopeId,slotScopeIds:e.slotScopeIds,children:g,target:e.target,targetAnchor:e.targetAnchor,staticCount:e.staticCount,shapeFlag:e.shapeFlag,patchFlag:p&&e.type!==_e?D===-1?16:D|16:D,dynamicProps:e.dynamicProps,dynamicChildren:e.dynamicChildren,appContext:e.appContext,dirs:e.dirs,transition:e.transition,component:e.component,suspense:e.suspense,ssContent:e.ssContent&&ct(e.ssContent),ssFallback:e.ssFallback&&ct(e.ssFallback),el:e.el,anchor:e.anchor}}function vo(e=" ",p=0){return Oe(yn,null,e,p)}function go(e="",p=!1){return p?(Be(),Tn(We,null,e)):Oe(We,null,e)}function Je(e){return e==null||typeof e=="boolean"?Oe(We):fe(e)?Oe(_e,null,e.slice()):typeof e=="object"?at(e):Oe(yn,null,String(e))}function at(e){return e.el===null&&e.patchFlag!==-1||e.memo?e:ct(e)}function xn(e,p){let C=0;const{shapeFlag:l}=e;if(p==null)p=null;else if(fe(p))C=16;else if(typeof p=="object")if(l&65){const t=p.default;t&&(t._c&&(t._d=!1),xn(e,t()),t._c&&(t._d=!0));return}else{C=32;const t=p._;!t&&!(xr in p)?p._ctx=Fe:t===3&&Fe&&(Fe.slots._===1?p._=1:(p._=2,e.patchFlag|=1024))}else ce(p)?(p={default:p,_ctx:Fe},C=32):(p=String(p),l&64?(C=16,p=[vo(p)]):C=8);e.children=p,e.shapeFlag|=C}function mo(...e){const p={};for(let C=0;C<e.length;C++){const l=e[C];for(const t in l)if(t==="class")p.class!==l.class&&(p.class=en([p.class,l.class]));else if(t==="style")p.style=qr([p.style,l.style]);else if(fr(t)){const D=p[t],g=l[t];g&&D!==g&&!(fe(D)&&D.includes(g))&&(p[t]=D?[].concat(D,g):g)}else t!==""&&(p[t]=l[t])}return p}function Xe(e,p,C,l=null){Ke(e,p,7,[C,l])}const po=Xi();let Eo=0;function yo(e,p,C){const l=e.type,t=(p?p.appContext:e.appContext)||po,D={uid:Eo++,vnode:e,type:l,parent:p,appContext:t,root:null,next:null,subTree:null,effect:null,update:null,scope:new ci(!0),render:null,proxy:null,exposed:null,exposeProxy:null,withProxy:null,provides:p?p.provides:Object.create(t.provides),accessCache:null,renderCache:[],components:null,directives:null,propsOptions:Vi(l,t),emitsOptions:Bi(l,t),emit:null,emitted:null,propsDefaults:ye,inheritAttrs:l.inheritAttrs,ctx:ye,data:ye,props:ye,attrs:ye,slots:ye,refs:ye,setupState:ye,setupContext:null,suspense:C,suspenseId:C?C.pendingId:0,asyncDep:null,asyncResolved:!1,isMounted:!1,isUnmounted:!1,isDeactivated:!1,bc:null,c:null,bm:null,m:null,bu:null,u:null,um:null,bum:null,da:null,a:null,rtg:null,rtc:null,ec:null,sp:null};return D.ctx={_:D},D.root=p?p.root:D,D.emit=xa.bind(null,D),e.ce&&e.ce(D),D}let Ie=null;const Sn=()=>Ie||Fe,Ft=e=>{Ie=e,e.scope.on()},Lt=()=>{Ie&&Ie.scope.off(),Ie=null};function es(e){return e.vnode.shapeFlag&4}let zt=!1;function To(e,p=!1){zt=p;const{props:C,children:l}=e.vnode,t=es(e);qa(e,C,t,p),ro(e,l);const D=t?xo(e,p):void 0;return zt=!1,D}function xo(e,p){const C=e.type;e.accessCache=Object.create(null),e.proxy=_t(new Proxy(e.ctx,za));const{setup:l}=C;if(l){const t=e.setupContext=l.length>1?Lo(e):null;Ft(e),Ut();const D=ft(l,e,0,[e.props,t]);if(Nt(),Lt(),li(D)){if(D.then(Lt,Lt),p)return D.then(g=>{$n(e,g,p)}).catch(g=>{gr(g,e,0)});e.asyncDep=D}else $n(e,D,p)}else ts(e,p)}function $n(e,p,C){ce(p)?e.type.__ssrInlineRender?e.ssrRender=p:e.render=p:xe(p)&&(e.setupState=Ri(p)),ts(e,C)}let Xn;function ts(e,p,C){const l=e.type;if(!e.render){if(!p&&Xn&&!l.render){const t=l.template||pn(e).template;if(t){const{isCustomElement:D,compilerOptions:g}=e.appContext.config,{delimiters:E,compilerOptions:F}=l,_=Ce(Ce({isCustomElement:D,delimiters:E},g),F);l.render=Xn(t,_)}}e.render=l.render||Ve}Ft(e),Ut(),$a(e),Nt(),Lt()}function So(e){return new Proxy(e.attrs,{get(p,C){return Ne(e,"get","$attrs"),p[C]}})}function Lo(e){const p=l=>{e.exposed=l||{}};let C;return{get attrs(){return C||(C=So(e))},slots:e.slots,emit:e.emit,expose:p}}function Ln(e){if(e.exposed)return e.exposeProxy||(e.exposeProxy=new Proxy(Ri(_t(e.exposed)),{get(p,C){if(C in p)return p[C];if(C in lr)return lr[C](e)}}))}function Do(e){return ce(e)&&"__vccOpts"in e}const rs=(e,p)=>ga(e,p,zt),Ao="3.2.41",Oo="http://www.w3.org/2000/svg",xt=typeof document<"u"?document:null,Qn=xt&&xt.createElement("template"),Io={insert:(e,p,C)=>{p.insertBefore(e,C||null)},remove:e=>{const p=e.parentNode;p&&p.removeChild(e)},createElement:(e,p,C,l)=>{const t=p?xt.createElementNS(Oo,e):xt.createElement(e,C?{is:C}:void 0);return e==="select"&&l&&l.multiple!=null&&t.setAttribute("multiple",l.multiple),t},createText:e=>xt.createTextNode(e),createComment:e=>xt.createComment(e),setText:(e,p)=>{e.nodeValue=p},setElementText:(e,p)=>{e.textContent=p},parentNode:e=>e.parentNode,nextSibling:e=>e.nextSibling,querySelector:e=>xt.querySelector(e),setScopeId(e,p){e.setAttribute(p,"")},insertStaticContent(e,p,C,l,t,D){const g=C?C.previousSibling:p.lastChild;if(t&&(t===D||t.nextSibling))for(;p.insertBefore(t.cloneNode(!0),C),!(t===D||!(t=t.nextSibling)););else{Qn.innerHTML=l?`<svg>${e}</svg>`:e;const E=Qn.content;if(l){const F=E.firstChild;for(;F.firstChild;)E.appendChild(F.firstChild);E.removeChild(F)}p.insertBefore(E,C)}return[g?g.nextSibling:p.firstChild,C?C.previousSibling:p.lastChild]}};function Ro(e,p,C){const l=e._vtc;l&&(p=(p?[p,...l]:[...l]).join(" ")),p==null?e.removeAttribute("class"):C?e.setAttribute("class",p):e.className=p}function Po(e,p,C){const l=e.style,t=Re(C);if(C&&!t){for(const D in C)$r(l,D,C[D]);if(p&&!Re(p))for(const D in p)C[D]==null&&$r(l,D,"")}else{const D=l.display;t?p!==C&&(l.cssText=C):p&&e.removeAttribute("style"),"_vod"in e&&(l.display=D)}}const Jn=/\s*!important$/;function $r(e,p,C){if(fe(C))C.forEach(l=>$r(e,p,l));else if(C==null&&(C=""),p.startsWith("--"))e.setProperty(p,C);else{const l=Co(e,p);Jn.test(C)?e.setProperty(Bt(l),C.replace(Jn,""),"important"):e[l]=C}}const Zn=["Webkit","Moz","ms"],_r={};function Co(e,p){const C=_r[p];if(C)return C;let l=Mt(p);if(l!=="filter"&&l in e)return _r[p]=l;l=di(l);for(let t=0;t<Zn.length;t++){const D=Zn[t]+l;if(D in e)return _r[p]=D}return p}const qn="http://www.w3.org/1999/xlink";function Mo(e,p,C,l,t){if(l&&p.startsWith("xlink:"))C==null?e.removeAttributeNS(qn,p.slice(6,p.length)):e.setAttributeNS(qn,p,C);else{const D=Ss(p);C==null||D&&!si(C)?e.removeAttribute(p):e.setAttribute(p,D?"":C)}}function bo(e,p,C,l,t,D,g){if(p==="innerHTML"||p==="textContent"){l&&g(l,t,D),e[p]=C==null?"":C;return}if(p==="value"&&e.tagName!=="PROGRESS"&&!e.tagName.includes("-")){e._value=C;const F=C==null?"":C;(e.value!==F||e.tagName==="OPTION")&&(e.value=F),C==null&&e.removeAttribute(p);return}let E=!1;if(C===""||C==null){const F=typeof e[p];F==="boolean"?C=si(C):C==null&&F==="string"?(C="",E=!0):F==="number"&&(C=0,E=!0)}try{e[p]=C}catch{}E&&e.removeAttribute(p)}function _o(e,p,C,l){e.addEventListener(p,C,l)}function Fo(e,p,C,l){e.removeEventListener(p,C,l)}function Bo(e,p,C,l,t=null){const D=e._vei||(e._vei={}),g=D[p];if(l&&g)g.value=l;else{const[E,F]=Uo(p);if(l){const _=D[p]=ko(l,t);_o(e,E,_,F)}else g&&(Fo(e,E,g,F),D[p]=void 0)}}const ei=/(?:Once|Passive|Capture)$/;function Uo(e){let p;if(ei.test(e)){p={};let l;for(;l=e.match(ei);)e=e.slice(0,e.length-l[0].length),p[l[0].toLowerCase()]=!0}return[e[2]===":"?e.slice(3):Bt(e.slice(2)),p]}let Fr=0;const No=Promise.resolve(),wo=()=>Fr||(No.then(()=>Fr=0),Fr=Date.now());function ko(e,p){const C=l=>{if(!l._vts)l._vts=Date.now();else if(l._vts<=C.attached)return;Ke(Ko(l,C.value),p,5,[l])};return C.value=e,C.attached=wo(),C}function Ko(e,p){if(fe(p)){const C=e.stopImmediatePropagation;return e.stopImmediatePropagation=()=>{C.call(e),e._stopped=!0},p.map(l=>t=>!t._stopped&&l&&l(t))}else return p}const ti=/^on[a-z]/,Wo=(e,p,C,l,t=!1,D,g,E,F)=>{p==="class"?Ro(e,l,t):p==="style"?Po(e,C,l):fr(p)?tn(p)||Bo(e,p,C,l,g):(p[0]==="."?(p=p.slice(1),!0):p[0]==="^"?(p=p.slice(1),!1):jo(e,p,l,t))?bo(e,p,l,D,g,E,F):(p==="true-value"?e._trueValue=l:p==="false-value"&&(e._falseValue=l),Mo(e,p,l,t))};function jo(e,p,C,l){return l?!!(p==="innerHTML"||p==="textContent"||p in e&&ti.test(p)&&ce(C)):p==="spellcheck"||p==="draggable"||p==="translate"||p==="form"||p==="list"&&e.tagName==="INPUT"||p==="type"&&e.tagName==="TEXTAREA"||ti.test(p)&&Re(C)?!1:p in e}const Go={name:String,type:String,css:{type:Boolean,default:!0},duration:[String,Number,Object],enterFromClass:String,enterActiveClass:String,enterToClass:String,appearFromClass:String,appearActiveClass:String,appearToClass:String,leaveFromClass:String,leaveActiveClass:String,leaveToClass:String};Fa.props;const Ho=Ce({patchProp:Wo},Io);let ri;function Vo(){return ri||(ri=ao(Ho))}const Yo=(...e)=>{const p=Vo().createApp(...e),{mount:C}=p;return p.mount=l=>{const t=zo(l);if(!t)return;const D=p._component;!ce(D)&&!D.render&&!D.template&&(D.template=t.innerHTML),t.innerHTML="";const g=C(t,!1,t instanceof SVGElement);return t instanceof Element&&(t.removeAttribute("v-cloak"),t.setAttribute("data-v-app","")),g},p};function zo(e){return Re(e)?document.querySelector(e):e}var $o=!1;/*!
  * pinia v2.0.23
  * (c) 2022 Eduardo San Martin Morote
  * @license MIT
  */let ns;const Sr=e=>ns=e,is=Symbol();function Xr(e){return e&&typeof e=="object"&&Object.prototype.toString.call(e)==="[object Object]"&&typeof e.toJSON!="function"}var Wt;(function(e){e.direct="direct",e.patchObject="patch object",e.patchFunction="patch function"})(Wt||(Wt={}));function Xo(){const e=hi(!0),p=e.run(()=>hn({}));let C=[],l=[];const t=_t({install(D){Sr(t),t._a=D,D.provide(is,t),D.config.globalProperties.$pinia=t,l.forEach(g=>C.push(g)),l=[]},use(D){return!this._a&&!$o?l.push(D):C.push(D),this},_p:C,_a:null,_e:e,_s:new Map,state:p});return t}const ss=()=>{};function ni(e,p,C,l=ss){e.push(p);const t=()=>{const D=e.indexOf(p);D>-1&&(e.splice(D,1),l())};return!C&&Sn()&&mn(t),t}function Ot(e,...p){e.slice().forEach(C=>{C(...p)})}function Qr(e,p){e instanceof Map&&p instanceof Map&&p.forEach((C,l)=>e.set(l,C)),e instanceof Set&&p instanceof Set&&p.forEach(e.add,e);for(const C in p){if(!p.hasOwnProperty(C))continue;const l=p[C],t=e[C];Xr(t)&&Xr(l)&&e.hasOwnProperty(C)&&!Se(l)&&!ut(l)?e[C]=Qr(t,l):e[C]=l}return e}const Qo=Symbol();function Jo(e){return!Xr(e)||!e.hasOwnProperty(Qo)}const{assign:ot}=Object;function Zo(e){return!!(Se(e)&&e.effect)}function qo(e,p,C,l){const{state:t,actions:D,getters:g}=p,E=C.state.value[e];let F;function _(){E||(C.state.value[e]=t?t():{});const b=da(C.state.value[e]);return ot(b,D,Object.keys(g||{}).reduce((R,L)=>(R[L]=_t(rs(()=>{Sr(C);const I=C._s.get(e);return g[L].call(I,I)})),R),{}))}return F=as(e,_,p,C,l,!0),F.$reset=function(){const R=t?t():{};this.$patch(L=>{ot(L,R)})},F}function as(e,p,C={},l,t,D){let g;const E=ot({actions:{}},C),F={deep:!0};let _,b,R=_t([]),L=_t([]),I;const A=l.state.value[e];!D&&!A&&(l.state.value[e]={}),hn({});let O;function S(s){let n;_=b=!1,typeof s=="function"?(s(l.state.value[e]),n={type:Wt.patchFunction,storeId:e,events:I}):(Qr(l.state.value[e],s),n={type:Wt.patchObject,payload:s,storeId:e,events:I});const i=O=Symbol();Mi().then(()=>{O===i&&(_=!0)}),b=!0,Ot(R,n,l.state.value[e])}const T=ss;function a(){g.stop(),R=[],L=[],l._s.delete(e)}function r(s,n){return function(){Sr(l);const i=Array.from(arguments),m=[],o=[];function f(d){m.push(d)}function v(d){o.push(d)}Ot(L,{args:i,name:s,store:h,after:f,onError:v});let c;try{c=n.apply(this&&this.$id===e?this:h,i)}catch(d){throw Ot(o,d),d}return c instanceof Promise?c.then(d=>(Ot(m,d),d)).catch(d=>(Ot(o,d),Promise.reject(d))):(Ot(m,c),c)}}const u={_p:l,$id:e,$onAction:ni.bind(null,L),$patch:S,$reset:T,$subscribe(s,n={}){const i=ni(R,s,n.detached,()=>m()),m=g.run(()=>nr(()=>l.state.value[e],o=>{(n.flush==="sync"?b:_)&&s({storeId:e,type:Wt.direct,events:I},o)},ot({},F,n)));return i},$dispose:a},h=vr(u);l._s.set(e,h);const y=l._e.run(()=>(g=hi(),g.run(()=>p())));for(const s in y){const n=y[s];if(Se(n)&&!Zo(n)||ut(n))D||(A&&Jo(n)&&(Se(n)?n.value=A[s]:Qr(n,A[s])),l.state.value[e][s]=n);else if(typeof n=="function"){const i=r(s,n);y[s]=i,E.actions[s]=n}}return ot(h,y),ot(me(h),y),Object.defineProperty(h,"$state",{get:()=>l.state.value[e],set:s=>{S(n=>{ot(n,s)})}}),l._p.forEach(s=>{ot(h,g.run(()=>s({store:h,app:l._a,pinia:l,options:E})))}),A&&D&&C.hydrate&&C.hydrate(h.$state,A),_=!0,b=!0,h}function el(e,p,C){let l,t;const D=typeof p=="function";typeof e=="string"?(l=e,t=D?C:p):(t=e,l=e.id);function g(E,F){const _=Sn();return E=E||_&&rr(is),E&&Sr(E),E=ns,E._s.has(l)||(D?as(l,p,t,E):qo(l,t,E)),E._s.get(l)}return g.$id=l,g}function os(e,p,C){if(e!==null)for(var l,t,D,g,E,F,_,b=0,R=0,L,I=e.type,A=I==="FeatureCollection",O=I==="Feature",S=A?e.features.length:1,T=0;T<S;T++){_=A?e.features[T].geometry:O?e.geometry:e,L=_?_.type==="GeometryCollection":!1,E=L?_.geometries.length:1;for(var a=0;a<E;a++){var r=0,u=0;if(g=L?_.geometries[a]:_,g!==null){F=g.coordinates;var h=g.type;switch(b=C&&(h==="Polygon"||h==="MultiPolygon")?1:0,h){case null:break;case"Point":if(p(F,R,T,r,u)===!1)return!1;R++,r++;break;case"LineString":case"MultiPoint":for(l=0;l<F.length;l++){if(p(F[l],R,T,r,u)===!1)return!1;R++,h==="MultiPoint"&&r++}h==="LineString"&&r++;break;case"Polygon":case"MultiLineString":for(l=0;l<F.length;l++){for(t=0;t<F[l].length-b;t++){if(p(F[l][t],R,T,r,u)===!1)return!1;R++}h==="MultiLineString"&&r++,h==="Polygon"&&u++}h==="Polygon"&&r++;break;case"MultiPolygon":for(l=0;l<F.length;l++){for(u=0,t=0;t<F[l].length;t++){for(D=0;D<F[l][t].length-b;D++){if(p(F[l][t][D],R,T,r,u)===!1)return!1;R++}u++}r++}break;case"GeometryCollection":for(l=0;l<g.geometries.length;l++)if(os(g.geometries[l],p,C)===!1)return!1;break;default:throw new Error("Unknown Geometry Type")}}}}}function Jr(e){var p=[1/0,1/0,-1/0,-1/0];return os(e,function(C){p[0]>C[0]&&(p[0]=C[0]),p[1]>C[1]&&(p[1]=C[1]),p[2]<C[0]&&(p[2]=C[0]),p[3]<C[1]&&(p[3]=C[1])}),p}Jr.default=Jr;const ls=el("store",{state:()=>({popup:{show:!1,has_video:null,id:null}})});async function tl(e){const p=await ii(()=>import("./maplibre-gl.bc05cfd7.js").then(g=>g.m),[],import.meta.url),C=new p.Map({container:e,style:{version:8,sources:{satellite:{type:"raster",tiles:["https://mt0.google.com/vt/lyrs=y&hl=en&x={x}&y={y}&z={z}"],tileSize:256,attribution:"Google"}},layers:[{id:"satellite",type:"raster",source:"satellite",minzoom:0,maxzoom:20}]},center:[-74.5,40],zoom:9}),l=(g,E)=>new Promise((F,_)=>{g.loadImage(E,(b,R)=>{b&&_(b),F(R)})}),D=await(await fetch("https://gist.githubusercontent.com/Gr44gg/388ca705b6c97b0d29380ec0272521dd/raw/003f8d5f0a4fbde02ee0f39db011ec7b890fc411/data.geojson")).json();return C.on("load",async()=>{const g=await l(C,"https://docs.mapbox.com/mapbox-gl-js/assets/custom_marker.png");C.addSource("data",{type:"geojson",data:D}),C.addLayer({id:"polygons",type:"fill",source:"data",paint:{"fill-color":"yellow","fill-opacity":.3},filter:["==","$type","Polygon"]}),C.addLayer({id:"lines",type:"line",source:"data",paint:{"line-color":"red","line-width":12},filter:["==","$type","LineString"]}),C.addImage("marker",g),C.addLayer({id:"markers",type:"symbol",source:"data",layout:{"icon-image":"marker"},filter:["==","$type","Point"]}),C.on("mousemove",_=>{_.defaultPrevented===!1&&(C.getCanvas().style.cursor="grab")});const E=["polygons","lines","markers"];E.forEach(_=>{C.on("mousemove",_,b=>{b.preventDefault(),C.getCanvas().style.cursor="pointer"})}),C.on("click",_=>{const b=ls();b.$reset();let R=C.queryRenderedFeatures(_.point,{layers:E});R.length&&(R[0].properties.has_video?b.popup.has_video=!0:b.popup.id=R[0].properties.id,b.popup.show=!0)});const F=Jr(D);C.fitBounds(F)}),C}const Lr=(e,p)=>{const C=e.__vccOpts||e;for(const[l,t]of p)C[l]=t;return C},rl={id:"map"},nl={__name:"Map",setup(e){return Tr(()=>{tl("map")}),(p,C)=>(Be(),Ye("div",rl))}},il=Lr(nl,[["__scopeId","data-v-9395c64a"]]),sl={xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 122.88 122.879","xml:space":"preserve"},al=ze("path",{fill:"#FF4141",d:"M61.44 0c16.96 0 32.328 6.882 43.453 17.986 11.104 11.125 17.986 26.494 17.986 43.453 0 16.961-6.883 32.328-17.986 43.453-11.124 11.106-26.493 17.987-43.453 17.987-16.96 0-32.329-6.881-43.454-17.986C6.882 93.768 0 78.4 0 61.439 0 44.48 6.882 29.111 17.986 17.986 29.112 6.882 44.48 0 61.44 0zm12.012 39.152a7.011 7.011 0 0 1 9.986-.026c2.764 2.776 2.775 7.292.027 10.083L71.4 61.445l12.077 12.25c2.728 2.77 2.689 7.256-.081 10.021-2.772 2.766-7.229 2.758-9.954-.012L61.445 71.541 49.428 83.729a7.008 7.008 0 0 1-9.985.025c-2.763-2.775-2.776-7.291-.026-10.082L51.48 61.435l-12.078-12.25c-2.726-2.769-2.689-7.256.082-10.022 2.772-2.765 7.229-2.758 9.954.013L61.435 51.34l12.017-12.188zM96.899 25.98C87.826 16.907 75.29 11.296 61.44 11.296c-13.851 0-26.387 5.611-35.46 14.685-9.073 9.073-14.684 21.609-14.684 35.459s5.611 26.387 14.684 35.459c9.073 9.074 21.609 14.686 35.46 14.686 13.85 0 26.386-5.611 35.459-14.686 9.073-9.072 14.684-21.609 14.684-35.459s-5.61-26.386-14.684-35.46z"},null,-1),ol=[al];function ll(e,p){return Be(),Ye("svg",sl,ol)}const ul={render:ll};var fl=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function dl(e){return e&&e.__esModule&&Object.prototype.hasOwnProperty.call(e,"default")?e.default:e}var us={exports:{}};(function(e,p){typeof window<"u"&&function(l,t){e.exports=t()}(fl,function(){return function(C){var l={};function t(D){if(l[D])return l[D].exports;var g=l[D]={i:D,l:!1,exports:{}};return C[D].call(g.exports,g,g.exports,t),g.l=!0,g.exports}return t.m=C,t.c=l,t.d=function(D,g,E){t.o(D,g)||Object.defineProperty(D,g,{enumerable:!0,get:E})},t.r=function(D){typeof Symbol<"u"&&Symbol.toStringTag&&Object.defineProperty(D,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(D,"__esModule",{value:!0})},t.t=function(D,g){if(g&1&&(D=t(D)),g&8||g&4&&typeof D=="object"&&D&&D.__esModule)return D;var E=Object.create(null);if(t.r(E),Object.defineProperty(E,"default",{enumerable:!0,value:D}),g&2&&typeof D!="string")for(var F in D)t.d(E,F,function(_){return D[_]}.bind(null,F));return E},t.n=function(D){var g=D&&D.__esModule?function(){return D.default}:function(){return D};return t.d(g,"a",g),g},t.o=function(D,g){return Object.prototype.hasOwnProperty.call(D,g)},t.p="/dist/",t(t.s="./src/hls.ts")}({"./node_modules/eventemitter3/index.js":function(C,l,t){var D=Object.prototype.hasOwnProperty,g="~";function E(){}Object.create&&(E.prototype=Object.create(null),new E().__proto__||(g=!1));function F(L,I,A){this.fn=L,this.context=I,this.once=A||!1}function _(L,I,A,O,S){if(typeof A!="function")throw new TypeError("The listener must be a function");var T=new F(A,O||L,S),a=g?g+I:I;return L._events[a]?L._events[a].fn?L._events[a]=[L._events[a],T]:L._events[a].push(T):(L._events[a]=T,L._eventsCount++),L}function b(L,I){--L._eventsCount===0?L._events=new E:delete L._events[I]}function R(){this._events=new E,this._eventsCount=0}R.prototype.eventNames=function(){var I=[],A,O;if(this._eventsCount===0)return I;for(O in A=this._events)D.call(A,O)&&I.push(g?O.slice(1):O);return Object.getOwnPropertySymbols?I.concat(Object.getOwnPropertySymbols(A)):I},R.prototype.listeners=function(I){var A=g?g+I:I,O=this._events[A];if(!O)return[];if(O.fn)return[O.fn];for(var S=0,T=O.length,a=new Array(T);S<T;S++)a[S]=O[S].fn;return a},R.prototype.listenerCount=function(I){var A=g?g+I:I,O=this._events[A];return O?O.fn?1:O.length:0},R.prototype.emit=function(I,A,O,S,T,a){var r=g?g+I:I;if(!this._events[r])return!1;var u=this._events[r],h=arguments.length,y,s;if(u.fn){switch(u.once&&this.removeListener(I,u.fn,void 0,!0),h){case 1:return u.fn.call(u.context),!0;case 2:return u.fn.call(u.context,A),!0;case 3:return u.fn.call(u.context,A,O),!0;case 4:return u.fn.call(u.context,A,O,S),!0;case 5:return u.fn.call(u.context,A,O,S,T),!0;case 6:return u.fn.call(u.context,A,O,S,T,a),!0}for(s=1,y=new Array(h-1);s<h;s++)y[s-1]=arguments[s];u.fn.apply(u.context,y)}else{var n=u.length,i;for(s=0;s<n;s++)switch(u[s].once&&this.removeListener(I,u[s].fn,void 0,!0),h){case 1:u[s].fn.call(u[s].context);break;case 2:u[s].fn.call(u[s].context,A);break;case 3:u[s].fn.call(u[s].context,A,O);break;case 4:u[s].fn.call(u[s].context,A,O,S);break;default:if(!y)for(i=1,y=new Array(h-1);i<h;i++)y[i-1]=arguments[i];u[s].fn.apply(u[s].context,y)}}return!0},R.prototype.on=function(I,A,O){return _(this,I,A,O,!1)},R.prototype.once=function(I,A,O){return _(this,I,A,O,!0)},R.prototype.removeListener=function(I,A,O,S){var T=g?g+I:I;if(!this._events[T])return this;if(!A)return b(this,T),this;var a=this._events[T];if(a.fn)a.fn===A&&(!S||a.once)&&(!O||a.context===O)&&b(this,T);else{for(var r=0,u=[],h=a.length;r<h;r++)(a[r].fn!==A||S&&!a[r].once||O&&a[r].context!==O)&&u.push(a[r]);u.length?this._events[T]=u.length===1?u[0]:u:b(this,T)}return this},R.prototype.removeAllListeners=function(I){var A;return I?(A=g?g+I:I,this._events[A]&&b(this,A)):(this._events=new E,this._eventsCount=0),this},R.prototype.off=R.prototype.removeListener,R.prototype.addListener=R.prototype.on,R.prefixed=g,R.EventEmitter=R,C.exports=R},"./node_modules/url-toolkit/src/url-toolkit.js":function(C,l,t){(function(D){var g=/^(?=((?:[a-zA-Z0-9+\-.]+:)?))\1(?=((?:\/\/[^\/?#]*)?))\2(?=((?:(?:[^?#\/]*\/)*[^;?#\/]*)?))\3((?:;[^?#]*)?)(\?[^#]*)?(#[^]*)?$/,E=/^(?=([^\/?#]*))\1([^]*)$/,F=/(?:\/|^)\.(?=\/)/g,_=/(?:\/|^)\.\.\/(?!\.\.\/)[^\/]*(?=\/)/g,b={buildAbsoluteURL:function(R,L,I){if(I=I||{},R=R.trim(),L=L.trim(),!L){if(!I.alwaysNormalize)return R;var A=b.parseURL(R);if(!A)throw new Error("Error trying to parse base URL.");return A.path=b.normalizePath(A.path),b.buildURLFromParts(A)}var O=b.parseURL(L);if(!O)throw new Error("Error trying to parse relative URL.");if(O.scheme)return I.alwaysNormalize?(O.path=b.normalizePath(O.path),b.buildURLFromParts(O)):L;var S=b.parseURL(R);if(!S)throw new Error("Error trying to parse base URL.");if(!S.netLoc&&S.path&&S.path[0]!=="/"){var T=E.exec(S.path);S.netLoc=T[1],S.path=T[2]}S.netLoc&&!S.path&&(S.path="/");var a={scheme:S.scheme,netLoc:O.netLoc,path:null,params:O.params,query:O.query,fragment:O.fragment};if(!O.netLoc&&(a.netLoc=S.netLoc,O.path[0]!=="/"))if(!O.path)a.path=S.path,O.params||(a.params=S.params,O.query||(a.query=S.query));else{var r=S.path,u=r.substring(0,r.lastIndexOf("/")+1)+O.path;a.path=b.normalizePath(u)}return a.path===null&&(a.path=I.alwaysNormalize?b.normalizePath(O.path):O.path),b.buildURLFromParts(a)},parseURL:function(R){var L=g.exec(R);return L?{scheme:L[1]||"",netLoc:L[2]||"",path:L[3]||"",params:L[4]||"",query:L[5]||"",fragment:L[6]||""}:null},normalizePath:function(R){for(R=R.split("").reverse().join("").replace(F,"");R.length!==(R=R.replace(_,"")).length;);return R.split("").reverse().join("")},buildURLFromParts:function(R){return R.scheme+R.netLoc+R.path+R.params+R.query+R.fragment}};C.exports=b})()},"./node_modules/webworkify-webpack/index.js":function(C,l,t){function D(I){var A={};function O(T){if(A[T])return A[T].exports;var a=A[T]={i:T,l:!1,exports:{}};return I[T].call(a.exports,a,a.exports,O),a.l=!0,a.exports}O.m=I,O.c=A,O.i=function(T){return T},O.d=function(T,a,r){O.o(T,a)||Object.defineProperty(T,a,{configurable:!1,enumerable:!0,get:r})},O.r=function(T){Object.defineProperty(T,"__esModule",{value:!0})},O.n=function(T){var a=T&&T.__esModule?function(){return T.default}:function(){return T};return O.d(a,"a",a),a},O.o=function(T,a){return Object.prototype.hasOwnProperty.call(T,a)},O.p="/",O.oe=function(T){throw console.error(T),T};var S=O(O.s=ENTRY_MODULE);return S.default||S}var g="[\\.|\\-|\\+|\\w|/|@]+",E="\\(\\s*(/\\*.*?\\*/)?\\s*.*?("+g+").*?\\)";function F(I){return(I+"").replace(/[.?*+^$[\]\\(){}|-]/g,"\\$&")}function _(I){return!isNaN(1*I)}function b(I,A,O){var S={};S[O]=[];var T=A.toString(),a=T.match(/^function\s?\w*\(\w+,\s*\w+,\s*(\w+)\)/);if(!a)return S;for(var r=a[1],u=new RegExp("(\\\\n|\\W)"+F(r)+E,"g"),h;h=u.exec(T);)h[3]!=="dll-reference"&&S[O].push(h[3]);for(u=new RegExp("\\("+F(r)+'\\("(dll-reference\\s('+g+'))"\\)\\)'+E,"g");h=u.exec(T);)I[h[2]]||(S[O].push(h[1]),I[h[2]]=t(h[1]).m),S[h[2]]=S[h[2]]||[],S[h[2]].push(h[4]);for(var y=Object.keys(S),s=0;s<y.length;s++)for(var n=0;n<S[y[s]].length;n++)_(S[y[s]][n])&&(S[y[s]][n]=1*S[y[s]][n]);return S}function R(I){var A=Object.keys(I);return A.reduce(function(O,S){return O||I[S].length>0},!1)}function L(I,A){for(var O={main:[A]},S={main:[]},T={main:{}};R(O);)for(var a=Object.keys(O),r=0;r<a.length;r++){var u=a[r],h=O[u],y=h.pop();if(T[u]=T[u]||{},!(T[u][y]||!I[u][y])){T[u][y]=!0,S[u]=S[u]||[],S[u].push(y);for(var s=b(I,I[u][y],u),n=Object.keys(s),i=0;i<n.length;i++)O[n[i]]=O[n[i]]||[],O[n[i]]=O[n[i]].concat(s[n[i]])}}return S}C.exports=function(I,A){A=A||{};var O={main:t.m},S=A.all?{main:Object.keys(O.main)}:L(O,I),T="";Object.keys(S).filter(function(y){return y!=="main"}).forEach(function(y){for(var s=0;S[y][s];)s++;S[y].push(s),O[y][s]="(function(module, exports, __webpack_require__) { module.exports = __webpack_require__; })",T=T+"var "+y+" = ("+D.toString().replace("ENTRY_MODULE",JSON.stringify(s))+")({"+S[y].map(function(n){return""+JSON.stringify(n)+": "+O[y][n].toString()}).join(",")+`});
`}),T=T+"new (("+D.toString().replace("ENTRY_MODULE",JSON.stringify(I))+")({"+S.main.map(function(y){return""+JSON.stringify(y)+": "+O.main[y].toString()}).join(",")+"}))(self);";var a=new window.Blob([T],{type:"text/javascript"});if(A.bare)return a;var r=window.URL||window.webkitURL||window.mozURL||window.msURL,u=r.createObjectURL(a),h=new window.Worker(u);return h.objectURL=u,h}},"./src/config.ts":function(C,l,t){t.r(l),t.d(l,"hlsDefaultConfig",function(){return i}),t.d(l,"mergeConfig",function(){return o}),t.d(l,"enableStreamingMode",function(){return f});var D=t("./src/controller/abr-controller.ts"),g=t("./src/controller/audio-stream-controller.ts"),E=t("./src/controller/audio-track-controller.ts"),F=t("./src/controller/subtitle-stream-controller.ts"),_=t("./src/controller/subtitle-track-controller.ts"),b=t("./src/controller/buffer-controller.ts"),R=t("./src/controller/timeline-controller.ts"),L=t("./src/controller/cap-level-controller.ts"),I=t("./src/controller/fps-controller.ts"),A=t("./src/controller/eme-controller.ts"),O=t("./src/controller/cmcd-controller.ts"),S=t("./src/utils/xhr-loader.ts"),T=t("./src/utils/fetch-loader.ts"),a=t("./src/utils/cues.ts"),r=t("./src/utils/mediakeys-helper.ts"),u=t("./src/utils/logger.ts");function h(){return h=Object.assign?Object.assign.bind():function(v){for(var c=1;c<arguments.length;c++){var d=arguments[c];for(var x in d)Object.prototype.hasOwnProperty.call(d,x)&&(v[x]=d[x])}return v},h.apply(this,arguments)}function y(v,c){var d=Object.keys(v);if(Object.getOwnPropertySymbols){var x=Object.getOwnPropertySymbols(v);c&&(x=x.filter(function(P){return Object.getOwnPropertyDescriptor(v,P).enumerable})),d.push.apply(d,x)}return d}function s(v){for(var c=1;c<arguments.length;c++){var d=arguments[c]!=null?arguments[c]:{};c%2?y(Object(d),!0).forEach(function(x){n(v,x,d[x])}):Object.getOwnPropertyDescriptors?Object.defineProperties(v,Object.getOwnPropertyDescriptors(d)):y(Object(d)).forEach(function(x){Object.defineProperty(v,x,Object.getOwnPropertyDescriptor(d,x))})}return v}function n(v,c,d){return c in v?Object.defineProperty(v,c,{value:d,enumerable:!0,configurable:!0,writable:!0}):v[c]=d,v}var i=s(s({autoStartLoad:!0,startPosition:-1,defaultAudioCodec:void 0,debug:!1,capLevelOnFPSDrop:!1,capLevelToPlayerSize:!1,ignoreDevicePixelRatio:!1,initialLiveManifestSize:1,maxBufferLength:30,backBufferLength:1/0,maxBufferSize:60*1e3*1e3,maxBufferHole:.1,highBufferWatchdogPeriod:2,nudgeOffset:.1,nudgeMaxRetry:3,maxFragLookUpTolerance:.25,liveSyncDurationCount:3,liveMaxLatencyDurationCount:1/0,liveSyncDuration:void 0,liveMaxLatencyDuration:void 0,maxLiveSyncPlaybackRate:1,liveDurationInfinity:!1,liveBackBufferLength:null,maxMaxBufferLength:600,enableWorker:!0,enableSoftwareAES:!0,manifestLoadingTimeOut:1e4,manifestLoadingMaxRetry:1,manifestLoadingRetryDelay:1e3,manifestLoadingMaxRetryTimeout:64e3,startLevel:void 0,levelLoadingTimeOut:1e4,levelLoadingMaxRetry:4,levelLoadingRetryDelay:1e3,levelLoadingMaxRetryTimeout:64e3,fragLoadingTimeOut:2e4,fragLoadingMaxRetry:6,fragLoadingRetryDelay:1e3,fragLoadingMaxRetryTimeout:64e3,startFragPrefetch:!1,fpsDroppedMonitoringPeriod:5e3,fpsDroppedMonitoringThreshold:.2,appendErrorMaxRetry:3,loader:S.default,fLoader:void 0,pLoader:void 0,xhrSetup:void 0,licenseXhrSetup:void 0,licenseResponseCallback:void 0,abrController:D.default,bufferController:b.default,capLevelController:L.default,fpsController:I.default,stretchShortVideoTrack:!1,maxAudioFramesDrift:1,forceKeyFrameOnDiscontinuity:!0,abrEwmaFastLive:3,abrEwmaSlowLive:9,abrEwmaFastVoD:3,abrEwmaSlowVoD:9,abrEwmaDefaultEstimate:5e5,abrBandWidthFactor:.95,abrBandWidthUpFactor:.7,abrMaxWithRealBitrate:!1,maxStarvationDelay:4,maxLoadingDelay:4,minAutoBitrate:0,emeEnabled:!1,widevineLicenseUrl:void 0,drmSystemOptions:{},requestMediaKeySystemAccessFunc:r.requestMediaKeySystemAccess,testBandwidth:!0,progressive:!1,lowLatencyMode:!0,cmcd:void 0,enableDateRangeMetadataCues:!0,enableEmsgMetadataCues:!0,enableID3MetadataCues:!0},m()),{},{subtitleStreamController:F.SubtitleStreamController,subtitleTrackController:_.default,timelineController:R.TimelineController,audioStreamController:g.default,audioTrackController:E.default,emeController:A.default,cmcdController:O.default});function m(){return{cueHandler:a.default,enableWebVTT:!0,enableIMSC1:!0,enableCEA708Captions:!0,captionsTextTrack1Label:"English",captionsTextTrack1LanguageCode:"en",captionsTextTrack2Label:"Spanish",captionsTextTrack2LanguageCode:"es",captionsTextTrack3Label:"Unknown CC",captionsTextTrack3LanguageCode:"",captionsTextTrack4Label:"Unknown CC",captionsTextTrack4LanguageCode:"",renderTextTracksNatively:!0}}function o(v,c){if((c.liveSyncDurationCount||c.liveMaxLatencyDurationCount)&&(c.liveSyncDuration||c.liveMaxLatencyDuration))throw new Error("Illegal hls.js config: don't mix up liveSyncDurationCount/liveMaxLatencyDurationCount and liveSyncDuration/liveMaxLatencyDuration");if(c.liveMaxLatencyDurationCount!==void 0&&(c.liveSyncDurationCount===void 0||c.liveMaxLatencyDurationCount<=c.liveSyncDurationCount))throw new Error('Illegal hls.js config: "liveMaxLatencyDurationCount" must be greater than "liveSyncDurationCount"');if(c.liveMaxLatencyDuration!==void 0&&(c.liveSyncDuration===void 0||c.liveMaxLatencyDuration<=c.liveSyncDuration))throw new Error('Illegal hls.js config: "liveMaxLatencyDuration" must be greater than "liveSyncDuration"');return h({},v,c)}function f(v){var c=v.loader;if(c!==T.default&&c!==S.default)u.logger.log("[config]: Custom loader detected, cannot enable progressive streaming"),v.progressive=!1;else{var d=Object(T.fetchSupported)();d&&(v.loader=T.default,v.progressive=!0,v.enableSoftwareAES=!0,u.logger.log("[config]: Progressive streaming enabled, using FetchLoader"))}}},"./src/controller/abr-controller.ts":function(C,l,t){t.r(l);var D=t("./src/polyfills/number.ts"),g=t("./src/utils/ewma-bandwidth-estimator.ts"),E=t("./src/events.ts"),F=t("./src/errors.ts"),_=t("./src/types/loader.ts"),b=t("./src/utils/logger.ts");function R(A,O){for(var S=0;S<O.length;S++){var T=O[S];T.enumerable=T.enumerable||!1,T.configurable=!0,"value"in T&&(T.writable=!0),Object.defineProperty(A,T.key,T)}}function L(A,O,S){return O&&R(A.prototype,O),S&&R(A,S),Object.defineProperty(A,"prototype",{writable:!1}),A}var I=function(){function A(S){this.hls=void 0,this.lastLoadedFragLevel=0,this._nextAutoLevel=-1,this.timer=void 0,this.onCheck=this._abandonRulesCheck.bind(this),this.fragCurrent=null,this.partCurrent=null,this.bitrateTestDelay=0,this.bwEstimator=void 0,this.hls=S;var T=S.config;this.bwEstimator=new g.default(T.abrEwmaSlowVoD,T.abrEwmaFastVoD,T.abrEwmaDefaultEstimate),this.registerListeners()}var O=A.prototype;return O.registerListeners=function(){var T=this.hls;T.on(E.Events.FRAG_LOADING,this.onFragLoading,this),T.on(E.Events.FRAG_LOADED,this.onFragLoaded,this),T.on(E.Events.FRAG_BUFFERED,this.onFragBuffered,this),T.on(E.Events.LEVEL_LOADED,this.onLevelLoaded,this),T.on(E.Events.ERROR,this.onError,this)},O.unregisterListeners=function(){var T=this.hls;T.off(E.Events.FRAG_LOADING,this.onFragLoading,this),T.off(E.Events.FRAG_LOADED,this.onFragLoaded,this),T.off(E.Events.FRAG_BUFFERED,this.onFragBuffered,this),T.off(E.Events.LEVEL_LOADED,this.onLevelLoaded,this),T.off(E.Events.ERROR,this.onError,this)},O.destroy=function(){this.unregisterListeners(),this.clearTimer(),this.hls=this.onCheck=null,this.fragCurrent=this.partCurrent=null},O.onFragLoading=function(T,a){var r=a.frag;if(r.type===_.PlaylistLevelType.MAIN&&!this.timer){var u;this.fragCurrent=r,this.partCurrent=(u=a.part)!=null?u:null,this.timer=self.setInterval(this.onCheck,100)}},O.onLevelLoaded=function(T,a){var r=this.hls.config;a.details.live?this.bwEstimator.update(r.abrEwmaSlowLive,r.abrEwmaFastLive):this.bwEstimator.update(r.abrEwmaSlowVoD,r.abrEwmaFastVoD)},O._abandonRulesCheck=function(){var T=this.fragCurrent,a=this.partCurrent,r=this.hls,u=r.autoLevelEnabled;r.config;var h=r.media;if(!(!T||!h)){var y=a?a.stats:T.stats,s=a?a.duration:T.duration;if(y.aborted||y.loaded&&y.loaded===y.total||T.level===0){this.clearTimer(),this._nextAutoLevel=-1;return}if(!(!u||h.paused||!h.playbackRate||!h.readyState)){var n=r.mainForwardBufferInfo;if(n!==null){var i=performance.now()-y.loading.start,m=Math.abs(h.playbackRate);if(!(i<=500*s/m)){var o=y.loaded&&y.loading.first,f=this.bwEstimator.getEstimate(),v=r.levels,c=r.minAutoLevel,d=v[T.level],x=y.total||Math.max(y.loaded,Math.round(s*d.maxBitrate/8)),P=o?y.loaded*1e3/i:0,M=P?(x-y.loaded)/P:x*8/f,B=n.len/m;if(!(M<=B)){var N=Number.POSITIVE_INFINITY,U;for(U=T.level-1;U>c;U--){var w=v[U].maxBitrate;if(N=P?s*w/(8*.8*P):s*w/f,N<B)break}N>=M||(b.logger.warn("Fragment "+T.sn+(a?" part "+a.index:"")+" of level "+T.level+" is loading too slowly and will cause an underbuffer; aborting and switching to level "+U+`
      Current BW estimate: `+(Object(D.isFiniteNumber)(f)?(f/1024).toFixed(3):"Unknown")+` Kb/s
      Estimated load time for current fragment: `+M.toFixed(3)+` s
      Estimated load time for the next fragment: `+N.toFixed(3)+` s
      Time to underbuffer: `+B.toFixed(3)+" s"),r.nextLoadLevel=U,o&&this.bwEstimator.sample(i,y.loaded),this.clearTimer(),T.loader&&(this.fragCurrent=this.partCurrent=null,T.loader.abort()),r.trigger(E.Events.FRAG_LOAD_EMERGENCY_ABORTED,{frag:T,part:a,stats:y}))}}}}}},O.onFragLoaded=function(T,a){var r=a.frag,u=a.part;if(r.type===_.PlaylistLevelType.MAIN&&Object(D.isFiniteNumber)(r.sn)){var h=u?u.stats:r.stats,y=u?u.duration:r.duration;if(this.clearTimer(),this.lastLoadedFragLevel=r.level,this._nextAutoLevel=-1,this.hls.config.abrMaxWithRealBitrate){var s=this.hls.levels[r.level],n=(s.loaded?s.loaded.bytes:0)+h.loaded,i=(s.loaded?s.loaded.duration:0)+y;s.loaded={bytes:n,duration:i},s.realBitrate=Math.round(8*n/i)}if(r.bitrateTest){var m={stats:h,frag:r,part:u,id:r.type};this.onFragBuffered(E.Events.FRAG_BUFFERED,m)}}},O.onFragBuffered=function(T,a){var r=a.frag,u=a.part,h=u?u.stats:r.stats;if(!h.aborted&&!(r.type!==_.PlaylistLevelType.MAIN||r.sn==="initSegment")){var y=h.parsing.end-h.loading.start;this.bwEstimator.sample(y,h.loaded),h.bwEstimate=this.bwEstimator.getEstimate(),r.bitrateTest?this.bitrateTestDelay=y/1e3:this.bitrateTestDelay=0}},O.onError=function(T,a){switch(a.details){case F.ErrorDetails.FRAG_LOAD_ERROR:case F.ErrorDetails.FRAG_LOAD_TIMEOUT:this.clearTimer();break}},O.clearTimer=function(){self.clearInterval(this.timer),this.timer=void 0},O.getNextABRAutoLevel=function(){var T=this.fragCurrent,a=this.partCurrent,r=this.hls,u=r.maxAutoLevel,h=r.config,y=r.minAutoLevel,s=r.media,n=a?a.duration:T?T.duration:0;s&&s.currentTime;var i=s&&s.playbackRate!==0?Math.abs(s.playbackRate):1,m=this.bwEstimator?this.bwEstimator.getEstimate():h.abrEwmaDefaultEstimate,o=r.mainForwardBufferInfo,f=(o?o.len:0)/i,v=this.findBestLevel(m,y,u,f,h.abrBandWidthFactor,h.abrBandWidthUpFactor);if(v>=0)return v;b.logger.trace((f?"rebuffering expected":"buffer is empty")+", finding optimal quality level");var c=n?Math.min(n,h.maxStarvationDelay):h.maxStarvationDelay,d=h.abrBandWidthFactor,x=h.abrBandWidthUpFactor;if(!f){var P=this.bitrateTestDelay;if(P){var M=n?Math.min(n,h.maxLoadingDelay):h.maxLoadingDelay;c=M-P,b.logger.trace("bitrate test took "+Math.round(1e3*P)+"ms, set first fragment max fetchDuration to "+Math.round(1e3*c)+" ms"),d=x=1}}return v=this.findBestLevel(m,y,u,f+c,d,x),Math.max(v,0)},O.findBestLevel=function(T,a,r,u,h,y){for(var s,n=this.fragCurrent,i=this.partCurrent,m=this.lastLoadedFragLevel,o=this.hls.levels,f=o[m],v=!!(f!=null&&(s=f.details)!==null&&s!==void 0&&s.live),c=f==null?void 0:f.codecSet,d=i?i.duration:n?n.duration:0,x=r;x>=a;x--){var P=o[x];if(!(!P||c&&P.codecSet!==c)){var M=P.details,B=(i?M==null?void 0:M.partTarget:M==null?void 0:M.averagetargetduration)||d,N=void 0;x<=m?N=h*T:N=y*T;var U=o[x].maxBitrate,w=U*B/N;if(b.logger.trace("level/adjustedbw/bitrate/avgDuration/maxFetchDuration/fetchDuration: "+x+"/"+Math.round(N)+"/"+U+"/"+B+"/"+u+"/"+w),N>U&&(w===0||!Object(D.isFiniteNumber)(w)||v&&!this.bitrateTestDelay||w<u))return x}}return-1},L(A,[{key:"nextAutoLevel",get:function(){var T=this._nextAutoLevel,a=this.bwEstimator;if(T!==-1&&!a.canEstimate())return T;var r=this.getNextABRAutoLevel();return T!==-1&&this.hls.levels[r].loadError?T:(T!==-1&&(r=Math.min(T,r)),r)},set:function(T){this._nextAutoLevel=T}}]),A}();l.default=I},"./src/controller/audio-stream-controller.ts":function(C,l,t){t.r(l);var D=t("./src/polyfills/number.ts"),g=t("./src/controller/base-stream-controller.ts"),E=t("./src/events.ts"),F=t("./src/utils/buffer-helper.ts"),_=t("./src/controller/fragment-tracker.ts"),b=t("./src/types/level.ts"),R=t("./src/types/loader.ts"),L=t("./src/loader/fragment.ts"),I=t("./src/demux/chunk-cache.ts"),A=t("./src/demux/transmuxer-interface.ts"),O=t("./src/types/transmuxer.ts"),S=t("./src/controller/fragment-finders.ts"),T=t("./src/utils/discontinuities.ts"),a=t("./src/errors.ts");function r(){return r=Object.assign?Object.assign.bind():function(n){for(var i=1;i<arguments.length;i++){var m=arguments[i];for(var o in m)Object.prototype.hasOwnProperty.call(m,o)&&(n[o]=m[o])}return n},r.apply(this,arguments)}function u(n,i){n.prototype=Object.create(i.prototype),n.prototype.constructor=n,h(n,i)}function h(n,i){return h=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(o,f){return o.__proto__=f,o},h(n,i)}var y=100,s=function(n){u(i,n);function i(o,f){var v;return v=n.call(this,o,f,"[audio-stream-controller]")||this,v.videoBuffer=null,v.videoTrackCC=-1,v.waitingVideoCC=-1,v.audioSwitch=!1,v.trackId=-1,v.waitingData=null,v.mainDetails=null,v.bufferFlushed=!1,v.cachedTrackLoadedData=null,v._registerListeners(),v}var m=i.prototype;return m.onHandlerDestroying=function(){this._unregisterListeners(),this.mainDetails=null},m._registerListeners=function(){var f=this.hls;f.on(E.Events.MEDIA_ATTACHED,this.onMediaAttached,this),f.on(E.Events.MEDIA_DETACHING,this.onMediaDetaching,this),f.on(E.Events.MANIFEST_LOADING,this.onManifestLoading,this),f.on(E.Events.LEVEL_LOADED,this.onLevelLoaded,this),f.on(E.Events.AUDIO_TRACKS_UPDATED,this.onAudioTracksUpdated,this),f.on(E.Events.AUDIO_TRACK_SWITCHING,this.onAudioTrackSwitching,this),f.on(E.Events.AUDIO_TRACK_LOADED,this.onAudioTrackLoaded,this),f.on(E.Events.ERROR,this.onError,this),f.on(E.Events.BUFFER_RESET,this.onBufferReset,this),f.on(E.Events.BUFFER_CREATED,this.onBufferCreated,this),f.on(E.Events.BUFFER_FLUSHED,this.onBufferFlushed,this),f.on(E.Events.INIT_PTS_FOUND,this.onInitPtsFound,this),f.on(E.Events.FRAG_BUFFERED,this.onFragBuffered,this)},m._unregisterListeners=function(){var f=this.hls;f.off(E.Events.MEDIA_ATTACHED,this.onMediaAttached,this),f.off(E.Events.MEDIA_DETACHING,this.onMediaDetaching,this),f.off(E.Events.MANIFEST_LOADING,this.onManifestLoading,this),f.off(E.Events.LEVEL_LOADED,this.onLevelLoaded,this),f.off(E.Events.AUDIO_TRACKS_UPDATED,this.onAudioTracksUpdated,this),f.off(E.Events.AUDIO_TRACK_SWITCHING,this.onAudioTrackSwitching,this),f.off(E.Events.AUDIO_TRACK_LOADED,this.onAudioTrackLoaded,this),f.off(E.Events.ERROR,this.onError,this),f.off(E.Events.BUFFER_RESET,this.onBufferReset,this),f.off(E.Events.BUFFER_CREATED,this.onBufferCreated,this),f.off(E.Events.BUFFER_FLUSHED,this.onBufferFlushed,this),f.off(E.Events.INIT_PTS_FOUND,this.onInitPtsFound,this),f.off(E.Events.FRAG_BUFFERED,this.onFragBuffered,this)},m.onInitPtsFound=function(f,v){var c=v.frag,d=v.id,x=v.initPTS;if(d==="main"){var P=c.cc;this.initPTS[c.cc]=x,this.log("InitPTS for cc: "+P+" found from main: "+x),this.videoTrackCC=P,this.state===g.State.WAITING_INIT_PTS&&this.tick()}},m.startLoad=function(f){if(!this.levels){this.startPosition=f,this.state=g.State.STOPPED;return}var v=this.lastCurrentTime;this.stopLoad(),this.setInterval(y),this.fragLoadError=0,v>0&&f===-1?(this.log("Override startPosition with lastCurrentTime @"+v.toFixed(3)),f=v,this.state=g.State.IDLE):(this.loadedmetadata=!1,this.state=g.State.WAITING_TRACK),this.nextLoadPosition=this.startPosition=this.lastCurrentTime=f,this.tick()},m.doTick=function(){switch(this.state){case g.State.IDLE:this.doTickIdle();break;case g.State.WAITING_TRACK:{var f,v=this.levels,c=this.trackId,d=v==null||(f=v[c])===null||f===void 0?void 0:f.details;if(d){if(this.waitForCdnTuneIn(d))break;this.state=g.State.WAITING_INIT_PTS}break}case g.State.FRAG_LOADING_WAITING_RETRY:{var x,P=performance.now(),M=this.retryDate;(!M||P>=M||(x=this.media)!==null&&x!==void 0&&x.seeking)&&(this.log("RetryDate reached, switch back to IDLE state"),this.resetStartWhenNotLoaded(this.trackId),this.state=g.State.IDLE);break}case g.State.WAITING_INIT_PTS:{var B=this.waitingData;if(B){var N=B.frag,U=B.part,w=B.cache,W=B.complete;if(this.initPTS[N.cc]!==void 0){this.waitingData=null,this.waitingVideoCC=-1,this.state=g.State.FRAG_LOADING;var j=w.flush(),G={frag:N,part:U,payload:j,networkDetails:null};this._handleFragmentLoadProgress(G),W&&n.prototype._handleFragmentLoadComplete.call(this,G)}else if(this.videoTrackCC!==this.waitingVideoCC)this.log("Waiting fragment cc ("+N.cc+") cancelled because video is at cc "+this.videoTrackCC),this.clearWaitingFragment();else{var H=this.getLoadPosition(),$=F.BufferHelper.bufferInfo(this.mediaBuffer,H,this.config.maxBufferHole),te=Object(S.fragmentWithinToleranceTest)($.end,this.config.maxFragLookUpTolerance,N);te<0&&(this.log("Waiting fragment cc ("+N.cc+") @ "+N.start+" cancelled because another fragment at "+$.end+" is needed"),this.clearWaitingFragment())}}else this.state=g.State.IDLE}}this.onTickEnd()},m.clearWaitingFragment=function(){var f=this.waitingData;f&&(this.fragmentTracker.removeFragment(f.frag),this.waitingData=null,this.waitingVideoCC=-1,this.state=g.State.IDLE)},m.resetLoadingState=function(){this.clearWaitingFragment(),n.prototype.resetLoadingState.call(this)},m.onTickEnd=function(){var f=this.media;if(!(!f||!f.readyState)){var v=this.mediaBuffer?this.mediaBuffer:f,c=v.buffered;!this.loadedmetadata&&c.length&&(this.loadedmetadata=!0),this.lastCurrentTime=f.currentTime}},m.doTickIdle=function(){var f,v,c=this.hls,d=this.levels,x=this.media,P=this.trackId,M=c.config;if(!(!d||!d[P])&&!(!x&&(this.startFragRequested||!M.startFragPrefetch))){var B=d[P],N=B.details;if(!N||N.live&&this.levelLastLoaded!==P||this.waitForCdnTuneIn(N)){this.state=g.State.WAITING_TRACK;return}var U=this.mediaBuffer?this.mediaBuffer:this.media;this.bufferFlushed&&U&&(this.bufferFlushed=!1,this.afterBufferFlushed(U,L.ElementaryStreamTypes.AUDIO,R.PlaylistLevelType.AUDIO));var w=this.getFwdBufferInfo(U,R.PlaylistLevelType.AUDIO);if(w!==null){var W=this.getFwdBufferInfo(this.videoBuffer?this.videoBuffer:this.media,R.PlaylistLevelType.MAIN),j=w.len,G=this.getMaxBufferLength(W==null?void 0:W.len),H=this.audioSwitch;if(!(j>=G&&!H)){if(!H&&this._streamEnded(w,N)){c.trigger(E.Events.BUFFER_EOS,{type:"audio"}),this.state=g.State.ENDED;return}var $=N.fragments,te=$[0].start,q=w.end;if(H&&x){var ne=this.getLoadPosition();q=ne,N.PTSKnown&&ne<te&&(w.end>te||w.nextStart)&&(this.log("Alt audio track ahead of main track, seek to start of alt audio track"),x.currentTime=te+.05)}if(!(W&&q>W.end+N.targetduration)&&!((!W||!W.len)&&w.len)){var oe=this.getNextFragment(q,N);if(!oe){this.bufferFlushed=!0;return}((f=oe.decryptdata)===null||f===void 0?void 0:f.keyFormat)==="identity"&&!((v=oe.decryptdata)!==null&&v!==void 0&&v.key)?this.loadKey(oe,N):this.loadFragment(oe,N,q)}}}}},m.getMaxBufferLength=function(f){var v=n.prototype.getMaxBufferLength.call(this);return f?Math.max(v,f):v},m.onMediaDetaching=function(){this.videoBuffer=null,n.prototype.onMediaDetaching.call(this)},m.onAudioTracksUpdated=function(f,v){var c=v.audioTracks;this.resetTransmuxer(),this.levels=c.map(function(d){return new b.Level(d)})},m.onAudioTrackSwitching=function(f,v){var c=!!v.url;this.trackId=v.id;var d=this.fragCurrent;d!=null&&d.loader&&d.loader.abort(),this.fragCurrent=null,this.clearWaitingFragment(),c?this.setInterval(y):this.resetTransmuxer(),c?(this.audioSwitch=!0,this.state=g.State.IDLE):this.state=g.State.STOPPED,this.tick()},m.onManifestLoading=function(){this.mainDetails=null,this.fragmentTracker.removeAllFragments(),this.startPosition=this.lastCurrentTime=0,this.bufferFlushed=!1},m.onLevelLoaded=function(f,v){this.mainDetails=v.details,this.cachedTrackLoadedData!==null&&(this.hls.trigger(E.Events.AUDIO_TRACK_LOADED,this.cachedTrackLoadedData),this.cachedTrackLoadedData=null)},m.onAudioTrackLoaded=function(f,v){var c;if(this.mainDetails==null){this.cachedTrackLoadedData=v;return}var d=this.levels,x=v.details,P=v.id;if(!d){this.warn("Audio tracks were reset while loading level "+P);return}this.log("Track "+P+" loaded ["+x.startSN+","+x.endSN+"],duration:"+x.totalduration);var M=d[P],B=0;if(x.live||(c=M.details)!==null&&c!==void 0&&c.live){var N=this.mainDetails;if(x.fragments[0]||(x.deltaUpdateFailed=!0),x.deltaUpdateFailed||!N)return;!M.details&&x.hasProgramDateTime&&N.hasProgramDateTime?(Object(T.alignMediaPlaylistByPDT)(x,N),B=x.fragments[0].start):B=this.alignPlaylists(x,M.details)}M.details=x,this.levelLastLoaded=P,!this.startFragRequested&&(this.mainDetails||!x.live)&&this.setStartPosition(M.details,B),this.state===g.State.WAITING_TRACK&&!this.waitForCdnTuneIn(x)&&(this.state=g.State.IDLE),this.tick()},m._handleFragmentLoadProgress=function(f){var v,c=f.frag,d=f.part,x=f.payload,P=this.config,M=this.trackId,B=this.levels;if(!B){this.warn("Audio tracks were reset while fragment load was in progress. Fragment "+c.sn+" of level "+c.level+" will not be buffered");return}var N=B[M];console.assert(N,"Audio track is defined on fragment load progress");var U=N.details;console.assert(U,"Audio track details are defined on fragment load progress");var w=P.defaultAudioCodec||N.audioCodec||"mp4a.40.2",W=this.transmuxer;W||(W=this.transmuxer=new A.default(this.hls,R.PlaylistLevelType.AUDIO,this._handleTransmuxComplete.bind(this),this._handleTransmuxerFlush.bind(this)));var j=this.initPTS[c.cc],G=(v=c.initSegment)===null||v===void 0?void 0:v.data;if(j!==void 0){var H=!1,$=d?d.index:-1,te=$!==-1,q=new O.ChunkMetadata(c.level,c.sn,c.stats.chunkCount,x.byteLength,$,te);W.push(x,G,w,"",c,d,U.totalduration,H,q,j)}else{this.log("Unknown video PTS for cc "+c.cc+", waiting for video PTS before demuxing audio frag "+c.sn+" of ["+U.startSN+" ,"+U.endSN+"],track "+M);var ne=this.waitingData=this.waitingData||{frag:c,part:d,cache:new I.default,complete:!1},oe=ne.cache;oe.push(new Uint8Array(x)),this.waitingVideoCC=this.videoTrackCC,this.state=g.State.WAITING_INIT_PTS}},m._handleFragmentLoadComplete=function(f){if(this.waitingData){this.waitingData.complete=!0;return}n.prototype._handleFragmentLoadComplete.call(this,f)},m.onBufferReset=function(){this.mediaBuffer=this.videoBuffer=null,this.loadedmetadata=!1},m.onBufferCreated=function(f,v){var c=v.tracks.audio;c&&(this.mediaBuffer=c.buffer||null),v.tracks.video&&(this.videoBuffer=v.tracks.video.buffer||null)},m.onFragBuffered=function(f,v){var c=v.frag,d=v.part;if(c.type===R.PlaylistLevelType.AUDIO){if(this.fragContextChanged(c)){this.warn("Fragment "+c.sn+(d?" p: "+d.index:"")+" of level "+c.level+" finished buffering, but was aborted. state: "+this.state+", audioSwitch: "+this.audioSwitch);return}c.sn!=="initSegment"&&(this.fragPrevious=c,this.audioSwitch&&(this.audioSwitch=!1,this.hls.trigger(E.Events.AUDIO_TRACK_SWITCHED,{id:this.trackId}))),this.fragBufferedComplete(c,d)}},m.onError=function(f,v){switch(v.details){case a.ErrorDetails.FRAG_LOAD_ERROR:case a.ErrorDetails.FRAG_LOAD_TIMEOUT:case a.ErrorDetails.KEY_LOAD_ERROR:case a.ErrorDetails.KEY_LOAD_TIMEOUT:this.onFragmentOrKeyLoadError(R.PlaylistLevelType.AUDIO,v);break;case a.ErrorDetails.AUDIO_TRACK_LOAD_ERROR:case a.ErrorDetails.AUDIO_TRACK_LOAD_TIMEOUT:this.state!==g.State.ERROR&&this.state!==g.State.STOPPED&&(this.state=v.fatal?g.State.ERROR:g.State.IDLE,this.warn(v.details+" while loading frag, switching to "+this.state+" state"));break;case a.ErrorDetails.BUFFER_FULL_ERROR:if(v.parent==="audio"&&(this.state===g.State.PARSING||this.state===g.State.PARSED)){var c=!0,d=this.getFwdBufferInfo(this.mediaBuffer,R.PlaylistLevelType.AUDIO);d&&d.len>.5&&(c=!this.reduceMaxBufferLength(d.len)),c&&(this.warn("Buffer full error also media.currentTime is not buffered, flush audio buffer"),this.fragCurrent=null,n.prototype.flushMainBuffer.call(this,0,Number.POSITIVE_INFINITY,"audio")),this.resetLoadingState()}break}},m.onBufferFlushed=function(f,v){var c=v.type;c===L.ElementaryStreamTypes.AUDIO&&(this.bufferFlushed=!0)},m._handleTransmuxComplete=function(f){var v,c="audio",d=this.hls,x=f.remuxResult,P=f.chunkMeta,M=this.getCurrentContext(P);if(!M){this.warn("The loading context changed while buffering fragment "+P.sn+" of level "+P.level+". This chunk will not be buffered."),this.resetStartWhenNotLoaded(P.level);return}var B=M.frag,N=M.part,U=M.level.details,w=x.audio,W=x.text,j=x.id3,G=x.initSegment;if(!(this.fragContextChanged(B)||!U)){if(this.state=g.State.PARSING,this.audioSwitch&&w&&this.completeAudioSwitch(),G!=null&&G.tracks&&(this._bufferInitSegment(G.tracks,B,P),d.trigger(E.Events.FRAG_PARSING_INIT_SEGMENT,{frag:B,id:c,tracks:G.tracks})),w){var H=w.startPTS,$=w.endPTS,te=w.startDTS,q=w.endDTS;N&&(N.elementaryStreams[L.ElementaryStreamTypes.AUDIO]={startPTS:H,endPTS:$,startDTS:te,endDTS:q}),B.setElementaryStreamInfo(L.ElementaryStreamTypes.AUDIO,H,$,te,q),this.bufferFragmentData(w,B,N,P)}if(j!=null&&(v=j.samples)!==null&&v!==void 0&&v.length){var ne=r({id:c,frag:B,details:U},j);d.trigger(E.Events.FRAG_PARSING_METADATA,ne)}if(W){var oe=r({id:c,frag:B,details:U},W);d.trigger(E.Events.FRAG_PARSING_USERDATA,oe)}}},m._bufferInitSegment=function(f,v,c){if(this.state===g.State.PARSING){f.video&&delete f.video;var d=f.audio;if(!!d){d.levelCodec=d.codec,d.id="audio",this.log("Init audio buffer, container:"+d.container+", codecs[parsed]=["+d.codec+"]"),this.hls.trigger(E.Events.BUFFER_CODECS,f);var x=d.initSegment;if(x!=null&&x.byteLength){var P={type:"audio",frag:v,part:null,chunkMeta:c,parent:v.type,data:x};this.hls.trigger(E.Events.BUFFER_APPENDING,P)}this.tick()}}},m.loadFragment=function(f,v,c){var d=this.fragmentTracker.getState(f);this.fragCurrent=f,(this.audioSwitch||d===_.FragmentState.NOT_LOADED||d===_.FragmentState.PARTIAL)&&(f.sn==="initSegment"?this._loadInitSegment(f):v.live&&!Object(D.isFiniteNumber)(this.initPTS[f.cc])?(this.log("Waiting for video PTS in continuity counter "+f.cc+" of live stream before loading audio fragment "+f.sn+" of level "+this.trackId),this.state=g.State.WAITING_INIT_PTS):(this.startFragRequested=!0,n.prototype.loadFragment.call(this,f,v,c)))},m.completeAudioSwitch=function(){var f=this.hls,v=this.media,c=this.trackId;v&&(this.log("Switching audio track : flushing all audio"),n.prototype.flushMainBuffer.call(this,0,Number.POSITIVE_INFINITY,"audio")),this.audioSwitch=!1,f.trigger(E.Events.AUDIO_TRACK_SWITCHED,{id:c})},i}(g.default);l.default=s},"./src/controller/audio-track-controller.ts":function(C,l,t){t.r(l);var D=t("./src/events.ts"),g=t("./src/errors.ts"),E=t("./src/controller/base-playlist-controller.ts"),F=t("./src/types/loader.ts");function _(A,O){for(var S=0;S<O.length;S++){var T=O[S];T.enumerable=T.enumerable||!1,T.configurable=!0,"value"in T&&(T.writable=!0),Object.defineProperty(A,T.key,T)}}function b(A,O,S){return O&&_(A.prototype,O),S&&_(A,S),Object.defineProperty(A,"prototype",{writable:!1}),A}function R(A,O){A.prototype=Object.create(O.prototype),A.prototype.constructor=A,L(A,O)}function L(A,O){return L=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(T,a){return T.__proto__=a,T},L(A,O)}var I=function(A){R(O,A);function O(T){var a;return a=A.call(this,T,"[audio-track-controller]")||this,a.tracks=[],a.groupId=null,a.tracksInGroup=[],a.trackId=-1,a.trackName="",a.selectDefaultTrack=!0,a.registerListeners(),a}var S=O.prototype;return S.registerListeners=function(){var a=this.hls;a.on(D.Events.MANIFEST_LOADING,this.onManifestLoading,this),a.on(D.Events.MANIFEST_PARSED,this.onManifestParsed,this),a.on(D.Events.LEVEL_LOADING,this.onLevelLoading,this),a.on(D.Events.LEVEL_SWITCHING,this.onLevelSwitching,this),a.on(D.Events.AUDIO_TRACK_LOADED,this.onAudioTrackLoaded,this),a.on(D.Events.ERROR,this.onError,this)},S.unregisterListeners=function(){var a=this.hls;a.off(D.Events.MANIFEST_LOADING,this.onManifestLoading,this),a.off(D.Events.MANIFEST_PARSED,this.onManifestParsed,this),a.off(D.Events.LEVEL_LOADING,this.onLevelLoading,this),a.off(D.Events.LEVEL_SWITCHING,this.onLevelSwitching,this),a.off(D.Events.AUDIO_TRACK_LOADED,this.onAudioTrackLoaded,this),a.off(D.Events.ERROR,this.onError,this)},S.destroy=function(){this.unregisterListeners(),this.tracks.length=0,this.tracksInGroup.length=0,A.prototype.destroy.call(this)},S.onManifestLoading=function(){this.tracks=[],this.groupId=null,this.tracksInGroup=[],this.trackId=-1,this.trackName="",this.selectDefaultTrack=!0},S.onManifestParsed=function(a,r){this.tracks=r.audioTracks||[]},S.onAudioTrackLoaded=function(a,r){var u=r.id,h=r.details,y=this.tracksInGroup[u];if(!y){this.warn("Invalid audio track id "+u);return}var s=y.details;y.details=r.details,this.log("audioTrack "+u+" loaded ["+h.startSN+"-"+h.endSN+"]"),u===this.trackId&&(this.retryCount=0,this.playlistLoaded(u,r,s))},S.onLevelLoading=function(a,r){this.switchLevel(r.level)},S.onLevelSwitching=function(a,r){this.switchLevel(r.level)},S.switchLevel=function(a){var r=this.hls.levels[a];if(!!(r!=null&&r.audioGroupIds)){var u=r.audioGroupIds[r.urlId];if(this.groupId!==u){this.groupId=u;var h=this.tracks.filter(function(s){return!u||s.groupId===u});this.selectDefaultTrack&&!h.some(function(s){return s.default})&&(this.selectDefaultTrack=!1),this.tracksInGroup=h;var y={audioTracks:h};this.log("Updating audio tracks, "+h.length+' track(s) found in "'+u+'" group-id'),this.hls.trigger(D.Events.AUDIO_TRACKS_UPDATED,y),this.selectInitialTrack()}}},S.onError=function(a,r){A.prototype.onError.call(this,a,r),!(r.fatal||!r.context)&&r.context.type===F.PlaylistContextType.AUDIO_TRACK&&r.context.id===this.trackId&&r.context.groupId===this.groupId&&this.retryLoadingOrFail(r)},S.setAudioTrack=function(a){var r=this.tracksInGroup;if(a<0||a>=r.length){this.warn("Invalid id passed to audio-track controller");return}this.clearTimer();var u=r[this.trackId];this.log("Now switching to audio-track index "+a);var h=r[a],y=h.id,s=h.groupId,n=s===void 0?"":s,i=h.name,m=h.type,o=h.url;if(this.trackId=a,this.trackName=i,this.selectDefaultTrack=!1,this.hls.trigger(D.Events.AUDIO_TRACK_SWITCHING,{id:y,groupId:n,name:i,type:m,url:o}),!(h.details&&!h.details.live)){var f=this.switchParams(h.url,u==null?void 0:u.details);this.loadPlaylist(f)}},S.selectInitialTrack=function(){var a=this.tracksInGroup;console.assert(a.length,"Initial audio track should be selected when tracks are known");var r=this.trackName,u=this.findTrackId(r)||this.findTrackId();u!==-1?this.setAudioTrack(u):(this.warn("No track found for running audio group-ID: "+this.groupId),this.hls.trigger(D.Events.ERROR,{type:g.ErrorTypes.MEDIA_ERROR,details:g.ErrorDetails.AUDIO_TRACK_LOAD_ERROR,fatal:!0}))},S.findTrackId=function(a){for(var r=this.tracksInGroup,u=0;u<r.length;u++){var h=r[u];if((!this.selectDefaultTrack||h.default)&&(!a||a===h.name))return h.id}return-1},S.loadPlaylist=function(a){var r=this.tracksInGroup[this.trackId];if(this.shouldLoadTrack(r)){var u=r.id,h=r.groupId,y=r.url;if(a)try{y=a.addDirectives(y)}catch(s){this.warn("Could not construct new URL with HLS Delivery Directives: "+s)}this.log("loading audio-track playlist for id: "+u),this.clearTimer(),this.hls.trigger(D.Events.AUDIO_TRACK_LOADING,{url:y,id:u,groupId:h,deliveryDirectives:a||null})}},b(O,[{key:"audioTracks",get:function(){return this.tracksInGroup}},{key:"audioTrack",get:function(){return this.trackId},set:function(a){this.selectDefaultTrack=!1,this.setAudioTrack(a)}}]),O}(E.default);l.default=I},"./src/controller/base-playlist-controller.ts":function(C,l,t){t.r(l),t.d(l,"default",function(){return b});var D=t("./src/polyfills/number.ts"),g=t("./src/types/level.ts"),E=t("./src/controller/level-helper.ts"),F=t("./src/utils/logger.ts"),_=t("./src/errors.ts"),b=function(){function R(I,A){this.hls=void 0,this.timer=-1,this.canLoad=!1,this.retryCount=0,this.log=void 0,this.warn=void 0,this.log=F.logger.log.bind(F.logger,A+":"),this.warn=F.logger.warn.bind(F.logger,A+":"),this.hls=I}var L=R.prototype;return L.destroy=function(){this.clearTimer(),this.hls=this.log=this.warn=null},L.onError=function(A,O){O.fatal&&O.type===_.ErrorTypes.NETWORK_ERROR&&this.clearTimer()},L.clearTimer=function(){clearTimeout(this.timer),this.timer=-1},L.startLoad=function(){this.canLoad=!0,this.retryCount=0,this.loadPlaylist()},L.stopLoad=function(){this.canLoad=!1,this.clearTimer()},L.switchParams=function(A,O){var S=O==null?void 0:O.renditionReports;if(S)for(var T=0;T<S.length;T++){var a=S[T],r=""+a.URI;if(r===A.slice(-r.length)){var u=parseInt(a["LAST-MSN"]),h=parseInt(a["LAST-PART"]);if(O&&this.hls.config.lowLatencyMode){var y=Math.min(O.age-O.partTarget,O.targetduration);h!==void 0&&y>O.partTarget&&(h+=1)}if(Object(D.isFiniteNumber)(u))return new g.HlsUrlParameters(u,Object(D.isFiniteNumber)(h)?h:void 0,g.HlsSkip.No)}}},L.loadPlaylist=function(A){},L.shouldLoadTrack=function(A){return this.canLoad&&A&&!!A.url&&(!A.details||A.details.live)},L.playlistLoaded=function(A,O,S){var T=this,a=O.details,r=O.stats,u=r.loading.end?Math.max(0,self.performance.now()-r.loading.end):0;if(a.advancedDateTime=Date.now()-u,a.live||S!=null&&S.live){if(a.reloaded(S),S&&this.log("live playlist "+A+" "+(a.advanced?"REFRESHED "+a.lastPartSn+"-"+a.lastPartIndex:"MISSED")),S&&a.fragments.length>0&&Object(E.mergeDetails)(S,a),!this.canLoad||!a.live)return;var h,y=void 0,s=void 0;if(a.canBlockReload&&a.endSN&&a.advanced){var n=this.hls.config.lowLatencyMode,i=a.lastPartSn,m=a.endSN,o=a.lastPartIndex,f=o!==-1,v=i===m,c=n?0:o;f?(y=v?m+1:i,s=v?c:o+1):y=m+1;var d=a.age,x=d+a.ageHeader,P=Math.min(x-a.partTarget,a.targetduration*1.5);if(P>0){if(S&&P>S.tuneInGoal)this.warn("CDN Tune-in goal increased from: "+S.tuneInGoal+" to: "+P+" with playlist age: "+a.age),P=0;else{var M=Math.floor(P/a.targetduration);if(y+=M,s!==void 0){var B=Math.round(P%a.targetduration/a.partTarget);s+=B}this.log("CDN Tune-in age: "+a.ageHeader+"s last advanced "+d.toFixed(2)+"s goal: "+P+" skip sn "+M+" to part "+s)}a.tuneInGoal=P}if(h=this.getDeliveryDirectives(a,O.deliveryDirectives,y,s),n||!v){this.loadPlaylist(h);return}}else h=this.getDeliveryDirectives(a,O.deliveryDirectives,y,s);var N=Object(E.computeReloadInterval)(a,r);y!==void 0&&a.canBlockReload&&(N-=a.partTarget||1),this.log("reload live playlist "+A+" in "+Math.round(N)+" ms"),this.timer=self.setTimeout(function(){return T.loadPlaylist(h)},N)}else this.clearTimer()},L.getDeliveryDirectives=function(A,O,S,T){var a=Object(g.getSkipValue)(A,S);return O!=null&&O.skip&&A.deltaUpdateFailed&&(S=O.msn,T=O.part,a=g.HlsSkip.No),new g.HlsUrlParameters(S,T,a)},L.retryLoadingOrFail=function(A){var O=this,S=this.hls.config,T=this.retryCount<S.levelLoadingMaxRetry;if(T){var a;if(this.retryCount++,A.details.indexOf("LoadTimeOut")>-1&&(a=A.context)!==null&&a!==void 0&&a.deliveryDirectives)this.warn("retry playlist loading #"+this.retryCount+' after "'+A.details+'"'),this.loadPlaylist();else{var r=Math.min(Math.pow(2,this.retryCount)*S.levelLoadingRetryDelay,S.levelLoadingMaxRetryTimeout);this.timer=self.setTimeout(function(){return O.loadPlaylist()},r),this.warn("retry playlist loading #"+this.retryCount+" in "+r+' ms after "'+A.details+'"')}}else this.warn('cannot recover from error "'+A.details+'"'),this.clearTimer(),A.fatal=!0;return T},R}()},"./src/controller/base-stream-controller.ts":function(C,l,t){t.r(l),t.d(l,"State",function(){return m}),t.d(l,"default",function(){return o});var D=t("./src/polyfills/number.ts"),g=t("./src/task-loop.ts"),E=t("./src/controller/fragment-tracker.ts"),F=t("./src/utils/buffer-helper.ts"),_=t("./src/utils/logger.ts"),b=t("./src/events.ts"),R=t("./src/errors.ts"),L=t("./src/types/transmuxer.ts"),I=t("./src/utils/mp4-tools.ts"),A=t("./src/utils/discontinuities.ts"),O=t("./src/controller/fragment-finders.ts"),S=t("./src/controller/level-helper.ts"),T=t("./src/loader/fragment-loader.ts"),a=t("./src/crypt/decrypter.ts"),r=t("./src/utils/time-ranges.ts"),u=t("./src/types/loader.ts");function h(f,v){for(var c=0;c<v.length;c++){var d=v[c];d.enumerable=d.enumerable||!1,d.configurable=!0,"value"in d&&(d.writable=!0),Object.defineProperty(f,d.key,d)}}function y(f,v,c){return v&&h(f.prototype,v),c&&h(f,c),Object.defineProperty(f,"prototype",{writable:!1}),f}function s(f){if(f===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return f}function n(f,v){f.prototype=Object.create(v.prototype),f.prototype.constructor=f,i(f,v)}function i(f,v){return i=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(d,x){return d.__proto__=x,d},i(f,v)}var m={STOPPED:"STOPPED",IDLE:"IDLE",KEY_LOADING:"KEY_LOADING",FRAG_LOADING:"FRAG_LOADING",FRAG_LOADING_WAITING_RETRY:"FRAG_LOADING_WAITING_RETRY",WAITING_TRACK:"WAITING_TRACK",PARSING:"PARSING",PARSED:"PARSED",ENDED:"ENDED",ERROR:"ERROR",WAITING_INIT_PTS:"WAITING_INIT_PTS",WAITING_LEVEL:"WAITING_LEVEL"},o=function(f){n(v,f);function v(d,x,P){var M;return M=f.call(this)||this,M.hls=void 0,M.fragPrevious=null,M.fragCurrent=null,M.fragmentTracker=void 0,M.transmuxer=null,M._state=m.STOPPED,M.media=null,M.mediaBuffer=null,M.config=void 0,M.bitrateTest=!1,M.lastCurrentTime=0,M.nextLoadPosition=0,M.startPosition=0,M.loadedmetadata=!1,M.fragLoadError=0,M.retryDate=0,M.levels=null,M.fragmentLoader=void 0,M.levelLastLoaded=null,M.startFragRequested=!1,M.decrypter=void 0,M.initPTS=[],M.onvseeking=null,M.onvended=null,M.logPrefix="",M.log=void 0,M.warn=void 0,M.logPrefix=P,M.log=_.logger.log.bind(_.logger,P+":"),M.warn=_.logger.warn.bind(_.logger,P+":"),M.hls=d,M.fragmentLoader=new T.default(d.config),M.fragmentTracker=x,M.config=d.config,M.decrypter=new a.default(d,d.config),d.on(b.Events.KEY_LOADED,M.onKeyLoaded,s(M)),d.on(b.Events.LEVEL_SWITCHING,M.onLevelSwitching,s(M)),M}var c=v.prototype;return c.doTick=function(){this.onTickEnd()},c.onTickEnd=function(){},c.startLoad=function(x){},c.stopLoad=function(){this.fragmentLoader.abort();var x=this.fragCurrent;x&&this.fragmentTracker.removeFragment(x),this.resetTransmuxer(),this.fragCurrent=null,this.fragPrevious=null,this.clearInterval(),this.clearNextTick(),this.state=m.STOPPED},c._streamEnded=function(x,P){var M=this.fragCurrent,B=this.fragmentTracker;if(!P.live&&M&&this.media&&M.sn>=P.endSN&&!x.nextStart){var N=P.partList;if(N!=null&&N.length){var U=N[N.length-1],w=F.BufferHelper.isBuffered(this.media,U.start+U.duration/2);return w}var W=B.getState(M);return W===E.FragmentState.PARTIAL||W===E.FragmentState.OK}return!1},c.onMediaAttached=function(x,P){var M=this.media=this.mediaBuffer=P.media;this.onvseeking=this.onMediaSeeking.bind(this),this.onvended=this.onMediaEnded.bind(this),M.addEventListener("seeking",this.onvseeking),M.addEventListener("ended",this.onvended);var B=this.config;this.levels&&B.autoStartLoad&&this.state===m.STOPPED&&this.startLoad(B.startPosition)},c.onMediaDetaching=function(){var x=this.media;x!=null&&x.ended&&(this.log("MSE detaching and video ended, reset startPosition"),this.startPosition=this.lastCurrentTime=0),x&&this.onvseeking&&this.onvended&&(x.removeEventListener("seeking",this.onvseeking),x.removeEventListener("ended",this.onvended),this.onvseeking=this.onvended=null),this.media=this.mediaBuffer=null,this.loadedmetadata=!1,this.fragmentTracker.removeAllFragments(),this.stopLoad()},c.onMediaSeeking=function(){var x=this.config,P=this.fragCurrent,M=this.media,B=this.mediaBuffer,N=this.state,U=M?M.currentTime:0,w=F.BufferHelper.bufferInfo(B||M,U,x.maxBufferHole);if(this.log("media seeking to "+(Object(D.isFiniteNumber)(U)?U.toFixed(3):U)+", state: "+N),N===m.ENDED)this.resetLoadingState();else if(P&&!w.len){var W=x.maxFragLookUpTolerance,j=P.start-W,G=P.start+P.duration+W,H=U>G;(U<j||H)&&(H&&P.loader&&(this.log("seeking outside of buffer while fragment load in progress, cancel fragment load"),P.loader.abort()),this.resetLoadingState())}M&&(this.lastCurrentTime=U),!this.loadedmetadata&&!w.len&&(this.nextLoadPosition=this.startPosition=U),this.tickImmediate()},c.onMediaEnded=function(){this.startPosition=this.lastCurrentTime=0},c.onKeyLoaded=function(x,P){if(!(this.state!==m.KEY_LOADING||P.frag!==this.fragCurrent||!this.levels)){this.state=m.IDLE;var M=this.levels[P.frag.level].details;M&&this.loadFragment(P.frag,M,P.frag.start)}},c.onLevelSwitching=function(x,P){this.fragLoadError=0},c.onHandlerDestroying=function(){this.stopLoad(),f.prototype.onHandlerDestroying.call(this)},c.onHandlerDestroyed=function(){this.state=m.STOPPED,this.hls.off(b.Events.KEY_LOADED,this.onKeyLoaded,this),this.hls.off(b.Events.LEVEL_SWITCHING,this.onLevelSwitching,this),this.fragmentLoader&&this.fragmentLoader.destroy(),this.decrypter&&this.decrypter.destroy(),this.hls=this.log=this.warn=this.decrypter=this.fragmentLoader=this.fragmentTracker=null,f.prototype.onHandlerDestroyed.call(this)},c.loadKey=function(x,P){this.log("Loading key for "+x.sn+" of ["+P.startSN+"-"+P.endSN+"], "+(this.logPrefix==="[stream-controller]"?"level":"track")+" "+x.level),this.state=m.KEY_LOADING,this.fragCurrent=x,this.hls.trigger(b.Events.KEY_LOADING,{frag:x})},c.loadFragment=function(x,P,M){this._loadFragForPlayback(x,P,M)},c._loadFragForPlayback=function(x,P,M){var B=this,N=function(w){if(B.fragContextChanged(x)){B.warn("Fragment "+x.sn+(w.part?" p: "+w.part.index:"")+" of level "+x.level+" was dropped during download."),B.fragmentTracker.removeFragment(x);return}x.stats.chunkCount++,B._handleFragmentLoadProgress(w)};this._doFragLoad(x,P,M,N).then(function(U){if(!!U){B.fragLoadError=0;var w=B.state;if(B.fragContextChanged(x)){(w===m.FRAG_LOADING||!B.fragCurrent&&w===m.PARSING)&&(B.fragmentTracker.removeFragment(x),B.state=m.IDLE);return}"payload"in U&&(B.log("Loaded fragment "+x.sn+" of level "+x.level),B.hls.trigger(b.Events.FRAG_LOADED,U)),B._handleFragmentLoadComplete(U)}}).catch(function(U){B.state===m.STOPPED||B.state===m.ERROR||(B.warn(U),B.resetFragmentLoading(x))})},c.flushMainBuffer=function(x,P,M){if(M===void 0&&(M=null),!!(x-P)){var B={startOffset:x,endOffset:P,type:M};this.fragLoadError=0,this.hls.trigger(b.Events.BUFFER_FLUSHING,B)}},c._loadInitSegment=function(x){var P=this;this._doFragLoad(x).then(function(M){if(!M||P.fragContextChanged(x)||!P.levels)throw new Error("init load aborted");return M}).then(function(M){var B=P.hls,N=M.payload,U=x.decryptdata;if(N&&N.byteLength>0&&U&&U.key&&U.iv&&U.method==="AES-128"){var w=self.performance.now();return P.decrypter.webCryptoDecrypt(new Uint8Array(N),U.key.buffer,U.iv.buffer).then(function(W){var j=self.performance.now();return B.trigger(b.Events.FRAG_DECRYPTED,{frag:x,payload:W,stats:{tstart:w,tdecrypt:j}}),M.payload=W,M})}return M}).then(function(M){var B=P.fragCurrent,N=P.hls,U=P.levels;if(!U)throw new Error("init load aborted, missing levels");var w=U[x.level].details;console.assert(w,"Level details are defined when init segment is loaded");var W=x.stats;P.state=m.IDLE,P.fragLoadError=0,x.data=new Uint8Array(M.payload),W.parsing.start=W.buffering.start=self.performance.now(),W.parsing.end=W.buffering.end=self.performance.now(),M.frag===B&&N.trigger(b.Events.FRAG_BUFFERED,{stats:W,frag:B,part:null,id:x.type}),P.tick()}).catch(function(M){P.state===m.STOPPED||P.state===m.ERROR||(P.warn(M),P.resetFragmentLoading(x))})},c.fragContextChanged=function(x){var P=this.fragCurrent;return!x||!P||x.level!==P.level||x.sn!==P.sn||x.urlId!==P.urlId},c.fragBufferedComplete=function(x,P){var M=this.mediaBuffer?this.mediaBuffer:this.media;this.log("Buffered "+x.type+" sn: "+x.sn+(P?" part: "+P.index:"")+" of "+(this.logPrefix==="[stream-controller]"?"level":"track")+" "+x.level+" "+(M?r.default.toString(F.BufferHelper.getBuffered(M)):"(detached)")),this.state=m.IDLE,M&&(!this.loadedmetadata&&M.buffered.length&&this.fragCurrent===this.fragPrevious&&(this.loadedmetadata=!0,this.seekToStartPos()),this.tick())},c.seekToStartPos=function(){},c._handleFragmentLoadComplete=function(x){var P=this.transmuxer;if(!!P){var M=x.frag,B=x.part,N=x.partsLoaded,U=!N||N.length===0||N.some(function(W){return!W}),w=new L.ChunkMetadata(M.level,M.sn,M.stats.chunkCount+1,0,B?B.index:-1,!U);P.flush(w)}},c._handleFragmentLoadProgress=function(x){},c._doFragLoad=function(x,P,M,B){var N=this;if(M===void 0&&(M=null),!this.levels)throw new Error("frag load aborted, missing levels");if(M=Math.max(x.start,M||0),this.config.lowLatencyMode&&P){var U=P.partList;if(U&&B){M>x.end&&P.fragmentHint&&(x=P.fragmentHint);var w=this.getNextPart(U,x,M);if(w>-1){var W=U[w];return this.log("Loading part sn: "+x.sn+" p: "+W.index+" cc: "+x.cc+" of playlist ["+P.startSN+"-"+P.endSN+"] parts [0-"+w+"-"+(U.length-1)+"] "+(this.logPrefix==="[stream-controller]"?"level":"track")+": "+x.level+", target: "+parseFloat(M.toFixed(3))),this.nextLoadPosition=W.start+W.duration,this.state=m.FRAG_LOADING,this.hls.trigger(b.Events.FRAG_LOADING,{frag:x,part:U[w],targetBufferTime:M}),this.doFragPartsLoad(x,U,w,B).catch(function(j){return N.handleFragLoadError(j)})}else if(!x.url||this.loadedEndOfParts(U,M))return Promise.resolve(null)}}return this.log("Loading fragment "+x.sn+" cc: "+x.cc+" "+(P?"of ["+P.startSN+"-"+P.endSN+"] ":"")+(this.logPrefix==="[stream-controller]"?"level":"track")+": "+x.level+", target: "+parseFloat(M.toFixed(3))),Object(D.isFiniteNumber)(x.sn)&&!this.bitrateTest&&(this.nextLoadPosition=x.start+x.duration),this.state=m.FRAG_LOADING,this.hls.trigger(b.Events.FRAG_LOADING,{frag:x,targetBufferTime:M}),this.fragmentLoader.load(x,B).catch(function(j){return N.handleFragLoadError(j)})},c.doFragPartsLoad=function(x,P,M,B){var N=this;return new Promise(function(U,w){var W=[],j=function G(H){var $=P[H];N.fragmentLoader.loadPart(x,$,B).then(function(te){W[$.index]=te;var q=te.part;N.hls.trigger(b.Events.FRAG_LOADED,te);var ne=P[H+1];if(ne&&ne.fragment===x)G(H+1);else return U({frag:x,part:q,partsLoaded:W})}).catch(w)};j(M)})},c.handleFragLoadError=function(x){var P=x.data;return P&&P.details===R.ErrorDetails.INTERNAL_ABORTED?this.handleFragLoadAborted(P.frag,P.part):this.hls.trigger(b.Events.ERROR,P),null},c._handleTransmuxerFlush=function(x){var P=this.getCurrentContext(x);if(!P||this.state!==m.PARSING){this.fragCurrent||(this.state=m.IDLE);return}var M=P.frag,B=P.part,N=P.level,U=self.performance.now();M.stats.parsing.end=U,B&&(B.stats.parsing.end=U),this.updateLevelTiming(M,B,N,x.partial)},c.getCurrentContext=function(x){var P=this.levels,M=x.level,B=x.sn,N=x.part;if(!P||!P[M])return this.warn("Levels object was unset while buffering fragment "+B+" of level "+M+". The current chunk will not be buffered."),null;var U=P[M],w=N>-1?Object(S.getPartWith)(U,B,N):null,W=w?w.fragment:Object(S.getFragmentWithSN)(U,B,this.fragCurrent);return W?{frag:W,part:w,level:U}:null},c.bufferFragmentData=function(x,P,M,B){if(!(!x||this.state!==m.PARSING)){var N=x.data1,U=x.data2,w=N;if(N&&U&&(w=Object(I.appendUint8Array)(N,U)),!(!w||!w.length)){var W={type:x.type,frag:P,part:M,chunkMeta:B,parent:P.type,data:w};this.hls.trigger(b.Events.BUFFER_APPENDING,W),x.dropped&&x.independent&&!M&&this.flushBufferGap(P)}}},c.flushBufferGap=function(x){var P=this.media;if(!!P){if(!F.BufferHelper.isBuffered(P,P.currentTime)){this.flushMainBuffer(0,x.start);return}var M=P.currentTime,B=F.BufferHelper.bufferInfo(P,M,0),N=x.duration,U=Math.min(this.config.maxFragLookUpTolerance*2,N*.25),w=Math.max(Math.min(x.start-U,B.end-U),M+U);x.start-w>U&&this.flushMainBuffer(w,x.start)}},c.getFwdBufferInfo=function(x,P){var M=this.config,B=this.getLoadPosition();if(!Object(D.isFiniteNumber)(B))return null;var N=F.BufferHelper.bufferInfo(x,B,M.maxBufferHole);if(N.len===0&&N.nextStart!==void 0){var U=this.fragmentTracker.getBufferedFrag(B,P);if(U&&N.nextStart<U.end)return F.BufferHelper.bufferInfo(x,B,Math.max(N.nextStart,M.maxBufferHole))}return N},c.getMaxBufferLength=function(x){var P=this.config,M;return x?M=Math.max(8*P.maxBufferSize/x,P.maxBufferLength):M=P.maxBufferLength,Math.min(M,P.maxMaxBufferLength)},c.reduceMaxBufferLength=function(x){var P=this.config,M=x||P.maxBufferLength;return P.maxMaxBufferLength>=M?(P.maxMaxBufferLength/=2,this.warn("Reduce max buffer length to "+P.maxMaxBufferLength+"s"),!0):!1},c.getNextFragment=function(x,P){var M=P.fragments,B=M.length;if(!B)return null;var N=this.config,U=M[0].start,w;if(P.live){var W=N.initialLiveManifestSize;if(B<W)return this.warn("Not enough fragments to start playback (have: "+B+", need: "+W+")"),null;!P.PTSKnown&&!this.startFragRequested&&this.startPosition===-1&&(w=this.getInitialLiveFragment(P,M),this.startPosition=w?this.hls.liveSyncPosition||w.start:x)}else x<=U&&(w=M[0]);if(!w){var j=N.lowLatencyMode?P.partEnd:P.fragmentEnd;w=this.getFragmentAtPosition(x,j,P)}return this.mapToInitFragWhenRequired(w)},c.mapToInitFragWhenRequired=function(x){return x!=null&&x.initSegment&&!(x!=null&&x.initSegment.data)&&!this.bitrateTest?x.initSegment:x},c.getNextPart=function(x,P,M){for(var B=-1,N=!1,U=!0,w=0,W=x.length;w<W;w++){var j=x[w];if(U=U&&!j.independent,B>-1&&M<j.start)break;var G=j.loaded;!G&&(N||j.independent||U)&&j.fragment===P&&(B=w),N=G}return B},c.loadedEndOfParts=function(x,P){var M=x[x.length-1];return M&&P>M.start&&M.loaded},c.getInitialLiveFragment=function(x,P){var M=this.fragPrevious,B=null;if(M){if(x.hasProgramDateTime&&(this.log("Live playlist, switching playlist, load frag with same PDT: "+M.programDateTime),B=Object(O.findFragmentByPDT)(P,M.endProgramDateTime,this.config.maxFragLookUpTolerance)),!B){var N=M.sn+1;if(N>=x.startSN&&N<=x.endSN){var U=P[N-x.startSN];M.cc===U.cc&&(B=U,this.log("Live playlist, switching playlist, load frag with next SN: "+B.sn))}B||(B=Object(O.findFragWithCC)(P,M.cc),B&&this.log("Live playlist, switching playlist, load frag with same CC: "+B.sn))}}else{var w=this.hls.liveSyncPosition;w!==null&&(B=this.getFragmentAtPosition(w,this.bitrateTest?x.fragmentEnd:x.edge,x))}return B},c.getFragmentAtPosition=function(x,P,M){var B=this.config,N=this.fragPrevious,U=M.fragments,w=M.endSN,W=M.fragmentHint,j=B.maxFragLookUpTolerance,G=!!(B.lowLatencyMode&&M.partList&&W);G&&W&&!this.bitrateTest&&(U=U.concat(W),w=W.sn);var H;if(x<P){var $=x>P-j?0:j;H=Object(O.findFragmentByPTS)(N,U,x,$)}else H=U[U.length-1];if(H){var te=H.sn-M.startSN;if(N&&H.sn===N.sn&&!G){var q=N&&H.level===N.level;if(q){var ne=U[te+1];H.sn<w&&this.fragmentTracker.getState(ne)!==E.FragmentState.OK?(this.log("SN "+H.sn+" just loaded, load next one: "+ne.sn),H=ne):H=null}}}return H},c.synchronizeToLiveEdge=function(x){var P=this.config,M=this.media;if(!!M){var B=this.hls.liveSyncPosition,N=M.currentTime,U=x.fragments[0].start,w=x.edge,W=N>=U-P.maxFragLookUpTolerance&&N<=w;if(B!==null&&M.duration>B&&(N<B||!W)){var j=P.liveMaxLatencyDuration!==void 0?P.liveMaxLatencyDuration:P.liveMaxLatencyDurationCount*x.targetduration;(!W&&M.readyState<4||N<w-j)&&(this.loadedmetadata||(this.nextLoadPosition=B),M.readyState&&(this.warn("Playback: "+N.toFixed(3)+" is located too far from the end of live sliding playlist: "+w+", reset currentTime to : "+B.toFixed(3)),M.currentTime=B))}}},c.alignPlaylists=function(x,P){var M=this.levels,B=this.levelLastLoaded,N=this.fragPrevious,U=B!==null?M[B]:null,w=x.fragments.length;if(!w)return this.warn("No fragments in live playlist"),0;var W=x.fragments[0].start,j=!P,G=x.alignedSliding&&Object(D.isFiniteNumber)(W);if(j||!G&&!W){Object(A.alignStream)(N,U,x);var H=x.fragments[0].start;return this.log("Live playlist sliding: "+H.toFixed(2)+" start-sn: "+(P?P.startSN:"na")+"->"+x.startSN+" prev-sn: "+(N?N.sn:"na")+" fragments: "+w),H}return W},c.waitForCdnTuneIn=function(x){var P=3;return x.live&&x.canBlockReload&&x.partTarget&&x.tuneInGoal>Math.max(x.partHoldBack,x.partTarget*P)},c.setStartPosition=function(x,P){var M=this.startPosition;if(M<P&&(M=-1),M===-1||this.lastCurrentTime===-1){var B=x.startTimeOffset;Object(D.isFiniteNumber)(B)?(M=P+B,B<0&&(M+=x.totalduration),M=Math.min(Math.max(P,M),P+x.totalduration),this.log("Start time offset "+B+" found in playlist, adjust startPosition to "+M),this.startPosition=M):x.live?M=this.hls.liveSyncPosition||P:this.startPosition=M=0,this.lastCurrentTime=M}this.nextLoadPosition=M},c.getLoadPosition=function(){var x=this.media,P=0;return this.loadedmetadata&&x?P=x.currentTime:this.nextLoadPosition&&(P=this.nextLoadPosition),P},c.handleFragLoadAborted=function(x,P){this.transmuxer&&x.sn!=="initSegment"&&x.stats.aborted&&(this.warn("Fragment "+x.sn+(P?" part"+P.index:"")+" of level "+x.level+" was aborted"),this.resetFragmentLoading(x))},c.resetFragmentLoading=function(x){(!this.fragCurrent||!this.fragContextChanged(x)&&this.state!==m.FRAG_LOADING_WAITING_RETRY)&&(this.state=m.IDLE)},c.onFragmentOrKeyLoadError=function(x,P){if(!P.fatal){var M=P.frag;if(!(!M||M.type!==x)){var B=this.fragCurrent;console.assert(B&&M.sn===B.sn&&M.level===B.level&&M.urlId===B.urlId,"Frag load error must match current frag to retry");var N=this.config;if(this.fragLoadError+1<=N.fragLoadingMaxRetry){this.loadedmetadata||(this.startFragRequested=!1,this.nextLoadPosition=this.startPosition);var U=Math.min(Math.pow(2,this.fragLoadError)*N.fragLoadingRetryDelay,N.fragLoadingMaxRetryTimeout);this.warn("Fragment "+M.sn+" of "+x+" "+M.level+" failed to load, retrying in "+U+"ms"),this.retryDate=self.performance.now()+U,this.fragLoadError++,this.state=m.FRAG_LOADING_WAITING_RETRY}else P.levelRetry?(x===u.PlaylistLevelType.AUDIO&&(this.fragCurrent=null),this.fragLoadError=0,this.state=m.IDLE):(_.logger.error(P.details+" reaches max retry, redispatch as fatal ..."),P.fatal=!0,this.hls.stopLoad(),this.state=m.ERROR)}}},c.afterBufferFlushed=function(x,P,M){if(!!x){var B=F.BufferHelper.getBuffered(x);this.fragmentTracker.detectEvictedFragments(P,B,M),this.state===m.ENDED&&this.resetLoadingState()}},c.resetLoadingState=function(){this.fragCurrent=null,this.fragPrevious=null,this.state=m.IDLE},c.resetStartWhenNotLoaded=function(x){if(!this.loadedmetadata){this.startFragRequested=!1;var P=this.levels?this.levels[x].details:null;P!=null&&P.live?(this.startPosition=-1,this.setStartPosition(P,0),this.resetLoadingState()):this.nextLoadPosition=this.startPosition}},c.updateLevelTiming=function(x,P,M,B){var N=this,U=M.details;console.assert(!!U,"level.details must be defined");var w=Object.keys(x.elementaryStreams).reduce(function(W,j){var G=x.elementaryStreams[j];if(G){var H=G.endPTS-G.startPTS;if(H<=0)return N.warn("Could not parse fragment "+x.sn+" "+j+" duration reliably ("+H+")"),W||!1;var $=B?0:Object(S.updateFragPTSDTS)(U,x,G.startPTS,G.endPTS,G.startDTS,G.endDTS);return N.hls.trigger(b.Events.LEVEL_PTS_UPDATED,{details:U,level:M,drift:$,type:j,frag:x,start:G.startPTS,end:G.endPTS}),!0}return W},!1);w||(this.warn("Found no media in fragment "+x.sn+" of level "+M.id+" resetting transmuxer to fallback to playlist timing"),this.resetTransmuxer()),this.state=m.PARSED,this.hls.trigger(b.Events.FRAG_PARSED,{frag:x,part:P})},c.resetTransmuxer=function(){this.transmuxer&&(this.transmuxer.destroy(),this.transmuxer=null)},y(v,[{key:"state",get:function(){return this._state},set:function(x){var P=this._state;P!==x&&(this._state=x,this.log(P+"->"+x))}}]),v}(g.default)},"./src/controller/buffer-controller.ts":function(C,l,t){t.r(l),t.d(l,"default",function(){return O});var D=t("./src/polyfills/number.ts"),g=t("./src/events.ts"),E=t("./src/utils/logger.ts"),F=t("./src/errors.ts"),_=t("./src/utils/buffer-helper.ts"),b=t("./src/utils/mediasource-helper.ts"),R=t("./src/loader/fragment.ts"),L=t("./src/controller/buffer-operation-queue.ts"),I=Object(b.getMediaSource)(),A=/([ha]vc.)(?:\.[^.,]+)+/,O=function(){function S(a){var r=this;this.details=null,this._objectUrl=null,this.operationQueue=void 0,this.listeners=void 0,this.hls=void 0,this.bufferCodecEventsExpected=0,this._bufferCodecEventsTotal=0,this.media=null,this.mediaSource=null,this.appendError=0,this.tracks={},this.pendingTracks={},this.sourceBuffer=void 0,this._onMediaSourceOpen=function(){var u=r.hls,h=r.media,y=r.mediaSource;E.logger.log("[buffer-controller]: Media source opened"),h&&(r.updateMediaElementDuration(),u.trigger(g.Events.MEDIA_ATTACHED,{media:h})),y&&y.removeEventListener("sourceopen",r._onMediaSourceOpen),r.checkPendingTracks()},this._onMediaSourceClose=function(){E.logger.log("[buffer-controller]: Media source closed")},this._onMediaSourceEnded=function(){E.logger.log("[buffer-controller]: Media source ended")},this.hls=a,this._initSourceBuffer(),this.registerListeners()}var T=S.prototype;return T.hasSourceTypes=function(){return this.getSourceBufferTypes().length>0||Object.keys(this.pendingTracks).length>0},T.destroy=function(){this.unregisterListeners(),this.details=null},T.registerListeners=function(){var r=this.hls;r.on(g.Events.MEDIA_ATTACHING,this.onMediaAttaching,this),r.on(g.Events.MEDIA_DETACHING,this.onMediaDetaching,this),r.on(g.Events.MANIFEST_PARSED,this.onManifestParsed,this),r.on(g.Events.BUFFER_RESET,this.onBufferReset,this),r.on(g.Events.BUFFER_APPENDING,this.onBufferAppending,this),r.on(g.Events.BUFFER_CODECS,this.onBufferCodecs,this),r.on(g.Events.BUFFER_EOS,this.onBufferEos,this),r.on(g.Events.BUFFER_FLUSHING,this.onBufferFlushing,this),r.on(g.Events.LEVEL_UPDATED,this.onLevelUpdated,this),r.on(g.Events.FRAG_PARSED,this.onFragParsed,this),r.on(g.Events.FRAG_CHANGED,this.onFragChanged,this)},T.unregisterListeners=function(){var r=this.hls;r.off(g.Events.MEDIA_ATTACHING,this.onMediaAttaching,this),r.off(g.Events.MEDIA_DETACHING,this.onMediaDetaching,this),r.off(g.Events.MANIFEST_PARSED,this.onManifestParsed,this),r.off(g.Events.BUFFER_RESET,this.onBufferReset,this),r.off(g.Events.BUFFER_APPENDING,this.onBufferAppending,this),r.off(g.Events.BUFFER_CODECS,this.onBufferCodecs,this),r.off(g.Events.BUFFER_EOS,this.onBufferEos,this),r.off(g.Events.BUFFER_FLUSHING,this.onBufferFlushing,this),r.off(g.Events.LEVEL_UPDATED,this.onLevelUpdated,this),r.off(g.Events.FRAG_PARSED,this.onFragParsed,this),r.off(g.Events.FRAG_CHANGED,this.onFragChanged,this)},T._initSourceBuffer=function(){this.sourceBuffer={},this.operationQueue=new L.default(this.sourceBuffer),this.listeners={audio:[],video:[],audiovideo:[]}},T.onManifestParsed=function(r,u){var h=2;(u.audio&&!u.video||!u.altAudio)&&(h=1),this.bufferCodecEventsExpected=this._bufferCodecEventsTotal=h,this.details=null,E.logger.log(this.bufferCodecEventsExpected+" bufferCodec event(s) expected")},T.onMediaAttaching=function(r,u){var h=this.media=u.media;if(h&&I){var y=this.mediaSource=new I;y.addEventListener("sourceopen",this._onMediaSourceOpen),y.addEventListener("sourceended",this._onMediaSourceEnded),y.addEventListener("sourceclose",this._onMediaSourceClose),h.src=self.URL.createObjectURL(y),this._objectUrl=h.src}},T.onMediaDetaching=function(){var r=this.media,u=this.mediaSource,h=this._objectUrl;if(u){if(E.logger.log("[buffer-controller]: media source detaching"),u.readyState==="open")try{u.endOfStream()}catch(y){E.logger.warn("[buffer-controller]: onMediaDetaching: "+y.message+" while calling endOfStream")}this.onBufferReset(),u.removeEventListener("sourceopen",this._onMediaSourceOpen),u.removeEventListener("sourceended",this._onMediaSourceEnded),u.removeEventListener("sourceclose",this._onMediaSourceClose),r&&(h&&self.URL.revokeObjectURL(h),r.src===h?(r.removeAttribute("src"),r.load()):E.logger.warn("[buffer-controller]: media.src was changed by a third party - skip cleanup")),this.mediaSource=null,this.media=null,this._objectUrl=null,this.bufferCodecEventsExpected=this._bufferCodecEventsTotal,this.pendingTracks={},this.tracks={}}this.hls.trigger(g.Events.MEDIA_DETACHED,void 0)},T.onBufferReset=function(){var r=this;this.getSourceBufferTypes().forEach(function(u){var h=r.sourceBuffer[u];try{h&&(r.removeBufferListeners(u),r.mediaSource&&r.mediaSource.removeSourceBuffer(h),r.sourceBuffer[u]=void 0)}catch(y){E.logger.warn("[buffer-controller]: Failed to reset the "+u+" buffer",y)}}),this._initSourceBuffer()},T.onBufferCodecs=function(r,u){var h=this,y=this.getSourceBufferTypes().length;Object.keys(u).forEach(function(s){if(y){var n=h.tracks[s];if(n&&typeof n.buffer.changeType=="function"){var i=u[s],m=i.id,o=i.codec,f=i.levelCodec,v=i.container,c=i.metadata,d=(n.levelCodec||n.codec).replace(A,"$1"),x=(f||o).replace(A,"$1");if(d!==x){var P=v+";codecs="+(f||o);h.appendChangeType(s,P),E.logger.log("[buffer-controller]: switching codec "+d+" to "+x),h.tracks[s]={buffer:n.buffer,codec:o,container:v,levelCodec:f,metadata:c,id:m}}}}else h.pendingTracks[s]=u[s]}),!y&&(this.bufferCodecEventsExpected=Math.max(this.bufferCodecEventsExpected-1,0),this.mediaSource&&this.mediaSource.readyState==="open"&&this.checkPendingTracks())},T.appendChangeType=function(r,u){var h=this,y=this.operationQueue,s={execute:function(){var i=h.sourceBuffer[r];i&&(E.logger.log("[buffer-controller]: changing "+r+" sourceBuffer type to "+u),i.changeType(u)),y.shiftAndExecuteNext(r)},onStart:function(){},onComplete:function(){},onError:function(i){E.logger.warn("[buffer-controller]: Failed to change "+r+" SourceBuffer type",i)}};y.append(s,r)},T.onBufferAppending=function(r,u){var h=this,y=this.hls,s=this.operationQueue,n=this.tracks,i=u.data,m=u.type,o=u.frag,f=u.part,v=u.chunkMeta,c=v.buffering[m],d=self.performance.now();c.start=d;var x=o.stats.buffering,P=f?f.stats.buffering:null;x.start===0&&(x.start=d),P&&P.start===0&&(P.start=d);var M=n.audio,B=m==="audio"&&v.id===1&&(M==null?void 0:M.container)==="audio/mpeg",N={execute:function(){if(c.executeStart=self.performance.now(),B){var w=h.sourceBuffer[m];if(w){var W=o.start-w.timestampOffset;Math.abs(W)>=.1&&(E.logger.log("[buffer-controller]: Updating audio SourceBuffer timestampOffset to "+o.start+" (delta: "+W+") sn: "+o.sn+")"),w.timestampOffset=o.start)}}h.appendExecutor(i,m)},onStart:function(){},onComplete:function(){var w=self.performance.now();c.executeEnd=c.end=w,x.first===0&&(x.first=w),P&&P.first===0&&(P.first=w);var W=h.sourceBuffer,j={};for(var G in W)j[G]=_.BufferHelper.getBuffered(W[G]);h.appendError=0,h.hls.trigger(g.Events.BUFFER_APPENDED,{type:m,frag:o,part:f,chunkMeta:v,parent:o.type,timeRanges:j})},onError:function(w){E.logger.error("[buffer-controller]: Error encountered while trying to append to the "+m+" SourceBuffer",w);var W={type:F.ErrorTypes.MEDIA_ERROR,parent:o.type,details:F.ErrorDetails.BUFFER_APPEND_ERROR,err:w,fatal:!1};w.code===DOMException.QUOTA_EXCEEDED_ERR?W.details=F.ErrorDetails.BUFFER_FULL_ERROR:(h.appendError++,W.details=F.ErrorDetails.BUFFER_APPEND_ERROR,h.appendError>y.config.appendErrorMaxRetry&&(E.logger.error("[buffer-controller]: Failed "+y.config.appendErrorMaxRetry+" times to append segment in sourceBuffer"),W.fatal=!0,y.stopLoad())),y.trigger(g.Events.ERROR,W)}};s.append(N,m)},T.onBufferFlushing=function(r,u){var h=this,y=this.operationQueue,s=function(i){return{execute:h.removeExecutor.bind(h,i,u.startOffset,u.endOffset),onStart:function(){},onComplete:function(){h.hls.trigger(g.Events.BUFFER_FLUSHED,{type:i})},onError:function(o){E.logger.warn("[buffer-controller]: Failed to remove from "+i+" SourceBuffer",o)}}};u.type?y.append(s(u.type),u.type):this.getSourceBufferTypes().forEach(function(n){y.append(s(n),n)})},T.onFragParsed=function(r,u){var h=this,y=u.frag,s=u.part,n=[],i=s?s.elementaryStreams:y.elementaryStreams;i[R.ElementaryStreamTypes.AUDIOVIDEO]?n.push("audiovideo"):(i[R.ElementaryStreamTypes.AUDIO]&&n.push("audio"),i[R.ElementaryStreamTypes.VIDEO]&&n.push("video"));var m=function(){var f=self.performance.now();y.stats.buffering.end=f,s&&(s.stats.buffering.end=f);var v=s?s.stats:y.stats;h.hls.trigger(g.Events.FRAG_BUFFERED,{frag:y,part:s,stats:v,id:y.type})};n.length===0&&E.logger.warn("Fragments must have at least one ElementaryStreamType set. type: "+y.type+" level: "+y.level+" sn: "+y.sn),this.blockBuffers(m,n)},T.onFragChanged=function(r,u){this.flushBackBuffer()},T.onBufferEos=function(r,u){var h=this,y=this.getSourceBufferTypes().reduce(function(s,n){var i=h.sourceBuffer[n];return(!u.type||u.type===n)&&i&&!i.ended&&(i.ended=!0,E.logger.log("[buffer-controller]: "+n+" sourceBuffer now EOS")),s&&!!(!i||i.ended)},!0);y&&this.blockBuffers(function(){var s=h.mediaSource;!s||s.readyState!=="open"||s.endOfStream()})},T.onLevelUpdated=function(r,u){var h=u.details;!h.fragments.length||(this.details=h,this.getSourceBufferTypes().length?this.blockBuffers(this.updateMediaElementDuration.bind(this)):this.updateMediaElementDuration())},T.flushBackBuffer=function(){var r=this.hls,u=this.details,h=this.media,y=this.sourceBuffer;if(!(!h||u===null)){var s=this.getSourceBufferTypes();if(!!s.length){var n=u.live&&r.config.liveBackBufferLength!==null?r.config.liveBackBufferLength:r.config.backBufferLength;if(!(!Object(D.isFiniteNumber)(n)||n<0)){var i=h.currentTime,m=u.levelTargetDuration,o=Math.max(n,m),f=Math.floor(i/m)*m-o;s.forEach(function(v){var c=y[v];if(c){var d=_.BufferHelper.getBuffered(c);d.length>0&&f>d.start(0)&&(r.trigger(g.Events.BACK_BUFFER_REACHED,{bufferEnd:f}),u.live&&r.trigger(g.Events.LIVE_BACK_BUFFER_REACHED,{bufferEnd:f}),r.trigger(g.Events.BUFFER_FLUSHING,{startOffset:0,endOffset:f,type:v}))}})}}}},T.updateMediaElementDuration=function(){if(!(!this.details||!this.media||!this.mediaSource||this.mediaSource.readyState!=="open")){var r=this.details,u=this.hls,h=this.media,y=this.mediaSource,s=r.fragments[0].start+r.totalduration,n=h.duration,i=Object(D.isFiniteNumber)(y.duration)?y.duration:0;r.live&&u.config.liveDurationInfinity?(E.logger.log("[buffer-controller]: Media Source duration is set to Infinity"),y.duration=1/0,this.updateSeekableRange(r)):(s>i&&s>n||!Object(D.isFiniteNumber)(n))&&(E.logger.log("[buffer-controller]: Updating Media Source duration to "+s.toFixed(3)),y.duration=s)}},T.updateSeekableRange=function(r){var u=this.mediaSource,h=r.fragments,y=h.length;if(y&&r.live&&u!==null&&u!==void 0&&u.setLiveSeekableRange){var s=Math.max(0,h[0].start),n=Math.max(s,s+r.totalduration);u.setLiveSeekableRange(s,n)}},T.checkPendingTracks=function(){var r=this.bufferCodecEventsExpected,u=this.operationQueue,h=this.pendingTracks,y=Object.keys(h).length;if(y&&!r||y===2){this.createSourceBuffers(h),this.pendingTracks={};var s=this.getSourceBufferTypes();if(s.length===0){this.hls.trigger(g.Events.ERROR,{type:F.ErrorTypes.MEDIA_ERROR,details:F.ErrorDetails.BUFFER_INCOMPATIBLE_CODECS_ERROR,fatal:!0,reason:"could not create source buffer for media codec(s)"});return}s.forEach(function(n){u.executeNext(n)})}},T.createSourceBuffers=function(r){var u=this.sourceBuffer,h=this.mediaSource;if(!h)throw Error("createSourceBuffers called when mediaSource was null");var y=0;for(var s in r)if(!u[s]){var n=r[s];if(!n)throw Error("source buffer exists for track "+s+", however track does not");var i=n.levelCodec||n.codec,m=n.container+";codecs="+i;E.logger.log("[buffer-controller]: creating sourceBuffer("+m+")");try{var o=u[s]=h.addSourceBuffer(m),f=s;this.addBufferListener(f,"updatestart",this._onSBUpdateStart),this.addBufferListener(f,"updateend",this._onSBUpdateEnd),this.addBufferListener(f,"error",this._onSBUpdateError),this.tracks[s]={buffer:o,codec:i,container:n.container,levelCodec:n.levelCodec,metadata:n.metadata,id:n.id},y++}catch(v){E.logger.error("[buffer-controller]: error while trying to add sourceBuffer: "+v.message),this.hls.trigger(g.Events.ERROR,{type:F.ErrorTypes.MEDIA_ERROR,details:F.ErrorDetails.BUFFER_ADD_CODEC_ERROR,fatal:!1,error:v,mimeType:m})}}y&&this.hls.trigger(g.Events.BUFFER_CREATED,{tracks:this.tracks})},T._onSBUpdateStart=function(r){var u=this.operationQueue,h=u.current(r);h.onStart()},T._onSBUpdateEnd=function(r){var u=this.operationQueue,h=u.current(r);h.onComplete(),u.shiftAndExecuteNext(r)},T._onSBUpdateError=function(r,u){E.logger.error("[buffer-controller]: "+r+" SourceBuffer error",u),this.hls.trigger(g.Events.ERROR,{type:F.ErrorTypes.MEDIA_ERROR,details:F.ErrorDetails.BUFFER_APPENDING_ERROR,fatal:!1});var h=this.operationQueue.current(r);h&&h.onError(u)},T.removeExecutor=function(r,u,h){var y=this.media,s=this.mediaSource,n=this.operationQueue,i=this.sourceBuffer,m=i[r];if(!y||!s||!m){E.logger.warn("[buffer-controller]: Attempting to remove from the "+r+" SourceBuffer, but it does not exist"),n.shiftAndExecuteNext(r);return}var o=Object(D.isFiniteNumber)(y.duration)?y.duration:1/0,f=Object(D.isFiniteNumber)(s.duration)?s.duration:1/0,v=Math.max(0,u),c=Math.min(h,o,f);c>v?(E.logger.log("[buffer-controller]: Removing ["+v+","+c+"] from the "+r+" SourceBuffer"),console.assert(!m.updating,r+" sourceBuffer must not be updating"),m.remove(v,c)):n.shiftAndExecuteNext(r)},T.appendExecutor=function(r,u){var h=this.operationQueue,y=this.sourceBuffer,s=y[u];if(!s){E.logger.warn("[buffer-controller]: Attempting to append to the "+u+" SourceBuffer, but it does not exist"),h.shiftAndExecuteNext(u);return}s.ended=!1,console.assert(!s.updating,u+" sourceBuffer must not be updating"),s.appendBuffer(r)},T.blockBuffers=function(r,u){var h=this;if(u===void 0&&(u=this.getSourceBufferTypes()),!u.length){E.logger.log("[buffer-controller]: Blocking operation requested, but no SourceBuffers exist"),Promise.resolve().then(r);return}var y=this.operationQueue,s=u.map(function(n){return y.appendBlocker(n)});Promise.all(s).then(function(){r(),u.forEach(function(n){var i=h.sourceBuffer[n];(!i||!i.updating)&&y.shiftAndExecuteNext(n)})})},T.getSourceBufferTypes=function(){return Object.keys(this.sourceBuffer)},T.addBufferListener=function(r,u,h){var y=this.sourceBuffer[r];if(!!y){var s=h.bind(this,r);this.listeners[r].push({event:u,listener:s}),y.addEventListener(u,s)}},T.removeBufferListeners=function(r){var u=this.sourceBuffer[r];!u||this.listeners[r].forEach(function(h){u.removeEventListener(h.event,h.listener)})},S}()},"./src/controller/buffer-operation-queue.ts":function(C,l,t){t.r(l),t.d(l,"default",function(){return g});var D=t("./src/utils/logger.ts"),g=function(){function E(_){this.buffers=void 0,this.queues={video:[],audio:[],audiovideo:[]},this.buffers=_}var F=E.prototype;return F.append=function(b,R){var L=this.queues[R];L.push(b),L.length===1&&this.buffers[R]&&this.executeNext(R)},F.insertAbort=function(b,R){var L=this.queues[R];L.unshift(b),this.executeNext(R)},F.appendBlocker=function(b){var R,L=new Promise(function(A){R=A}),I={execute:R,onStart:function(){},onComplete:function(){},onError:function(){}};return this.append(I,b),L},F.executeNext=function(b){var R=this.buffers,L=this.queues,I=R[b],A=L[b];if(A.length){var O=A[0];try{O.execute()}catch(S){D.logger.warn("[buffer-operation-queue]: Unhandled exception executing the current operation"),O.onError(S),(!I||!I.updating)&&(A.shift(),this.executeNext(b))}}},F.shiftAndExecuteNext=function(b){this.queues[b].shift(),this.executeNext(b)},F.current=function(b){return this.queues[b][0]},E}()},"./src/controller/cap-level-controller.ts":function(C,l,t){t.r(l);var D=t("./src/events.ts");function g(_,b){for(var R=0;R<b.length;R++){var L=b[R];L.enumerable=L.enumerable||!1,L.configurable=!0,"value"in L&&(L.writable=!0),Object.defineProperty(_,L.key,L)}}function E(_,b,R){return b&&g(_.prototype,b),R&&g(_,R),Object.defineProperty(_,"prototype",{writable:!1}),_}var F=function(){function _(R){this.autoLevelCapping=void 0,this.firstLevel=void 0,this.media=void 0,this.restrictedLevels=void 0,this.timer=void 0,this.hls=void 0,this.streamController=void 0,this.clientRect=void 0,this.hls=R,this.autoLevelCapping=Number.POSITIVE_INFINITY,this.firstLevel=-1,this.media=null,this.restrictedLevels=[],this.timer=void 0,this.clientRect=null,this.registerListeners()}var b=_.prototype;return b.setStreamController=function(L){this.streamController=L},b.destroy=function(){this.unregisterListener(),this.hls.config.capLevelToPlayerSize&&this.stopCapping(),this.media=null,this.clientRect=null,this.hls=this.streamController=null},b.registerListeners=function(){var L=this.hls;L.on(D.Events.FPS_DROP_LEVEL_CAPPING,this.onFpsDropLevelCapping,this),L.on(D.Events.MEDIA_ATTACHING,this.onMediaAttaching,this),L.on(D.Events.MANIFEST_PARSED,this.onManifestParsed,this),L.on(D.Events.BUFFER_CODECS,this.onBufferCodecs,this),L.on(D.Events.MEDIA_DETACHING,this.onMediaDetaching,this)},b.unregisterListener=function(){var L=this.hls;L.off(D.Events.FPS_DROP_LEVEL_CAPPING,this.onFpsDropLevelCapping,this),L.off(D.Events.MEDIA_ATTACHING,this.onMediaAttaching,this),L.off(D.Events.MANIFEST_PARSED,this.onManifestParsed,this),L.off(D.Events.BUFFER_CODECS,this.onBufferCodecs,this),L.off(D.Events.MEDIA_DETACHING,this.onMediaDetaching,this)},b.onFpsDropLevelCapping=function(L,I){_.isLevelAllowed(I.droppedLevel,this.restrictedLevels)&&this.restrictedLevels.push(I.droppedLevel)},b.onMediaAttaching=function(L,I){this.media=I.media instanceof HTMLVideoElement?I.media:null},b.onManifestParsed=function(L,I){var A=this.hls;this.restrictedLevels=[],this.firstLevel=I.firstLevel,A.config.capLevelToPlayerSize&&I.video&&this.startCapping()},b.onBufferCodecs=function(L,I){var A=this.hls;A.config.capLevelToPlayerSize&&I.video&&this.startCapping()},b.onMediaDetaching=function(){this.stopCapping()},b.detectPlayerSize=function(){if(this.media&&this.mediaHeight>0&&this.mediaWidth>0){var L=this.hls.levels;if(L.length){var I=this.hls;I.autoLevelCapping=this.getMaxLevel(L.length-1),I.autoLevelCapping>this.autoLevelCapping&&this.streamController&&this.streamController.nextLevelSwitch(),this.autoLevelCapping=I.autoLevelCapping}}},b.getMaxLevel=function(L){var I=this,A=this.hls.levels;if(!A.length)return-1;var O=A.filter(function(S,T){return _.isLevelAllowed(T,I.restrictedLevels)&&T<=L});return this.clientRect=null,_.getMaxLevelByMediaSize(O,this.mediaWidth,this.mediaHeight)},b.startCapping=function(){this.timer||(this.autoLevelCapping=Number.POSITIVE_INFINITY,this.hls.firstLevel=this.getMaxLevel(this.firstLevel),self.clearInterval(this.timer),this.timer=self.setInterval(this.detectPlayerSize.bind(this),1e3),this.detectPlayerSize())},b.stopCapping=function(){this.restrictedLevels=[],this.firstLevel=-1,this.autoLevelCapping=Number.POSITIVE_INFINITY,this.timer&&(self.clearInterval(this.timer),this.timer=void 0)},b.getDimensions=function(){if(this.clientRect)return this.clientRect;var L=this.media,I={width:0,height:0};if(L){var A=L.getBoundingClientRect();I.width=A.width,I.height=A.height,!I.width&&!I.height&&(I.width=A.right-A.left||L.width||0,I.height=A.bottom-A.top||L.height||0)}return this.clientRect=I,I},_.isLevelAllowed=function(L,I){return I===void 0&&(I=[]),I.indexOf(L)===-1},_.getMaxLevelByMediaSize=function(L,I,A){if(!L||!L.length)return-1;for(var O=function(u,h){return h?u.width!==h.width||u.height!==h.height:!0},S=L.length-1,T=0;T<L.length;T+=1){var a=L[T];if((a.width>=I||a.height>=A)&&O(a,L[T+1])){S=T;break}}return S},E(_,[{key:"mediaWidth",get:function(){return this.getDimensions().width*this.contentScaleFactor}},{key:"mediaHeight",get:function(){return this.getDimensions().height*this.contentScaleFactor}},{key:"contentScaleFactor",get:function(){var L=1;if(!this.hls.config.ignoreDevicePixelRatio)try{L=self.devicePixelRatio}catch{}return L}}]),_}();l.default=F},"./src/controller/cmcd-controller.ts":function(C,l,t){t.r(l),t.d(l,"default",function(){return O});var D=t("./src/events.ts"),g=t("./src/types/cmcd.ts"),E=t("./src/utils/buffer-helper.ts"),F=t("./src/utils/logger.ts");function _(S,T){for(var a=0;a<T.length;a++){var r=T[a];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(S,r.key,r)}}function b(S,T,a){return T&&_(S.prototype,T),a&&_(S,a),Object.defineProperty(S,"prototype",{writable:!1}),S}function R(S,T){var a=typeof Symbol<"u"&&S[Symbol.iterator]||S["@@iterator"];if(a)return(a=a.call(S)).next.bind(a);if(Array.isArray(S)||(a=L(S))||T&&S&&typeof S.length=="number"){a&&(S=a);var r=0;return function(){return r>=S.length?{done:!0}:{done:!1,value:S[r++]}}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function L(S,T){if(!!S){if(typeof S=="string")return I(S,T);var a=Object.prototype.toString.call(S).slice(8,-1);if(a==="Object"&&S.constructor&&(a=S.constructor.name),a==="Map"||a==="Set")return Array.from(S);if(a==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(a))return I(S,T)}}function I(S,T){(T==null||T>S.length)&&(T=S.length);for(var a=0,r=new Array(T);a<T;a++)r[a]=S[a];return r}function A(){return A=Object.assign?Object.assign.bind():function(S){for(var T=1;T<arguments.length;T++){var a=arguments[T];for(var r in a)Object.prototype.hasOwnProperty.call(a,r)&&(S[r]=a[r])}return S},A.apply(this,arguments)}var O=function(){function S(a){var r=this;this.hls=void 0,this.config=void 0,this.media=void 0,this.sid=void 0,this.cid=void 0,this.useHeaders=!1,this.initialized=!1,this.starved=!1,this.buffering=!0,this.audioBuffer=void 0,this.videoBuffer=void 0,this.onWaiting=function(){r.initialized&&(r.starved=!0),r.buffering=!0},this.onPlaying=function(){r.initialized||(r.initialized=!0),r.buffering=!1},this.applyPlaylistData=function(y){try{r.apply(y,{ot:g.CMCDObjectType.MANIFEST,su:!r.initialized})}catch(s){F.logger.warn("Could not generate manifest CMCD data.",s)}},this.applyFragmentData=function(y){try{var s=y.frag,n=r.hls.levels[s.level],i=r.getObjectType(s),m={d:s.duration*1e3,ot:i};(i===g.CMCDObjectType.VIDEO||i===g.CMCDObjectType.AUDIO||i==g.CMCDObjectType.MUXED)&&(m.br=n.bitrate/1e3,m.tb=r.getTopBandwidth(i)/1e3,m.bl=r.getBufferLength(i)),r.apply(y,m)}catch(o){F.logger.warn("Could not generate segment CMCD data.",o)}},this.hls=a;var u=this.config=a.config,h=u.cmcd;h!=null&&(u.pLoader=this.createPlaylistLoader(),u.fLoader=this.createFragmentLoader(),this.sid=h.sessionId||S.uuid(),this.cid=h.contentId,this.useHeaders=h.useHeaders===!0,this.registerListeners())}var T=S.prototype;return T.registerListeners=function(){var r=this.hls;r.on(D.Events.MEDIA_ATTACHED,this.onMediaAttached,this),r.on(D.Events.MEDIA_DETACHED,this.onMediaDetached,this),r.on(D.Events.BUFFER_CREATED,this.onBufferCreated,this)},T.unregisterListeners=function(){var r=this.hls;r.off(D.Events.MEDIA_ATTACHED,this.onMediaAttached,this),r.off(D.Events.MEDIA_DETACHED,this.onMediaDetached,this),r.off(D.Events.BUFFER_CREATED,this.onBufferCreated,this),this.onMediaDetached()},T.destroy=function(){this.unregisterListeners(),this.hls=this.config=this.audioBuffer=this.videoBuffer=null},T.onMediaAttached=function(r,u){this.media=u.media,this.media.addEventListener("waiting",this.onWaiting),this.media.addEventListener("playing",this.onPlaying)},T.onMediaDetached=function(){!this.media||(this.media.removeEventListener("waiting",this.onWaiting),this.media.removeEventListener("playing",this.onPlaying),this.media=null)},T.onBufferCreated=function(r,u){var h,y;this.audioBuffer=(h=u.tracks.audio)===null||h===void 0?void 0:h.buffer,this.videoBuffer=(y=u.tracks.video)===null||y===void 0?void 0:y.buffer},T.createData=function(){var r;return{v:g.CMCDVersion,sf:g.CMCDStreamingFormat.HLS,sid:this.sid,cid:this.cid,pr:(r=this.media)===null||r===void 0?void 0:r.playbackRate,mtp:this.hls.bandwidthEstimate/1e3}},T.apply=function(r,u){u===void 0&&(u={}),A(u,this.createData());var h=u.ot===g.CMCDObjectType.INIT||u.ot===g.CMCDObjectType.VIDEO||u.ot===g.CMCDObjectType.MUXED;if(this.starved&&h&&(u.bs=!0,u.su=!0,this.starved=!1),u.su==null&&(u.su=this.buffering),this.useHeaders){var y=S.toHeaders(u);if(!Object.keys(y).length)return;r.headers||(r.headers={}),A(r.headers,y)}else{var s=S.toQuery(u);if(!s)return;r.url=S.appendQueryToUri(r.url,s)}},T.getObjectType=function(r){var u=r.type;if(u==="subtitle")return g.CMCDObjectType.TIMED_TEXT;if(r.sn==="initSegment")return g.CMCDObjectType.INIT;if(u==="audio")return g.CMCDObjectType.AUDIO;if(u==="main")return this.hls.audioTracks.length?g.CMCDObjectType.VIDEO:g.CMCDObjectType.MUXED},T.getTopBandwidth=function(r){var u=0,h,y=this.hls;if(r===g.CMCDObjectType.AUDIO)h=y.audioTracks;else{var s=y.maxAutoLevel,n=s>-1?s+1:y.levels.length;h=y.levels.slice(0,n)}for(var i=R(h),m;!(m=i()).done;){var o=m.value;o.bitrate>u&&(u=o.bitrate)}return u>0?u:NaN},T.getBufferLength=function(r){var u=this.hls.media,h=r===g.CMCDObjectType.AUDIO?this.audioBuffer:this.videoBuffer;if(!h||!u)return NaN;var y=E.BufferHelper.bufferInfo(h,u.currentTime,this.config.maxBufferHole);return y.len*1e3},T.createPlaylistLoader=function(){var r=this.config.pLoader,u=this.applyPlaylistData,h=r||this.config.loader;return function(){function y(n){this.loader=void 0,this.loader=new h(n)}var s=y.prototype;return s.destroy=function(){this.loader.destroy()},s.abort=function(){this.loader.abort()},s.load=function(i,m,o){u(i),this.loader.load(i,m,o)},b(y,[{key:"stats",get:function(){return this.loader.stats}},{key:"context",get:function(){return this.loader.context}}]),y}()},T.createFragmentLoader=function(){var r=this.config.fLoader,u=this.applyFragmentData,h=r||this.config.loader;return function(){function y(n){this.loader=void 0,this.loader=new h(n)}var s=y.prototype;return s.destroy=function(){this.loader.destroy()},s.abort=function(){this.loader.abort()},s.load=function(i,m,o){u(i),this.loader.load(i,m,o)},b(y,[{key:"stats",get:function(){return this.loader.stats}},{key:"context",get:function(){return this.loader.context}}]),y}()},S.uuid=function(){var r=URL.createObjectURL(new Blob),u=r.toString();return URL.revokeObjectURL(r),u.slice(u.lastIndexOf("/")+1)},S.serialize=function(r){for(var u=[],h=function(B){return!Number.isNaN(B)&&B!=null&&B!==""&&B!==!1},y=function(B){return Math.round(B)},s=function(B){return y(B/100)*100},n=function(B){return encodeURIComponent(B)},i={br:y,d:y,bl:s,dl:s,mtp:s,nor:n,rtp:s,tb:y},m=Object.keys(r||{}).sort(),o=R(m),f;!(f=o()).done;){var v=f.value,c=r[v];if(!!h(c)&&!(v==="v"&&c===1)&&!(v=="pr"&&c===1)){var d=i[v];d&&(c=d(c));var x=typeof c,P=void 0;v==="ot"||v==="sf"||v==="st"?P=v+"="+c:x==="boolean"?P=v:x==="number"?P=v+"="+c:P=v+"="+JSON.stringify(c),u.push(P)}}return u.join(",")},S.toHeaders=function(r){for(var u=Object.keys(r),h={},y=["Object","Request","Session","Status"],s=[{},{},{},{}],n={br:0,d:0,ot:0,tb:0,bl:1,dl:1,mtp:1,nor:1,nrr:1,su:1,cid:2,pr:2,sf:2,sid:2,st:2,v:2,bs:3,rtp:3},i=0,m=u;i<m.length;i++){var o=m[i],f=n[o]!=null?n[o]:1;s[f][o]=r[o]}for(var v=0;v<s.length;v++){var c=S.serialize(s[v]);c&&(h["CMCD-"+y[v]]=c)}return h},S.toQuery=function(r){return"CMCD="+encodeURIComponent(S.serialize(r))},S.appendQueryToUri=function(r,u){if(!u)return r;var h=r.includes("?")?"&":"?";return""+r+h+u},S}()},"./src/controller/eme-controller.ts":function(C,l,t){t.r(l);var D=t("./src/events.ts"),g=t("./src/errors.ts"),E=t("./src/utils/logger.ts"),F=t("./src/utils/mediakeys-helper.ts");function _(O,S){for(var T=0;T<S.length;T++){var a=S[T];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(O,a.key,a)}}function b(O,S,T){return S&&_(O.prototype,S),T&&_(O,T),Object.defineProperty(O,"prototype",{writable:!1}),O}var R=3,L=function(S,T,a){var r={audioCapabilities:[],videoCapabilities:[]};return S.forEach(function(u){r.audioCapabilities.push({contentType:'audio/mp4; codecs="'+u+'"',robustness:a.audioRobustness||""})}),T.forEach(function(u){r.videoCapabilities.push({contentType:'video/mp4; codecs="'+u+'"',robustness:a.videoRobustness||""})}),[r]},I=function(S,T,a,r){switch(S){case F.KeySystems.WIDEVINE:return L(T,a,r);default:throw new Error("Unknown key-system: "+S)}},A=function(){function O(T){this.hls=void 0,this._widevineLicenseUrl=void 0,this._licenseXhrSetup=void 0,this._licenseResponseCallback=void 0,this._emeEnabled=void 0,this._requestMediaKeySystemAccess=void 0,this._drmSystemOptions=void 0,this._config=void 0,this._mediaKeysList=[],this._media=null,this._hasSetMediaKeys=!1,this._requestLicenseFailureCount=0,this.mediaKeysPromise=null,this._onMediaEncrypted=this.onMediaEncrypted.bind(this),this.hls=T,this._config=T.config,this._widevineLicenseUrl=this._config.widevineLicenseUrl,this._licenseXhrSetup=this._config.licenseXhrSetup,this._licenseResponseCallback=this._config.licenseResponseCallback,this._emeEnabled=this._config.emeEnabled,this._requestMediaKeySystemAccess=this._config.requestMediaKeySystemAccessFunc,this._drmSystemOptions=this._config.drmSystemOptions,this._registerListeners()}var S=O.prototype;return S.destroy=function(){this._unregisterListeners(),this.hls=this._onMediaEncrypted=null,this._requestMediaKeySystemAccess=null},S._registerListeners=function(){this.hls.on(D.Events.MEDIA_ATTACHED,this.onMediaAttached,this),this.hls.on(D.Events.MEDIA_DETACHED,this.onMediaDetached,this),this.hls.on(D.Events.MANIFEST_PARSED,this.onManifestParsed,this)},S._unregisterListeners=function(){this.hls.off(D.Events.MEDIA_ATTACHED,this.onMediaAttached,this),this.hls.off(D.Events.MEDIA_DETACHED,this.onMediaDetached,this),this.hls.off(D.Events.MANIFEST_PARSED,this.onManifestParsed,this)},S.getLicenseServerUrl=function(a){switch(a){case F.KeySystems.WIDEVINE:if(!this._widevineLicenseUrl)break;return this._widevineLicenseUrl}throw new Error('no license server URL configured for key-system "'+a+'"')},S._attemptKeySystemAccess=function(a,r,u){var h=this,y=I(a,r,u,this._drmSystemOptions);E.logger.log("Requesting encrypted media key-system access");var s=this.requestMediaKeySystemAccess(a,y);this.mediaKeysPromise=s.then(function(n){return h._onMediaKeySystemAccessObtained(a,n)}),s.catch(function(n){E.logger.error('Failed to obtain key-system "'+a+'" access:',n)})},S._onMediaKeySystemAccessObtained=function(a,r){var u=this;E.logger.log('Access for key-system "'+a+'" obtained');var h={mediaKeysSessionInitialized:!1,mediaKeySystemAccess:r,mediaKeySystemDomain:a};this._mediaKeysList.push(h);var y=Promise.resolve().then(function(){return r.createMediaKeys()}).then(function(s){return h.mediaKeys=s,E.logger.log('Media-keys created for key-system "'+a+'"'),u._onMediaKeysCreated(),s});return y.catch(function(s){E.logger.error("Failed to create media-keys:",s)}),y},S._onMediaKeysCreated=function(){var a=this;this._mediaKeysList.forEach(function(r){r.mediaKeysSession||(r.mediaKeysSession=r.mediaKeys.createSession(),a._onNewMediaKeySession(r.mediaKeysSession))})},S._onNewMediaKeySession=function(a){var r=this;E.logger.log("New key-system session "+a.sessionId),a.addEventListener("message",function(u){r._onKeySessionMessage(a,u.message)},!1)},S._onKeySessionMessage=function(a,r){E.logger.log("Got EME message event, creating license request"),this._requestLicense(r,function(u){E.logger.log("Received license data (length: "+(u&&u.byteLength)+"), updating key-session"),a.update(u).catch(function(h){E.logger.warn("Updating key-session failed: "+h)})})},S.onMediaEncrypted=function(a){var r=this;if(E.logger.log('Media is encrypted using "'+a.initDataType+'" init data type'),!this.mediaKeysPromise){E.logger.error("Fatal: Media is encrypted but no CDM access or no keys have been requested"),this.hls.trigger(D.Events.ERROR,{type:g.ErrorTypes.KEY_SYSTEM_ERROR,details:g.ErrorDetails.KEY_SYSTEM_NO_KEYS,fatal:!0});return}var u=function(y){!r._media||(r._attemptSetMediaKeys(y),r._generateRequestWithPreferredKeySession(a.initDataType,a.initData))};this.mediaKeysPromise.then(u).catch(u)},S._attemptSetMediaKeys=function(a){if(!this._media)throw new Error("Attempted to set mediaKeys without first attaching a media element");if(!this._hasSetMediaKeys){var r=this._mediaKeysList[0];if(!r||!r.mediaKeys){E.logger.error("Fatal: Media is encrypted but no CDM access or no keys have been obtained yet"),this.hls.trigger(D.Events.ERROR,{type:g.ErrorTypes.KEY_SYSTEM_ERROR,details:g.ErrorDetails.KEY_SYSTEM_NO_KEYS,fatal:!0});return}E.logger.log("Setting keys for encrypted media"),this._media.setMediaKeys(r.mediaKeys),this._hasSetMediaKeys=!0}},S._generateRequestWithPreferredKeySession=function(a,r){var u=this,h=this._mediaKeysList[0];if(!h){E.logger.error("Fatal: Media is encrypted but not any key-system access has been obtained yet"),this.hls.trigger(D.Events.ERROR,{type:g.ErrorTypes.KEY_SYSTEM_ERROR,details:g.ErrorDetails.KEY_SYSTEM_NO_ACCESS,fatal:!0});return}if(h.mediaKeysSessionInitialized){E.logger.warn("Key-Session already initialized but requested again");return}var y=h.mediaKeysSession;if(!y){E.logger.error("Fatal: Media is encrypted but no key-session existing"),this.hls.trigger(D.Events.ERROR,{type:g.ErrorTypes.KEY_SYSTEM_ERROR,details:g.ErrorDetails.KEY_SYSTEM_NO_SESSION,fatal:!0});return}if(!r){E.logger.warn("Fatal: initData required for generating a key session is null"),this.hls.trigger(D.Events.ERROR,{type:g.ErrorTypes.KEY_SYSTEM_ERROR,details:g.ErrorDetails.KEY_SYSTEM_NO_INIT_DATA,fatal:!0});return}E.logger.log('Generating key-session request for "'+a+'" init data type'),h.mediaKeysSessionInitialized=!0,y.generateRequest(a,r).then(function(){E.logger.debug("Key-session generation succeeded")}).catch(function(s){E.logger.error("Error generating key-session request:",s),u.hls.trigger(D.Events.ERROR,{type:g.ErrorTypes.KEY_SYSTEM_ERROR,details:g.ErrorDetails.KEY_SYSTEM_NO_SESSION,fatal:!1})})},S._createLicenseXhr=function(a,r,u){var h=new XMLHttpRequest;h.responseType="arraybuffer",h.onreadystatechange=this._onLicenseRequestReadyStageChange.bind(this,h,a,r,u);var y=this._licenseXhrSetup;if(y)try{y.call(this.hls,h,a),y=void 0}catch(s){E.logger.error(s)}try{h.readyState||h.open("POST",a,!0),y&&y.call(this.hls,h,a)}catch(s){throw new Error("issue setting up KeySystem license XHR "+s)}return h},S._onLicenseRequestReadyStageChange=function(a,r,u,h){switch(a.readyState){case 4:if(a.status===200){this._requestLicenseFailureCount=0,E.logger.log("License request succeeded");var y=a.response,s=this._licenseResponseCallback;if(s)try{y=s.call(this.hls,a,r)}catch(i){E.logger.error(i)}h(y)}else{if(E.logger.error("License Request XHR failed ("+r+"). Status: "+a.status+" ("+a.statusText+")"),this._requestLicenseFailureCount++,this._requestLicenseFailureCount>R){this.hls.trigger(D.Events.ERROR,{type:g.ErrorTypes.KEY_SYSTEM_ERROR,details:g.ErrorDetails.KEY_SYSTEM_LICENSE_REQUEST_FAILED,fatal:!0});return}var n=R-this._requestLicenseFailureCount+1;E.logger.warn("Retrying license request, "+n+" attempts left"),this._requestLicense(u,h)}break}},S._generateLicenseRequestChallenge=function(a,r){switch(a.mediaKeySystemDomain){case F.KeySystems.WIDEVINE:return r}throw new Error("unsupported key-system: "+a.mediaKeySystemDomain)},S._requestLicense=function(a,r){E.logger.log("Requesting content license for key-system");var u=this._mediaKeysList[0];if(!u){E.logger.error("Fatal error: Media is encrypted but no key-system access has been obtained yet"),this.hls.trigger(D.Events.ERROR,{type:g.ErrorTypes.KEY_SYSTEM_ERROR,details:g.ErrorDetails.KEY_SYSTEM_NO_ACCESS,fatal:!0});return}try{var h=this.getLicenseServerUrl(u.mediaKeySystemDomain),y=this._createLicenseXhr(h,a,r);E.logger.log("Sending license request to URL: "+h);var s=this._generateLicenseRequestChallenge(u,a);y.send(s)}catch(n){E.logger.error("Failure requesting DRM license: "+n),this.hls.trigger(D.Events.ERROR,{type:g.ErrorTypes.KEY_SYSTEM_ERROR,details:g.ErrorDetails.KEY_SYSTEM_LICENSE_REQUEST_FAILED,fatal:!0})}},S.onMediaAttached=function(a,r){if(!!this._emeEnabled){var u=r.media;this._media=u,u.addEventListener("encrypted",this._onMediaEncrypted)}},S.onMediaDetached=function(){var a=this._media,r=this._mediaKeysList;!a||(a.removeEventListener("encrypted",this._onMediaEncrypted),this._media=null,this._mediaKeysList=[],Promise.all(r.map(function(u){if(u.mediaKeysSession)return u.mediaKeysSession.close().catch(function(){})})).then(function(){return a.setMediaKeys(null)}).catch(function(){}))},S.onManifestParsed=function(a,r){if(!!this._emeEnabled){var u=r.levels.map(function(y){return y.audioCodec}).filter(function(y){return!!y}),h=r.levels.map(function(y){return y.videoCodec}).filter(function(y){return!!y});this._attemptKeySystemAccess(F.KeySystems.WIDEVINE,u,h)}},b(O,[{key:"requestMediaKeySystemAccess",get:function(){if(!this._requestMediaKeySystemAccess)throw new Error("No requestMediaKeySystemAccess function configured");return this._requestMediaKeySystemAccess}}]),O}();l.default=A},"./src/controller/fps-controller.ts":function(C,l,t){t.r(l);var D=t("./src/events.ts"),g=t("./src/utils/logger.ts"),E=function(){function F(b){this.hls=void 0,this.isVideoPlaybackQualityAvailable=!1,this.timer=void 0,this.media=null,this.lastTime=void 0,this.lastDroppedFrames=0,this.lastDecodedFrames=0,this.streamController=void 0,this.hls=b,this.registerListeners()}var _=F.prototype;return _.setStreamController=function(R){this.streamController=R},_.registerListeners=function(){this.hls.on(D.Events.MEDIA_ATTACHING,this.onMediaAttaching,this)},_.unregisterListeners=function(){this.hls.off(D.Events.MEDIA_ATTACHING,this.onMediaAttaching)},_.destroy=function(){this.timer&&clearInterval(this.timer),this.unregisterListeners(),this.isVideoPlaybackQualityAvailable=!1,this.media=null},_.onMediaAttaching=function(R,L){var I=this.hls.config;if(I.capLevelOnFPSDrop){var A=L.media instanceof self.HTMLVideoElement?L.media:null;this.media=A,A&&typeof A.getVideoPlaybackQuality=="function"&&(this.isVideoPlaybackQualityAvailable=!0),self.clearInterval(this.timer),this.timer=self.setInterval(this.checkFPSInterval.bind(this),I.fpsDroppedMonitoringPeriod)}},_.checkFPS=function(R,L,I){var A=performance.now();if(L){if(this.lastTime){var O=A-this.lastTime,S=I-this.lastDroppedFrames,T=L-this.lastDecodedFrames,a=1e3*S/O,r=this.hls;if(r.trigger(D.Events.FPS_DROP,{currentDropped:S,currentDecoded:T,totalDroppedFrames:I}),a>0&&S>r.config.fpsDroppedMonitoringThreshold*T){var u=r.currentLevel;g.logger.warn("drop FPS ratio greater than max allowed value for currentLevel: "+u),u>0&&(r.autoLevelCapping===-1||r.autoLevelCapping>=u)&&(u=u-1,r.trigger(D.Events.FPS_DROP_LEVEL_CAPPING,{level:u,droppedLevel:r.currentLevel}),r.autoLevelCapping=u,this.streamController.nextLevelSwitch())}}this.lastTime=A,this.lastDroppedFrames=I,this.lastDecodedFrames=L}},_.checkFPSInterval=function(){var R=this.media;if(R)if(this.isVideoPlaybackQualityAvailable){var L=R.getVideoPlaybackQuality();this.checkFPS(R,L.totalVideoFrames,L.droppedVideoFrames)}else this.checkFPS(R,R.webkitDecodedFrameCount,R.webkitDroppedFrameCount)},F}();l.default=E},"./src/controller/fragment-finders.ts":function(C,l,t){t.r(l),t.d(l,"findFragmentByPDT",function(){return E}),t.d(l,"findFragmentByPTS",function(){return F}),t.d(l,"fragmentWithinToleranceTest",function(){return _}),t.d(l,"pdtWithinToleranceTest",function(){return b}),t.d(l,"findFragWithCC",function(){return R});var D=t("./src/polyfills/number.ts"),g=t("./src/utils/binary-search.ts");function E(L,I,A){if(I===null||!Array.isArray(L)||!L.length||!Object(D.isFiniteNumber)(I))return null;var O=L[0].programDateTime;if(I<(O||0))return null;var S=L[L.length-1].endProgramDateTime;if(I>=(S||0))return null;A=A||0;for(var T=0;T<L.length;++T){var a=L[T];if(b(I,A,a))return a}return null}function F(L,I,A,O){A===void 0&&(A=0),O===void 0&&(O=0);var S=null;if(L?S=I[L.sn-I[0].sn+1]||null:A===0&&I[0].start===0&&(S=I[0]),S&&_(A,O,S)===0)return S;var T=g.default.search(I,_.bind(null,A,O));return T||S}function _(L,I,A){L===void 0&&(L=0),I===void 0&&(I=0);var O=Math.min(I,A.duration+(A.deltaPTS?A.deltaPTS:0));return A.start+A.duration-O<=L?1:A.start-O>L&&A.start?-1:0}function b(L,I,A){var O=Math.min(I,A.duration+(A.deltaPTS?A.deltaPTS:0))*1e3,S=A.endProgramDateTime||0;return S-O>L}function R(L,I){return g.default.search(L,function(A){return A.cc<I?1:A.cc>I?-1:0})}},"./src/controller/fragment-tracker.ts":function(C,l,t){t.r(l),t.d(l,"FragmentState",function(){return E}),t.d(l,"FragmentTracker",function(){return F});var D=t("./src/events.ts"),g=t("./src/types/loader.ts"),E;(function(R){R.NOT_LOADED="NOT_LOADED",R.APPENDING="APPENDING",R.PARTIAL="PARTIAL",R.OK="OK"})(E||(E={}));var F=function(){function R(I){this.activeFragment=null,this.activeParts=null,this.fragments=Object.create(null),this.timeRanges=Object.create(null),this.bufferPadding=.2,this.hls=void 0,this.hls=I,this._registerListeners()}var L=R.prototype;return L._registerListeners=function(){var A=this.hls;A.on(D.Events.BUFFER_APPENDED,this.onBufferAppended,this),A.on(D.Events.FRAG_BUFFERED,this.onFragBuffered,this),A.on(D.Events.FRAG_LOADED,this.onFragLoaded,this)},L._unregisterListeners=function(){var A=this.hls;A.off(D.Events.BUFFER_APPENDED,this.onBufferAppended,this),A.off(D.Events.FRAG_BUFFERED,this.onFragBuffered,this),A.off(D.Events.FRAG_LOADED,this.onFragLoaded,this)},L.destroy=function(){this._unregisterListeners(),this.fragments=this.timeRanges=null},L.getAppendedFrag=function(A,O){if(O===g.PlaylistLevelType.MAIN){var S=this.activeFragment,T=this.activeParts;if(!S)return null;if(T)for(var a=T.length;a--;){var r=T[a],u=r?r.end:S.appendedPTS;if(r.start<=A&&u!==void 0&&A<=u)return a>9&&(this.activeParts=T.slice(a-9)),r}else if(S.start<=A&&S.appendedPTS!==void 0&&A<=S.appendedPTS)return S}return this.getBufferedFrag(A,O)},L.getBufferedFrag=function(A,O){for(var S=this.fragments,T=Object.keys(S),a=T.length;a--;){var r=S[T[a]];if((r==null?void 0:r.body.type)===O&&r.buffered){var u=r.body;if(u.start<=A&&A<=u.end)return u}}return null},L.detectEvictedFragments=function(A,O,S){var T=this;Object.keys(this.fragments).forEach(function(a){var r=T.fragments[a];if(!!r){if(!r.buffered){r.body.type===S&&T.removeFragment(r.body);return}var u=r.range[A];!u||u.time.some(function(h){var y=!T.isTimeBuffered(h.startPTS,h.endPTS,O);return y&&T.removeFragment(r.body),y})}})},L.detectPartialFragments=function(A){var O=this,S=this.timeRanges,T=A.frag,a=A.part;if(!(!S||T.sn==="initSegment")){var r=b(T),u=this.fragments[r];!u||(Object.keys(S).forEach(function(h){var y=T.elementaryStreams[h];if(!!y){var s=S[h],n=a!==null||y.partial===!0;u.range[h]=O.getBufferedTimes(T,a,n,s)}}),u.loaded=null,Object.keys(u.range).length?u.buffered=!0:this.removeFragment(u.body))}},L.fragBuffered=function(A){var O=b(A),S=this.fragments[O];S&&(S.loaded=null,S.buffered=!0)},L.getBufferedTimes=function(A,O,S,T){for(var a={time:[],partial:S},r=O?O.start:A.start,u=O?O.end:A.end,h=A.minEndPTS||u,y=A.maxStartPTS||r,s=0;s<T.length;s++){var n=T.start(s)-this.bufferPadding,i=T.end(s)+this.bufferPadding;if(y>=n&&h<=i){a.time.push({startPTS:Math.max(r,T.start(s)),endPTS:Math.min(u,T.end(s))});break}else if(r<i&&u>n)a.partial=!0,a.time.push({startPTS:Math.max(r,T.start(s)),endPTS:Math.min(u,T.end(s))});else if(u<=n)break}return a},L.getPartialFragment=function(A){var O=null,S,T,a,r=0,u=this.bufferPadding,h=this.fragments;return Object.keys(h).forEach(function(y){var s=h[y];!s||_(s)&&(T=s.body.start-u,a=s.body.end+u,A>=T&&A<=a&&(S=Math.min(A-T,a-A),r<=S&&(O=s.body,r=S)))}),O},L.getState=function(A){var O=b(A),S=this.fragments[O];return S?S.buffered?_(S)?E.PARTIAL:E.OK:E.APPENDING:E.NOT_LOADED},L.isTimeBuffered=function(A,O,S){for(var T,a,r=0;r<S.length;r++){if(T=S.start(r)-this.bufferPadding,a=S.end(r)+this.bufferPadding,A>=T&&O<=a)return!0;if(O<=T)return!1}return!1},L.onFragLoaded=function(A,O){var S=O.frag,T=O.part;if(!(S.sn==="initSegment"||S.bitrateTest||T)){var a=b(S);this.fragments[a]={body:S,loaded:O,buffered:!1,range:Object.create(null)}}},L.onBufferAppended=function(A,O){var S=this,T=O.frag,a=O.part,r=O.timeRanges;if(T.type===g.PlaylistLevelType.MAIN)if(this.activeFragment=T,a){var u=this.activeParts;u||(this.activeParts=u=[]),u.push(a)}else this.activeParts=null;this.timeRanges=r,Object.keys(r).forEach(function(h){var y=r[h];if(S.detectEvictedFragments(h,y),!a)for(var s=0;s<y.length;s++)T.appendedPTS=Math.max(y.end(s),T.appendedPTS||0)})},L.onFragBuffered=function(A,O){this.detectPartialFragments(O)},L.hasFragment=function(A){var O=b(A);return!!this.fragments[O]},L.removeFragmentsInRange=function(A,O,S){var T=this;Object.keys(this.fragments).forEach(function(a){var r=T.fragments[a];if(!!r&&r.buffered){var u=r.body;u.type===S&&u.start<O&&u.end>A&&T.removeFragment(u)}})},L.removeFragment=function(A){var O=b(A);A.stats.loaded=0,A.clearElementaryStreamInfo(),delete this.fragments[O]},L.removeAllFragments=function(){this.fragments=Object.create(null),this.activeFragment=null,this.activeParts=null},R}();function _(R){var L,I;return R.buffered&&(((L=R.range.video)===null||L===void 0?void 0:L.partial)||((I=R.range.audio)===null||I===void 0?void 0:I.partial))}function b(R){return R.type+"_"+R.level+"_"+R.urlId+"_"+R.sn}},"./src/controller/gap-controller.ts":function(C,l,t){t.r(l),t.d(l,"STALL_MINIMUM_DURATION_MS",function(){return _}),t.d(l,"MAX_START_GAP_JUMP",function(){return b}),t.d(l,"SKIP_BUFFER_HOLE_STEP_SECONDS",function(){return R}),t.d(l,"SKIP_BUFFER_RANGE_START",function(){return L}),t.d(l,"default",function(){return I});var D=t("./src/utils/buffer-helper.ts"),g=t("./src/errors.ts"),E=t("./src/events.ts"),F=t("./src/utils/logger.ts"),_=250,b=2,R=.1,L=.05,I=function(){function A(S,T,a,r){this.config=void 0,this.media=null,this.fragmentTracker=void 0,this.hls=void 0,this.nudgeRetry=0,this.stallReported=!1,this.stalled=null,this.moved=!1,this.seeking=!1,this.config=S,this.media=T,this.fragmentTracker=a,this.hls=r}var O=A.prototype;return O.destroy=function(){this.media=null,this.hls=this.fragmentTracker=null},O.poll=function(T,a){var r=this.config,u=this.media,h=this.stalled;if(u!==null){var y=u.currentTime,s=u.seeking,n=this.seeking&&!s,i=!this.seeking&&s;if(this.seeking=s,y!==T){if(this.moved=!0,h!==null){if(this.stallReported){var m=self.performance.now()-h;F.logger.warn("playback not stuck anymore @"+y+", after "+Math.round(m)+"ms"),this.stallReported=!1}this.stalled=null,this.nudgeRetry=0}return}if((i||n)&&(this.stalled=null),!(u.paused&&!s||u.ended||u.playbackRate===0||!D.BufferHelper.getBuffered(u).length)){var o=D.BufferHelper.bufferInfo(u,y,0),f=o.len>0,v=o.nextStart||0;if(!(!f&&!v)){if(s){var c=o.len>b,d=!v||a&&a.start<=y||v-y>b&&!this.fragmentTracker.getPartialFragment(y);if(c||d)return;this.moved=!1}if(!this.moved&&this.stalled!==null){var x,P=Math.max(v,o.start||0)-y,M=this.hls.levels?this.hls.levels[this.hls.currentLevel]:null,B=M==null||(x=M.details)===null||x===void 0?void 0:x.live,N=B?M.details.targetduration*2:b;if(P>0&&P<=N){this._trySkipBufferHole(null);return}}var U=self.performance.now();if(h===null){this.stalled=U;return}var w=U-h;if(!(!s&&w>=_&&(this._reportStall(o),!this.media))){var W=D.BufferHelper.bufferInfo(u,y,r.maxBufferHole);this._tryFixBufferStall(W,w)}}}}},O._tryFixBufferStall=function(T,a){var r=this.config,u=this.fragmentTracker,h=this.media;if(h!==null){var y=h.currentTime,s=u.getPartialFragment(y);if(s){var n=this._trySkipBufferHole(s);if(n||!this.media)return}T.len>r.maxBufferHole&&a>r.highBufferWatchdogPeriod*1e3&&(F.logger.warn("Trying to nudge playhead over buffer-hole"),this.stalled=null,this._tryNudgeBuffer())}},O._reportStall=function(T){var a=this.hls,r=this.media,u=this.stallReported;!u&&r&&(this.stallReported=!0,F.logger.warn("Playback stalling at @"+r.currentTime+" due to low buffer ("+JSON.stringify(T)+")"),a.trigger(E.Events.ERROR,{type:g.ErrorTypes.MEDIA_ERROR,details:g.ErrorDetails.BUFFER_STALLED_ERROR,fatal:!1,buffer:T.len}))},O._trySkipBufferHole=function(T){var a=this.config,r=this.hls,u=this.media;if(u===null)return 0;for(var h=u.currentTime,y=0,s=D.BufferHelper.getBuffered(u),n=0;n<s.length;n++){var i=s.start(n);if(h+a.maxBufferHole>=y&&h<i){var m=Math.max(i+L,u.currentTime+R);return F.logger.warn("skipping hole, adjusting currentTime from "+h+" to "+m),this.moved=!0,this.stalled=null,u.currentTime=m,T&&r.trigger(E.Events.ERROR,{type:g.ErrorTypes.MEDIA_ERROR,details:g.ErrorDetails.BUFFER_SEEK_OVER_HOLE,fatal:!1,reason:"fragment loaded with buffer holes, seeking from "+h+" to "+m,frag:T}),m}y=s.end(n)}return 0},O._tryNudgeBuffer=function(){var T=this.config,a=this.hls,r=this.media,u=this.nudgeRetry;if(r!==null){var h=r.currentTime;if(this.nudgeRetry++,u<T.nudgeMaxRetry){var y=h+(u+1)*T.nudgeOffset;F.logger.warn("Nudging 'currentTime' from "+h+" to "+y),r.currentTime=y,a.trigger(E.Events.ERROR,{type:g.ErrorTypes.MEDIA_ERROR,details:g.ErrorDetails.BUFFER_NUDGE_ON_STALL,fatal:!1})}else F.logger.error("Playhead still not moving while enough data buffered @"+h+" after "+T.nudgeMaxRetry+" nudges"),a.trigger(E.Events.ERROR,{type:g.ErrorTypes.MEDIA_ERROR,details:g.ErrorDetails.BUFFER_STALLED_ERROR,fatal:!0})}},A}()},"./src/controller/id3-track-controller.ts":function(C,l,t){t.r(l);var D=t("./src/polyfills/number.ts"),g=t("./src/events.ts"),E=t("./src/utils/texttrack-utils.ts"),F=t("./src/demux/id3.ts"),_=t("./src/loader/date-range.ts"),b=t("./src/types/demuxer.ts"),R=.25;function L(){return self.WebKitDataCue||self.VTTCue||self.TextTrackCue}function I(S,T){return S.getTime()/1e3-T}function A(S){return Uint8Array.from(S.replace(/^0x/,"").replace(/([\da-fA-F]{2}) ?/g,"0x$1 ").replace(/ +$/,"").split(" ")).buffer}var O=function(){function S(a){this.hls=void 0,this.id3Track=null,this.media=null,this.dateRangeCuesAppended={},this.hls=a,this._registerListeners()}var T=S.prototype;return T.destroy=function(){this._unregisterListeners(),this.id3Track=null,this.media=null,this.dateRangeCuesAppended={},this.hls=null},T._registerListeners=function(){var r=this.hls;r.on(g.Events.MEDIA_ATTACHED,this.onMediaAttached,this),r.on(g.Events.MEDIA_DETACHING,this.onMediaDetaching,this),r.on(g.Events.MANIFEST_LOADING,this.onManifestLoading,this),r.on(g.Events.FRAG_PARSING_METADATA,this.onFragParsingMetadata,this),r.on(g.Events.BUFFER_FLUSHING,this.onBufferFlushing,this),r.on(g.Events.LEVEL_UPDATED,this.onLevelUpdated,this)},T._unregisterListeners=function(){var r=this.hls;r.off(g.Events.MEDIA_ATTACHED,this.onMediaAttached,this),r.off(g.Events.MEDIA_DETACHING,this.onMediaDetaching,this),r.off(g.Events.MANIFEST_LOADING,this.onManifestLoading,this),r.off(g.Events.FRAG_PARSING_METADATA,this.onFragParsingMetadata,this),r.off(g.Events.BUFFER_FLUSHING,this.onBufferFlushing,this),r.off(g.Events.LEVEL_UPDATED,this.onLevelUpdated,this)},T.onMediaAttached=function(r,u){this.media=u.media},T.onMediaDetaching=function(){!this.id3Track||(Object(E.clearCurrentCues)(this.id3Track),this.id3Track=null,this.media=null,this.dateRangeCuesAppended={})},T.onManifestLoading=function(){this.dateRangeCuesAppended={}},T.createTrack=function(r){var u=this.getID3Track(r.textTracks);return u.mode="hidden",u},T.getID3Track=function(r){if(!!this.media){for(var u=0;u<r.length;u++){var h=r[u];if(h.kind==="metadata"&&h.label==="id3")return Object(E.sendAddTrackEvent)(h,this.media),h}return this.media.addTextTrack("metadata","id3")}},T.onFragParsingMetadata=function(r,u){if(!!this.media){var h=this.hls.config,y=h.enableEmsgMetadataCues,s=h.enableID3MetadataCues;if(!(!y&&!s)){var n=u.frag,i=u.samples,m=u.details;this.id3Track||(this.id3Track=this.createTrack(this.media));for(var o=m.edge||n.end,f=L(),v=!1,c={},d=0;d<i.length;d++){var x=i[d].type;if(!(x===b.MetadataSchema.emsg&&!y||!s)){var P=F.getID3Frames(i[d].data);if(P){var M=i[d].pts,B=o,N=B-M;N<=0&&(B=M+R);for(var U=0;U<P.length;U++){var w=P[U];if(!F.isTimeStampFrame(w)){var W=new f(M,B,"");W.value=w,x&&(W.type=x),this.id3Track.addCue(W),c[w.key]=null,v=!0}}}}}v&&this.updateId3CueEnds(c)}}},T.updateId3CueEnds=function(r){var u,h=(u=this.id3Track)===null||u===void 0?void 0:u.cues;if(h)for(var y=h.length;y--;){var s,n=h[y],i=(s=n.value)===null||s===void 0?void 0:s.key;if(i&&i in r){var m=r[i];m&&n.endTime!==m&&(n.endTime=m),r[i]=n.startTime}}},T.onBufferFlushing=function(r,u){var h=u.startOffset,y=u.endOffset,s=u.type,n=this.id3Track,i=this.hls;if(!!i){var m=i.config,o=m.enableEmsgMetadataCues,f=m.enableID3MetadataCues;if(n&&(o||f)){var v;s==="audio"?v=function(d){return d.type===b.MetadataSchema.audioId3&&f}:s==="video"?v=function(d){return d.type===b.MetadataSchema.emsg&&o}:v=function(d){return d.type===b.MetadataSchema.audioId3&&f||d.type===b.MetadataSchema.emsg&&o},Object(E.removeCuesInRange)(n,h,y,v)}}},T.onLevelUpdated=function(r,u){var h=this,y=u.details;if(!(!this.media||!y.hasProgramDateTime||!this.hls.config.enableDateRangeMetadataCues)){var s=this.dateRangeCuesAppended,n=this.id3Track,i=y.dateRanges,m=Object.keys(i);if(n)for(var o=Object.keys(s).filter(function(N){return!m.includes(N)}),f=function(U){var w=o[U];Object.keys(s[w].cues).forEach(function(W){n.removeCue(s[w].cues[W])}),delete s[w]},v=o.length;v--;)f(v);var c=y.fragments[y.fragments.length-1];if(!(m.length===0||!Object(D.isFiniteNumber)(c==null?void 0:c.programDateTime))){this.id3Track||(this.id3Track=this.createTrack(this.media));for(var d=c.programDateTime/1e3-c.start,x=y.edge||c.end,P=L(),M=function(U){var w=m[U],W=i[w],j=s[w],G=(j==null?void 0:j.cues)||{},H=(j==null?void 0:j.durationKnown)||!1,$=I(W.startDate,d),te=x,q=W.endDate;if(q)te=I(q,d),H=!0;else if(W.endOnNext&&!H){var ne=m.reduce(function(z,Q){var Z=i[Q];return Z.class===W.class&&Z.id!==Q&&Z.startDate>W.startDate&&z.push(Z),z},[]).sort(function(z,Q){return z.startDate.getTime()-Q.startDate.getTime()})[0];ne&&(te=I(ne.startDate,d),H=!0)}for(var oe=Object.keys(W.attr),k=0;k<oe.length;k++){var K=oe[k];if(!(K===_.DateRangeAttribute.ID||K===_.DateRangeAttribute.CLASS||K===_.DateRangeAttribute.START_DATE||K===_.DateRangeAttribute.DURATION||K===_.DateRangeAttribute.END_DATE||K===_.DateRangeAttribute.END_ON_NEXT)){var V=G[K];if(V)H&&!j.durationKnown&&(V.endTime=te);else{var Y=W.attr[K];V=new P($,te,""),(K===_.DateRangeAttribute.SCTE35_OUT||K===_.DateRangeAttribute.SCTE35_IN)&&(Y=A(Y)),V.value={key:K,data:Y},V.type=b.MetadataSchema.dateRange,h.id3Track.addCue(V),G[K]=V}}}s[w]={cues:G,dateRange:W,durationKnown:H}},B=0;B<m.length;B++)M(B)}}},S}();l.default=O},"./src/controller/latency-controller.ts":function(C,l,t){t.r(l),t.d(l,"default",function(){return b});var D=t("./src/errors.ts"),g=t("./src/events.ts"),E=t("./src/utils/logger.ts");function F(R,L){for(var I=0;I<L.length;I++){var A=L[I];A.enumerable=A.enumerable||!1,A.configurable=!0,"value"in A&&(A.writable=!0),Object.defineProperty(R,A.key,A)}}function _(R,L,I){return L&&F(R.prototype,L),I&&F(R,I),Object.defineProperty(R,"prototype",{writable:!1}),R}var b=function(){function R(I){var A=this;this.hls=void 0,this.config=void 0,this.media=null,this.levelDetails=null,this.currentTime=0,this.stallCount=0,this._latency=null,this.timeupdateHandler=function(){return A.timeupdate()},this.hls=I,this.config=I.config,this.registerListeners()}var L=R.prototype;return L.destroy=function(){this.unregisterListeners(),this.onMediaDetaching(),this.levelDetails=null,this.hls=this.timeupdateHandler=null},L.registerListeners=function(){this.hls.on(g.Events.MEDIA_ATTACHED,this.onMediaAttached,this),this.hls.on(g.Events.MEDIA_DETACHING,this.onMediaDetaching,this),this.hls.on(g.Events.MANIFEST_LOADING,this.onManifestLoading,this),this.hls.on(g.Events.LEVEL_UPDATED,this.onLevelUpdated,this),this.hls.on(g.Events.ERROR,this.onError,this)},L.unregisterListeners=function(){this.hls.off(g.Events.MEDIA_ATTACHED,this.onMediaAttached),this.hls.off(g.Events.MEDIA_DETACHING,this.onMediaDetaching),this.hls.off(g.Events.MANIFEST_LOADING,this.onManifestLoading),this.hls.off(g.Events.LEVEL_UPDATED,this.onLevelUpdated),this.hls.off(g.Events.ERROR,this.onError)},L.onMediaAttached=function(A,O){this.media=O.media,this.media.addEventListener("timeupdate",this.timeupdateHandler)},L.onMediaDetaching=function(){this.media&&(this.media.removeEventListener("timeupdate",this.timeupdateHandler),this.media=null)},L.onManifestLoading=function(){this.levelDetails=null,this._latency=null,this.stallCount=0},L.onLevelUpdated=function(A,O){var S=O.details;this.levelDetails=S,S.advanced&&this.timeupdate(),!S.live&&this.media&&this.media.removeEventListener("timeupdate",this.timeupdateHandler)},L.onError=function(A,O){O.details===D.ErrorDetails.BUFFER_STALLED_ERROR&&(this.stallCount++,E.logger.warn("[playback-rate-controller]: Stall detected, adjusting target latency"))},L.timeupdate=function(){var A=this.media,O=this.levelDetails;if(!(!A||!O)){this.currentTime=A.currentTime;var S=this.computeLatency();if(S!==null){this._latency=S;var T=this.config,a=T.lowLatencyMode,r=T.maxLiveSyncPlaybackRate;if(!(!a||r===1)){var u=this.targetLatency;if(u!==null){var h=S-u,y=Math.min(this.maxLatency,u+O.targetduration),s=h<y;if(O.live&&s&&h>.05&&this.forwardBufferLength>1){var n=Math.min(2,Math.max(1,r)),i=Math.round(2/(1+Math.exp(-.75*h-this.edgeStalled))*20)/20;A.playbackRate=Math.min(n,Math.max(1,i))}else A.playbackRate!==1&&A.playbackRate!==0&&(A.playbackRate=1)}}}}},L.estimateLiveEdge=function(){var A=this.levelDetails;return A===null?null:A.edge+A.age},L.computeLatency=function(){var A=this.estimateLiveEdge();return A===null?null:A-this.currentTime},_(R,[{key:"latency",get:function(){return this._latency||0}},{key:"maxLatency",get:function(){var A=this.config,O=this.levelDetails;return A.liveMaxLatencyDuration!==void 0?A.liveMaxLatencyDuration:O?A.liveMaxLatencyDurationCount*O.targetduration:0}},{key:"targetLatency",get:function(){var A=this.levelDetails;if(A===null)return null;var O=A.holdBack,S=A.partHoldBack,T=A.targetduration,a=this.config,r=a.liveSyncDuration,u=a.liveSyncDurationCount,h=a.lowLatencyMode,y=this.hls.userConfig,s=h&&S||O;(y.liveSyncDuration||y.liveSyncDurationCount||s===0)&&(s=r!==void 0?r:u*T);var n=T,i=1;return s+Math.min(this.stallCount*i,n)}},{key:"liveSyncPosition",get:function(){var A=this.estimateLiveEdge(),O=this.targetLatency,S=this.levelDetails;if(A===null||O===null||S===null)return null;var T=S.edge,a=A-O-this.edgeStalled,r=T-S.totalduration,u=T-(this.config.lowLatencyMode&&S.partTarget||S.targetduration);return Math.min(Math.max(r,a),u)}},{key:"drift",get:function(){var A=this.levelDetails;return A===null?1:A.drift}},{key:"edgeStalled",get:function(){var A=this.levelDetails;if(A===null)return 0;var O=(this.config.lowLatencyMode&&A.partTarget||A.targetduration)*3;return Math.max(A.age-O,0)}},{key:"forwardBufferLength",get:function(){var A=this.media,O=this.levelDetails;if(!A||!O)return 0;var S=A.buffered.length;return(S?A.buffered.end(S-1):O.edge)-this.currentTime}}]),R}()},"./src/controller/level-controller.ts":function(C,l,t){t.r(l),t.d(l,"default",function(){return a});var D=t("./src/types/level.ts"),g=t("./src/events.ts"),E=t("./src/errors.ts"),F=t("./src/utils/codecs.ts"),_=t("./src/controller/level-helper.ts"),b=t("./src/controller/base-playlist-controller.ts"),R=t("./src/types/loader.ts");function L(){return L=Object.assign?Object.assign.bind():function(r){for(var u=1;u<arguments.length;u++){var h=arguments[u];for(var y in h)Object.prototype.hasOwnProperty.call(h,y)&&(r[y]=h[y])}return r},L.apply(this,arguments)}function I(r,u){for(var h=0;h<u.length;h++){var y=u[h];y.enumerable=y.enumerable||!1,y.configurable=!0,"value"in y&&(y.writable=!0),Object.defineProperty(r,y.key,y)}}function A(r,u,h){return u&&I(r.prototype,u),h&&I(r,h),Object.defineProperty(r,"prototype",{writable:!1}),r}function O(r,u){r.prototype=Object.create(u.prototype),r.prototype.constructor=r,S(r,u)}function S(r,u){return S=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(y,s){return y.__proto__=s,y},S(r,u)}var T=/chrome|firefox/.test(navigator.userAgent.toLowerCase()),a=function(r){O(u,r);function u(y){var s;return s=r.call(this,y,"[level-controller]")||this,s._levels=[],s._firstLevel=-1,s._startLevel=void 0,s.currentLevelIndex=-1,s.manualLevelIndex=-1,s.onParsedComplete=void 0,s._registerListeners(),s}var h=u.prototype;return h._registerListeners=function(){var s=this.hls;s.on(g.Events.MANIFEST_LOADED,this.onManifestLoaded,this),s.on(g.Events.LEVEL_LOADED,this.onLevelLoaded,this),s.on(g.Events.AUDIO_TRACK_SWITCHED,this.onAudioTrackSwitched,this),s.on(g.Events.FRAG_LOADED,this.onFragLoaded,this),s.on(g.Events.ERROR,this.onError,this)},h._unregisterListeners=function(){var s=this.hls;s.off(g.Events.MANIFEST_LOADED,this.onManifestLoaded,this),s.off(g.Events.LEVEL_LOADED,this.onLevelLoaded,this),s.off(g.Events.AUDIO_TRACK_SWITCHED,this.onAudioTrackSwitched,this),s.off(g.Events.FRAG_LOADED,this.onFragLoaded,this),s.off(g.Events.ERROR,this.onError,this)},h.destroy=function(){this._unregisterListeners(),this.manualLevelIndex=-1,this._levels.length=0,r.prototype.destroy.call(this)},h.startLoad=function(){var s=this._levels;s.forEach(function(n){n.loadError=0}),r.prototype.startLoad.call(this)},h.onManifestLoaded=function(s,n){var i=[],m=[],o=[],f,v={},c,d=!1,x=!1,P=!1;if(n.levels.forEach(function(U){var w=U.attrs;d=d||!!(U.width&&U.height),x=x||!!U.videoCodec,P=P||!!U.audioCodec,T&&U.audioCodec&&U.audioCodec.indexOf("mp4a.40.34")!==-1&&(U.audioCodec=void 0);var W=U.bitrate+"-"+U.attrs.RESOLUTION+"-"+U.attrs.CODECS;c=v[W],c?c.url.push(U.url):(c=new D.Level(U),v[W]=c,i.push(c)),w&&(w.AUDIO&&Object(_.addGroupId)(c,"audio",w.AUDIO),w.SUBTITLES&&Object(_.addGroupId)(c,"text",w.SUBTITLES))}),(d||x)&&P&&(i=i.filter(function(U){var w=U.videoCodec,W=U.width,j=U.height;return!!w||!!(W&&j)})),i=i.filter(function(U){var w=U.audioCodec,W=U.videoCodec;return(!w||Object(F.isCodecSupportedInMp4)(w,"audio"))&&(!W||Object(F.isCodecSupportedInMp4)(W,"video"))}),n.audioTracks&&(m=n.audioTracks.filter(function(U){return!U.audioCodec||Object(F.isCodecSupportedInMp4)(U.audioCodec,"audio")}),Object(_.assignTrackIdsByGroup)(m)),n.subtitles&&(o=n.subtitles,Object(_.assignTrackIdsByGroup)(o)),i.length>0){f=i[0].bitrate,i.sort(function(U,w){return U.bitrate-w.bitrate}),this._levels=i;for(var M=0;M<i.length;M++)if(i[M].bitrate===f){this._firstLevel=M,this.log("manifest loaded, "+i.length+" level(s) found, first bitrate: "+f);break}var B=P&&!x,N={levels:i,audioTracks:m,subtitleTracks:o,firstLevel:this._firstLevel,stats:n.stats,audio:P,video:x,altAudio:!B&&m.some(function(U){return!!U.url})};this.hls.trigger(g.Events.MANIFEST_PARSED,N),(this.hls.config.autoStartLoad||this.hls.forceStartLoad)&&this.hls.startLoad(this.hls.config.startPosition)}else this.hls.trigger(g.Events.ERROR,{type:E.ErrorTypes.MEDIA_ERROR,details:E.ErrorDetails.MANIFEST_INCOMPATIBLE_CODECS_ERROR,fatal:!0,url:n.url,reason:"no level with compatible codecs found in manifest"})},h.onError=function(s,n){var i;if(r.prototype.onError.call(this,s,n),!n.fatal){var m=n.context,o=this._levels[this.currentLevelIndex];if(m&&(m.type===R.PlaylistContextType.AUDIO_TRACK&&o.audioGroupIds&&m.groupId===o.audioGroupIds[o.urlId]||m.type===R.PlaylistContextType.SUBTITLE_TRACK&&o.textGroupIds&&m.groupId===o.textGroupIds[o.urlId])){this.redundantFailover(this.currentLevelIndex);return}var f=!1,v=!0,c;switch(n.details){case E.ErrorDetails.FRAG_LOAD_ERROR:case E.ErrorDetails.FRAG_LOAD_TIMEOUT:case E.ErrorDetails.KEY_LOAD_ERROR:case E.ErrorDetails.KEY_LOAD_TIMEOUT:if(n.frag){var d=n.frag.type===R.PlaylistLevelType.MAIN?n.frag.level:this.currentLevelIndex,x=this._levels[d];x?(x.fragmentError++,x.fragmentError>this.hls.config.fragLoadingMaxRetry&&(c=d)):c=d}break;case E.ErrorDetails.LEVEL_LOAD_ERROR:case E.ErrorDetails.LEVEL_LOAD_TIMEOUT:m&&(m.deliveryDirectives&&(v=!1),c=m.level),f=!0;break;case E.ErrorDetails.REMUX_ALLOC_ERROR:c=(i=n.level)!=null?i:this.currentLevelIndex,f=!0;break}c!==void 0&&this.recoverLevel(n,c,f,v)}},h.recoverLevel=function(s,n,i,m){var o=s.details,f=this._levels[n];if(f.loadError++,i){var v=this.retryLoadingOrFail(s);if(v)s.levelRetry=!0;else{this.currentLevelIndex=-1;return}}if(m){var c=f.url.length;if(c>1&&f.loadError<c)s.levelRetry=!0,this.redundantFailover(n);else if(this.manualLevelIndex===-1){for(var d=-1,x=this._levels,P=x.length;P--;){var M=(P+this.currentLevelIndex)%x.length;if(M!==this.currentLevelIndex&&x[M].loadError===0){d=M;break}}d>-1&&this.currentLevelIndex!==d&&(this.warn(o+": switch to "+d),s.levelRetry=!0,this.hls.nextAutoLevel=d)}}},h.redundantFailover=function(s){var n=this._levels[s],i=n.url.length;if(i>1){var m=(n.urlId+1)%i;this.warn("Switching to redundant URL-id "+m),this._levels.forEach(function(o){o.urlId=m}),this.level=s}},h.onFragLoaded=function(s,n){var i=n.frag;if(i!==void 0&&i.type===R.PlaylistLevelType.MAIN){var m=this._levels[i.level];m!==void 0&&(m.fragmentError=0,m.loadError=0)}},h.onLevelLoaded=function(s,n){var i,m=n.level,o=n.details,f=this._levels[m];if(!f){var v;this.warn("Invalid level index "+m),(v=n.deliveryDirectives)!==null&&v!==void 0&&v.skip&&(o.deltaUpdateFailed=!0);return}m===this.currentLevelIndex?(f.fragmentError===0&&(f.loadError=0,this.retryCount=0),this.playlistLoaded(m,n,f.details)):(i=n.deliveryDirectives)!==null&&i!==void 0&&i.skip&&(o.deltaUpdateFailed=!0)},h.onAudioTrackSwitched=function(s,n){var i=this.hls.levels[this.currentLevelIndex];if(!!i&&i.audioGroupIds){for(var m=-1,o=this.hls.audioTracks[n.id].groupId,f=0;f<i.audioGroupIds.length;f++)if(i.audioGroupIds[f]===o){m=f;break}m!==i.urlId&&(i.urlId=m,this.startLoad())}},h.loadPlaylist=function(s){var n=this.currentLevelIndex,i=this._levels[n];if(this.canLoad&&i&&i.url.length>0){var m=i.urlId,o=i.url[m];if(s)try{o=s.addDirectives(o)}catch(f){this.warn("Could not construct new URL with HLS Delivery Directives: "+f)}this.log("Attempt loading level index "+n+(s?" at sn "+s.msn+" part "+s.part:"")+" with URL-id "+m+" "+o),this.clearTimer(),this.hls.trigger(g.Events.LEVEL_LOADING,{url:o,level:n,id:m,deliveryDirectives:s||null})}},h.removeLevel=function(s,n){var i=function(f,v){return v!==n},m=this._levels.filter(function(o,f){return f!==s?!0:o.url.length>1&&n!==void 0?(o.url=o.url.filter(i),o.audioGroupIds&&(o.audioGroupIds=o.audioGroupIds.filter(i)),o.textGroupIds&&(o.textGroupIds=o.textGroupIds.filter(i)),o.urlId=0,!0):!1}).map(function(o,f){var v=o.details;return v!=null&&v.fragments&&v.fragments.forEach(function(c){c.level=f}),o});this._levels=m,this.hls.trigger(g.Events.LEVELS_UPDATED,{levels:m})},A(u,[{key:"levels",get:function(){return this._levels.length===0?null:this._levels}},{key:"level",get:function(){return this.currentLevelIndex},set:function(s){var n,i=this._levels;if(i.length!==0&&!(this.currentLevelIndex===s&&(n=i[s])!==null&&n!==void 0&&n.details)){if(s<0||s>=i.length){var m=s<0;if(this.hls.trigger(g.Events.ERROR,{type:E.ErrorTypes.OTHER_ERROR,details:E.ErrorDetails.LEVEL_SWITCH_ERROR,level:s,fatal:m,reason:"invalid level idx"}),m)return;s=Math.min(s,i.length-1)}this.clearTimer();var o=this.currentLevelIndex,f=i[o],v=i[s];this.log("switching to level "+s+" from "+o),this.currentLevelIndex=s;var c=L({},v,{level:s,maxBitrate:v.maxBitrate,uri:v.uri,urlId:v.urlId});delete c._urlId,this.hls.trigger(g.Events.LEVEL_SWITCHING,c);var d=v.details;if(!d||d.live){var x=this.switchParams(v.uri,f==null?void 0:f.details);this.loadPlaylist(x)}}}},{key:"manualLevel",get:function(){return this.manualLevelIndex},set:function(s){this.manualLevelIndex=s,this._startLevel===void 0&&(this._startLevel=s),s!==-1&&(this.level=s)}},{key:"firstLevel",get:function(){return this._firstLevel},set:function(s){this._firstLevel=s}},{key:"startLevel",get:function(){if(this._startLevel===void 0){var s=this.hls.config.startLevel;return s!==void 0?s:this._firstLevel}else return this._startLevel},set:function(s){this._startLevel=s}},{key:"nextLoadLevel",get:function(){return this.manualLevelIndex!==-1?this.manualLevelIndex:this.hls.nextAutoLevel},set:function(s){this.level=s,this.manualLevelIndex===-1&&(this.hls.nextAutoLevel=s)}}]),u}(b.default)},"./src/controller/level-helper.ts":function(C,l,t){t.r(l),t.d(l,"addGroupId",function(){return _}),t.d(l,"assignTrackIdsByGroup",function(){return b}),t.d(l,"updatePTS",function(){return R}),t.d(l,"updateFragPTSDTS",function(){return I}),t.d(l,"mergeDetails",function(){return A}),t.d(l,"mapPartIntersection",function(){return S}),t.d(l,"mapFragmentIntersection",function(){return T}),t.d(l,"adjustSliding",function(){return a}),t.d(l,"addSliding",function(){return r}),t.d(l,"computeReloadInterval",function(){return u}),t.d(l,"getFragmentWithSN",function(){return h}),t.d(l,"getPartWith",function(){return y});var D=t("./src/polyfills/number.ts"),g=t("./src/utils/logger.ts"),E=t("./src/loader/date-range.ts");function F(){return F=Object.assign?Object.assign.bind():function(s){for(var n=1;n<arguments.length;n++){var i=arguments[n];for(var m in i)Object.prototype.hasOwnProperty.call(i,m)&&(s[m]=i[m])}return s},F.apply(this,arguments)}function _(s,n,i){switch(n){case"audio":s.audioGroupIds||(s.audioGroupIds=[]),s.audioGroupIds.push(i);break;case"text":s.textGroupIds||(s.textGroupIds=[]),s.textGroupIds.push(i);break}}function b(s){var n={};s.forEach(function(i){var m=i.groupId||"";i.id=n[m]=n[m]||0,n[m]++})}function R(s,n,i){var m=s[n],o=s[i];L(m,o)}function L(s,n){var i=n.startPTS;if(Object(D.isFiniteNumber)(i)){var m=0,o;n.sn>s.sn?(m=i-s.start,o=s):(m=s.start-i,o=n),o.duration!==m&&(o.duration=m)}else if(n.sn>s.sn){var f=s.cc===n.cc;f&&s.minEndPTS?n.start=s.start+(s.minEndPTS-s.start):n.start=s.start+s.duration}else n.start=Math.max(s.start-n.duration,0)}function I(s,n,i,m,o,f){var v=m-i;v<=0&&(g.logger.warn("Fragment should have a positive duration",n),m=i+n.duration,f=o+n.duration);var c=i,d=m,x=n.startPTS,P=n.endPTS;if(Object(D.isFiniteNumber)(x)){var M=Math.abs(x-i);Object(D.isFiniteNumber)(n.deltaPTS)?n.deltaPTS=Math.max(M,n.deltaPTS):n.deltaPTS=M,c=Math.max(i,x),i=Math.min(i,x),o=Math.min(o,n.startDTS),d=Math.min(m,P),m=Math.max(m,P),f=Math.max(f,n.endDTS)}n.duration=m-i;var B=i-n.start;n.appendedPTS=m,n.start=n.startPTS=i,n.maxStartPTS=c,n.startDTS=o,n.endPTS=m,n.minEndPTS=d,n.endDTS=f;var N=n.sn;if(!s||N<s.startSN||N>s.endSN)return 0;var U,w=N-s.startSN,W=s.fragments;for(W[w]=n,U=w;U>0;U--)L(W[U],W[U-1]);for(U=w;U<W.length-1;U++)L(W[U],W[U+1]);return s.fragmentHint&&L(W[W.length-1],s.fragmentHint),s.PTSKnown=s.alignedSliding=!0,B}function A(s,n){for(var i=null,m=s.fragments,o=m.length-1;o>=0;o--){var f=m[o].initSegment;if(f){i=f;break}}s.fragmentHint&&delete s.fragmentHint.endPTS;var v=0,c;if(T(s,n,function(U,w){U.relurl&&(v=U.cc-w.cc),Object(D.isFiniteNumber)(U.startPTS)&&Object(D.isFiniteNumber)(U.endPTS)&&(w.start=w.startPTS=U.startPTS,w.startDTS=U.startDTS,w.appendedPTS=U.appendedPTS,w.maxStartPTS=U.maxStartPTS,w.endPTS=U.endPTS,w.endDTS=U.endDTS,w.minEndPTS=U.minEndPTS,w.duration=U.endPTS-U.startPTS,w.duration&&(c=w),n.PTSKnown=n.alignedSliding=!0),w.elementaryStreams=U.elementaryStreams,w.loader=U.loader,w.stats=U.stats,w.urlId=U.urlId,U.initSegment&&(w.initSegment=U.initSegment,i=U.initSegment)}),i){var d=n.fragmentHint?n.fragments.concat(n.fragmentHint):n.fragments;d.forEach(function(U){var w;(!U.initSegment||U.initSegment.relurl===((w=i)===null||w===void 0?void 0:w.relurl))&&(U.initSegment=i)})}if(n.skippedSegments)if(n.deltaUpdateFailed=n.fragments.some(function(U){return!U}),n.deltaUpdateFailed){g.logger.warn("[level-helper] Previous playlist missing segments skipped in delta playlist");for(var x=n.skippedSegments;x--;)n.fragments.shift();n.startSN=n.fragments[0].sn,n.startCC=n.fragments[0].cc}else n.canSkipDateRanges&&(n.dateRanges=O(s.dateRanges,n.dateRanges,n.recentlyRemovedDateranges));var P=n.fragments;if(v){g.logger.warn("discontinuity sliding from playlist, take drift into account");for(var M=0;M<P.length;M++)P[M].cc+=v}n.skippedSegments&&(n.startCC=n.fragments[0].cc),S(s.partList,n.partList,function(U,w){w.elementaryStreams=U.elementaryStreams,w.stats=U.stats}),c?I(n,c,c.startPTS,c.endPTS,c.startDTS,c.endDTS):a(s,n),P.length&&(n.totalduration=n.edge-P[0].start),n.driftStartTime=s.driftStartTime,n.driftStart=s.driftStart;var B=n.advancedDateTime;if(n.advanced&&B){var N=n.edge;n.driftStart||(n.driftStartTime=B,n.driftStart=N),n.driftEndTime=B,n.driftEnd=N}else n.driftEndTime=s.driftEndTime,n.driftEnd=s.driftEnd,n.advancedDateTime=s.advancedDateTime}function O(s,n,i){var m=F({},s);return i&&i.forEach(function(o){delete m[o]}),Object.keys(n).forEach(function(o){var f=new E.DateRange(n[o].attr,m[o]);f.isValid?m[o]=f:g.logger.warn('Ignoring invalid Playlist Delta Update DATERANGE tag: "'+JSON.stringify(n[o].attr)+'"')}),m}function S(s,n,i){if(s&&n)for(var m=0,o=0,f=s.length;o<=f;o++){var v=s[o],c=n[o+m];v&&c&&v.index===c.index&&v.fragment.sn===c.fragment.sn?i(v,c):m--}}function T(s,n,i){for(var m=n.skippedSegments,o=Math.max(s.startSN,n.startSN)-n.startSN,f=(s.fragmentHint?1:0)+(m?n.endSN:Math.min(s.endSN,n.endSN))-n.startSN,v=n.startSN-s.startSN,c=n.fragmentHint?n.fragments.concat(n.fragmentHint):n.fragments,d=s.fragmentHint?s.fragments.concat(s.fragmentHint):s.fragments,x=o;x<=f;x++){var P=d[v+x],M=c[x];m&&!M&&x<m&&(M=n.fragments[x]=P),P&&M&&i(P,M)}}function a(s,n){var i=n.startSN+n.skippedSegments-s.startSN,m=s.fragments;i<0||i>=m.length||r(n,m[i].start)}function r(s,n){if(n){for(var i=s.fragments,m=s.skippedSegments;m<i.length;m++)i[m].start+=n;s.fragmentHint&&(s.fragmentHint.start+=n)}}function u(s,n){var i=1e3*s.levelTargetDuration,m=i/2,o=s.age,f=o>0&&o<i*3,v=n.loading.end-n.loading.start,c,d=s.availabilityDelay;if(s.updated===!1)if(f){var x=333*s.misses;c=Math.max(Math.min(m,v*2),x),s.availabilityDelay=(s.availabilityDelay||0)+c}else c=m;else f?(d=Math.min(d||i/2,o),s.availabilityDelay=d,c=d+i-o):c=i-v;return Math.round(c)}function h(s,n,i){if(!s||!s.details)return null;var m=s.details,o=m.fragments[n-m.startSN];return o||(o=m.fragmentHint,o&&o.sn===n)?o:n<m.startSN&&i&&i.sn===n?i:null}function y(s,n,i){if(!s||!s.details)return null;var m=s.details.partList;if(m)for(var o=m.length;o--;){var f=m[o];if(f.index===i&&f.fragment.sn===n)return f}return null}},"./src/controller/stream-controller.ts":function(C,l,t){t.r(l),t.d(l,"default",function(){return y});var D=t("./src/polyfills/number.ts"),g=t("./src/controller/base-stream-controller.ts"),E=t("./src/is-supported.ts"),F=t("./src/events.ts"),_=t("./src/utils/buffer-helper.ts"),b=t("./src/controller/fragment-tracker.ts"),R=t("./src/types/loader.ts"),L=t("./src/loader/fragment.ts"),I=t("./src/demux/transmuxer-interface.ts"),A=t("./src/types/transmuxer.ts"),O=t("./src/controller/gap-controller.ts"),S=t("./src/errors.ts");function T(s,n){for(var i=0;i<n.length;i++){var m=n[i];m.enumerable=m.enumerable||!1,m.configurable=!0,"value"in m&&(m.writable=!0),Object.defineProperty(s,m.key,m)}}function a(s,n,i){return n&&T(s.prototype,n),i&&T(s,i),Object.defineProperty(s,"prototype",{writable:!1}),s}function r(s,n){s.prototype=Object.create(n.prototype),s.prototype.constructor=s,u(s,n)}function u(s,n){return u=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(m,o){return m.__proto__=o,m},u(s,n)}var h=100,y=function(s){r(n,s);function n(m,o){var f;return f=s.call(this,m,o,"[stream-controller]")||this,f.audioCodecSwap=!1,f.gapController=null,f.level=-1,f._forceStartLoad=!1,f.altAudio=!1,f.audioOnly=!1,f.fragPlaying=null,f.onvplaying=null,f.onvseeked=null,f.fragLastKbps=0,f.couldBacktrack=!1,f.backtrackFragment=null,f.audioCodecSwitch=!1,f.videoBuffer=null,f._registerListeners(),f}var i=n.prototype;return i._registerListeners=function(){var o=this.hls;o.on(F.Events.MEDIA_ATTACHED,this.onMediaAttached,this),o.on(F.Events.MEDIA_DETACHING,this.onMediaDetaching,this),o.on(F.Events.MANIFEST_LOADING,this.onManifestLoading,this),o.on(F.Events.MANIFEST_PARSED,this.onManifestParsed,this),o.on(F.Events.LEVEL_LOADING,this.onLevelLoading,this),o.on(F.Events.LEVEL_LOADED,this.onLevelLoaded,this),o.on(F.Events.FRAG_LOAD_EMERGENCY_ABORTED,this.onFragLoadEmergencyAborted,this),o.on(F.Events.ERROR,this.onError,this),o.on(F.Events.AUDIO_TRACK_SWITCHING,this.onAudioTrackSwitching,this),o.on(F.Events.AUDIO_TRACK_SWITCHED,this.onAudioTrackSwitched,this),o.on(F.Events.BUFFER_CREATED,this.onBufferCreated,this),o.on(F.Events.BUFFER_FLUSHED,this.onBufferFlushed,this),o.on(F.Events.LEVELS_UPDATED,this.onLevelsUpdated,this),o.on(F.Events.FRAG_BUFFERED,this.onFragBuffered,this)},i._unregisterListeners=function(){var o=this.hls;o.off(F.Events.MEDIA_ATTACHED,this.onMediaAttached,this),o.off(F.Events.MEDIA_DETACHING,this.onMediaDetaching,this),o.off(F.Events.MANIFEST_LOADING,this.onManifestLoading,this),o.off(F.Events.MANIFEST_PARSED,this.onManifestParsed,this),o.off(F.Events.LEVEL_LOADED,this.onLevelLoaded,this),o.off(F.Events.FRAG_LOAD_EMERGENCY_ABORTED,this.onFragLoadEmergencyAborted,this),o.off(F.Events.ERROR,this.onError,this),o.off(F.Events.AUDIO_TRACK_SWITCHING,this.onAudioTrackSwitching,this),o.off(F.Events.AUDIO_TRACK_SWITCHED,this.onAudioTrackSwitched,this),o.off(F.Events.BUFFER_CREATED,this.onBufferCreated,this),o.off(F.Events.BUFFER_FLUSHED,this.onBufferFlushed,this),o.off(F.Events.LEVELS_UPDATED,this.onLevelsUpdated,this),o.off(F.Events.FRAG_BUFFERED,this.onFragBuffered,this)},i.onHandlerDestroying=function(){this._unregisterListeners(),this.onMediaDetaching()},i.startLoad=function(o){if(this.levels){var f=this.lastCurrentTime,v=this.hls;if(this.stopLoad(),this.setInterval(h),this.level=-1,this.fragLoadError=0,!this.startFragRequested){var c=v.startLevel;c===-1&&(v.config.testBandwidth&&this.levels.length>1?(c=0,this.bitrateTest=!0):c=v.nextAutoLevel),this.level=v.nextLoadLevel=c,this.loadedmetadata=!1}f>0&&o===-1&&(this.log("Override startPosition with lastCurrentTime @"+f.toFixed(3)),o=f),this.state=g.State.IDLE,this.nextLoadPosition=this.startPosition=this.lastCurrentTime=o,this.tick()}else this._forceStartLoad=!0,this.state=g.State.STOPPED},i.stopLoad=function(){this._forceStartLoad=!1,s.prototype.stopLoad.call(this)},i.doTick=function(){switch(this.state){case g.State.IDLE:this.doTickIdle();break;case g.State.WAITING_LEVEL:{var o,f=this.levels,v=this.level,c=f==null||(o=f[v])===null||o===void 0?void 0:o.details;if(c&&(!c.live||this.levelLastLoaded===this.level)){if(this.waitForCdnTuneIn(c))break;this.state=g.State.IDLE;break}break}case g.State.FRAG_LOADING_WAITING_RETRY:{var d,x=self.performance.now(),P=this.retryDate;(!P||x>=P||(d=this.media)!==null&&d!==void 0&&d.seeking)&&(this.log("retryDate reached, switch back to IDLE state"),this.resetStartWhenNotLoaded(this.level),this.state=g.State.IDLE)}break}this.onTickEnd()},i.onTickEnd=function(){s.prototype.onTickEnd.call(this),this.checkBuffer(),this.checkFragmentChanged()},i.doTickIdle=function(){var o,f,v=this.hls,c=this.levelLastLoaded,d=this.levels,x=this.media,P=v.config,M=v.nextLoadLevel;if(!(c===null||!x&&(this.startFragRequested||!P.startFragPrefetch))&&!(this.altAudio&&this.audioOnly)&&!(!d||!d[M])){var B=d[M];this.level=v.nextLoadLevel=M;var N=B.details;if(!N||this.state===g.State.WAITING_LEVEL||N.live&&this.levelLastLoaded!==M){this.state=g.State.WAITING_LEVEL;return}var U=this.getMainFwdBufferInfo();if(U!==null){var w=U.len,W=this.getMaxBufferLength(B.maxBitrate);if(!(w>=W)){if(this._streamEnded(U,N)){var j={};this.altAudio&&(j.type="video"),this.hls.trigger(F.Events.BUFFER_EOS,j),this.state=g.State.ENDED;return}this.backtrackFragment&&this.backtrackFragment.start>U.end&&(this.backtrackFragment=null);var G=this.backtrackFragment?this.backtrackFragment.start:U.end,H=this.getNextFragment(G,N);if(this.couldBacktrack&&!this.fragPrevious&&H&&H.sn!=="initSegment"&&this.fragmentTracker.getState(H)!==b.FragmentState.OK){var $,te=(($=this.backtrackFragment)!=null?$:H).sn,q=te-N.startSN,ne=N.fragments[q-1];ne&&H.cc===ne.cc&&(H=ne,this.fragmentTracker.removeFragment(ne))}else this.backtrackFragment&&U.len&&(this.backtrackFragment=null);if(H&&this.fragmentTracker.getState(H)===b.FragmentState.OK&&this.nextLoadPosition>G){var oe=this.audioOnly&&!this.altAudio?L.ElementaryStreamTypes.AUDIO:L.ElementaryStreamTypes.VIDEO;x&&this.afterBufferFlushed(x,oe,R.PlaylistLevelType.MAIN),H=this.getNextFragment(this.nextLoadPosition,N)}!H||(H.initSegment&&!H.initSegment.data&&!this.bitrateTest&&(H=H.initSegment),((o=H.decryptdata)===null||o===void 0?void 0:o.keyFormat)==="identity"&&!((f=H.decryptdata)!==null&&f!==void 0&&f.key)?this.loadKey(H,N):this.loadFragment(H,N,G))}}}},i.loadFragment=function(o,f,v){var c,d=this.fragmentTracker.getState(o);this.fragCurrent=o,d===b.FragmentState.NOT_LOADED?o.sn==="initSegment"?this._loadInitSegment(o):this.bitrateTest?(this.log("Fragment "+o.sn+" of level "+o.level+" is being downloaded to test bitrate and will not be buffered"),this._loadBitrateTestFrag(o)):(this.startFragRequested=!0,s.prototype.loadFragment.call(this,o,f,v)):d===b.FragmentState.APPENDING?this.reduceMaxBufferLength(o.duration)&&this.fragmentTracker.removeFragment(o):((c=this.media)===null||c===void 0?void 0:c.buffered.length)===0&&this.fragmentTracker.removeAllFragments()},i.getAppendedFrag=function(o){var f=this.fragmentTracker.getAppendedFrag(o,R.PlaylistLevelType.MAIN);return f&&"fragment"in f?f.fragment:f},i.getBufferedFrag=function(o){return this.fragmentTracker.getBufferedFrag(o,R.PlaylistLevelType.MAIN)},i.followingBufferedFrag=function(o){return o?this.getBufferedFrag(o.end+.5):null},i.immediateLevelSwitch=function(){this.abortCurrentFrag(),this.flushMainBuffer(0,Number.POSITIVE_INFINITY)},i.nextLevelSwitch=function(){var o=this.levels,f=this.media;if(f!=null&&f.readyState){var v,c=this.getAppendedFrag(f.currentTime);if(c&&c.start>1&&this.flushMainBuffer(0,c.start-1),!f.paused&&o){var d=this.hls.nextLoadLevel,x=o[d],P=this.fragLastKbps;P&&this.fragCurrent?v=this.fragCurrent.duration*x.maxBitrate/(1e3*P)+1:v=0}else v=0;var M=this.getBufferedFrag(f.currentTime+v);if(M){var B=this.followingBufferedFrag(M);if(B){this.abortCurrentFrag();var N=B.maxStartPTS?B.maxStartPTS:B.start,U=B.duration,w=Math.max(M.end,N+Math.min(Math.max(U-this.config.maxFragLookUpTolerance,U*.5),U*.75));this.flushMainBuffer(w,Number.POSITIVE_INFINITY)}}}},i.abortCurrentFrag=function(){var o=this.fragCurrent;switch(this.fragCurrent=null,this.backtrackFragment=null,o!=null&&o.loader&&o.loader.abort(),this.state){case g.State.KEY_LOADING:case g.State.FRAG_LOADING:case g.State.FRAG_LOADING_WAITING_RETRY:case g.State.PARSING:case g.State.PARSED:this.state=g.State.IDLE;break}this.nextLoadPosition=this.getLoadPosition()},i.flushMainBuffer=function(o,f){s.prototype.flushMainBuffer.call(this,o,f,this.altAudio?"video":null)},i.onMediaAttached=function(o,f){s.prototype.onMediaAttached.call(this,o,f);var v=f.media;this.onvplaying=this.onMediaPlaying.bind(this),this.onvseeked=this.onMediaSeeked.bind(this),v.addEventListener("playing",this.onvplaying),v.addEventListener("seeked",this.onvseeked),this.gapController=new O.default(this.config,v,this.fragmentTracker,this.hls)},i.onMediaDetaching=function(){var o=this.media;o&&this.onvplaying&&this.onvseeked&&(o.removeEventListener("playing",this.onvplaying),o.removeEventListener("seeked",this.onvseeked),this.onvplaying=this.onvseeked=null,this.videoBuffer=null),this.fragPlaying=null,this.gapController&&(this.gapController.destroy(),this.gapController=null),s.prototype.onMediaDetaching.call(this)},i.onMediaPlaying=function(){this.tick()},i.onMediaSeeked=function(){var o=this.media,f=o?o.currentTime:null;Object(D.isFiniteNumber)(f)&&this.log("Media seeked to "+f.toFixed(3)),this.tick()},i.onManifestLoading=function(){this.log("Trigger BUFFER_RESET"),this.hls.trigger(F.Events.BUFFER_RESET,void 0),this.fragmentTracker.removeAllFragments(),this.couldBacktrack=!1,this.startPosition=this.lastCurrentTime=0,this.fragPlaying=null,this.backtrackFragment=null},i.onManifestParsed=function(o,f){var v=!1,c=!1,d;f.levels.forEach(function(x){d=x.audioCodec,d&&(d.indexOf("mp4a.40.2")!==-1&&(v=!0),d.indexOf("mp4a.40.5")!==-1&&(c=!0))}),this.audioCodecSwitch=v&&c&&!Object(E.changeTypeSupported)(),this.audioCodecSwitch&&this.log("Both AAC/HE-AAC audio found in levels; declaring level codec as HE-AAC"),this.levels=f.levels,this.startFragRequested=!1},i.onLevelLoading=function(o,f){var v=this.levels;if(!(!v||this.state!==g.State.IDLE)){var c=v[f.level];(!c.details||c.details.live&&this.levelLastLoaded!==f.level||this.waitForCdnTuneIn(c.details))&&(this.state=g.State.WAITING_LEVEL)}},i.onLevelLoaded=function(o,f){var v,c=this.levels,d=f.level,x=f.details,P=x.totalduration;if(!c){this.warn("Levels were reset while loading level "+d);return}this.log("Level "+d+" loaded ["+x.startSN+","+x.endSN+"], cc ["+x.startCC+", "+x.endCC+"] duration:"+P);var M=this.fragCurrent;M&&(this.state===g.State.FRAG_LOADING||this.state===g.State.FRAG_LOADING_WAITING_RETRY)&&M.level!==f.level&&M.loader&&(this.state=g.State.IDLE,this.backtrackFragment=null,M.loader.abort());var B=c[d],N=0;if(x.live||(v=B.details)!==null&&v!==void 0&&v.live){if(x.fragments[0]||(x.deltaUpdateFailed=!0),x.deltaUpdateFailed)return;N=this.alignPlaylists(x,B.details)}if(B.details=x,this.levelLastLoaded=d,this.hls.trigger(F.Events.LEVEL_UPDATED,{details:x,level:d}),this.state===g.State.WAITING_LEVEL){if(this.waitForCdnTuneIn(x))return;this.state=g.State.IDLE}this.startFragRequested?x.live&&this.synchronizeToLiveEdge(x):this.setStartPosition(x,N),this.tick()},i._handleFragmentLoadProgress=function(o){var f,v=o.frag,c=o.part,d=o.payload,x=this.levels;if(!x){this.warn("Levels were reset while fragment load was in progress. Fragment "+v.sn+" of level "+v.level+" will not be buffered");return}var P=x[v.level],M=P.details;if(!M){this.warn("Dropping fragment "+v.sn+" of level "+v.level+" after level details were reset");return}var B=P.videoCodec,N=M.PTSKnown||!M.live,U=(f=v.initSegment)===null||f===void 0?void 0:f.data,w=this._getAudioCodec(P),W=this.transmuxer=this.transmuxer||new I.default(this.hls,R.PlaylistLevelType.MAIN,this._handleTransmuxComplete.bind(this),this._handleTransmuxerFlush.bind(this)),j=c?c.index:-1,G=j!==-1,H=new A.ChunkMetadata(v.level,v.sn,v.stats.chunkCount,d.byteLength,j,G),$=this.initPTS[v.cc];W.push(d,U,w,B,v,c,M.totalduration,N,H,$)},i.onAudioTrackSwitching=function(o,f){var v=this.altAudio,c=!!f.url,d=f.id;if(!c){if(this.mediaBuffer!==this.media){this.log("Switching on main audio, use media.buffered to schedule main fragment loading"),this.mediaBuffer=this.media;var x=this.fragCurrent;x!=null&&x.loader&&(this.log("Switching to main audio track, cancel main fragment load"),x.loader.abort()),this.resetTransmuxer(),this.resetLoadingState()}else this.audioOnly&&this.resetTransmuxer();var P=this.hls;v&&P.trigger(F.Events.BUFFER_FLUSHING,{startOffset:0,endOffset:Number.POSITIVE_INFINITY,type:"audio"}),P.trigger(F.Events.AUDIO_TRACK_SWITCHED,{id:d})}},i.onAudioTrackSwitched=function(o,f){var v=f.id,c=!!this.hls.audioTracks[v].url;if(c){var d=this.videoBuffer;d&&this.mediaBuffer!==d&&(this.log("Switching on alternate audio, use video.buffered to schedule main fragment loading"),this.mediaBuffer=d)}this.altAudio=c,this.tick()},i.onBufferCreated=function(o,f){var v=f.tracks,c,d,x=!1;for(var P in v){var M=v[P];if(M.id==="main"){if(d=P,c=M,P==="video"){var B=v[P];B&&(this.videoBuffer=B.buffer)}}else x=!0}x&&c?(this.log("Alternate track found, use "+d+".buffered to schedule main fragment loading"),this.mediaBuffer=c.buffer):this.mediaBuffer=this.media},i.onFragBuffered=function(o,f){var v=f.frag,c=f.part;if(!(v&&v.type!==R.PlaylistLevelType.MAIN)){if(this.fragContextChanged(v)){this.warn("Fragment "+v.sn+(c?" p: "+c.index:"")+" of level "+v.level+" finished buffering, but was aborted. state: "+this.state),this.state===g.State.PARSED&&(this.state=g.State.IDLE);return}var d=c?c.stats:v.stats;this.fragLastKbps=Math.round(8*d.total/(d.buffering.end-d.loading.first)),v.sn!=="initSegment"&&(this.fragPrevious=v),this.fragBufferedComplete(v,c)}},i.onError=function(o,f){switch(f.details){case S.ErrorDetails.FRAG_LOAD_ERROR:case S.ErrorDetails.FRAG_LOAD_TIMEOUT:case S.ErrorDetails.KEY_LOAD_ERROR:case S.ErrorDetails.KEY_LOAD_TIMEOUT:this.onFragmentOrKeyLoadError(R.PlaylistLevelType.MAIN,f);break;case S.ErrorDetails.LEVEL_LOAD_ERROR:case S.ErrorDetails.LEVEL_LOAD_TIMEOUT:this.state!==g.State.ERROR&&(f.fatal?(this.warn(""+f.details),this.state=g.State.ERROR):!f.levelRetry&&this.state===g.State.WAITING_LEVEL&&(this.state=g.State.IDLE));break;case S.ErrorDetails.BUFFER_FULL_ERROR:if(f.parent==="main"&&(this.state===g.State.PARSING||this.state===g.State.PARSED)){var v=!0,c=this.getFwdBufferInfo(this.media,R.PlaylistLevelType.MAIN);c&&c.len>.5&&(v=!this.reduceMaxBufferLength(c.len)),v&&(this.warn("buffer full error also media.currentTime is not buffered, flush main"),this.immediateLevelSwitch()),this.resetLoadingState()}break}},i.checkBuffer=function(){var o=this.media,f=this.gapController;if(!(!o||!f||!o.readyState)){if(this.loadedmetadata||!_.BufferHelper.getBuffered(o).length){var v=this.state!==g.State.IDLE?this.fragCurrent:null;f.poll(this.lastCurrentTime,v)}this.lastCurrentTime=o.currentTime}},i.onFragLoadEmergencyAborted=function(){this.state=g.State.IDLE,this.loadedmetadata||(this.startFragRequested=!1,this.nextLoadPosition=this.startPosition),this.tickImmediate()},i.onBufferFlushed=function(o,f){var v=f.type;if(v!==L.ElementaryStreamTypes.AUDIO||this.audioOnly&&!this.altAudio){var c=(v===L.ElementaryStreamTypes.VIDEO?this.videoBuffer:this.mediaBuffer)||this.media;this.afterBufferFlushed(c,v,R.PlaylistLevelType.MAIN)}},i.onLevelsUpdated=function(o,f){this.levels=f.levels},i.swapAudioCodec=function(){this.audioCodecSwap=!this.audioCodecSwap},i.seekToStartPos=function(){var o=this.media;if(!!o){var f=o.currentTime,v=this.startPosition;if(v>=0&&f<v){if(o.seeking){this.log("could not seek to "+v+", already seeking at "+f);return}var c=_.BufferHelper.getBuffered(o),d=c.length?c.start(0):0,x=d-v;x>0&&(x<this.config.maxBufferHole||x<this.config.maxFragLookUpTolerance)&&(this.log("adjusting start position by "+x+" to match buffer start"),v+=x,this.startPosition=v),this.log("seek to target start position "+v+" from current time "+f),o.currentTime=v}}},i._getAudioCodec=function(o){var f=this.config.defaultAudioCodec||o.audioCodec;return this.audioCodecSwap&&f&&(this.log("Swapping audio codec"),f.indexOf("mp4a.40.5")!==-1?f="mp4a.40.2":f="mp4a.40.5"),f},i._loadBitrateTestFrag=function(o){var f=this;o.bitrateTest=!0,this._doFragLoad(o).then(function(v){var c=f.hls;if(!(!v||c.nextLoadLevel||f.fragContextChanged(o))){f.fragLoadError=0,f.state=g.State.IDLE,f.startFragRequested=!1,f.bitrateTest=!1;var d=o.stats;d.parsing.start=d.parsing.end=d.buffering.start=d.buffering.end=self.performance.now(),c.trigger(F.Events.FRAG_LOADED,v),o.bitrateTest=!1}})},i._handleTransmuxComplete=function(o){var f,v="main",c=this.hls,d=o.remuxResult,x=o.chunkMeta,P=this.getCurrentContext(x);if(!P){this.warn("The loading context changed while buffering fragment "+x.sn+" of level "+x.level+". This chunk will not be buffered."),this.resetStartWhenNotLoaded(x.level);return}var M=P.frag,B=P.part,N=P.level,U=d.video,w=d.text,W=d.id3,j=d.initSegment,G=N.details,H=this.altAudio?void 0:d.audio;if(!this.fragContextChanged(M)){if(this.state=g.State.PARSING,j){j.tracks&&(this._bufferInitSegment(N,j.tracks,M,x),c.trigger(F.Events.FRAG_PARSING_INIT_SEGMENT,{frag:M,id:v,tracks:j.tracks}));var $=j.initPTS,te=j.timescale;Object(D.isFiniteNumber)($)&&(this.initPTS[M.cc]=$,c.trigger(F.Events.INIT_PTS_FOUND,{frag:M,id:v,initPTS:$,timescale:te}))}if(U&&d.independent!==!1){if(G){var q=U.startPTS,ne=U.endPTS,oe=U.startDTS,k=U.endDTS;if(B)B.elementaryStreams[U.type]={startPTS:q,endPTS:ne,startDTS:oe,endDTS:k};else if(U.firstKeyFrame&&U.independent&&(this.couldBacktrack=!0),U.dropped&&U.independent){var K=this.getMainFwdBufferInfo(),V=(K?K.end:this.getLoadPosition())+this.config.maxBufferHole,Y=U.firstKeyFramePTS?U.firstKeyFramePTS:q;if(V<Y-this.config.maxBufferHole){this.backtrack(M);return}M.setElementaryStreamInfo(U.type,M.start,ne,M.start,k,!0)}M.setElementaryStreamInfo(U.type,q,ne,oe,k),this.backtrackFragment&&(this.backtrackFragment=M),this.bufferFragmentData(U,M,B,x)}}else if(d.independent===!1){this.backtrack(M);return}if(H){var z=H.startPTS,Q=H.endPTS,Z=H.startDTS,J=H.endDTS;B&&(B.elementaryStreams[L.ElementaryStreamTypes.AUDIO]={startPTS:z,endPTS:Q,startDTS:Z,endDTS:J}),M.setElementaryStreamInfo(L.ElementaryStreamTypes.AUDIO,z,Q,Z,J),this.bufferFragmentData(H,M,B,x)}if(G&&W!==null&&W!==void 0&&(f=W.samples)!==null&&f!==void 0&&f.length){var ee={id:v,frag:M,details:G,samples:W.samples};c.trigger(F.Events.FRAG_PARSING_METADATA,ee)}if(G&&w){var X={id:v,frag:M,details:G,samples:w.samples};c.trigger(F.Events.FRAG_PARSING_USERDATA,X)}}},i._bufferInitSegment=function(o,f,v,c){var d=this;if(this.state===g.State.PARSING){this.audioOnly=!!f.audio&&!f.video,this.altAudio&&!this.audioOnly&&delete f.audio;var x=f.audio,P=f.video,M=f.audiovideo;if(x){var B=o.audioCodec,N=navigator.userAgent.toLowerCase();this.audioCodecSwitch&&(B&&(B.indexOf("mp4a.40.5")!==-1?B="mp4a.40.2":B="mp4a.40.5"),x.metadata.channelCount!==1&&N.indexOf("firefox")===-1&&(B="mp4a.40.5")),N.indexOf("android")!==-1&&x.container!=="audio/mpeg"&&(B="mp4a.40.2",this.log("Android: force audio codec to "+B)),o.audioCodec&&o.audioCodec!==B&&this.log('Swapping manifest audio codec "'+o.audioCodec+'" for "'+B+'"'),x.levelCodec=B,x.id="main",this.log("Init audio buffer, container:"+x.container+", codecs[selected/level/parsed]=["+(B||"")+"/"+(o.audioCodec||"")+"/"+x.codec+"]")}P&&(P.levelCodec=o.videoCodec,P.id="main",this.log("Init video buffer, container:"+P.container+", codecs[level/parsed]=["+(o.videoCodec||"")+"/"+P.codec+"]")),M&&this.log("Init audiovideo buffer, container:"+M.container+", codecs[level/parsed]=["+(o.attrs.CODECS||"")+"/"+M.codec+"]"),this.hls.trigger(F.Events.BUFFER_CODECS,f),Object.keys(f).forEach(function(U){var w=f[U],W=w.initSegment;W!=null&&W.byteLength&&d.hls.trigger(F.Events.BUFFER_APPENDING,{type:U,data:W,frag:v,part:null,chunkMeta:c,parent:v.type})}),this.tick()}},i.getMainFwdBufferInfo=function(){return this.getFwdBufferInfo(this.mediaBuffer?this.mediaBuffer:this.media,R.PlaylistLevelType.MAIN)},i.backtrack=function(o){this.couldBacktrack=!0,this.backtrackFragment=o,this.resetTransmuxer(),this.flushBufferGap(o),this.fragmentTracker.removeFragment(o),this.fragPrevious=null,this.nextLoadPosition=o.start,this.state=g.State.IDLE},i.checkFragmentChanged=function(){var o=this.media,f=null;if(o&&o.readyState>1&&o.seeking===!1){var v=o.currentTime;if(_.BufferHelper.isBuffered(o,v)?f=this.getAppendedFrag(v):_.BufferHelper.isBuffered(o,v+.1)&&(f=this.getAppendedFrag(v+.1)),f){this.backtrackFragment=null;var c=this.fragPlaying,d=f.level;(!c||f.sn!==c.sn||c.level!==d||f.urlId!==c.urlId)&&(this.hls.trigger(F.Events.FRAG_CHANGED,{frag:f}),(!c||c.level!==d)&&this.hls.trigger(F.Events.LEVEL_SWITCHED,{level:d}),this.fragPlaying=f)}}},a(n,[{key:"nextLevel",get:function(){var o=this.nextBufferedFrag;return o?o.level:-1}},{key:"currentFrag",get:function(){var o=this.media;return o?this.fragPlaying||this.getAppendedFrag(o.currentTime):null}},{key:"currentProgramDateTime",get:function(){var o=this.media;if(o){var f=o.currentTime,v=this.currentFrag;if(v&&Object(D.isFiniteNumber)(f)&&Object(D.isFiniteNumber)(v.programDateTime)){var c=v.programDateTime+(f-v.start)*1e3;return new Date(c)}}return null}},{key:"currentLevel",get:function(){var o=this.currentFrag;return o?o.level:-1}},{key:"nextBufferedFrag",get:function(){var o=this.currentFrag;return o?this.followingBufferedFrag(o):null}},{key:"forceStartLoad",get:function(){return this._forceStartLoad}}]),n}(g.default)},"./src/controller/subtitle-stream-controller.ts":function(C,l,t){t.r(l),t.d(l,"SubtitleStreamController",function(){return r});var D=t("./src/events.ts"),g=t("./src/utils/buffer-helper.ts"),E=t("./src/controller/fragment-finders.ts"),F=t("./src/utils/discontinuities.ts"),_=t("./src/controller/level-helper.ts"),b=t("./src/controller/fragment-tracker.ts"),R=t("./src/controller/base-stream-controller.ts"),L=t("./src/types/loader.ts"),I=t("./src/types/level.ts");function A(h,y){for(var s=0;s<y.length;s++){var n=y[s];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(h,n.key,n)}}function O(h,y,s){return y&&A(h.prototype,y),s&&A(h,s),Object.defineProperty(h,"prototype",{writable:!1}),h}function S(h,y){h.prototype=Object.create(y.prototype),h.prototype.constructor=h,T(h,y)}function T(h,y){return T=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(n,i){return n.__proto__=i,n},T(h,y)}var a=500,r=function(h){S(y,h);function y(n,i){var m;return m=h.call(this,n,i,"[subtitle-stream-controller]")||this,m.levels=[],m.currentTrackId=-1,m.tracksBuffered=[],m.mainDetails=null,m._registerListeners(),m}var s=y.prototype;return s.onHandlerDestroying=function(){this._unregisterListeners(),this.mainDetails=null},s._registerListeners=function(){var i=this.hls;i.on(D.Events.MEDIA_ATTACHED,this.onMediaAttached,this),i.on(D.Events.MEDIA_DETACHING,this.onMediaDetaching,this),i.on(D.Events.MANIFEST_LOADING,this.onManifestLoading,this),i.on(D.Events.LEVEL_LOADED,this.onLevelLoaded,this),i.on(D.Events.ERROR,this.onError,this),i.on(D.Events.SUBTITLE_TRACKS_UPDATED,this.onSubtitleTracksUpdated,this),i.on(D.Events.SUBTITLE_TRACK_SWITCH,this.onSubtitleTrackSwitch,this),i.on(D.Events.SUBTITLE_TRACK_LOADED,this.onSubtitleTrackLoaded,this),i.on(D.Events.SUBTITLE_FRAG_PROCESSED,this.onSubtitleFragProcessed,this),i.on(D.Events.BUFFER_FLUSHING,this.onBufferFlushing,this)},s._unregisterListeners=function(){var i=this.hls;i.off(D.Events.MEDIA_ATTACHED,this.onMediaAttached,this),i.off(D.Events.MEDIA_DETACHING,this.onMediaDetaching,this),i.off(D.Events.MANIFEST_LOADING,this.onManifestLoading,this),i.off(D.Events.LEVEL_LOADED,this.onLevelLoaded,this),i.off(D.Events.ERROR,this.onError,this),i.off(D.Events.SUBTITLE_TRACKS_UPDATED,this.onSubtitleTracksUpdated,this),i.off(D.Events.SUBTITLE_TRACK_SWITCH,this.onSubtitleTrackSwitch,this),i.off(D.Events.SUBTITLE_TRACK_LOADED,this.onSubtitleTrackLoaded,this),i.off(D.Events.SUBTITLE_FRAG_PROCESSED,this.onSubtitleFragProcessed,this),i.off(D.Events.BUFFER_FLUSHING,this.onBufferFlushing,this)},s.startLoad=function(){this.stopLoad(),this.state=R.State.IDLE,this.setInterval(a),this.tick()},s.onManifestLoading=function(){this.mainDetails=null,this.fragmentTracker.removeAllFragments()},s.onLevelLoaded=function(i,m){this.mainDetails=m.details},s.onSubtitleFragProcessed=function(i,m){var o=m.frag,f=m.success;if(this.fragPrevious=o,this.state=R.State.IDLE,!!f){var v=this.tracksBuffered[this.currentTrackId];if(!!v){for(var c,d=o.start,x=0;x<v.length;x++)if(d>=v[x].start&&d<=v[x].end){c=v[x];break}var P=o.start+o.duration;c?c.end=P:(c={start:d,end:P},v.push(c)),this.fragmentTracker.fragBuffered(o)}}},s.onBufferFlushing=function(i,m){var o=m.startOffset,f=m.endOffset;if(o===0&&f!==Number.POSITIVE_INFINITY){var v=this.currentTrackId,c=this.levels;if(!c.length||!c[v]||!c[v].details)return;var d=c[v].details,x=d.targetduration,P=f-x;if(P<=0)return;m.endOffsetSubtitles=Math.max(0,P),this.tracksBuffered.forEach(function(M){for(var B=0;B<M.length;){if(M[B].end<=P){M.shift();continue}else if(M[B].start<P)M[B].start=P;else break;B++}}),this.fragmentTracker.removeFragmentsInRange(o,P,L.PlaylistLevelType.SUBTITLE)}},s.onError=function(i,m){var o,f=m.frag;!f||f.type!==L.PlaylistLevelType.SUBTITLE||((o=this.fragCurrent)!==null&&o!==void 0&&o.loader&&this.fragCurrent.loader.abort(),this.state=R.State.IDLE)},s.onSubtitleTracksUpdated=function(i,m){var o=this,f=m.subtitleTracks;this.tracksBuffered=[],this.levels=f.map(function(v){return new I.Level(v)}),this.fragmentTracker.removeAllFragments(),this.fragPrevious=null,this.levels.forEach(function(v){o.tracksBuffered[v.id]=[]}),this.mediaBuffer=null},s.onSubtitleTrackSwitch=function(i,m){if(this.currentTrackId=m.id,!this.levels.length||this.currentTrackId===-1){this.clearInterval();return}var o=this.levels[this.currentTrackId];o!=null&&o.details?this.mediaBuffer=this.mediaBufferTimeRanges:this.mediaBuffer=null,o&&this.setInterval(a)},s.onSubtitleTrackLoaded=function(i,m){var o,f=m.details,v=m.id,c=this.currentTrackId,d=this.levels;if(!!d.length){var x=d[c];if(!(v>=d.length||v!==c||!x)){if(this.mediaBuffer=this.mediaBufferTimeRanges,f.live||(o=x.details)!==null&&o!==void 0&&o.live){var P=this.mainDetails;if(f.deltaUpdateFailed||!P)return;var M=P.fragments[0];if(!x.details)f.hasProgramDateTime&&P.hasProgramDateTime?Object(F.alignMediaPlaylistByPDT)(f,P):M&&Object(_.addSliding)(f,M.start);else{var B=this.alignPlaylists(f,x.details);B===0&&M&&Object(_.addSliding)(f,M.start)}}if(x.details=f,this.levelLastLoaded=v,this.tick(),f.live&&!this.fragCurrent&&this.media&&this.state===R.State.IDLE){var N=Object(E.findFragmentByPTS)(null,f.fragments,this.media.currentTime,0);N||(this.warn("Subtitle playlist not aligned with playback"),x.details=void 0)}}}},s._handleFragmentLoadComplete=function(i){var m=i.frag,o=i.payload,f=m.decryptdata,v=this.hls;if(!this.fragContextChanged(m)&&o&&o.byteLength>0&&f&&f.key&&f.iv&&f.method==="AES-128"){var c=performance.now();this.decrypter.webCryptoDecrypt(new Uint8Array(o),f.key.buffer,f.iv.buffer).then(function(d){var x=performance.now();v.trigger(D.Events.FRAG_DECRYPTED,{frag:m,payload:d,stats:{tstart:c,tdecrypt:x}})})}},s.doTick=function(){if(!this.media){this.state=R.State.IDLE;return}if(this.state===R.State.IDLE){var i=this.currentTrackId,m=this.levels;if(!m.length||!m[i]||!m[i].details)return;var o=m[i].details,f=o.targetduration,v=this.config,c=this.media,d=g.BufferHelper.bufferedInfo(this.tracksBuffered[this.currentTrackId]||[],c.currentTime-f,v.maxBufferHole),x=d.end,P=d.len,M=this.getMaxBufferLength()+f;if(P>M)return;console.assert(o,"Subtitle track details are defined on idle subtitle stream controller tick");var B=o.fragments,N=B.length,U=o.edge,w,W=this.fragPrevious;if(x<U){var j=v.maxFragLookUpTolerance;w=Object(E.findFragmentByPTS)(W,B,Math.max(B[0].start,x),j),!w&&W&&W.start<B[0].start&&(w=B[0])}else w=B[N-1];if(w=this.mapToInitFragWhenRequired(w),!w||this.fragmentTracker.getState(w)!==b.FragmentState.NOT_LOADED)return;w.encrypted?this.loadKey(w,o):this.loadFragment(w,o,x)}},s.loadFragment=function(i,m,o){this.fragCurrent=i,i.sn==="initSegment"?this._loadInitSegment(i):h.prototype.loadFragment.call(this,i,m,o)},O(y,[{key:"mediaBufferTimeRanges",get:function(){return new u(this.tracksBuffered[this.currentTrackId]||[])}}]),y}(R.default),u=function(y){this.buffered=void 0;var s=function(i,m,o){if(m=m>>>0,m>o-1)throw new DOMException("Failed to execute '"+i+"' on 'TimeRanges': The index provided ("+m+") is greater than the maximum bound ("+o+")");return y[m][i]};this.buffered={get length(){return y.length},end:function(i){return s("end",i,y.length)},start:function(i){return s("start",i,y.length)}}}},"./src/controller/subtitle-track-controller.ts":function(C,l,t){t.r(l);var D=t("./src/events.ts"),g=t("./src/utils/texttrack-utils.ts"),E=t("./src/controller/base-playlist-controller.ts"),F=t("./src/types/loader.ts");function _(O,S){for(var T=0;T<S.length;T++){var a=S[T];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(O,a.key,a)}}function b(O,S,T){return S&&_(O.prototype,S),T&&_(O,T),Object.defineProperty(O,"prototype",{writable:!1}),O}function R(O,S){O.prototype=Object.create(S.prototype),O.prototype.constructor=O,L(O,S)}function L(O,S){return L=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(a,r){return a.__proto__=r,a},L(O,S)}var I=function(O){R(S,O);function S(a){var r;return r=O.call(this,a,"[subtitle-track-controller]")||this,r.media=null,r.tracks=[],r.groupId=null,r.tracksInGroup=[],r.trackId=-1,r.selectDefaultTrack=!0,r.queuedDefaultTrack=-1,r.trackChangeListener=function(){return r.onTextTracksChanged()},r.asyncPollTrackChange=function(){return r.pollTrackChange(0)},r.useTextTrackPolling=!1,r.subtitlePollingInterval=-1,r._subtitleDisplay=!0,r.registerListeners(),r}var T=S.prototype;return T.destroy=function(){this.unregisterListeners(),this.tracks.length=0,this.tracksInGroup.length=0,this.trackChangeListener=this.asyncPollTrackChange=null,O.prototype.destroy.call(this)},T.registerListeners=function(){var r=this.hls;r.on(D.Events.MEDIA_ATTACHED,this.onMediaAttached,this),r.on(D.Events.MEDIA_DETACHING,this.onMediaDetaching,this),r.on(D.Events.MANIFEST_LOADING,this.onManifestLoading,this),r.on(D.Events.MANIFEST_PARSED,this.onManifestParsed,this),r.on(D.Events.LEVEL_LOADING,this.onLevelLoading,this),r.on(D.Events.LEVEL_SWITCHING,this.onLevelSwitching,this),r.on(D.Events.SUBTITLE_TRACK_LOADED,this.onSubtitleTrackLoaded,this),r.on(D.Events.ERROR,this.onError,this)},T.unregisterListeners=function(){var r=this.hls;r.off(D.Events.MEDIA_ATTACHED,this.onMediaAttached,this),r.off(D.Events.MEDIA_DETACHING,this.onMediaDetaching,this),r.off(D.Events.MANIFEST_LOADING,this.onManifestLoading,this),r.off(D.Events.MANIFEST_PARSED,this.onManifestParsed,this),r.off(D.Events.LEVEL_LOADING,this.onLevelLoading,this),r.off(D.Events.LEVEL_SWITCHING,this.onLevelSwitching,this),r.off(D.Events.SUBTITLE_TRACK_LOADED,this.onSubtitleTrackLoaded,this),r.off(D.Events.ERROR,this.onError,this)},T.onMediaAttached=function(r,u){this.media=u.media,this.media&&(this.queuedDefaultTrack>-1&&(this.subtitleTrack=this.queuedDefaultTrack,this.queuedDefaultTrack=-1),this.useTextTrackPolling=!(this.media.textTracks&&"onchange"in this.media.textTracks),this.useTextTrackPolling?this.pollTrackChange(500):this.media.textTracks.addEventListener("change",this.asyncPollTrackChange))},T.pollTrackChange=function(r){self.clearInterval(this.subtitlePollingInterval),this.subtitlePollingInterval=self.setInterval(this.trackChangeListener,r)},T.onMediaDetaching=function(){if(!!this.media){self.clearInterval(this.subtitlePollingInterval),this.useTextTrackPolling||this.media.textTracks.removeEventListener("change",this.asyncPollTrackChange),this.trackId>-1&&(this.queuedDefaultTrack=this.trackId);var r=A(this.media.textTracks);r.forEach(function(u){Object(g.clearCurrentCues)(u)}),this.subtitleTrack=-1,this.media=null}},T.onManifestLoading=function(){this.tracks=[],this.groupId=null,this.tracksInGroup=[],this.trackId=-1,this.selectDefaultTrack=!0},T.onManifestParsed=function(r,u){this.tracks=u.subtitleTracks},T.onSubtitleTrackLoaded=function(r,u){var h=u.id,y=u.details,s=this.trackId,n=this.tracksInGroup[s];if(!n){this.warn("Invalid subtitle track id "+h);return}var i=n.details;n.details=u.details,this.log("subtitle track "+h+" loaded ["+y.startSN+"-"+y.endSN+"]"),h===this.trackId&&(this.retryCount=0,this.playlistLoaded(h,u,i))},T.onLevelLoading=function(r,u){this.switchLevel(u.level)},T.onLevelSwitching=function(r,u){this.switchLevel(u.level)},T.switchLevel=function(r){var u=this.hls.levels[r];if(!!(u!=null&&u.textGroupIds)){var h=u.textGroupIds[u.urlId];if(this.groupId!==h){var y=this.tracksInGroup?this.tracksInGroup[this.trackId]:void 0,s=this.tracks.filter(function(m){return!h||m.groupId===h});this.tracksInGroup=s;var n=this.findTrackId(y==null?void 0:y.name)||this.findTrackId();this.groupId=h;var i={subtitleTracks:s};this.log("Updating subtitle tracks, "+s.length+' track(s) found in "'+h+'" group-id'),this.hls.trigger(D.Events.SUBTITLE_TRACKS_UPDATED,i),n!==-1&&this.setSubtitleTrack(n,y)}}},T.findTrackId=function(r){for(var u=this.tracksInGroup,h=0;h<u.length;h++){var y=u[h];if((!this.selectDefaultTrack||y.default)&&(!r||r===y.name))return y.id}return-1},T.onError=function(r,u){O.prototype.onError.call(this,r,u),!(u.fatal||!u.context)&&u.context.type===F.PlaylistContextType.SUBTITLE_TRACK&&u.context.id===this.trackId&&u.context.groupId===this.groupId&&this.retryLoadingOrFail(u)},T.loadPlaylist=function(r){var u=this.tracksInGroup[this.trackId];if(this.shouldLoadTrack(u)){var h=u.id,y=u.groupId,s=u.url;if(r)try{s=r.addDirectives(s)}catch(n){this.warn("Could not construct new URL with HLS Delivery Directives: "+n)}this.log("Loading subtitle playlist for id "+h),this.hls.trigger(D.Events.SUBTITLE_TRACK_LOADING,{url:s,id:h,groupId:y,deliveryDirectives:r||null})}},T.toggleTrackModes=function(r){var u=this,h=this.media,y=this.trackId;if(!!h){var s=A(h.textTracks),n=s.filter(function(o){return o.groupId===u.groupId});if(r===-1)[].slice.call(s).forEach(function(o){o.mode="disabled"});else{var i=n[y];i&&(i.mode="disabled")}var m=n[r];m&&(m.mode=this.subtitleDisplay?"showing":"hidden")}},T.setSubtitleTrack=function(r,u){var h,y=this.tracksInGroup;if(!this.media){this.queuedDefaultTrack=r;return}if(this.trackId!==r&&this.toggleTrackModes(r),!(this.trackId===r&&(r===-1||(h=y[r])!==null&&h!==void 0&&h.details)||r<-1||r>=y.length)){this.clearTimer();var s=y[r];if(this.log("Switching to subtitle track "+r),this.trackId=r,s){var n=s.id,i=s.groupId,m=i===void 0?"":i,o=s.name,f=s.type,v=s.url;this.hls.trigger(D.Events.SUBTITLE_TRACK_SWITCH,{id:n,groupId:m,name:o,type:f,url:v});var c=this.switchParams(s.url,u==null?void 0:u.details);this.loadPlaylist(c)}else this.hls.trigger(D.Events.SUBTITLE_TRACK_SWITCH,{id:r})}},T.onTextTracksChanged=function(){if(this.useTextTrackPolling||self.clearInterval(this.subtitlePollingInterval),!(!this.media||!this.hls.config.renderTextTracksNatively)){for(var r=-1,u=A(this.media.textTracks),h=0;h<u.length;h++)if(u[h].mode==="hidden")r=h;else if(u[h].mode==="showing"){r=h;break}this.subtitleTrack!==r&&(this.subtitleTrack=r)}},b(S,[{key:"subtitleDisplay",get:function(){return this._subtitleDisplay},set:function(r){this._subtitleDisplay=r,this.trackId>-1&&this.toggleTrackModes(this.trackId)}},{key:"subtitleTracks",get:function(){return this.tracksInGroup}},{key:"subtitleTrack",get:function(){return this.trackId},set:function(r){this.selectDefaultTrack=!1;var u=this.tracksInGroup?this.tracksInGroup[this.trackId]:void 0;this.setSubtitleTrack(r,u)}}]),S}(E.default);function A(O){for(var S=[],T=0;T<O.length;T++){var a=O[T];a.kind==="subtitles"&&a.label&&S.push(O[T])}return S}l.default=I},"./src/controller/timeline-controller.ts":function(C,l,t){t.r(l),t.d(l,"TimelineController",function(){return O});var D=t("./src/polyfills/number.ts"),g=t("./src/events.ts"),E=t("./src/utils/cea-608-parser.ts"),F=t("./src/utils/output-filter.ts"),_=t("./src/utils/webvtt-parser.ts"),b=t("./src/utils/texttrack-utils.ts"),R=t("./src/utils/imsc1-ttml-parser.ts"),L=t("./src/utils/mp4-tools.ts"),I=t("./src/types/loader.ts"),A=t("./src/utils/logger.ts"),O=function(){function r(h){if(this.hls=void 0,this.media=null,this.config=void 0,this.enabled=!0,this.Cues=void 0,this.textTracks=[],this.tracks=[],this.initPTS=[],this.timescale=[],this.unparsedVttFrags=[],this.captionsTracks={},this.nonNativeCaptionsTracks={},this.cea608Parser1=void 0,this.cea608Parser2=void 0,this.lastSn=-1,this.lastPartIndex=-1,this.prevCC=-1,this.vttCCs=a(),this.captionsProperties=void 0,this.hls=h,this.config=h.config,this.Cues=h.config.cueHandler,this.captionsProperties={textTrack1:{label:this.config.captionsTextTrack1Label,languageCode:this.config.captionsTextTrack1LanguageCode},textTrack2:{label:this.config.captionsTextTrack2Label,languageCode:this.config.captionsTextTrack2LanguageCode},textTrack3:{label:this.config.captionsTextTrack3Label,languageCode:this.config.captionsTextTrack3LanguageCode},textTrack4:{label:this.config.captionsTextTrack4Label,languageCode:this.config.captionsTextTrack4LanguageCode}},this.config.enableCEA708Captions){var y=new F.default(this,"textTrack1"),s=new F.default(this,"textTrack2"),n=new F.default(this,"textTrack3"),i=new F.default(this,"textTrack4");this.cea608Parser1=new E.default(1,y,s),this.cea608Parser2=new E.default(3,n,i)}h.on(g.Events.MEDIA_ATTACHING,this.onMediaAttaching,this),h.on(g.Events.MEDIA_DETACHING,this.onMediaDetaching,this),h.on(g.Events.MANIFEST_LOADING,this.onManifestLoading,this),h.on(g.Events.MANIFEST_LOADED,this.onManifestLoaded,this),h.on(g.Events.SUBTITLE_TRACKS_UPDATED,this.onSubtitleTracksUpdated,this),h.on(g.Events.FRAG_LOADING,this.onFragLoading,this),h.on(g.Events.FRAG_LOADED,this.onFragLoaded,this),h.on(g.Events.FRAG_PARSING_USERDATA,this.onFragParsingUserdata,this),h.on(g.Events.FRAG_DECRYPTED,this.onFragDecrypted,this),h.on(g.Events.INIT_PTS_FOUND,this.onInitPtsFound,this),h.on(g.Events.SUBTITLE_TRACKS_CLEARED,this.onSubtitleTracksCleared,this),h.on(g.Events.BUFFER_FLUSHING,this.onBufferFlushing,this)}var u=r.prototype;return u.destroy=function(){var y=this.hls;y.off(g.Events.MEDIA_ATTACHING,this.onMediaAttaching,this),y.off(g.Events.MEDIA_DETACHING,this.onMediaDetaching,this),y.off(g.Events.MANIFEST_LOADING,this.onManifestLoading,this),y.off(g.Events.MANIFEST_LOADED,this.onManifestLoaded,this),y.off(g.Events.SUBTITLE_TRACKS_UPDATED,this.onSubtitleTracksUpdated,this),y.off(g.Events.FRAG_LOADING,this.onFragLoading,this),y.off(g.Events.FRAG_LOADED,this.onFragLoaded,this),y.off(g.Events.FRAG_PARSING_USERDATA,this.onFragParsingUserdata,this),y.off(g.Events.FRAG_DECRYPTED,this.onFragDecrypted,this),y.off(g.Events.INIT_PTS_FOUND,this.onInitPtsFound,this),y.off(g.Events.SUBTITLE_TRACKS_CLEARED,this.onSubtitleTracksCleared,this),y.off(g.Events.BUFFER_FLUSHING,this.onBufferFlushing,this),this.hls=this.config=this.cea608Parser1=this.cea608Parser2=null},u.addCues=function(y,s,n,i,m){for(var o=!1,f=m.length;f--;){var v=m[f],c=T(v[0],v[1],s,n);if(c>=0&&(v[0]=Math.min(v[0],s),v[1]=Math.max(v[1],n),o=!0,c/(n-s)>.5))return}if(o||m.push([s,n]),this.config.renderTextTracksNatively){var d=this.captionsTracks[y];this.Cues.newCue(d,s,n,i)}else{var x=this.Cues.newCue(null,s,n,i);this.hls.trigger(g.Events.CUES_PARSED,{type:"captions",cues:x,track:y})}},u.onInitPtsFound=function(y,s){var n=this,i=s.frag,m=s.id,o=s.initPTS,f=s.timescale,v=this.unparsedVttFrags;m==="main"&&(this.initPTS[i.cc]=o,this.timescale[i.cc]=f),v.length&&(this.unparsedVttFrags=[],v.forEach(function(c){n.onFragLoaded(g.Events.FRAG_LOADED,c)}))},u.getExistingTrack=function(y){var s=this.media;if(s)for(var n=0;n<s.textTracks.length;n++){var i=s.textTracks[n];if(i[y])return i}return null},u.createCaptionsTrack=function(y){this.config.renderTextTracksNatively?this.createNativeTrack(y):this.createNonNativeTrack(y)},u.createNativeTrack=function(y){if(!this.captionsTracks[y]){var s=this.captionsProperties,n=this.captionsTracks,i=this.media,m=s[y],o=m.label,f=m.languageCode,v=this.getExistingTrack(y);if(v)n[y]=v,Object(b.clearCurrentCues)(n[y]),Object(b.sendAddTrackEvent)(n[y],i);else{var c=this.createTextTrack("captions",o,f);c&&(c[y]=!0,n[y]=c)}}},u.createNonNativeTrack=function(y){if(!this.nonNativeCaptionsTracks[y]){var s=this.captionsProperties[y];if(!!s){var n=s.label,i={_id:y,label:n,kind:"captions",default:s.media?!!s.media.default:!1,closedCaptions:s.media};this.nonNativeCaptionsTracks[y]=i,this.hls.trigger(g.Events.NON_NATIVE_TEXT_TRACKS_FOUND,{tracks:[i]})}}},u.createTextTrack=function(y,s,n){var i=this.media;if(!!i)return i.addTextTrack(y,s,n)},u.onMediaAttaching=function(y,s){this.media=s.media,this._cleanTracks()},u.onMediaDetaching=function(){var y=this.captionsTracks;Object.keys(y).forEach(function(s){Object(b.clearCurrentCues)(y[s]),delete y[s]}),this.nonNativeCaptionsTracks={}},u.onManifestLoading=function(){this.lastSn=-1,this.lastPartIndex=-1,this.prevCC=-1,this.vttCCs=a(),this._cleanTracks(),this.tracks=[],this.captionsTracks={},this.nonNativeCaptionsTracks={},this.textTracks=[],this.unparsedVttFrags=this.unparsedVttFrags||[],this.initPTS=[],this.timescale=[],this.cea608Parser1&&this.cea608Parser2&&(this.cea608Parser1.reset(),this.cea608Parser2.reset())},u._cleanTracks=function(){var y=this.media;if(!!y){var s=y.textTracks;if(s)for(var n=0;n<s.length;n++)Object(b.clearCurrentCues)(s[n])}},u.onSubtitleTracksUpdated=function(y,s){var n=this;this.textTracks=[];var i=s.subtitleTracks||[],m=i.some(function(c){return c.textCodec===R.IMSC1_CODEC});if(this.config.enableWebVTT||m&&this.config.enableIMSC1){var o=this.tracks&&i&&this.tracks.length===i.length;if(this.tracks=i||[],this.config.renderTextTracksNatively){var f=this.media?this.media.textTracks:[];this.tracks.forEach(function(c,d){var x;if(d<f.length){for(var P=null,M=0;M<f.length;M++)if(S(f[M],c)){P=f[M];break}P&&(x=P)}if(x)Object(b.clearCurrentCues)(x);else{var B=n._captionsOrSubtitlesFromCharacteristics(c);x=n.createTextTrack(B,c.name,c.lang),x&&(x.mode="disabled")}x&&(x.groupId=c.groupId,n.textTracks.push(x))})}else if(!o&&this.tracks&&this.tracks.length){var v=this.tracks.map(function(c){return{label:c.name,kind:c.type.toLowerCase(),default:c.default,subtitleTrack:c}});this.hls.trigger(g.Events.NON_NATIVE_TEXT_TRACKS_FOUND,{tracks:v})}}},u._captionsOrSubtitlesFromCharacteristics=function(y){var s;if((s=y.attrs)!==null&&s!==void 0&&s.CHARACTERISTICS){var n=/transcribes-spoken-dialog/gi.test(y.attrs.CHARACTERISTICS),i=/describes-music-and-sound/gi.test(y.attrs.CHARACTERISTICS);if(n&&i)return"captions"}return"subtitles"},u.onManifestLoaded=function(y,s){var n=this;this.config.enableCEA708Captions&&s.captions&&s.captions.forEach(function(i){var m=/(?:CC|SERVICE)([1-4])/.exec(i.instreamId);if(!!m){var o="textTrack"+m[1],f=n.captionsProperties[o];!f||(f.label=i.name,i.lang&&(f.languageCode=i.lang),f.media=i)}})},u.closedCaptionsForLevel=function(y){var s=this.hls.levels[y.level];return s==null?void 0:s.attrs["CLOSED-CAPTIONS"]},u.onFragLoading=function(y,s){var n=this.cea608Parser1,i=this.cea608Parser2,m=this.lastSn,o=this.lastPartIndex;if(!(!this.enabled||!(n&&i))&&s.frag.type===I.PlaylistLevelType.MAIN){var f,v,c=s.frag.sn,d=(f=s==null||(v=s.part)===null||v===void 0?void 0:v.index)!=null?f:-1;c===m+1||c===m&&d===o+1||(n.reset(),i.reset()),this.lastSn=c,this.lastPartIndex=d}},u.onFragLoaded=function(y,s){var n=s.frag,i=s.payload,m=this.initPTS,o=this.unparsedVttFrags;if(n.type===I.PlaylistLevelType.SUBTITLE)if(i.byteLength){if(!Object(D.isFiniteNumber)(m[n.cc])){o.push(s),m.length&&this.hls.trigger(g.Events.SUBTITLE_FRAG_PROCESSED,{success:!1,frag:n,error:new Error("Missing initial subtitle PTS")});return}var f=n.decryptdata,v="stats"in s;if(f==null||f.key==null||f.method!=="AES-128"||v){var c=this.tracks[n.level],d=this.vttCCs;d[n.cc]||(d[n.cc]={start:n.start,prevCC:this.prevCC,new:!0},this.prevCC=n.cc),c&&c.textCodec===R.IMSC1_CODEC?this._parseIMSC1(n,i):this._parseVTTs(n,i,d)}}else this.hls.trigger(g.Events.SUBTITLE_FRAG_PROCESSED,{success:!1,frag:n,error:new Error("Empty subtitle payload")})},u._parseIMSC1=function(y,s){var n=this,i=this.hls;Object(R.parseIMSC1)(s,this.initPTS[y.cc],this.timescale[y.cc],function(m){n._appendCues(m,y.level),i.trigger(g.Events.SUBTITLE_FRAG_PROCESSED,{success:!0,frag:y})},function(m){A.logger.log("Failed to parse IMSC1: "+m),i.trigger(g.Events.SUBTITLE_FRAG_PROCESSED,{success:!1,frag:y,error:m})})},u._parseVTTs=function(y,s,n){var i,m=this,o=this.hls,f=(i=y.initSegment)!==null&&i!==void 0&&i.data?Object(L.appendUint8Array)(y.initSegment.data,new Uint8Array(s)):s;Object(_.parseWebVTT)(f,this.initPTS[y.cc],this.timescale[y.cc],n,y.cc,y.start,function(v){m._appendCues(v,y.level),o.trigger(g.Events.SUBTITLE_FRAG_PROCESSED,{success:!0,frag:y})},function(v){m._fallbackToIMSC1(y,s),A.logger.log("Failed to parse VTT cue: "+v),o.trigger(g.Events.SUBTITLE_FRAG_PROCESSED,{success:!1,frag:y,error:v})})},u._fallbackToIMSC1=function(y,s){var n=this,i=this.tracks[y.level];i.textCodec||Object(R.parseIMSC1)(s,this.initPTS[y.cc],this.timescale[y.cc],function(){i.textCodec=R.IMSC1_CODEC,n._parseIMSC1(y,s)},function(){i.textCodec="wvtt"})},u._appendCues=function(y,s){var n=this.hls;if(this.config.renderTextTracksNatively){var i=this.textTracks[s];if(!i||i.mode==="disabled")return;y.forEach(function(f){return Object(b.addCueToTrack)(i,f)})}else{var m=this.tracks[s];if(!m)return;var o=m.default?"default":"subtitles"+s;n.trigger(g.Events.CUES_PARSED,{type:"subtitles",cues:y,track:o})}},u.onFragDecrypted=function(y,s){var n=s.frag;if(n.type===I.PlaylistLevelType.SUBTITLE){if(!Object(D.isFiniteNumber)(this.initPTS[n.cc])){this.unparsedVttFrags.push(s);return}this.onFragLoaded(g.Events.FRAG_LOADED,s)}},u.onSubtitleTracksCleared=function(){this.tracks=[],this.captionsTracks={}},u.onFragParsingUserdata=function(y,s){var n=this.cea608Parser1,i=this.cea608Parser2;if(!(!this.enabled||!(n&&i))){var m=s.frag,o=s.samples;if(!(m.type===I.PlaylistLevelType.MAIN&&this.closedCaptionsForLevel(m)==="NONE"))for(var f=0;f<o.length;f++){var v=o[f].bytes;if(v){var c=this.extractCea608Data(v);n.addData(o[f].pts,c[0]),i.addData(o[f].pts,c[1])}}}},u.onBufferFlushing=function(y,s){var n=s.startOffset,i=s.endOffset,m=s.endOffsetSubtitles,o=s.type,f=this.media;if(!(!f||f.currentTime<i)){if(!o||o==="video"){var v=this.captionsTracks;Object.keys(v).forEach(function(d){return Object(b.removeCuesInRange)(v[d],n,i)})}if(this.config.renderTextTracksNatively&&n===0&&m!==void 0){var c=this.textTracks;Object.keys(c).forEach(function(d){return Object(b.removeCuesInRange)(c[d],n,m)})}}},u.extractCea608Data=function(y){for(var s=[[],[]],n=y[0]&31,i=2,m=0;m<n;m++){var o=y[i++],f=127&y[i++],v=127&y[i++];if(!(f===0&&v===0)){var c=(4&o)!==0;if(c){var d=3&o;(d===0||d===1)&&(s[d].push(f),s[d].push(v))}}}return s},r}();function S(r,u){return r&&r.label===u.name&&!(r.textTrack1||r.textTrack2)}function T(r,u,h,y){return Math.min(u,y)-Math.max(r,h)}function a(){return{ccOffset:0,presentationOffset:0,0:{start:0,prevCC:-1,new:!0}}}},"./src/crypt/aes-crypto.ts":function(C,l,t){t.r(l),t.d(l,"default",function(){return D});var D=function(){function g(F,_){this.subtle=void 0,this.aesIV=void 0,this.subtle=F,this.aesIV=_}var E=g.prototype;return E.decrypt=function(_,b){return this.subtle.decrypt({name:"AES-CBC",iv:this.aesIV},b,_)},g}()},"./src/crypt/aes-decryptor.ts":function(C,l,t){t.r(l),t.d(l,"removePadding",function(){return g}),t.d(l,"default",function(){return E});var D=t("./src/utils/typed-array.ts");function g(F){var _=F.byteLength,b=_&&new DataView(F.buffer).getUint8(_-1);return b?Object(D.sliceUint8)(F,0,_-b):F}var E=function(){function F(){this.rcon=[0,1,2,4,8,16,32,64,128,27,54],this.subMix=[new Uint32Array(256),new Uint32Array(256),new Uint32Array(256),new Uint32Array(256)],this.invSubMix=[new Uint32Array(256),new Uint32Array(256),new Uint32Array(256),new Uint32Array(256)],this.sBox=new Uint32Array(256),this.invSBox=new Uint32Array(256),this.key=new Uint32Array(0),this.ksRows=0,this.keySize=0,this.keySchedule=void 0,this.invKeySchedule=void 0,this.initTable()}var _=F.prototype;return _.uint8ArrayToUint32Array_=function(R){for(var L=new DataView(R),I=new Uint32Array(4),A=0;A<4;A++)I[A]=L.getUint32(A*4);return I},_.initTable=function(){var R=this.sBox,L=this.invSBox,I=this.subMix,A=I[0],O=I[1],S=I[2],T=I[3],a=this.invSubMix,r=a[0],u=a[1],h=a[2],y=a[3],s=new Uint32Array(256),n=0,i=0,m=0;for(m=0;m<256;m++)m<128?s[m]=m<<1:s[m]=m<<1^283;for(m=0;m<256;m++){var o=i^i<<1^i<<2^i<<3^i<<4;o=o>>>8^o&255^99,R[n]=o,L[o]=n;var f=s[n],v=s[f],c=s[v],d=s[o]*257^o*16843008;A[n]=d<<24|d>>>8,O[n]=d<<16|d>>>16,S[n]=d<<8|d>>>24,T[n]=d,d=c*16843009^v*65537^f*257^n*16843008,r[o]=d<<24|d>>>8,u[o]=d<<16|d>>>16,h[o]=d<<8|d>>>24,y[o]=d,n?(n=f^s[s[s[c^f]]],i^=s[s[i]]):n=i=1}},_.expandKey=function(R){for(var L=this.uint8ArrayToUint32Array_(R),I=!0,A=0;A<L.length&&I;)I=L[A]===this.key[A],A++;if(!I){this.key=L;var O=this.keySize=L.length;if(O!==4&&O!==6&&O!==8)throw new Error("Invalid aes key size="+O);var S=this.ksRows=(O+6+1)*4,T,a,r=this.keySchedule=new Uint32Array(S),u=this.invKeySchedule=new Uint32Array(S),h=this.sBox,y=this.rcon,s=this.invSubMix,n=s[0],i=s[1],m=s[2],o=s[3],f,v;for(T=0;T<S;T++){if(T<O){f=r[T]=L[T];continue}v=f,T%O===0?(v=v<<8|v>>>24,v=h[v>>>24]<<24|h[v>>>16&255]<<16|h[v>>>8&255]<<8|h[v&255],v^=y[T/O|0]<<24):O>6&&T%O===4&&(v=h[v>>>24]<<24|h[v>>>16&255]<<16|h[v>>>8&255]<<8|h[v&255]),r[T]=f=(r[T-O]^v)>>>0}for(a=0;a<S;a++)T=S-a,a&3?v=r[T]:v=r[T-4],a<4||T<=4?u[a]=v:u[a]=n[h[v>>>24]]^i[h[v>>>16&255]]^m[h[v>>>8&255]]^o[h[v&255]],u[a]=u[a]>>>0}},_.networkToHostOrderSwap=function(R){return R<<24|(R&65280)<<8|(R&16711680)>>8|R>>>24},_.decrypt=function(R,L,I){for(var A=this.keySize+6,O=this.invKeySchedule,S=this.invSBox,T=this.invSubMix,a=T[0],r=T[1],u=T[2],h=T[3],y=this.uint8ArrayToUint32Array_(I),s=y[0],n=y[1],i=y[2],m=y[3],o=new Int32Array(R),f=new Int32Array(o.length),v,c,d,x,P,M,B,N,U,w,W,j,G,H,$=this.networkToHostOrderSwap;L<o.length;){for(U=$(o[L]),w=$(o[L+1]),W=$(o[L+2]),j=$(o[L+3]),P=U^O[0],M=j^O[1],B=W^O[2],N=w^O[3],G=4,H=1;H<A;H++)v=a[P>>>24]^r[M>>16&255]^u[B>>8&255]^h[N&255]^O[G],c=a[M>>>24]^r[B>>16&255]^u[N>>8&255]^h[P&255]^O[G+1],d=a[B>>>24]^r[N>>16&255]^u[P>>8&255]^h[M&255]^O[G+2],x=a[N>>>24]^r[P>>16&255]^u[M>>8&255]^h[B&255]^O[G+3],P=v,M=c,B=d,N=x,G=G+4;v=S[P>>>24]<<24^S[M>>16&255]<<16^S[B>>8&255]<<8^S[N&255]^O[G],c=S[M>>>24]<<24^S[B>>16&255]<<16^S[N>>8&255]<<8^S[P&255]^O[G+1],d=S[B>>>24]<<24^S[N>>16&255]<<16^S[P>>8&255]<<8^S[M&255]^O[G+2],x=S[N>>>24]<<24^S[P>>16&255]<<16^S[M>>8&255]<<8^S[B&255]^O[G+3],f[L]=$(v^s),f[L+1]=$(x^n),f[L+2]=$(d^i),f[L+3]=$(c^m),s=U,n=w,i=W,m=j,L=L+4}return f.buffer},F}()},"./src/crypt/decrypter.ts":function(C,l,t){t.r(l),t.d(l,"default",function(){return L});var D=t("./src/crypt/aes-crypto.ts"),g=t("./src/crypt/fast-aes-key.ts"),E=t("./src/crypt/aes-decryptor.ts"),F=t("./src/utils/logger.ts"),_=t("./src/utils/mp4-tools.ts"),b=t("./src/utils/typed-array.ts"),R=16,L=function(){function I(O,S,T){var a=T===void 0?{}:T,r=a.removePKCS7Padding,u=r===void 0?!0:r;if(this.logEnabled=!0,this.observer=void 0,this.config=void 0,this.removePKCS7Padding=void 0,this.subtle=null,this.softwareDecrypter=null,this.key=null,this.fastAesKey=null,this.remainderData=null,this.currentIV=null,this.currentResult=null,this.observer=O,this.config=S,this.removePKCS7Padding=u,u)try{var h=self.crypto;h&&(this.subtle=h.subtle||h.webkitSubtle)}catch{}this.subtle===null&&(this.config.enableSoftwareAES=!0)}var A=I.prototype;return A.destroy=function(){this.observer=null},A.isSync=function(){return this.config.enableSoftwareAES},A.flush=function(){var S=this.currentResult;if(!S){this.reset();return}var T=new Uint8Array(S);return this.reset(),this.removePKCS7Padding?Object(E.removePadding)(T):T},A.reset=function(){this.currentResult=null,this.currentIV=null,this.remainderData=null,this.softwareDecrypter&&(this.softwareDecrypter=null)},A.decrypt=function(S,T,a,r){if(this.config.enableSoftwareAES){this.softwareDecrypt(new Uint8Array(S),T,a);var u=this.flush();u&&r(u.buffer)}else this.webCryptoDecrypt(new Uint8Array(S),T,a).then(r)},A.softwareDecrypt=function(S,T,a){var r=this.currentIV,u=this.currentResult,h=this.remainderData;this.logOnce("JS AES decrypt"),h&&(S=Object(_.appendUint8Array)(h,S),this.remainderData=null);var y=this.getValidChunk(S);if(!y.length)return null;r&&(a=r);var s=this.softwareDecrypter;s||(s=this.softwareDecrypter=new E.default),s.expandKey(T);var n=u;return this.currentResult=s.decrypt(y.buffer,0,a),this.currentIV=Object(b.sliceUint8)(y,-16).buffer,n||null},A.webCryptoDecrypt=function(S,T,a){var r=this,u=this.subtle;return(this.key!==T||!this.fastAesKey)&&(this.key=T,this.fastAesKey=new g.default(u,T)),this.fastAesKey.expandKey().then(function(h){if(!u)return Promise.reject(new Error("web crypto not initialized"));var y=new D.default(u,a);return y.decrypt(S.buffer,h)}).catch(function(h){return r.onWebCryptoError(h,S,T,a)})},A.onWebCryptoError=function(S,T,a,r){return F.logger.warn("[decrypter.ts]: WebCrypto Error, disable WebCrypto API:",S),this.config.enableSoftwareAES=!0,this.logEnabled=!0,this.softwareDecrypt(T,a,r)},A.getValidChunk=function(S){var T=S,a=S.length-S.length%R;return a!==S.length&&(T=Object(b.sliceUint8)(S,0,a),this.remainderData=Object(b.sliceUint8)(S,a)),T},A.logOnce=function(S){!this.logEnabled||(F.logger.log("[decrypter.ts]: "+S),this.logEnabled=!1)},I}()},"./src/crypt/fast-aes-key.ts":function(C,l,t){t.r(l),t.d(l,"default",function(){return D});var D=function(){function g(F,_){this.subtle=void 0,this.key=void 0,this.subtle=F,this.key=_}var E=g.prototype;return E.expandKey=function(){return this.subtle.importKey("raw",this.key,{name:"AES-CBC"},!1,["encrypt","decrypt"])},g}()},"./src/demux/aacdemuxer.ts":function(C,l,t){t.r(l);var D=t("./src/demux/base-audio-demuxer.ts"),g=t("./src/demux/adts.ts"),E=t("./src/utils/logger.ts"),F=t("./src/demux/id3.ts");function _(L,I){L.prototype=Object.create(I.prototype),L.prototype.constructor=L,b(L,I)}function b(L,I){return b=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(O,S){return O.__proto__=S,O},b(L,I)}var R=function(L){_(I,L);function I(O,S){var T;return T=L.call(this)||this,T.observer=void 0,T.config=void 0,T.observer=O,T.config=S,T}var A=I.prototype;return A.resetInitSegment=function(S,T,a,r){L.prototype.resetInitSegment.call(this,S,T,a,r),this._audioTrack={container:"audio/adts",type:"audio",id:2,pid:-1,sequenceNumber:0,segmentCodec:"aac",samples:[],manifestCodec:T,duration:r,inputTimeScale:9e4,dropped:0}},I.probe=function(S){if(!S)return!1;for(var T=F.getID3Data(S,0)||[],a=T.length,r=S.length;a<r;a++)if(g.probe(S,a))return E.logger.log("ADTS sync word found !"),!0;return!1},A.canParse=function(S,T){return g.canParse(S,T)},A.appendFrame=function(S,T,a){g.initTrackConfig(S,this.observer,T,a,S.manifestCodec);var r=g.appendFrame(S,T,a,this.basePTS,this.frameIndex);if(r&&r.missing===0)return r},I}(D.default);l.default=R},"./src/demux/adts.ts":function(C,l,t){t.r(l),t.d(l,"getAudioConfig",function(){return F}),t.d(l,"isHeaderPattern",function(){return _}),t.d(l,"getHeaderLength",function(){return b}),t.d(l,"getFullFrameLength",function(){return R}),t.d(l,"canGetFrameLength",function(){return L}),t.d(l,"isHeader",function(){return I}),t.d(l,"canParse",function(){return A}),t.d(l,"probe",function(){return O}),t.d(l,"initTrackConfig",function(){return S}),t.d(l,"getFrameDuration",function(){return T}),t.d(l,"parseFrameHeader",function(){return a}),t.d(l,"appendFrame",function(){return r});var D=t("./src/utils/logger.ts"),g=t("./src/errors.ts"),E=t("./src/events.ts");function F(u,h,y,s){var n,i,m,o,f=navigator.userAgent.toLowerCase(),v=s,c=[96e3,88200,64e3,48e3,44100,32e3,24e3,22050,16e3,12e3,11025,8e3,7350];n=((h[y+2]&192)>>>6)+1;var d=(h[y+2]&60)>>>2;if(d>c.length-1){u.trigger(E.Events.ERROR,{type:g.ErrorTypes.MEDIA_ERROR,details:g.ErrorDetails.FRAG_PARSING_ERROR,fatal:!0,reason:"invalid ADTS sampling index:"+d});return}return m=(h[y+2]&1)<<2,m|=(h[y+3]&192)>>>6,D.logger.log("manifest codec:"+s+", ADTS type:"+n+", samplingIndex:"+d),/firefox/i.test(f)?d>=6?(n=5,o=new Array(4),i=d-3):(n=2,o=new Array(2),i=d):f.indexOf("android")!==-1?(n=2,o=new Array(2),i=d):(n=5,o=new Array(4),s&&(s.indexOf("mp4a.40.29")!==-1||s.indexOf("mp4a.40.5")!==-1)||!s&&d>=6?i=d-3:((s&&s.indexOf("mp4a.40.2")!==-1&&(d>=6&&m===1||/vivaldi/i.test(f))||!s&&m===1)&&(n=2,o=new Array(2)),i=d)),o[0]=n<<3,o[0]|=(d&14)>>1,o[1]|=(d&1)<<7,o[1]|=m<<3,n===5&&(o[1]|=(i&14)>>1,o[2]=(i&1)<<7,o[2]|=2<<2,o[3]=0),{config:o,samplerate:c[d],channelCount:m,codec:"mp4a.40."+n,manifestCodec:v}}function _(u,h){return u[h]===255&&(u[h+1]&246)===240}function b(u,h){return u[h+1]&1?7:9}function R(u,h){return(u[h+3]&3)<<11|u[h+4]<<3|(u[h+5]&224)>>>5}function L(u,h){return h+5<u.length}function I(u,h){return h+1<u.length&&_(u,h)}function A(u,h){return L(u,h)&&_(u,h)&&R(u,h)<=u.length-h}function O(u,h){if(I(u,h)){var y=b(u,h);if(h+y>=u.length)return!1;var s=R(u,h);if(s<=y)return!1;var n=h+s;return n===u.length||I(u,n)}return!1}function S(u,h,y,s,n){if(!u.samplerate){var i=F(h,y,s,n);if(!i)return;u.config=i.config,u.samplerate=i.samplerate,u.channelCount=i.channelCount,u.codec=i.codec,u.manifestCodec=i.manifestCodec,D.logger.log("parsed codec:"+u.codec+", rate:"+i.samplerate+", channels:"+i.channelCount)}}function T(u){return 1024*9e4/u}function a(u,h){var y=b(u,h);if(h+y<=u.length){var s=R(u,h)-y;if(s>0)return{headerLength:y,frameLength:s}}}function r(u,h,y,s,n){var i=T(u.samplerate),m=s+n*i,o=a(h,y),f;if(o){var v=o.frameLength,c=o.headerLength,d=c+v,x=Math.max(0,y+d-h.length);x?(f=new Uint8Array(d-c),f.set(h.subarray(y+c,h.length),0)):f=h.subarray(y+c,y+d);var P={unit:f,pts:m};return x||u.samples.push(P),{sample:P,length:d,missing:x}}var M=h.length-y;f=new Uint8Array(M),f.set(h.subarray(y,h.length),0);var B={unit:f,pts:m};return{sample:B,length:M,missing:-1}}},"./src/demux/base-audio-demuxer.ts":function(C,l,t){t.r(l),t.d(l,"initPTSFn",function(){return L});var D=t("./src/polyfills/number.ts"),g=t("./src/demux/id3.ts"),E=t("./src/types/demuxer.ts"),F=t("./src/demux/dummy-demuxed-track.ts"),_=t("./src/utils/mp4-tools.ts"),b=t("./src/utils/typed-array.ts"),R=function(){function I(){this._audioTrack=void 0,this._id3Track=void 0,this.frameIndex=0,this.cachedData=null,this.basePTS=null,this.initPTS=null}var A=I.prototype;return A.resetInitSegment=function(S,T,a,r){this._id3Track={type:"id3",id:3,pid:-1,inputTimeScale:9e4,sequenceNumber:0,samples:[],dropped:0}},A.resetTimeStamp=function(S){this.initPTS=S,this.resetContiguity()},A.resetContiguity=function(){this.basePTS=null,this.frameIndex=0},A.canParse=function(S,T){return!1},A.appendFrame=function(S,T,a){},A.demux=function(S,T){this.cachedData&&(S=Object(_.appendUint8Array)(this.cachedData,S),this.cachedData=null);var a=g.getID3Data(S,0),r=a?a.length:0,u,h,y=this._audioTrack,s=this._id3Track,n=a?g.getTimeStamp(a):void 0,i=S.length;for((this.basePTS===null||this.frameIndex===0&&Object(D.isFiniteNumber)(n))&&(this.basePTS=L(n,T,this.initPTS)),a&&a.length>0&&s.samples.push({pts:this.basePTS,dts:this.basePTS,data:a,type:E.MetadataSchema.audioId3}),h=this.basePTS;r<i;){if(this.canParse(S,r)){var m=this.appendFrame(y,S,r);m?(this.frameIndex++,h=m.sample.pts,r+=m.length,u=r):r=i}else g.canParse(S,r)?(a=g.getID3Data(S,r),s.samples.push({pts:h,dts:h,data:a,type:E.MetadataSchema.audioId3}),r+=a.length,u=r):r++;if(r===i&&u!==i){var o=Object(b.sliceUint8)(S,u);this.cachedData?this.cachedData=Object(_.appendUint8Array)(this.cachedData,o):this.cachedData=o}}return{audioTrack:y,videoTrack:Object(F.dummyTrack)(),id3Track:s,textTrack:Object(F.dummyTrack)()}},A.demuxSampleAes=function(S,T,a){return Promise.reject(new Error("["+this+"] This demuxer does not support Sample-AES decryption"))},A.flush=function(S){var T=this.cachedData;return T&&(this.cachedData=null,this.demux(T,0)),{audioTrack:this._audioTrack,videoTrack:Object(F.dummyTrack)(),id3Track:this._id3Track,textTrack:Object(F.dummyTrack)()}},A.destroy=function(){},I}(),L=function(A,O,S){return Object(D.isFiniteNumber)(A)?A*90:O*9e4+(S||0)};l.default=R},"./src/demux/chunk-cache.ts":function(C,l,t){t.r(l),t.d(l,"default",function(){return D});var D=function(){function E(){this.chunks=[],this.dataLength=0}var F=E.prototype;return F.push=function(b){this.chunks.push(b),this.dataLength+=b.length},F.flush=function(){var b=this.chunks,R=this.dataLength,L;if(b.length)b.length===1?L=b[0]:L=g(b,R);else return new Uint8Array(0);return this.reset(),L},F.reset=function(){this.chunks.length=0,this.dataLength=0},E}();function g(E,F){for(var _=new Uint8Array(F),b=0,R=0;R<E.length;R++){var L=E[R];_.set(L,b),b+=L.length}return _}},"./src/demux/dummy-demuxed-track.ts":function(C,l,t){t.r(l),t.d(l,"dummyTrack",function(){return D});function D(g,E){return g===void 0&&(g=""),E===void 0&&(E=9e4),{type:g,id:-1,pid:-1,inputTimeScale:E,sequenceNumber:-1,samples:[],dropped:0}}},"./src/demux/exp-golomb.ts":function(C,l,t){t.r(l);var D=t("./src/utils/logger.ts"),g=function(){function E(_){this.data=void 0,this.bytesAvailable=void 0,this.word=void 0,this.bitsAvailable=void 0,this.data=_,this.bytesAvailable=_.byteLength,this.word=0,this.bitsAvailable=0}var F=E.prototype;return F.loadWord=function(){var b=this.data,R=this.bytesAvailable,L=b.byteLength-R,I=new Uint8Array(4),A=Math.min(4,R);if(A===0)throw new Error("no bytes available");I.set(b.subarray(L,L+A)),this.word=new DataView(I.buffer).getUint32(0),this.bitsAvailable=A*8,this.bytesAvailable-=A},F.skipBits=function(b){var R;this.bitsAvailable>b?(this.word<<=b,this.bitsAvailable-=b):(b-=this.bitsAvailable,R=b>>3,b-=R>>3,this.bytesAvailable-=R,this.loadWord(),this.word<<=b,this.bitsAvailable-=b)},F.readBits=function(b){var R=Math.min(this.bitsAvailable,b),L=this.word>>>32-R;return b>32&&D.logger.error("Cannot read more than 32 bits at a time"),this.bitsAvailable-=R,this.bitsAvailable>0?this.word<<=R:this.bytesAvailable>0&&this.loadWord(),R=b-R,R>0&&this.bitsAvailable?L<<R|this.readBits(R):L},F.skipLZ=function(){var b;for(b=0;b<this.bitsAvailable;++b)if((this.word&2147483648>>>b)!==0)return this.word<<=b,this.bitsAvailable-=b,b;return this.loadWord(),b+this.skipLZ()},F.skipUEG=function(){this.skipBits(1+this.skipLZ())},F.skipEG=function(){this.skipBits(1+this.skipLZ())},F.readUEG=function(){var b=this.skipLZ();return this.readBits(b+1)-1},F.readEG=function(){var b=this.readUEG();return 1&b?1+b>>>1:-1*(b>>>1)},F.readBoolean=function(){return this.readBits(1)===1},F.readUByte=function(){return this.readBits(8)},F.readUShort=function(){return this.readBits(16)},F.readUInt=function(){return this.readBits(32)},F.skipScalingList=function(b){for(var R=8,L=8,I,A=0;A<b;A++)L!==0&&(I=this.readEG(),L=(R+I+256)%256),R=L===0?R:L},F.readSPS=function(){var b=0,R=0,L=0,I=0,A,O,S,T=this.readUByte.bind(this),a=this.readBits.bind(this),r=this.readUEG.bind(this),u=this.readBoolean.bind(this),h=this.skipBits.bind(this),y=this.skipEG.bind(this),s=this.skipUEG.bind(this),n=this.skipScalingList.bind(this);T();var i=T();if(a(5),h(3),T(),s(),i===100||i===110||i===122||i===244||i===44||i===83||i===86||i===118||i===128){var m=r();if(m===3&&h(1),s(),s(),h(1),u())for(O=m!==3?8:12,S=0;S<O;S++)u()&&(S<6?n(16):n(64))}s();var o=r();if(o===0)r();else if(o===1)for(h(1),y(),y(),A=r(),S=0;S<A;S++)y();s(),h(1);var f=r(),v=r(),c=a(1);c===0&&h(1),h(1),u()&&(b=r(),R=r(),L=r(),I=r());var d=[1,1];if(u()&&u()){var x=T();switch(x){case 1:d=[1,1];break;case 2:d=[12,11];break;case 3:d=[10,11];break;case 4:d=[16,11];break;case 5:d=[40,33];break;case 6:d=[24,11];break;case 7:d=[20,11];break;case 8:d=[32,11];break;case 9:d=[80,33];break;case 10:d=[18,11];break;case 11:d=[15,11];break;case 12:d=[64,33];break;case 13:d=[160,99];break;case 14:d=[4,3];break;case 15:d=[3,2];break;case 16:d=[2,1];break;case 255:{d=[T()<<8|T(),T()<<8|T()];break}}}return{width:Math.ceil((f+1)*16-b*2-R*2),height:(2-c)*(v+1)*16-(c?2:4)*(L+I),pixelRatio:d}},F.readSliceType=function(){return this.readUByte(),this.readUEG(),this.readUEG()},E}();l.default=g},"./src/demux/id3.ts":function(C,l,t){t.r(l),t.d(l,"isHeader",function(){return D}),t.d(l,"isFooter",function(){return g}),t.d(l,"getID3Data",function(){return E}),t.d(l,"canParse",function(){return _}),t.d(l,"getTimeStamp",function(){return b}),t.d(l,"isTimeStampFrame",function(){return R}),t.d(l,"getID3Frames",function(){return I}),t.d(l,"decodeFrame",function(){return A}),t.d(l,"utf8ArrayToStr",function(){return r}),t.d(l,"testables",function(){return u});var D=function(n,i){return i+10<=n.length&&n[i]===73&&n[i+1]===68&&n[i+2]===51&&n[i+3]<255&&n[i+4]<255&&n[i+6]<128&&n[i+7]<128&&n[i+8]<128&&n[i+9]<128},g=function(n,i){return i+10<=n.length&&n[i]===51&&n[i+1]===68&&n[i+2]===73&&n[i+3]<255&&n[i+4]<255&&n[i+6]<128&&n[i+7]<128&&n[i+8]<128&&n[i+9]<128},E=function(n,i){for(var m=i,o=0;D(n,i);){o+=10;var f=F(n,i+6);o+=f,g(n,i+10)&&(o+=10),i+=o}if(o>0)return n.subarray(m,m+o)},F=function(n,i){var m=0;return m=(n[i]&127)<<21,m|=(n[i+1]&127)<<14,m|=(n[i+2]&127)<<7,m|=n[i+3]&127,m},_=function(n,i){return D(n,i)&&F(n,i+6)+10<=n.length-i},b=function(n){for(var i=I(n),m=0;m<i.length;m++){var o=i[m];if(R(o))return a(o)}},R=function(n){return n&&n.key==="PRIV"&&n.info==="com.apple.streaming.transportStreamTimestamp"},L=function(n){var i=String.fromCharCode(n[0],n[1],n[2],n[3]),m=F(n,4),o=10;return{type:i,size:m,data:n.subarray(o,o+m)}},I=function(n){for(var i=0,m=[];D(n,i);){var o=F(n,i+6);i+=10;for(var f=i+o;i+8<f;){var v=L(n.subarray(i)),c=A(v);c&&m.push(c),i+=v.size+10}g(n,i)&&(i+=10)}return m},A=function(n){return n.type==="PRIV"?O(n):n.type[0]==="W"?T(n):S(n)},O=function(n){if(!(n.size<2)){var i=r(n.data,!0),m=new Uint8Array(n.data.subarray(i.length+1));return{key:n.type,info:i,data:m.buffer}}},S=function(n){if(!(n.size<2)){if(n.type==="TXXX"){var i=1,m=r(n.data.subarray(i),!0);i+=m.length+1;var o=r(n.data.subarray(i));return{key:n.type,info:m,data:o}}var f=r(n.data.subarray(1));return{key:n.type,data:f}}},T=function(n){if(n.type==="WXXX"){if(n.size<2)return;var i=1,m=r(n.data.subarray(i),!0);i+=m.length+1;var o=r(n.data.subarray(i));return{key:n.type,info:m,data:o}}var f=r(n.data);return{key:n.type,data:f}},a=function(n){if(n.data.byteLength===8){var i=new Uint8Array(n.data),m=i[3]&1,o=(i[4]<<23)+(i[5]<<15)+(i[6]<<7)+i[7];return o/=45,m&&(o+=4772185884e-2),Math.round(o)}},r=function(n,i){i===void 0&&(i=!1);var m=y();if(m){var o=m.decode(n);if(i){var f=o.indexOf("\0");return f!==-1?o.substring(0,f):o}return o.replace(/\0/g,"")}for(var v=n.length,c,d,x,P="",M=0;M<v;){if(c=n[M++],c===0&&i)return P;if(c===0||c===3)continue;switch(c>>4){case 0:case 1:case 2:case 3:case 4:case 5:case 6:case 7:P+=String.fromCharCode(c);break;case 12:case 13:d=n[M++],P+=String.fromCharCode((c&31)<<6|d&63);break;case 14:d=n[M++],x=n[M++],P+=String.fromCharCode((c&15)<<12|(d&63)<<6|(x&63)<<0);break}}return P},u={decodeTextFrame:S},h;function y(){return!h&&typeof self.TextDecoder<"u"&&(h=new self.TextDecoder("utf-8")),h}},"./src/demux/mp3demuxer.ts":function(C,l,t){t.r(l);var D=t("./src/demux/base-audio-demuxer.ts"),g=t("./src/demux/id3.ts"),E=t("./src/utils/logger.ts"),F=t("./src/demux/mpegaudio.ts");function _(L,I){L.prototype=Object.create(I.prototype),L.prototype.constructor=L,b(L,I)}function b(L,I){return b=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(O,S){return O.__proto__=S,O},b(L,I)}var R=function(L){_(I,L);function I(){return L.apply(this,arguments)||this}var A=I.prototype;return A.resetInitSegment=function(S,T,a,r){L.prototype.resetInitSegment.call(this,S,T,a,r),this._audioTrack={container:"audio/mpeg",type:"audio",id:2,pid:-1,sequenceNumber:0,segmentCodec:"mp3",samples:[],manifestCodec:T,duration:r,inputTimeScale:9e4,dropped:0}},I.probe=function(S){if(!S)return!1;for(var T=g.getID3Data(S,0)||[],a=T.length,r=S.length;a<r;a++)if(F.probe(S,a))return E.logger.log("MPEG Audio sync word found !"),!0;return!1},A.canParse=function(S,T){return F.canParse(S,T)},A.appendFrame=function(S,T,a){if(this.basePTS!==null)return F.appendFrame(S,T,a,this.basePTS,this.frameIndex)},I}(D.default);l.default=R},"./src/demux/mp4demuxer.ts":function(C,l,t){t.r(l);var D=t("./src/polyfills/number.ts"),g=t("./src/types/demuxer.ts"),E=t("./src/utils/mp4-tools.ts"),F=t("./src/demux/dummy-demuxed-track.ts"),_=/\/emsg[-/]ID3/i,b=function(){function R(I,A){this.remainderData=null,this.timeOffset=0,this.config=void 0,this.videoTrack=void 0,this.audioTrack=void 0,this.id3Track=void 0,this.txtTrack=void 0,this.config=A}var L=R.prototype;return L.resetTimeStamp=function(){},L.resetInitSegment=function(A,O,S,T){var a=Object(E.parseInitSegment)(A),r=this.videoTrack=Object(F.dummyTrack)("video",1),u=this.audioTrack=Object(F.dummyTrack)("audio",1),h=this.txtTrack=Object(F.dummyTrack)("text",1);if(this.id3Track=Object(F.dummyTrack)("id3",1),this.timeOffset=0,a.video){var y=a.video,s=y.id,n=y.timescale,i=y.codec;r.id=s,r.timescale=h.timescale=n,r.codec=i}if(a.audio){var m=a.audio,o=m.id,f=m.timescale,v=m.codec;u.id=o,u.timescale=f,u.codec=v}h.id=E.RemuxerTrackIdConfig.text,r.sampleDuration=0,r.duration=u.duration=T},L.resetContiguity=function(){},R.probe=function(A){return A=A.length>16384?A.subarray(0,16384):A,Object(E.findBox)(A,["moof"]).length>0},L.demux=function(A,O){this.timeOffset=O;var S=A,T=this.videoTrack,a=this.txtTrack;if(this.config.progressive){this.remainderData&&(S=Object(E.appendUint8Array)(this.remainderData,A));var r=Object(E.segmentValidRange)(S);this.remainderData=r.remainder,T.samples=r.valid||new Uint8Array}else T.samples=S;var u=this.extractID3Track(T,O);return a.samples=Object(E.parseSamples)(O,T),{videoTrack:T,audioTrack:this.audioTrack,id3Track:u,textTrack:this.txtTrack}},L.flush=function(){var A=this.timeOffset,O=this.videoTrack,S=this.txtTrack;O.samples=this.remainderData||new Uint8Array,this.remainderData=null;var T=this.extractID3Track(O,this.timeOffset);return S.samples=Object(E.parseSamples)(A,O),{videoTrack:O,audioTrack:Object(F.dummyTrack)(),id3Track:T,textTrack:Object(F.dummyTrack)()}},L.extractID3Track=function(A,O){var S=this.id3Track;if(A.samples.length){var T=Object(E.findBox)(A.samples,["emsg"]);T&&T.forEach(function(a){var r=Object(E.parseEmsg)(a);if(_.test(r.schemeIdUri)){var u=Object(D.isFiniteNumber)(r.presentationTime)?r.presentationTime/r.timeScale:O+r.presentationTimeDelta/r.timeScale,h=r.payload;S.samples.push({data:h,len:h.byteLength,dts:u,pts:u,type:g.MetadataSchema.emsg})}})}return S},L.demuxSampleAes=function(A,O,S){return Promise.reject(new Error("The MP4 demuxer does not support SAMPLE-AES decryption"))},L.destroy=function(){},R}();l.default=b},"./src/demux/mpegaudio.ts":function(C,l,t){t.r(l),t.d(l,"appendFrame",function(){return b}),t.d(l,"parseHeader",function(){return R}),t.d(l,"isHeaderPattern",function(){return L}),t.d(l,"isHeader",function(){return I}),t.d(l,"canParse",function(){return A}),t.d(l,"probe",function(){return O});var D=null,g=[32,64,96,128,160,192,224,256,288,320,352,384,416,448,32,48,56,64,80,96,112,128,160,192,224,256,320,384,32,40,48,56,64,80,96,112,128,160,192,224,256,320,32,48,56,64,80,96,112,128,144,160,176,192,224,256,8,16,24,32,40,48,56,64,80,96,112,128,144,160],E=[44100,48e3,32e3,22050,24e3,16e3,11025,12e3,8e3],F=[[0,72,144,12],[0,0,0,0],[0,72,144,12],[0,144,144,12]],_=[0,1,1,4];function b(S,T,a,r,u){if(!(a+24>T.length)){var h=R(T,a);if(h&&a+h.frameLength<=T.length){var y=h.samplesPerFrame*9e4/h.sampleRate,s=r+u*y,n={unit:T.subarray(a,a+h.frameLength),pts:s,dts:s};return S.config=[],S.channelCount=h.channelCount,S.samplerate=h.sampleRate,S.samples.push(n),{sample:n,length:h.frameLength,missing:0}}}}function R(S,T){var a=S[T+1]>>3&3,r=S[T+1]>>1&3,u=S[T+2]>>4&15,h=S[T+2]>>2&3;if(a!==1&&u!==0&&u!==15&&h!==3){var y=S[T+2]>>1&1,s=S[T+3]>>6,n=a===3?3-r:r===3?3:4,i=g[n*14+u-1]*1e3,m=a===3?0:a===2?1:2,o=E[m*3+h],f=s===3?1:2,v=F[a][r],c=_[r],d=v*8*c,x=Math.floor(v*i/o+y)*c;if(D===null){var P=navigator.userAgent||"",M=P.match(/Chrome\/(\d+)/i);D=M?parseInt(M[1]):0}var B=!!D&&D<=87;return B&&r===2&&i>=224e3&&s===0&&(S[T+3]=S[T+3]|128),{sampleRate:o,channelCount:f,frameLength:x,samplesPerFrame:d}}}function L(S,T){return S[T]===255&&(S[T+1]&224)===224&&(S[T+1]&6)!==0}function I(S,T){return T+1<S.length&&L(S,T)}function A(S,T){var a=4;return L(S,T)&&a<=S.length-T}function O(S,T){if(T+1<S.length&&L(S,T)){var a=4,r=R(S,T),u=a;r!=null&&r.frameLength&&(u=r.frameLength);var h=T+u;return h===S.length||I(S,h)}return!1}},"./src/demux/sample-aes.ts":function(C,l,t){t.r(l);var D=t("./src/crypt/decrypter.ts"),g=t("./src/demux/tsdemuxer.ts"),E=function(){function F(b,R,L){this.keyData=void 0,this.decrypter=void 0,this.keyData=L,this.decrypter=new D.default(b,R,{removePKCS7Padding:!1})}var _=F.prototype;return _.decryptBuffer=function(R,L){this.decrypter.decrypt(R,this.keyData.key.buffer,this.keyData.iv.buffer,L)},_.decryptAacSample=function(R,L,I,A){var O=R[L].unit;if(!(O.length<=16)){var S=O.subarray(16,O.length-O.length%16),T=S.buffer.slice(S.byteOffset,S.byteOffset+S.length),a=this;this.decryptBuffer(T,function(r){var u=new Uint8Array(r);O.set(u,16),A||a.decryptAacSamples(R,L+1,I)})}},_.decryptAacSamples=function(R,L,I){for(;;L++){if(L>=R.length){I();return}if(!(R[L].unit.length<32)){var A=this.decrypter.isSync();if(this.decryptAacSample(R,L,I,A),!A)return}}},_.getAvcEncryptedData=function(R){for(var L=Math.floor((R.length-48)/160)*16+16,I=new Int8Array(L),A=0,O=32;O<R.length-16;O+=160,A+=16)I.set(R.subarray(O,O+16),A);return I},_.getAvcDecryptedUnit=function(R,L){for(var I=new Uint8Array(L),A=0,O=32;O<R.length-16;O+=160,A+=16)R.set(I.subarray(A,A+16),O);return R},_.decryptAvcSample=function(R,L,I,A,O,S){var T=Object(g.discardEPB)(O.data),a=this.getAvcEncryptedData(T),r=this;this.decryptBuffer(a.buffer,function(u){O.data=r.getAvcDecryptedUnit(T,u),S||r.decryptAvcSamples(R,L,I+1,A)})},_.decryptAvcSamples=function(R,L,I,A){if(R instanceof Uint8Array)throw new Error("Cannot decrypt samples of type Uint8Array");for(;;L++,I=0){if(L>=R.length){A();return}for(var O=R[L].units;!(I>=O.length);I++){var S=O[I];if(!(S.data.length<=48||S.type!==1&&S.type!==5)){var T=this.decrypter.isSync();if(this.decryptAvcSample(R,L,I,A,S,T),!T)return}}}},F}();l.default=E},"./src/demux/transmuxer-interface.ts":function(C,l,t){t.r(l),t.d(l,"default",function(){return I});var D=t("./node_modules/webworkify-webpack/index.js"),g=t("./src/events.ts"),E=t("./src/demux/transmuxer.ts"),F=t("./src/utils/logger.ts"),_=t("./src/errors.ts"),b=t("./src/utils/mediasource-helper.ts"),R=t("./node_modules/eventemitter3/index.js"),L=Object(b.getMediaSource)()||{isTypeSupported:function(){return!1}},I=function(){function A(S,T,a,r){var u=this;this.hls=void 0,this.id=void 0,this.observer=void 0,this.frag=null,this.part=null,this.worker=void 0,this.onwmsg=void 0,this.transmuxer=null,this.onTransmuxComplete=void 0,this.onFlush=void 0,this.hls=S,this.id=T,this.onTransmuxComplete=a,this.onFlush=r;var h=S.config,y=function(o,f){f=f||{},f.frag=u.frag,f.id=u.id,S.trigger(o,f)};this.observer=new R.EventEmitter,this.observer.on(g.Events.FRAG_DECRYPTED,y),this.observer.on(g.Events.ERROR,y);var s={mp4:L.isTypeSupported("video/mp4"),mpeg:L.isTypeSupported("audio/mpeg"),mp3:L.isTypeSupported('audio/mp4; codecs="mp3"')},n=navigator.vendor;if(h.enableWorker&&typeof Worker<"u"){F.logger.log("demuxing in webworker");var i;try{i=this.worker=D("./src/demux/transmuxer-worker.ts"),this.onwmsg=this.onWorkerMessage.bind(this),i.addEventListener("message",this.onwmsg),i.onerror=function(m){S.trigger(g.Events.ERROR,{type:_.ErrorTypes.OTHER_ERROR,details:_.ErrorDetails.INTERNAL_EXCEPTION,fatal:!0,event:"demuxerWorker",error:new Error(m.message+"  ("+m.filename+":"+m.lineno+")")})},i.postMessage({cmd:"init",typeSupported:s,vendor:n,id:T,config:JSON.stringify(h)})}catch(m){F.logger.warn("Error in worker:",m),F.logger.error("Error while initializing DemuxerWorker, fallback to inline"),i&&self.URL.revokeObjectURL(i.objectURL),this.transmuxer=new E.default(this.observer,s,h,n,T),this.worker=null}}else this.transmuxer=new E.default(this.observer,s,h,n,T)}var O=A.prototype;return O.destroy=function(){var T=this.worker;if(T)T.removeEventListener("message",this.onwmsg),T.terminate(),this.worker=null,this.onwmsg=void 0;else{var a=this.transmuxer;a&&(a.destroy(),this.transmuxer=null)}var r=this.observer;r&&r.removeAllListeners(),this.frag=null,this.observer=null,this.hls=null},O.push=function(T,a,r,u,h,y,s,n,i,m){var o,f,v=this;i.transmuxing.start=self.performance.now();var c=this.transmuxer,d=this.worker,x=y?y.start:h.start,P=h.decryptdata,M=this.frag,B=!(M&&h.cc===M.cc),N=!(M&&i.level===M.level),U=M?i.sn-M.sn:-1,w=this.part?i.part-this.part.index:-1,W=U===0&&i.id>1&&i.id===(M==null?void 0:M.stats.chunkCount),j=!N&&(U===1||U===0&&(w===1||W&&w<=0)),G=self.performance.now();(N||U||h.stats.parsing.start===0)&&(h.stats.parsing.start=G),y&&(w||!j)&&(y.stats.parsing.start=G);var H=!(M&&((o=h.initSegment)===null||o===void 0?void 0:o.url)===((f=M.initSegment)===null||f===void 0?void 0:f.url)),$=new E.TransmuxState(B,j,n,N,x,H);if(!j||B||H){F.logger.log("[transmuxer-interface, "+h.type+"]: Starting new transmux session for sn: "+i.sn+" p: "+i.part+" level: "+i.level+" id: "+i.id+`
        discontinuity: `+B+`
        trackSwitch: `+N+`
        contiguous: `+j+`
        accurateTimeOffset: `+n+`
        timeOffset: `+x+`
        initSegmentChange: `+H);var te=new E.TransmuxConfig(r,u,a,s,m);this.configureTransmuxer(te)}if(this.frag=h,this.part=y,d)d.postMessage({cmd:"demux",data:T,decryptdata:P,chunkMeta:i,state:$},T instanceof ArrayBuffer?[T]:[]);else if(c){var q=c.push(T,P,i,$);Object(E.isPromise)(q)?q.then(function(ne){v.handleTransmuxComplete(ne)}):this.handleTransmuxComplete(q)}},O.flush=function(T){var a=this;T.transmuxing.start=self.performance.now();var r=this.transmuxer,u=this.worker;if(u)u.postMessage({cmd:"flush",chunkMeta:T});else if(r){var h=r.flush(T);Object(E.isPromise)(h)?h.then(function(y){a.handleFlushResult(y,T)}):this.handleFlushResult(h,T)}},O.handleFlushResult=function(T,a){var r=this;T.forEach(function(u){r.handleTransmuxComplete(u)}),this.onFlush(a)},O.onWorkerMessage=function(T){var a=T.data,r=this.hls;switch(a.event){case"init":{self.URL.revokeObjectURL(this.worker.objectURL);break}case"transmuxComplete":{this.handleTransmuxComplete(a.data);break}case"flush":{this.onFlush(a.data);break}case"workerLog":F.logger[a.data.logType]&&F.logger[a.data.logType](a.data.message);break;default:{a.data=a.data||{},a.data.frag=this.frag,a.data.id=this.id,r.trigger(a.event,a.data);break}}},O.configureTransmuxer=function(T){var a=this.worker,r=this.transmuxer;a?a.postMessage({cmd:"configure",config:T}):r&&r.configure(T)},O.handleTransmuxComplete=function(T){T.chunkMeta.transmuxing.end=self.performance.now(),this.onTransmuxComplete(T)},A}()},"./src/demux/transmuxer-worker.ts":function(C,l,t){t.r(l),t.d(l,"default",function(){return _});var D=t("./src/demux/transmuxer.ts"),g=t("./src/events.ts"),E=t("./src/utils/logger.ts"),F=t("./node_modules/eventemitter3/index.js");function _(A){var O=new F.EventEmitter,S=function(r,u){A.postMessage({event:r,data:u})};O.on(g.Events.FRAG_DECRYPTED,S),O.on(g.Events.ERROR,S);var T=function(){var r=function(y){var s=function(i){S("workerLog",{logType:y,message:i})};E.logger[y]=s};for(var u in E.logger)r(u)};A.addEventListener("message",function(a){var r=a.data;switch(r.cmd){case"init":{var u=JSON.parse(r.config);A.transmuxer=new D.default(O,r.typeSupported,u,r.vendor,r.id),Object(E.enableLogs)(u.debug),T(),S("init",null);break}case"configure":{A.transmuxer.configure(r.config);break}case"demux":{var h=A.transmuxer.push(r.data,r.decryptdata,r.chunkMeta,r.state);Object(D.isPromise)(h)?h.then(function(n){b(A,n)}):b(A,h);break}case"flush":{var y=r.chunkMeta,s=A.transmuxer.flush(y);Object(D.isPromise)(s)?s.then(function(n){L(A,n,y)}):L(A,s,y);break}}})}function b(A,O){if(I(O.remuxResult))return!1;var S=[],T=O.remuxResult,a=T.audio,r=T.video;return a&&R(S,a),r&&R(S,r),A.postMessage({event:"transmuxComplete",data:O},S),!0}function R(A,O){O.data1&&A.push(O.data1.buffer),O.data2&&A.push(O.data2.buffer)}function L(A,O,S){var T=O.reduce(function(a,r){return b(A,r)||a},!1);T||A.postMessage({event:"transmuxComplete",data:O[0]}),A.postMessage({event:"flush",data:S})}function I(A){return!A.audio&&!A.video&&!A.text&&!A.id3&&!A.initSegment}},"./src/demux/transmuxer.ts":function(C,l,t){t.r(l),t.d(l,"default",function(){return T}),t.d(l,"isPromise",function(){return u}),t.d(l,"TransmuxConfig",function(){return h}),t.d(l,"TransmuxState",function(){return y});var D=t("./src/events.ts"),g=t("./src/errors.ts"),E=t("./src/crypt/decrypter.ts"),F=t("./src/demux/aacdemuxer.ts"),_=t("./src/demux/mp4demuxer.ts"),b=t("./src/demux/tsdemuxer.ts"),R=t("./src/demux/mp3demuxer.ts"),L=t("./src/remux/mp4-remuxer.ts"),I=t("./src/remux/passthrough-remuxer.ts"),A=t("./src/utils/logger.ts"),O;try{O=self.performance.now.bind(self.performance)}catch{A.logger.debug("Unable to use Performance API on this environment"),O=self.Date.now}var S=[{demux:b.default,remux:L.default},{demux:_.default,remux:I.default},{demux:F.default,remux:L.default},{demux:R.default,remux:L.default}],T=function(){function s(i,m,o,f,v){this.observer=void 0,this.typeSupported=void 0,this.config=void 0,this.vendor=void 0,this.id=void 0,this.demuxer=void 0,this.remuxer=void 0,this.decrypter=void 0,this.probe=void 0,this.decryptionPromise=null,this.transmuxConfig=void 0,this.currentTransmuxState=void 0,this.observer=i,this.typeSupported=m,this.config=o,this.vendor=f,this.id=v}var n=s.prototype;return n.configure=function(m){this.transmuxConfig=m,this.decrypter&&this.decrypter.reset()},n.push=function(m,o,f,v){var c=this,d=f.transmuxing;d.executeStart=O();var x=new Uint8Array(m),P=this.config,M=this.currentTransmuxState,B=this.transmuxConfig;v&&(this.currentTransmuxState=v);var N=v||M,U=N.contiguous,w=N.discontinuity,W=N.trackSwitch,j=N.accurateTimeOffset,G=N.timeOffset,H=N.initSegmentChange,$=B.audioCodec,te=B.videoCodec,q=B.defaultInitPts,ne=B.duration,oe=B.initSegmentData;(w||W||H)&&this.resetInitSegment(oe,$,te,ne),(w||H)&&this.resetInitialTimestamp(q),U||this.resetContiguity();var k=a(x,o);if(k&&k.method==="AES-128"){var K=this.getDecrypter();if(P.enableSoftwareAES){var V=K.softwareDecrypt(x,k.key.buffer,k.iv.buffer);if(!V)return d.executeEnd=O(),r(f);x=new Uint8Array(V)}else return this.decryptionPromise=K.webCryptoDecrypt(x,k.key.buffer,k.iv.buffer).then(function(Q){var Z=c.push(Q,null,f);return c.decryptionPromise=null,Z}),this.decryptionPromise}this.needsProbing(x,w,W)&&this.configureTransmuxer(x,B);var Y=this.transmux(x,k,G,j,f),z=this.currentTransmuxState;return z.contiguous=!0,z.discontinuity=!1,z.trackSwitch=!1,d.executeEnd=O(),Y},n.flush=function(m){var o=this,f=m.transmuxing;f.executeStart=O();var v=this.decrypter,c=this.currentTransmuxState,d=this.decryptionPromise;if(d)return d.then(function(){return o.flush(m)});var x=[],P=c.timeOffset;if(v){var M=v.flush();M&&x.push(this.push(M,null,m))}var B=this.demuxer,N=this.remuxer;if(!B||!N)return this.observer.emit(D.Events.ERROR,D.Events.ERROR,{type:g.ErrorTypes.MEDIA_ERROR,details:g.ErrorDetails.FRAG_PARSING_ERROR,fatal:!0,reason:"no demux matching with content found"}),f.executeEnd=O(),[r(m)];var U=B.flush(P);return u(U)?U.then(function(w){return o.flushRemux(x,w,m),x}):(this.flushRemux(x,U,m),x)},n.flushRemux=function(m,o,f){var v=o.audioTrack,c=o.videoTrack,d=o.id3Track,x=o.textTrack,P=this.currentTransmuxState,M=P.accurateTimeOffset,B=P.timeOffset;A.logger.log("[transmuxer.ts]: Flushed fragment "+f.sn+(f.part>-1?" p: "+f.part:"")+" of level "+f.level);var N=this.remuxer.remux(v,c,d,x,B,M,!0,this.id);m.push({remuxResult:N,chunkMeta:f}),f.transmuxing.executeEnd=O()},n.resetInitialTimestamp=function(m){var o=this.demuxer,f=this.remuxer;!o||!f||(o.resetTimeStamp(m),f.resetTimeStamp(m))},n.resetContiguity=function(){var m=this.demuxer,o=this.remuxer;!m||!o||(m.resetContiguity(),o.resetNextTimestamp())},n.resetInitSegment=function(m,o,f,v){var c=this.demuxer,d=this.remuxer;!c||!d||(c.resetInitSegment(m,o,f,v),d.resetInitSegment(m,o,f))},n.destroy=function(){this.demuxer&&(this.demuxer.destroy(),this.demuxer=void 0),this.remuxer&&(this.remuxer.destroy(),this.remuxer=void 0)},n.transmux=function(m,o,f,v,c){var d;return o&&o.method==="SAMPLE-AES"?d=this.transmuxSampleAes(m,o,f,v,c):d=this.transmuxUnencrypted(m,f,v,c),d},n.transmuxUnencrypted=function(m,o,f,v){var c=this.demuxer.demux(m,o,!1,!this.config.progressive),d=c.audioTrack,x=c.videoTrack,P=c.id3Track,M=c.textTrack,B=this.remuxer.remux(d,x,P,M,o,f,!1,this.id);return{remuxResult:B,chunkMeta:v}},n.transmuxSampleAes=function(m,o,f,v,c){var d=this;return this.demuxer.demuxSampleAes(m,o,f).then(function(x){var P=d.remuxer.remux(x.audioTrack,x.videoTrack,x.id3Track,x.textTrack,f,v,!1,d.id);return{remuxResult:P,chunkMeta:c}})},n.configureTransmuxer=function(m,o){for(var f=this.config,v=this.observer,c=this.typeSupported,d=this.vendor,x=o.audioCodec,P=o.defaultInitPts,M=o.duration,B=o.initSegmentData,N=o.videoCodec,U,w=0,W=S.length;w<W;w++)if(S[w].demux.probe(m)){U=S[w];break}U||(A.logger.warn("Failed to find demuxer by probing frag, treating as mp4 passthrough"),U={demux:_.default,remux:I.default});var j=this.demuxer,G=this.remuxer,H=U.remux,$=U.demux;(!G||!(G instanceof H))&&(this.remuxer=new H(v,f,c,d)),(!j||!(j instanceof $))&&(this.demuxer=new $(v,f,c),this.probe=$.probe),this.resetInitSegment(B,x,N,M),this.resetInitialTimestamp(P)},n.needsProbing=function(m,o,f){return!this.demuxer||!this.remuxer||o||f},n.getDecrypter=function(){var m=this.decrypter;return m||(m=this.decrypter=new E.default(this.observer,this.config)),m},s}();function a(s,n){var i=null;return s.byteLength>0&&n!=null&&n.key!=null&&n.iv!==null&&n.method!=null&&(i=n),i}var r=function(n){return{remuxResult:{},chunkMeta:n}};function u(s){return"then"in s&&s.then instanceof Function}var h=function(n,i,m,o,f){this.audioCodec=void 0,this.videoCodec=void 0,this.initSegmentData=void 0,this.duration=void 0,this.defaultInitPts=void 0,this.audioCodec=n,this.videoCodec=i,this.initSegmentData=m,this.duration=o,this.defaultInitPts=f},y=function(n,i,m,o,f,v){this.discontinuity=void 0,this.contiguous=void 0,this.accurateTimeOffset=void 0,this.trackSwitch=void 0,this.timeOffset=void 0,this.initSegmentChange=void 0,this.discontinuity=n,this.contiguous=i,this.accurateTimeOffset=m,this.trackSwitch=o,this.timeOffset=f,this.initSegmentChange=v}},"./src/demux/tsdemuxer.ts":function(C,l,t){t.r(l),t.d(l,"discardEPB",function(){return h});var D=t("./src/demux/adts.ts"),g=t("./src/demux/mpegaudio.ts"),E=t("./src/demux/exp-golomb.ts"),F=t("./src/demux/sample-aes.ts"),_=t("./src/events.ts"),b=t("./src/utils/mp4-tools.ts"),R=t("./src/utils/logger.ts"),L=t("./src/errors.ts"),I=t("./src/types/demuxer.ts");function A(){return A=Object.assign?Object.assign.bind():function(y){for(var s=1;s<arguments.length;s++){var n=arguments[s];for(var i in n)Object.prototype.hasOwnProperty.call(n,i)&&(y[i]=n[i])}return y},A.apply(this,arguments)}var O=function(){function y(n,i,m){this.observer=void 0,this.config=void 0,this.typeSupported=void 0,this.sampleAes=null,this.pmtParsed=!1,this.audioCodec=void 0,this.videoCodec=void 0,this._duration=0,this._pmtId=-1,this._avcTrack=void 0,this._audioTrack=void 0,this._id3Track=void 0,this._txtTrack=void 0,this.aacOverFlow=null,this.avcSample=null,this.remainderData=null,this.observer=n,this.config=i,this.typeSupported=m}y.probe=function(i){return i[0]===71&&i[188]===71},y.createTrack=function(i,m){return{container:i==="video"||i==="audio"?"video/mp2t":void 0,type:i,id:b.RemuxerTrackIdConfig[i],pid:-1,inputTimeScale:9e4,sequenceNumber:0,samples:[],dropped:0,duration:i==="audio"?m:void 0}};var s=y.prototype;return s.resetInitSegment=function(i,m,o,f){this.pmtParsed=!1,this._pmtId=-1,this._avcTrack=y.createTrack("video"),this._audioTrack=y.createTrack("audio",f),this._id3Track=y.createTrack("id3"),this._txtTrack=y.createTrack("text"),this._audioTrack.segmentCodec="aac",this.aacOverFlow=null,this.avcSample=null,this.remainderData=null,this.audioCodec=m,this.videoCodec=o,this._duration=f},s.resetTimeStamp=function(){},s.resetContiguity=function(){var i=this._audioTrack,m=this._avcTrack,o=this._id3Track;i&&(i.pesData=null),m&&(m.pesData=null),o&&(o.pesData=null),this.aacOverFlow=null},s.demux=function(i,m,o,f){o===void 0&&(o=!1),f===void 0&&(f=!1),o||(this.sampleAes=null);var v,c=this._avcTrack,d=this._audioTrack,x=this._id3Track,P=this._txtTrack,M=c.pid,B=c.pesData,N=d.pid,U=x.pid,w=d.pesData,W=x.pesData,j=null,G=this.pmtParsed,H=this._pmtId,$=i.length;if(this.remainderData&&(i=Object(b.appendUint8Array)(this.remainderData,i),$=i.length,this.remainderData=null),$<188&&!f)return this.remainderData=i,{audioTrack:d,videoTrack:c,id3Track:x,textTrack:P};$-=$%188,$<i.byteLength&&!f&&(this.remainderData=new Uint8Array(i.buffer,$,i.buffer.byteLength-$));for(var te=0,q=0;q<$;q+=188)if(i[q]===71){var ne=!!(i[q+1]&64),oe=((i[q+1]&31)<<8)+i[q+2],k=(i[q+3]&48)>>4,K=void 0;if(k>1){if(K=q+5+i[q+4],K===q+188)continue}else K=q+4;switch(oe){case M:ne&&(B&&(v=r(B))&&this.parseAVCPES(c,P,v,!1),B={data:[],size:0}),B&&(B.data.push(i.subarray(K,q+188)),B.size+=q+188-K);break;case N:if(ne){if(w&&(v=r(w)))switch(d.segmentCodec){case"aac":this.parseAACPES(d,v);break;case"mp3":this.parseMPEGPES(d,v);break}w={data:[],size:0}}w&&(w.data.push(i.subarray(K,q+188)),w.size+=q+188-K);break;case U:ne&&(W&&(v=r(W))&&this.parseID3PES(x,v),W={data:[],size:0}),W&&(W.data.push(i.subarray(K,q+188)),W.size+=q+188-K);break;case 0:ne&&(K+=i[K]+1),H=this._pmtId=T(i,K);break;case H:{ne&&(K+=i[K]+1);var V=a(i,K,this.typeSupported,o);M=V.avc,M>0&&(c.pid=M),N=V.audio,N>0&&(d.pid=N,d.segmentCodec=V.segmentCodec),U=V.id3,U>0&&(x.pid=U),j!==null&&!G&&(R.logger.log("unknown PID '"+j+"' in TS found"),j=null),G=this.pmtParsed=!0;break}case 17:case 8191:break;default:j=oe;break}}else te++;te>0&&this.observer.emit(_.Events.ERROR,_.Events.ERROR,{type:L.ErrorTypes.MEDIA_ERROR,details:L.ErrorDetails.FRAG_PARSING_ERROR,fatal:!1,reason:"Found "+te+" TS packet/s that do not start with 0x47"}),c.pesData=B,d.pesData=w,x.pesData=W;var Y={audioTrack:d,videoTrack:c,id3Track:x,textTrack:P};return f&&this.extractRemainingSamples(Y),Y},s.flush=function(){var i=this.remainderData;this.remainderData=null;var m;return i?m=this.demux(i,-1,!1,!0):m={videoTrack:this._avcTrack,audioTrack:this._audioTrack,id3Track:this._id3Track,textTrack:this._txtTrack},this.extractRemainingSamples(m),this.sampleAes?this.decrypt(m,this.sampleAes):m},s.extractRemainingSamples=function(i){var m=i.audioTrack,o=i.videoTrack,f=i.id3Track,v=i.textTrack,c=o.pesData,d=m.pesData,x=f.pesData,P;if(c&&(P=r(c))?(this.parseAVCPES(o,v,P,!0),o.pesData=null):o.pesData=c,d&&(P=r(d))){switch(m.segmentCodec){case"aac":this.parseAACPES(m,P);break;case"mp3":this.parseMPEGPES(m,P);break}m.pesData=null}else d!=null&&d.size&&R.logger.log("last AAC PES packet truncated,might overlap between fragments"),m.pesData=d;x&&(P=r(x))?(this.parseID3PES(f,P),f.pesData=null):f.pesData=x},s.demuxSampleAes=function(i,m,o){var f=this.demux(i,o,!0,!this.config.progressive),v=this.sampleAes=new F.default(this.observer,this.config,m);return this.decrypt(f,v)},s.decrypt=function(i,m){return new Promise(function(o){var f=i.audioTrack,v=i.videoTrack;f.samples&&f.segmentCodec==="aac"?m.decryptAacSamples(f.samples,0,function(){v.samples?m.decryptAvcSamples(v.samples,0,0,function(){o(i)}):o(i)}):v.samples&&m.decryptAvcSamples(v.samples,0,0,function(){o(i)})})},s.destroy=function(){this._duration=0},s.parseAVCPES=function(i,m,o,f){var v=this,c=this.parseAVCNALu(i,o.data),d=this.avcSample,x,P=!1;o.data=null,d&&c.length&&!i.audFound&&(u(d,i),d=this.avcSample=S(!1,o.pts,o.dts,"")),c.forEach(function(M){switch(M.type){case 1:{x=!0,d||(d=v.avcSample=S(!0,o.pts,o.dts,"")),d.frame=!0;var B=M.data;if(P&&B.length>4){var N=new E.default(B).readSliceType();(N===2||N===4||N===7||N===9)&&(d.key=!0)}break}case 5:x=!0,d||(d=v.avcSample=S(!0,o.pts,o.dts,"")),d.key=!0,d.frame=!0;break;case 6:{x=!0,Object(b.parseSEIMessageFromNALu)(h(M.data),o.pts,m.samples);break}case 7:if(x=!0,P=!0,!i.sps){var U=new E.default(M.data),w=U.readSPS();i.width=w.width,i.height=w.height,i.pixelRatio=w.pixelRatio,i.sps=[M.data],i.duration=v._duration;for(var W=M.data.subarray(1,4),j="avc1.",G=0;G<3;G++){var H=W[G].toString(16);H.length<2&&(H="0"+H),j+=H}i.codec=j}break;case 8:x=!0,i.pps||(i.pps=[M.data]);break;case 9:x=!1,i.audFound=!0,d&&u(d,i),d=v.avcSample=S(!1,o.pts,o.dts,"");break;case 12:x=!0;break;default:x=!1,d&&(d.debug+="unknown NAL "+M.type+" ");break}if(d&&x){var $=d.units;$.push(M)}}),f&&d&&(u(d,i),this.avcSample=null)},s.getLastNalUnit=function(i){var m,o=this.avcSample,f;if((!o||o.units.length===0)&&(o=i[i.length-1]),(m=o)!==null&&m!==void 0&&m.units){var v=o.units;f=v[v.length-1]}return f},s.parseAVCNALu=function(i,m){var o=m.byteLength,f=i.naluState||0,v=f,c=[],d=0,x,P,M,B=-1,N=0;for(f===-1&&(B=0,N=m[0]&31,f=0,d=1);d<o;){if(x=m[d++],!f){f=x?0:1;continue}if(f===1){f=x?0:2;continue}if(!x)f=3;else if(x===1){if(B>=0){var U={data:m.subarray(B,d-f-1),type:N};c.push(U)}else{var w=this.getLastNalUnit(i.samples);if(w&&(v&&d<=4-v&&w.state&&(w.data=w.data.subarray(0,w.data.byteLength-v)),P=d-f-1,P>0)){var W=new Uint8Array(w.data.byteLength+P);W.set(w.data,0),W.set(m.subarray(0,P),w.data.byteLength),w.data=W,w.state=0}}d<o?(M=m[d]&31,B=d,N=M,f=0):f=-1}else f=0}if(B>=0&&f>=0){var j={data:m.subarray(B,o),type:N,state:f};c.push(j)}if(c.length===0){var G=this.getLastNalUnit(i.samples);if(G){var H=new Uint8Array(G.data.byteLength+m.byteLength);H.set(G.data,0),H.set(m,G.data.byteLength),G.data=H}}return i.naluState=f,c},s.parseAACPES=function(i,m){var o=0,f=this.aacOverFlow,v=m.data;if(f){this.aacOverFlow=null;var c=f.missing,d=f.sample.unit.byteLength;if(c===-1){var x=new Uint8Array(d+v.byteLength);x.set(f.sample.unit,0),x.set(v,d),v=x}else{var P=d-c;f.sample.unit.set(v.subarray(0,c),P),i.samples.push(f.sample),o=f.missing}}var M,B;for(M=o,B=v.length;M<B-1&&!D.isHeader(v,M);M++);if(M!==o){var N,U;if(M<B-1?(N="AAC PES did not start with ADTS header,offset:"+M,U=!1):(N="no ADTS header found in AAC PES",U=!0),R.logger.warn("parsing error:"+N),this.observer.emit(_.Events.ERROR,_.Events.ERROR,{type:L.ErrorTypes.MEDIA_ERROR,details:L.ErrorDetails.FRAG_PARSING_ERROR,fatal:U,reason:N}),U)return}D.initTrackConfig(i,this.observer,v,M,this.audioCodec);var w;if(m.pts!==void 0)w=m.pts;else if(f){var W=D.getFrameDuration(i.samplerate);w=f.sample.pts+W}else{R.logger.warn("[tsdemuxer]: AAC PES unknown PTS");return}for(var j=0,G;M<B;)if(G=D.appendFrame(i,v,M,w,j),M+=G.length,G.missing){this.aacOverFlow=G;break}else for(j++;M<B-1&&!D.isHeader(v,M);M++);},s.parseMPEGPES=function(i,m){var o=m.data,f=o.length,v=0,c=0,d=m.pts;if(d===void 0){R.logger.warn("[tsdemuxer]: MPEG PES unknown PTS");return}for(;c<f;)if(g.isHeader(o,c)){var x=g.appendFrame(i,o,c,d,v);if(x)c+=x.length,v++;else break}else c++},s.parseID3PES=function(i,m){if(m.pts===void 0){R.logger.warn("[tsdemuxer]: ID3 PES unknown PTS");return}var o=A({},m,{type:this._avcTrack?I.MetadataSchema.emsg:I.MetadataSchema.audioId3});i.samples.push(o)},y}();function S(y,s,n,i){return{key:y,frame:!1,pts:s,dts:n,units:[],debug:i,length:0}}function T(y,s){return(y[s+10]&31)<<8|y[s+11]}function a(y,s,n,i){var m={audio:-1,avc:-1,id3:-1,segmentCodec:"aac"},o=(y[s+1]&15)<<8|y[s+2],f=s+3+o-4,v=(y[s+10]&15)<<8|y[s+11];for(s+=12+v;s<f;){var c=(y[s+1]&31)<<8|y[s+2];switch(y[s]){case 207:if(!i){R.logger.log("ADTS AAC with AES-128-CBC frame encryption found in unencrypted stream");break}case 15:m.audio===-1&&(m.audio=c);break;case 21:m.id3===-1&&(m.id3=c);break;case 219:if(!i){R.logger.log("H.264 with AES-128-CBC slice encryption found in unencrypted stream");break}case 27:m.avc===-1&&(m.avc=c);break;case 3:case 4:n.mpeg!==!0&&n.mp3!==!0?R.logger.log("MPEG audio found, not supported in this browser"):m.audio===-1&&(m.audio=c,m.segmentCodec="mp3");break;case 36:R.logger.warn("Unsupported HEVC stream type found");break}s+=((y[s+3]&15)<<8|y[s+4])+5}return m}function r(y){var s=0,n,i,m,o,f,v=y.data;if(!y||y.size===0)return null;for(;v[0].length<19&&v.length>1;){var c=new Uint8Array(v[0].length+v[1].length);c.set(v[0]),c.set(v[1],v[0].length),v[0]=c,v.splice(1,1)}n=v[0];var d=(n[0]<<16)+(n[1]<<8)+n[2];if(d===1){if(i=(n[4]<<8)+n[5],i&&i>y.size-6)return null;var x=n[7];x&192&&(o=(n[9]&14)*536870912+(n[10]&255)*4194304+(n[11]&254)*16384+(n[12]&255)*128+(n[13]&254)/2,x&64?(f=(n[14]&14)*536870912+(n[15]&255)*4194304+(n[16]&254)*16384+(n[17]&255)*128+(n[18]&254)/2,o-f>60*9e4&&(R.logger.warn(Math.round((o-f)/9e4)+"s delta between PTS and DTS, align them"),o=f)):f=o),m=n[8];var P=m+9;if(y.size<=P)return null;y.size-=P;for(var M=new Uint8Array(y.size),B=0,N=v.length;B<N;B++){n=v[B];var U=n.byteLength;if(P)if(P>U){P-=U;continue}else n=n.subarray(P),U-=P,P=0;M.set(n,s),s+=U}return i&&(i-=m+3),{data:M,pts:o,dts:f,len:i}}return null}function u(y,s){if(y.units.length&&y.frame){if(y.pts===void 0){var n=s.samples,i=n.length;if(i){var m=n[i-1];y.pts=m.pts,y.dts=m.dts}else{s.dropped++;return}}s.samples.push(y)}y.debug.length&&R.logger.log(y.pts+"/"+y.dts+":"+y.debug)}function h(y){for(var s=y.byteLength,n=[],i=1;i<s-2;)y[i]===0&&y[i+1]===0&&y[i+2]===3?(n.push(i+2),i+=2):i++;if(n.length===0)return y;var m=s-n.length,o=new Uint8Array(m),f=0;for(i=0;i<m;f++,i++)f===n[0]&&(f++,n.shift()),o[i]=y[f];return o}l.default=O},"./src/errors.ts":function(C,l,t){t.r(l),t.d(l,"ErrorTypes",function(){return D}),t.d(l,"ErrorDetails",function(){return g});var D;(function(E){E.NETWORK_ERROR="networkError",E.MEDIA_ERROR="mediaError",E.KEY_SYSTEM_ERROR="keySystemError",E.MUX_ERROR="muxError",E.OTHER_ERROR="otherError"})(D||(D={}));var g;(function(E){E.KEY_SYSTEM_NO_KEYS="keySystemNoKeys",E.KEY_SYSTEM_NO_ACCESS="keySystemNoAccess",E.KEY_SYSTEM_NO_SESSION="keySystemNoSession",E.KEY_SYSTEM_LICENSE_REQUEST_FAILED="keySystemLicenseRequestFailed",E.KEY_SYSTEM_NO_INIT_DATA="keySystemNoInitData",E.MANIFEST_LOAD_ERROR="manifestLoadError",E.MANIFEST_LOAD_TIMEOUT="manifestLoadTimeOut",E.MANIFEST_PARSING_ERROR="manifestParsingError",E.MANIFEST_INCOMPATIBLE_CODECS_ERROR="manifestIncompatibleCodecsError",E.LEVEL_EMPTY_ERROR="levelEmptyError",E.LEVEL_LOAD_ERROR="levelLoadError",E.LEVEL_LOAD_TIMEOUT="levelLoadTimeOut",E.LEVEL_SWITCH_ERROR="levelSwitchError",E.AUDIO_TRACK_LOAD_ERROR="audioTrackLoadError",E.AUDIO_TRACK_LOAD_TIMEOUT="audioTrackLoadTimeOut",E.SUBTITLE_LOAD_ERROR="subtitleTrackLoadError",E.SUBTITLE_TRACK_LOAD_TIMEOUT="subtitleTrackLoadTimeOut",E.FRAG_LOAD_ERROR="fragLoadError",E.FRAG_LOAD_TIMEOUT="fragLoadTimeOut",E.FRAG_DECRYPT_ERROR="fragDecryptError",E.FRAG_PARSING_ERROR="fragParsingError",E.REMUX_ALLOC_ERROR="remuxAllocError",E.KEY_LOAD_ERROR="keyLoadError",E.KEY_LOAD_TIMEOUT="keyLoadTimeOut",E.BUFFER_ADD_CODEC_ERROR="bufferAddCodecError",E.BUFFER_INCOMPATIBLE_CODECS_ERROR="bufferIncompatibleCodecsError",E.BUFFER_APPEND_ERROR="bufferAppendError",E.BUFFER_APPENDING_ERROR="bufferAppendingError",E.BUFFER_STALLED_ERROR="bufferStalledError",E.BUFFER_FULL_ERROR="bufferFullError",E.BUFFER_SEEK_OVER_HOLE="bufferSeekOverHole",E.BUFFER_NUDGE_ON_STALL="bufferNudgeOnStall",E.INTERNAL_EXCEPTION="internalException",E.INTERNAL_ABORTED="aborted",E.UNKNOWN="unknown"})(g||(g={}))},"./src/events.ts":function(C,l,t){t.r(l),t.d(l,"Events",function(){return D});var D;(function(g){g.MEDIA_ATTACHING="hlsMediaAttaching",g.MEDIA_ATTACHED="hlsMediaAttached",g.MEDIA_DETACHING="hlsMediaDetaching",g.MEDIA_DETACHED="hlsMediaDetached",g.BUFFER_RESET="hlsBufferReset",g.BUFFER_CODECS="hlsBufferCodecs",g.BUFFER_CREATED="hlsBufferCreated",g.BUFFER_APPENDING="hlsBufferAppending",g.BUFFER_APPENDED="hlsBufferAppended",g.BUFFER_EOS="hlsBufferEos",g.BUFFER_FLUSHING="hlsBufferFlushing",g.BUFFER_FLUSHED="hlsBufferFlushed",g.MANIFEST_LOADING="hlsManifestLoading",g.MANIFEST_LOADED="hlsManifestLoaded",g.MANIFEST_PARSED="hlsManifestParsed",g.LEVEL_SWITCHING="hlsLevelSwitching",g.LEVEL_SWITCHED="hlsLevelSwitched",g.LEVEL_LOADING="hlsLevelLoading",g.LEVEL_LOADED="hlsLevelLoaded",g.LEVEL_UPDATED="hlsLevelUpdated",g.LEVEL_PTS_UPDATED="hlsLevelPtsUpdated",g.LEVELS_UPDATED="hlsLevelsUpdated",g.AUDIO_TRACKS_UPDATED="hlsAudioTracksUpdated",g.AUDIO_TRACK_SWITCHING="hlsAudioTrackSwitching",g.AUDIO_TRACK_SWITCHED="hlsAudioTrackSwitched",g.AUDIO_TRACK_LOADING="hlsAudioTrackLoading",g.AUDIO_TRACK_LOADED="hlsAudioTrackLoaded",g.SUBTITLE_TRACKS_UPDATED="hlsSubtitleTracksUpdated",g.SUBTITLE_TRACKS_CLEARED="hlsSubtitleTracksCleared",g.SUBTITLE_TRACK_SWITCH="hlsSubtitleTrackSwitch",g.SUBTITLE_TRACK_LOADING="hlsSubtitleTrackLoading",g.SUBTITLE_TRACK_LOADED="hlsSubtitleTrackLoaded",g.SUBTITLE_FRAG_PROCESSED="hlsSubtitleFragProcessed",g.CUES_PARSED="hlsCuesParsed",g.NON_NATIVE_TEXT_TRACKS_FOUND="hlsNonNativeTextTracksFound",g.INIT_PTS_FOUND="hlsInitPtsFound",g.FRAG_LOADING="hlsFragLoading",g.FRAG_LOAD_EMERGENCY_ABORTED="hlsFragLoadEmergencyAborted",g.FRAG_LOADED="hlsFragLoaded",g.FRAG_DECRYPTED="hlsFragDecrypted",g.FRAG_PARSING_INIT_SEGMENT="hlsFragParsingInitSegment",g.FRAG_PARSING_USERDATA="hlsFragParsingUserdata",g.FRAG_PARSING_METADATA="hlsFragParsingMetadata",g.FRAG_PARSED="hlsFragParsed",g.FRAG_BUFFERED="hlsFragBuffered",g.FRAG_CHANGED="hlsFragChanged",g.FPS_DROP="hlsFpsDrop",g.FPS_DROP_LEVEL_CAPPING="hlsFpsDropLevelCapping",g.ERROR="hlsError",g.DESTROYING="hlsDestroying",g.KEY_LOADING="hlsKeyLoading",g.KEY_LOADED="hlsKeyLoaded",g.LIVE_BACK_BUFFER_REACHED="hlsLiveBackBufferReached",g.BACK_BUFFER_REACHED="hlsBackBufferReached"})(D||(D={}))},"./src/hls.ts":function(C,l,t){t.r(l),t.d(l,"default",function(){return h});var D=t("./node_modules/url-toolkit/src/url-toolkit.js"),g=t("./src/loader/playlist-loader.ts"),E=t("./src/loader/key-loader.ts"),F=t("./src/controller/id3-track-controller.ts"),_=t("./src/controller/latency-controller.ts"),b=t("./src/controller/level-controller.ts"),R=t("./src/controller/fragment-tracker.ts"),L=t("./src/controller/stream-controller.ts"),I=t("./src/is-supported.ts"),A=t("./src/utils/logger.ts"),O=t("./src/config.ts"),S=t("./node_modules/eventemitter3/index.js"),T=t("./src/events.ts"),a=t("./src/errors.ts");function r(y,s){for(var n=0;n<s.length;n++){var i=s[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(y,i.key,i)}}function u(y,s,n){return s&&r(y.prototype,s),n&&r(y,n),Object.defineProperty(y,"prototype",{writable:!1}),y}var h=function(){y.isSupported=function(){return Object(I.isSupported)()};function y(n){n===void 0&&(n={}),this.config=void 0,this.userConfig=void 0,this.coreComponents=void 0,this.networkControllers=void 0,this._emitter=new S.EventEmitter,this._autoLevelCapping=void 0,this.abrController=void 0,this.bufferController=void 0,this.capLevelController=void 0,this.latencyController=void 0,this.levelController=void 0,this.streamController=void 0,this.audioTrackController=void 0,this.subtitleTrackController=void 0,this.emeController=void 0,this.cmcdController=void 0,this._media=null,this.url=null;var i=this.config=Object(O.mergeConfig)(y.DefaultConfig,n);this.userConfig=n,Object(A.enableLogs)(i.debug),this._autoLevelCapping=-1,i.progressive&&Object(O.enableStreamingMode)(i);var m=i.abrController,o=i.bufferController,f=i.capLevelController,v=i.fpsController,c=this.abrController=new m(this),d=this.bufferController=new o(this),x=this.capLevelController=new f(this),P=new v(this),M=new g.default(this),B=new E.default(this),N=new F.default(this),U=this.levelController=new b.default(this),w=new R.FragmentTracker(this),W=this.streamController=new L.default(this,w);x.setStreamController(W),P.setStreamController(W);var j=[M,B,U,W];this.networkControllers=j;var G=[c,d,x,P,N,w];this.audioTrackController=this.createController(i.audioTrackController,null,j),this.createController(i.audioStreamController,w,j),this.subtitleTrackController=this.createController(i.subtitleTrackController,null,j),this.createController(i.subtitleStreamController,w,j),this.createController(i.timelineController,null,G),this.emeController=this.createController(i.emeController,null,G),this.cmcdController=this.createController(i.cmcdController,null,G),this.latencyController=this.createController(_.default,null,G),this.coreComponents=G}var s=y.prototype;return s.createController=function(i,m,o){if(i){var f=m?new i(this,m):new i(this);return o&&o.push(f),f}return null},s.on=function(i,m,o){o===void 0&&(o=this),this._emitter.on(i,m,o)},s.once=function(i,m,o){o===void 0&&(o=this),this._emitter.once(i,m,o)},s.removeAllListeners=function(i){this._emitter.removeAllListeners(i)},s.off=function(i,m,o,f){o===void 0&&(o=this),this._emitter.off(i,m,o,f)},s.listeners=function(i){return this._emitter.listeners(i)},s.emit=function(i,m,o){return this._emitter.emit(i,m,o)},s.trigger=function(i,m){if(this.config.debug)return this.emit(i,i,m);try{return this.emit(i,i,m)}catch(o){A.logger.error("An internal error happened while handling event "+i+'. Error message: "'+o.message+'". Here is a stacktrace:',o),this.trigger(T.Events.ERROR,{type:a.ErrorTypes.OTHER_ERROR,details:a.ErrorDetails.INTERNAL_EXCEPTION,fatal:!1,event:i,error:o})}return!1},s.listenerCount=function(i){return this._emitter.listenerCount(i)},s.destroy=function(){A.logger.log("destroy"),this.trigger(T.Events.DESTROYING,void 0),this.detachMedia(),this.removeAllListeners(),this._autoLevelCapping=-1,this.url=null,this.networkControllers.forEach(function(i){return i.destroy()}),this.networkControllers.length=0,this.coreComponents.forEach(function(i){return i.destroy()}),this.coreComponents.length=0},s.attachMedia=function(i){A.logger.log("attachMedia"),this._media=i,this.trigger(T.Events.MEDIA_ATTACHING,{media:i})},s.detachMedia=function(){A.logger.log("detachMedia"),this.trigger(T.Events.MEDIA_DETACHING,void 0),this._media=null},s.loadSource=function(i){this.stopLoad();var m=this.media,o=this.url,f=this.url=D.buildAbsoluteURL(self.location.href,i,{alwaysNormalize:!0});A.logger.log("loadSource:"+f),m&&o&&o!==f&&this.bufferController.hasSourceTypes()&&(this.detachMedia(),this.attachMedia(m)),this.trigger(T.Events.MANIFEST_LOADING,{url:i})},s.startLoad=function(i){i===void 0&&(i=-1),A.logger.log("startLoad("+i+")"),this.networkControllers.forEach(function(m){m.startLoad(i)})},s.stopLoad=function(){A.logger.log("stopLoad"),this.networkControllers.forEach(function(i){i.stopLoad()})},s.swapAudioCodec=function(){A.logger.log("swapAudioCodec"),this.streamController.swapAudioCodec()},s.recoverMediaError=function(){A.logger.log("recoverMediaError");var i=this._media;this.detachMedia(),i&&this.attachMedia(i)},s.removeLevel=function(i,m){m===void 0&&(m=0),this.levelController.removeLevel(i,m)},u(y,[{key:"levels",get:function(){var i=this.levelController.levels;return i||[]}},{key:"currentLevel",get:function(){return this.streamController.currentLevel},set:function(i){A.logger.log("set currentLevel:"+i),this.loadLevel=i,this.abrController.clearTimer(),this.streamController.immediateLevelSwitch()}},{key:"nextLevel",get:function(){return this.streamController.nextLevel},set:function(i){A.logger.log("set nextLevel:"+i),this.levelController.manualLevel=i,this.streamController.nextLevelSwitch()}},{key:"loadLevel",get:function(){return this.levelController.level},set:function(i){A.logger.log("set loadLevel:"+i),this.levelController.manualLevel=i}},{key:"nextLoadLevel",get:function(){return this.levelController.nextLoadLevel},set:function(i){this.levelController.nextLoadLevel=i}},{key:"firstLevel",get:function(){return Math.max(this.levelController.firstLevel,this.minAutoLevel)},set:function(i){A.logger.log("set firstLevel:"+i),this.levelController.firstLevel=i}},{key:"startLevel",get:function(){return this.levelController.startLevel},set:function(i){A.logger.log("set startLevel:"+i),i!==-1&&(i=Math.max(i,this.minAutoLevel)),this.levelController.startLevel=i}},{key:"capLevelToPlayerSize",get:function(){return this.config.capLevelToPlayerSize},set:function(i){var m=!!i;m!==this.config.capLevelToPlayerSize&&(m?this.capLevelController.startCapping():(this.capLevelController.stopCapping(),this.autoLevelCapping=-1,this.streamController.nextLevelSwitch()),this.config.capLevelToPlayerSize=m)}},{key:"autoLevelCapping",get:function(){return this._autoLevelCapping},set:function(i){this._autoLevelCapping!==i&&(A.logger.log("set autoLevelCapping:"+i),this._autoLevelCapping=i)}},{key:"bandwidthEstimate",get:function(){var i=this.abrController.bwEstimator;return i?i.getEstimate():NaN}},{key:"autoLevelEnabled",get:function(){return this.levelController.manualLevel===-1}},{key:"manualLevel",get:function(){return this.levelController.manualLevel}},{key:"minAutoLevel",get:function(){var i=this.levels,m=this.config.minAutoBitrate;if(!i)return 0;for(var o=i.length,f=0;f<o;f++)if(i[f].maxBitrate>=m)return f;return 0}},{key:"maxAutoLevel",get:function(){var i=this.levels,m=this.autoLevelCapping,o;return m===-1&&i&&i.length?o=i.length-1:o=m,o}},{key:"nextAutoLevel",get:function(){return Math.min(Math.max(this.abrController.nextAutoLevel,this.minAutoLevel),this.maxAutoLevel)},set:function(i){this.abrController.nextAutoLevel=Math.max(this.minAutoLevel,i)}},{key:"playingDate",get:function(){return this.streamController.currentProgramDateTime}},{key:"mainForwardBufferInfo",get:function(){return this.streamController.getMainFwdBufferInfo()}},{key:"audioTracks",get:function(){var i=this.audioTrackController;return i?i.audioTracks:[]}},{key:"audioTrack",get:function(){var i=this.audioTrackController;return i?i.audioTrack:-1},set:function(i){var m=this.audioTrackController;m&&(m.audioTrack=i)}},{key:"subtitleTracks",get:function(){var i=this.subtitleTrackController;return i?i.subtitleTracks:[]}},{key:"subtitleTrack",get:function(){var i=this.subtitleTrackController;return i?i.subtitleTrack:-1},set:function(i){var m=this.subtitleTrackController;m&&(m.subtitleTrack=i)}},{key:"media",get:function(){return this._media}},{key:"subtitleDisplay",get:function(){var i=this.subtitleTrackController;return i?i.subtitleDisplay:!1},set:function(i){var m=this.subtitleTrackController;m&&(m.subtitleDisplay=i)}},{key:"lowLatencyMode",get:function(){return this.config.lowLatencyMode},set:function(i){this.config.lowLatencyMode=i}},{key:"liveSyncPosition",get:function(){return this.latencyController.liveSyncPosition}},{key:"latency",get:function(){return this.latencyController.latency}},{key:"maxLatency",get:function(){return this.latencyController.maxLatency}},{key:"targetLatency",get:function(){return this.latencyController.targetLatency}},{key:"drift",get:function(){return this.latencyController.drift}},{key:"forceStartLoad",get:function(){return this.streamController.forceStartLoad}}],[{key:"version",get:function(){return"1.2.4"}},{key:"Events",get:function(){return T.Events}},{key:"ErrorTypes",get:function(){return a.ErrorTypes}},{key:"ErrorDetails",get:function(){return a.ErrorDetails}},{key:"DefaultConfig",get:function(){return y.defaultConfig?y.defaultConfig:O.hlsDefaultConfig},set:function(i){y.defaultConfig=i}}]),y}();h.defaultConfig=void 0},"./src/is-supported.ts":function(C,l,t){t.r(l),t.d(l,"isSupported",function(){return E}),t.d(l,"changeTypeSupported",function(){return F});var D=t("./src/utils/mediasource-helper.ts");function g(){return self.SourceBuffer||self.WebKitSourceBuffer}function E(){var _=Object(D.getMediaSource)();if(!_)return!1;var b=g(),R=_&&typeof _.isTypeSupported=="function"&&_.isTypeSupported('video/mp4; codecs="avc1.42E01E,mp4a.40.2"'),L=!b||b.prototype&&typeof b.prototype.appendBuffer=="function"&&typeof b.prototype.remove=="function";return!!R&&!!L}function F(){var _,b=g();return typeof(b==null||(_=b.prototype)===null||_===void 0?void 0:_.changeType)=="function"}},"./src/loader/date-range.ts":function(C,l,t){t.r(l),t.d(l,"DateRangeAttribute",function(){return R}),t.d(l,"DateRange",function(){return L});var D=t("./src/polyfills/number.ts"),g=t("./src/utils/attr-list.ts"),E=t("./src/utils/logger.ts");function F(){return F=Object.assign?Object.assign.bind():function(I){for(var A=1;A<arguments.length;A++){var O=arguments[A];for(var S in O)Object.prototype.hasOwnProperty.call(O,S)&&(I[S]=O[S])}return I},F.apply(this,arguments)}function _(I,A){for(var O=0;O<A.length;O++){var S=A[O];S.enumerable=S.enumerable||!1,S.configurable=!0,"value"in S&&(S.writable=!0),Object.defineProperty(I,S.key,S)}}function b(I,A,O){return A&&_(I.prototype,A),O&&_(I,O),Object.defineProperty(I,"prototype",{writable:!1}),I}var R;(function(I){I.ID="ID",I.CLASS="CLASS",I.START_DATE="START-DATE",I.DURATION="DURATION",I.END_DATE="END-DATE",I.END_ON_NEXT="END-ON-NEXT",I.PLANNED_DURATION="PLANNED-DURATION",I.SCTE35_OUT="SCTE35-OUT",I.SCTE35_IN="SCTE35-IN"})(R||(R={}));var L=function(){function I(A,O){if(this.attr=void 0,this._startDate=void 0,this._endDate=void 0,this._badValueForSameId=void 0,O){var S=O.attr;for(var T in S)if(Object.prototype.hasOwnProperty.call(A,T)&&A[T]!==S[T]){E.logger.warn('DATERANGE tag attribute: "'+T+'" does not match for tags with ID: "'+A.ID+'"'),this._badValueForSameId=T;break}A=F(new g.AttrList({}),S,A)}if(this.attr=A,this._startDate=new Date(A[R.START_DATE]),R.END_DATE in this.attr){var a=new Date(this.attr[R.END_DATE]);Object(D.isFiniteNumber)(a.getTime())&&(this._endDate=a)}}return b(I,[{key:"id",get:function(){return this.attr.ID}},{key:"class",get:function(){return this.attr.CLASS}},{key:"startDate",get:function(){return this._startDate}},{key:"endDate",get:function(){if(this._endDate)return this._endDate;var O=this.duration;return O!==null?new Date(this._startDate.getTime()+O*1e3):null}},{key:"duration",get:function(){if(R.DURATION in this.attr){var O=this.attr.decimalFloatingPoint(R.DURATION);if(Object(D.isFiniteNumber)(O))return O}else if(this._endDate)return(this._endDate.getTime()-this._startDate.getTime())/1e3;return null}},{key:"plannedDuration",get:function(){return R.PLANNED_DURATION in this.attr?this.attr.decimalFloatingPoint(R.PLANNED_DURATION):null}},{key:"endOnNext",get:function(){return this.attr.bool(R.END_ON_NEXT)}},{key:"isValid",get:function(){return!!this.id&&!this._badValueForSameId&&Object(D.isFiniteNumber)(this.startDate.getTime())&&(this.duration===null||this.duration>=0)&&(!this.endOnNext||!!this.class)}}]),I}()},"./src/loader/fragment-loader.ts":function(C,l,t){t.r(l),t.d(l,"default",function(){return O}),t.d(l,"LoadError",function(){return T});var D=t("./src/polyfills/number.ts"),g=t("./src/errors.ts");function E(a,r){a.prototype=Object.create(r.prototype),a.prototype.constructor=a,L(a,r)}function F(a){var r=typeof Map=="function"?new Map:void 0;return F=function(h){if(h===null||!R(h))return h;if(typeof h!="function")throw new TypeError("Super expression must either be null or a function");if(typeof r<"u"){if(r.has(h))return r.get(h);r.set(h,y)}function y(){return _(h,arguments,I(this).constructor)}return y.prototype=Object.create(h.prototype,{constructor:{value:y,enumerable:!1,writable:!0,configurable:!0}}),L(y,h)},F(a)}function _(a,r,u){return b()?_=Reflect.construct.bind():_=function(y,s,n){var i=[null];i.push.apply(i,s);var m=Function.bind.apply(y,i),o=new m;return n&&L(o,n.prototype),o},_.apply(null,arguments)}function b(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}function R(a){return Function.toString.call(a).indexOf("[native code]")!==-1}function L(a,r){return L=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(h,y){return h.__proto__=y,h},L(a,r)}function I(a){return I=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(u){return u.__proto__||Object.getPrototypeOf(u)},I(a)}var A=Math.pow(2,17),O=function(){function a(u){this.config=void 0,this.loader=null,this.partLoadTimeout=-1,this.config=u}var r=a.prototype;return r.destroy=function(){this.loader&&(this.loader.destroy(),this.loader=null)},r.abort=function(){this.loader&&this.loader.abort()},r.load=function(h,y){var s=this,n=h.url;if(!n)return Promise.reject(new T({type:g.ErrorTypes.NETWORK_ERROR,details:g.ErrorDetails.FRAG_LOAD_ERROR,fatal:!1,frag:h,networkDetails:null},"Fragment does not have a "+(n?"part list":"url")));this.abort();var i=this.config,m=i.fLoader,o=i.loader;return new Promise(function(f,v){s.loader&&s.loader.destroy();var c=s.loader=h.loader=m?new m(i):new o(i),d=S(h),x={timeout:i.fragLoadingTimeOut,maxRetry:0,retryDelay:0,maxRetryDelay:i.fragLoadingMaxRetryTimeout,highWaterMark:h.sn==="initSegment"?1/0:A};h.stats=c.stats,c.load(d,x,{onSuccess:function(M,B,N,U){s.resetLoader(h,c),f({frag:h,part:null,payload:M.data,networkDetails:U})},onError:function(M,B,N){s.resetLoader(h,c),v(new T({type:g.ErrorTypes.NETWORK_ERROR,details:g.ErrorDetails.FRAG_LOAD_ERROR,fatal:!1,frag:h,response:M,networkDetails:N}))},onAbort:function(M,B,N){s.resetLoader(h,c),v(new T({type:g.ErrorTypes.NETWORK_ERROR,details:g.ErrorDetails.INTERNAL_ABORTED,fatal:!1,frag:h,networkDetails:N}))},onTimeout:function(M,B,N){s.resetLoader(h,c),v(new T({type:g.ErrorTypes.NETWORK_ERROR,details:g.ErrorDetails.FRAG_LOAD_TIMEOUT,fatal:!1,frag:h,networkDetails:N}))},onProgress:function(M,B,N,U){y&&y({frag:h,part:null,payload:N,networkDetails:U})}})})},r.loadPart=function(h,y,s){var n=this;this.abort();var i=this.config,m=i.fLoader,o=i.loader;return new Promise(function(f,v){n.loader&&n.loader.destroy();var c=n.loader=h.loader=m?new m(i):new o(i),d=S(h,y),x={timeout:i.fragLoadingTimeOut,maxRetry:0,retryDelay:0,maxRetryDelay:i.fragLoadingMaxRetryTimeout,highWaterMark:A};y.stats=c.stats,c.load(d,x,{onSuccess:function(M,B,N,U){n.resetLoader(h,c),n.updateStatsFromPart(h,y);var w={frag:h,part:y,payload:M.data,networkDetails:U};s(w),f(w)},onError:function(M,B,N){n.resetLoader(h,c),v(new T({type:g.ErrorTypes.NETWORK_ERROR,details:g.ErrorDetails.FRAG_LOAD_ERROR,fatal:!1,frag:h,part:y,response:M,networkDetails:N}))},onAbort:function(M,B,N){h.stats.aborted=y.stats.aborted,n.resetLoader(h,c),v(new T({type:g.ErrorTypes.NETWORK_ERROR,details:g.ErrorDetails.INTERNAL_ABORTED,fatal:!1,frag:h,part:y,networkDetails:N}))},onTimeout:function(M,B,N){n.resetLoader(h,c),v(new T({type:g.ErrorTypes.NETWORK_ERROR,details:g.ErrorDetails.FRAG_LOAD_TIMEOUT,fatal:!1,frag:h,part:y,networkDetails:N}))}})})},r.updateStatsFromPart=function(h,y){var s=h.stats,n=y.stats,i=n.total;if(s.loaded+=n.loaded,i){var m=Math.round(h.duration/y.duration),o=Math.min(Math.round(s.loaded/i),m),f=m-o,v=f*Math.round(s.loaded/o);s.total=s.loaded+v}else s.total=Math.max(s.loaded,s.total);var c=s.loading,d=n.loading;c.start?c.first+=d.first-d.start:(c.start=d.start,c.first=d.first),c.end=d.end},r.resetLoader=function(h,y){h.loader=null,this.loader===y&&(self.clearTimeout(this.partLoadTimeout),this.loader=null),y.destroy()},a}();function S(a,r){r===void 0&&(r=null);var u=r||a,h={frag:a,part:r,responseType:"arraybuffer",url:u.url,headers:{},rangeStart:0,rangeEnd:0},y=u.byteRangeStartOffset,s=u.byteRangeEndOffset;return Object(D.isFiniteNumber)(y)&&Object(D.isFiniteNumber)(s)&&(h.rangeStart=y,h.rangeEnd=s),h}var T=function(a){E(r,a);function r(u){for(var h,y=arguments.length,s=new Array(y>1?y-1:0),n=1;n<y;n++)s[n-1]=arguments[n];return h=a.call.apply(a,[this].concat(s))||this,h.data=void 0,h.data=u,h}return r}(F(Error))},"./src/loader/fragment.ts":function(C,l,t){t.r(l),t.d(l,"ElementaryStreamTypes",function(){return A}),t.d(l,"BaseSegment",function(){return O}),t.d(l,"Fragment",function(){return S}),t.d(l,"Part",function(){return T});var D=t("./src/polyfills/number.ts"),g=t("./node_modules/url-toolkit/src/url-toolkit.js"),E=t("./src/utils/logger.ts"),F=t("./src/loader/level-key.ts"),_=t("./src/loader/load-stats.ts");function b(a,r){a.prototype=Object.create(r.prototype),a.prototype.constructor=a,R(a,r)}function R(a,r){return R=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(h,y){return h.__proto__=y,h},R(a,r)}function L(a,r){for(var u=0;u<r.length;u++){var h=r[u];h.enumerable=h.enumerable||!1,h.configurable=!0,"value"in h&&(h.writable=!0),Object.defineProperty(a,h.key,h)}}function I(a,r,u){return r&&L(a.prototype,r),u&&L(a,u),Object.defineProperty(a,"prototype",{writable:!1}),a}var A;(function(a){a.AUDIO="audio",a.VIDEO="video",a.AUDIOVIDEO="audiovideo"})(A||(A={}));var O=function(){function a(u){var h;this._byteRange=null,this._url=null,this.baseurl=void 0,this.relurl=void 0,this.elementaryStreams=(h={},h[A.AUDIO]=null,h[A.VIDEO]=null,h[A.AUDIOVIDEO]=null,h),this.baseurl=u}var r=a.prototype;return r.setByteRange=function(h,y){var s=h.split("@",2),n=[];s.length===1?n[0]=y?y.byteRangeEndOffset:0:n[0]=parseInt(s[1]),n[1]=parseInt(s[0])+n[0],this._byteRange=n},I(a,[{key:"byteRange",get:function(){return this._byteRange?this._byteRange:[]}},{key:"byteRangeStartOffset",get:function(){return this.byteRange[0]}},{key:"byteRangeEndOffset",get:function(){return this.byteRange[1]}},{key:"url",get:function(){return!this._url&&this.baseurl&&this.relurl&&(this._url=Object(g.buildAbsoluteURL)(this.baseurl,this.relurl,{alwaysNormalize:!0})),this._url||""},set:function(h){this._url=h}}]),a}(),S=function(a){b(r,a);function r(h,y){var s;return s=a.call(this,y)||this,s._decryptdata=null,s.rawProgramDateTime=null,s.programDateTime=null,s.tagList=[],s.duration=0,s.sn=0,s.levelkey=void 0,s.type=void 0,s.loader=null,s.level=-1,s.cc=0,s.startPTS=void 0,s.endPTS=void 0,s.appendedPTS=void 0,s.startDTS=void 0,s.endDTS=void 0,s.start=0,s.deltaPTS=void 0,s.maxStartPTS=void 0,s.minEndPTS=void 0,s.stats=new _.LoadStats,s.urlId=0,s.data=void 0,s.bitrateTest=!1,s.title=null,s.initSegment=null,s.type=h,s}var u=r.prototype;return u.createInitializationVector=function(y){for(var s=new Uint8Array(16),n=12;n<16;n++)s[n]=y>>8*(15-n)&255;return s},u.setDecryptDataFromLevelKey=function(y,s){var n=y;return(y==null?void 0:y.method)==="AES-128"&&y.uri&&!y.iv&&(n=F.LevelKey.fromURI(y.uri),n.method=y.method,n.iv=this.createInitializationVector(s),n.keyFormat="identity"),n},u.setElementaryStreamInfo=function(y,s,n,i,m,o){o===void 0&&(o=!1);var f=this.elementaryStreams,v=f[y];if(!v){f[y]={startPTS:s,endPTS:n,startDTS:i,endDTS:m,partial:o};return}v.startPTS=Math.min(v.startPTS,s),v.endPTS=Math.max(v.endPTS,n),v.startDTS=Math.min(v.startDTS,i),v.endDTS=Math.max(v.endDTS,m)},u.clearElementaryStreamInfo=function(){var y=this.elementaryStreams;y[A.AUDIO]=null,y[A.VIDEO]=null,y[A.AUDIOVIDEO]=null},I(r,[{key:"decryptdata",get:function(){if(!this.levelkey&&!this._decryptdata)return null;if(!this._decryptdata&&this.levelkey){var y=this.sn;typeof y!="number"&&(this.levelkey&&this.levelkey.method==="AES-128"&&!this.levelkey.iv&&E.logger.warn('missing IV for initialization segment with method="'+this.levelkey.method+'" - compliance issue'),y=0),this._decryptdata=this.setDecryptDataFromLevelKey(this.levelkey,y)}return this._decryptdata}},{key:"end",get:function(){return this.start+this.duration}},{key:"endProgramDateTime",get:function(){if(this.programDateTime===null||!Object(D.isFiniteNumber)(this.programDateTime))return null;var y=Object(D.isFiniteNumber)(this.duration)?this.duration:0;return this.programDateTime+y*1e3}},{key:"encrypted",get:function(){var y;return!!((y=this.decryptdata)!==null&&y!==void 0&&y.keyFormat&&this.decryptdata.uri)}}]),r}(O),T=function(a){b(r,a);function r(u,h,y,s,n){var i;i=a.call(this,y)||this,i.fragOffset=0,i.duration=0,i.gap=!1,i.independent=!1,i.relurl=void 0,i.fragment=void 0,i.index=void 0,i.stats=new _.LoadStats,i.duration=u.decimalFloatingPoint("DURATION"),i.gap=u.bool("GAP"),i.independent=u.bool("INDEPENDENT"),i.relurl=u.enumeratedString("URI"),i.fragment=h,i.index=s;var m=u.enumeratedString("BYTERANGE");return m&&i.setByteRange(m,n),n&&(i.fragOffset=n.fragOffset+n.duration),i}return I(r,[{key:"start",get:function(){return this.fragment.start+this.fragOffset}},{key:"end",get:function(){return this.start+this.duration}},{key:"loaded",get:function(){var h=this.elementaryStreams;return!!(h.audio||h.video||h.audiovideo)}}]),r}(O)},"./src/loader/key-loader.ts":function(C,l,t){t.r(l),t.d(l,"default",function(){return F});var D=t("./src/events.ts"),g=t("./src/errors.ts"),E=t("./src/utils/logger.ts"),F=function(){function _(R){this.hls=void 0,this.loaders={},this.decryptkey=null,this.decrypturl=null,this.hls=R,this.registerListeners()}var b=_.prototype;return b.startLoad=function(L){},b.stopLoad=function(){this.destroyInternalLoaders()},b.registerListeners=function(){this.hls.on(D.Events.KEY_LOADING,this.onKeyLoading,this)},b.unregisterListeners=function(){this.hls.off(D.Events.KEY_LOADING,this.onKeyLoading)},b.destroyInternalLoaders=function(){for(var L in this.loaders){var I=this.loaders[L];I&&I.destroy()}this.loaders={}},b.destroy=function(){this.unregisterListeners(),this.destroyInternalLoaders()},b.onKeyLoading=function(L,I){var A=I.frag,O=A.type,S=this.loaders[O];if(!A.decryptdata){E.logger.warn("Missing decryption data on fragment in onKeyLoading");return}var T=A.decryptdata.uri;if(T!==this.decrypturl||this.decryptkey===null){var a=this.hls.config;if(S&&(E.logger.warn("abort previous key loader for type:"+O),S.abort()),!T){E.logger.warn("key uri is falsy");return}var r=a.loader,u=A.loader=this.loaders[O]=new r(a);this.decrypturl=T,this.decryptkey=null;var h={url:T,frag:A,responseType:"arraybuffer"},y={timeout:a.fragLoadingTimeOut,maxRetry:0,retryDelay:a.fragLoadingRetryDelay,maxRetryDelay:a.fragLoadingMaxRetryTimeout,highWaterMark:0},s={onSuccess:this.loadsuccess.bind(this),onError:this.loaderror.bind(this),onTimeout:this.loadtimeout.bind(this)};u.load(h,y,s)}else this.decryptkey&&(A.decryptdata.key=this.decryptkey,this.hls.trigger(D.Events.KEY_LOADED,{frag:A}))},b.loadsuccess=function(L,I,A){var O=A.frag;if(!O.decryptdata){E.logger.error("after key load, decryptdata unset");return}this.decryptkey=O.decryptdata.key=new Uint8Array(L.data),O.loader=null,delete this.loaders[O.type],this.hls.trigger(D.Events.KEY_LOADED,{frag:O})},b.loaderror=function(L,I){var A=I.frag,O=A.loader;O&&O.abort(),delete this.loaders[A.type],this.hls.trigger(D.Events.ERROR,{type:g.ErrorTypes.NETWORK_ERROR,details:g.ErrorDetails.KEY_LOAD_ERROR,fatal:!1,frag:A,response:L})},b.loadtimeout=function(L,I){var A=I.frag,O=A.loader;O&&O.abort(),delete this.loaders[A.type],this.hls.trigger(D.Events.ERROR,{type:g.ErrorTypes.NETWORK_ERROR,details:g.ErrorDetails.KEY_LOAD_TIMEOUT,fatal:!1,frag:A})},_}()},"./src/loader/level-details.ts":function(C,l,t){t.r(l),t.d(l,"LevelDetails",function(){return _});var D=t("./src/polyfills/number.ts");function g(b,R){for(var L=0;L<R.length;L++){var I=R[L];I.enumerable=I.enumerable||!1,I.configurable=!0,"value"in I&&(I.writable=!0),Object.defineProperty(b,I.key,I)}}function E(b,R,L){return R&&g(b.prototype,R),L&&g(b,L),Object.defineProperty(b,"prototype",{writable:!1}),b}var F=10,_=function(){function b(L){this.PTSKnown=!1,this.alignedSliding=!1,this.averagetargetduration=void 0,this.endCC=0,this.endSN=0,this.fragments=void 0,this.fragmentHint=void 0,this.partList=null,this.dateRanges=void 0,this.live=!0,this.ageHeader=0,this.advancedDateTime=void 0,this.updated=!0,this.advanced=!0,this.availabilityDelay=void 0,this.misses=0,this.needSidxRanges=!1,this.startCC=0,this.startSN=0,this.startTimeOffset=null,this.targetduration=0,this.totalduration=0,this.type=null,this.url=void 0,this.m3u8="",this.version=null,this.canBlockReload=!1,this.canSkipUntil=0,this.canSkipDateRanges=!1,this.skippedSegments=0,this.recentlyRemovedDateranges=void 0,this.partHoldBack=0,this.holdBack=0,this.partTarget=0,this.preloadHint=void 0,this.renditionReports=void 0,this.tuneInGoal=0,this.deltaUpdateFailed=void 0,this.driftStartTime=0,this.driftEndTime=0,this.driftStart=0,this.driftEnd=0,this.fragments=[],this.dateRanges={},this.url=L}var R=b.prototype;return R.reloaded=function(I){if(!I){this.advanced=!0,this.updated=!0;return}var A=this.lastPartSn-I.lastPartSn,O=this.lastPartIndex-I.lastPartIndex;this.updated=this.endSN!==I.endSN||!!O||!!A,this.advanced=this.endSN>I.endSN||A>0||A===0&&O>0,this.updated||this.advanced?this.misses=Math.floor(I.misses*.6):this.misses=I.misses+1,this.availabilityDelay=I.availabilityDelay},E(b,[{key:"hasProgramDateTime",get:function(){return this.fragments.length?Object(D.isFiniteNumber)(this.fragments[this.fragments.length-1].programDateTime):!1}},{key:"levelTargetDuration",get:function(){return this.averagetargetduration||this.targetduration||F}},{key:"drift",get:function(){var I=this.driftEndTime-this.driftStartTime;if(I>0){var A=this.driftEnd-this.driftStart;return A*1e3/I}return 1}},{key:"edge",get:function(){return this.partEnd||this.fragmentEnd}},{key:"partEnd",get:function(){var I;return(I=this.partList)!==null&&I!==void 0&&I.length?this.partList[this.partList.length-1].end:this.fragmentEnd}},{key:"fragmentEnd",get:function(){var I;return(I=this.fragments)!==null&&I!==void 0&&I.length?this.fragments[this.fragments.length-1].end:0}},{key:"age",get:function(){return this.advancedDateTime?Math.max(Date.now()-this.advancedDateTime,0)/1e3:0}},{key:"lastPartIndex",get:function(){var I;return(I=this.partList)!==null&&I!==void 0&&I.length?this.partList[this.partList.length-1].index:-1}},{key:"lastPartSn",get:function(){var I;return(I=this.partList)!==null&&I!==void 0&&I.length?this.partList[this.partList.length-1].fragment.sn:this.endSN}}]),b}()},"./src/loader/level-key.ts":function(C,l,t){t.r(l),t.d(l,"LevelKey",function(){return F});var D=t("./node_modules/url-toolkit/src/url-toolkit.js");function g(_,b){for(var R=0;R<b.length;R++){var L=b[R];L.enumerable=L.enumerable||!1,L.configurable=!0,"value"in L&&(L.writable=!0),Object.defineProperty(_,L.key,L)}}function E(_,b,R){return b&&g(_.prototype,b),R&&g(_,R),Object.defineProperty(_,"prototype",{writable:!1}),_}var F=function(){_.fromURL=function(R,L){return new _(R,L)},_.fromURI=function(R){return new _(R)};function _(b,R){this._uri=null,this.method=null,this.keyFormat=null,this.keyFormatVersions=null,this.keyID=null,this.key=null,this.iv=null,R?this._uri=Object(D.buildAbsoluteURL)(b,R,{alwaysNormalize:!0}):this._uri=b}return E(_,[{key:"uri",get:function(){return this._uri}}]),_}()},"./src/loader/load-stats.ts":function(C,l,t){t.r(l),t.d(l,"LoadStats",function(){return D});var D=function(){this.aborted=!1,this.loaded=0,this.retry=0,this.total=0,this.chunkCount=0,this.bwEstimate=0,this.loading={start:0,first:0,end:0},this.parsing={start:0,end:0},this.buffering={start:0,first:0,end:0}}},"./src/loader/m3u8-parser.ts":function(C,l,t){t.r(l),t.d(l,"default",function(){return u});var D=t("./src/polyfills/number.ts"),g=t("./node_modules/url-toolkit/src/url-toolkit.js"),E=t("./src/loader/date-range.ts"),F=t("./src/loader/fragment.ts"),_=t("./src/loader/level-details.ts"),b=t("./src/loader/level-key.ts"),R=t("./src/utils/attr-list.ts"),L=t("./src/utils/logger.ts"),I=t("./src/utils/codecs.ts"),A=/#EXT-X-STREAM-INF:([^\r\n]*)(?:[\r\n](?:#[^\r\n]*)?)*([^\r\n]+)|#EXT-X-SESSION-DATA:([^\r\n]*)[\r\n]+/g,O=/#EXT-X-MEDIA:(.*)/g,S=new RegExp([/#EXTINF:\s*(\d*(?:\.\d+)?)(?:,(.*)\s+)?/.source,/(?!#) *(\S[\S ]*)/.source,/#EXT-X-BYTERANGE:*(.+)/.source,/#EXT-X-PROGRAM-DATE-TIME:(.+)/.source,/#.*/.source].join("|"),"g"),T=new RegExp([/#(EXTM3U)/.source,/#EXT-X-(DATERANGE|KEY|MAP|PART|PART-INF|PLAYLIST-TYPE|PRELOAD-HINT|RENDITION-REPORT|SERVER-CONTROL|SKIP|START):(.+)/.source,/#EXT-X-(BITRATE|DISCONTINUITY-SEQUENCE|MEDIA-SEQUENCE|TARGETDURATION|VERSION): *(\d+)/.source,/#EXT-X-(DISCONTINUITY|ENDLIST|GAP)/.source,/(#)([^:]*):(.*)/.source,/(#)(.*)(?:.*)\r?\n?/.source].join("|")),a=/\.(mp4|m4s|m4v|m4a)$/i;function r(m){var o,f;return a.test((o=(f=g.parseURL(m))===null||f===void 0?void 0:f.path)!=null?o:"")}var u=function(){function m(){}return m.findGroup=function(f,v){for(var c=0;c<f.length;c++){var d=f[c];if(d.id===v)return d}},m.convertAVC1ToAVCOTI=function(f){var v=f.split(".");if(v.length>2){var c=v.shift()+".";return c+=parseInt(v.shift()).toString(16),c+=("000"+parseInt(v.shift()).toString(16)).slice(-4),c}return f},m.resolve=function(f,v){return g.buildAbsoluteURL(v,f,{alwaysNormalize:!0})},m.parseMasterPlaylist=function(f,v){var c=[],d=[],x={},P=!1;A.lastIndex=0;for(var M;(M=A.exec(f))!=null;)if(M[1]){var B,N=new R.AttrList(M[1]),U={attrs:N,bitrate:N.decimalInteger("AVERAGE-BANDWIDTH")||N.decimalInteger("BANDWIDTH"),name:N.NAME,url:m.resolve(M[2],v)},w=N.decimalResolution("RESOLUTION");w&&(U.width=w.width,U.height=w.height),h((N.CODECS||"").split(/[ ,]+/).filter(function(G){return G}),U),U.videoCodec&&U.videoCodec.indexOf("avc1")!==-1&&(U.videoCodec=m.convertAVC1ToAVCOTI(U.videoCodec)),(B=U.unknownCodecs)!==null&&B!==void 0&&B.length||d.push(U),c.push(U)}else if(M[3]){var W=new R.AttrList(M[3]);W["DATA-ID"]&&(P=!0,x[W["DATA-ID"]]=W)}var j=d.length>0&&d.length<c.length;return{levels:j?d:c,sessionData:P?x:null}},m.parseMasterPlaylistMedia=function(f,v,c,d){d===void 0&&(d=[]);var x,P=[],M=0;for(O.lastIndex=0;(x=O.exec(f))!==null;){var B=new R.AttrList(x[1]);if(B.TYPE===c){var N={attrs:B,bitrate:0,id:M++,groupId:B["GROUP-ID"],instreamId:B["INSTREAM-ID"],name:B.NAME||B.LANGUAGE||"",type:c,default:B.bool("DEFAULT"),autoselect:B.bool("AUTOSELECT"),forced:B.bool("FORCED"),lang:B.LANGUAGE,url:B.URI?m.resolve(B.URI,v):""};if(d.length){var U=m.findGroup(d,N.groupId)||d[0];y(N,U,"audioCodec"),y(N,U,"textCodec")}P.push(N)}}return P},m.parseLevelPlaylist=function(f,v,c,d,x){var P=new _.LevelDetails(v),M=P.fragments,B=null,N=0,U=0,w=0,W=0,j=null,G=new F.Fragment(d,v),H,$,te,q=-1,ne=!1;for(S.lastIndex=0,P.m3u8=f;(H=S.exec(f))!==null;){ne&&(ne=!1,G=new F.Fragment(d,v),G.start=w,G.sn=N,G.cc=W,G.level=c,B&&(G.initSegment=B,G.rawProgramDateTime=B.rawProgramDateTime,B.rawProgramDateTime=null));var oe=H[1];if(oe){G.duration=parseFloat(oe);var k=(" "+H[2]).slice(1);G.title=k||null,G.tagList.push(k?["INF",oe,k]:["INF",oe])}else if(H[3])Object(D.isFiniteNumber)(G.duration)&&(G.start=w,te&&(G.levelkey=te),G.sn=N,G.level=c,G.cc=W,G.urlId=x,M.push(G),G.relurl=(" "+H[3]).slice(1),n(G,j),j=G,w+=G.duration,N++,U=0,ne=!0);else if(H[4]){var K=(" "+H[4]).slice(1);j?G.setByteRange(K,j):G.setByteRange(K)}else if(H[5])G.rawProgramDateTime=(" "+H[5]).slice(1),G.tagList.push(["PROGRAM-DATE-TIME",G.rawProgramDateTime]),q===-1&&(q=M.length);else{if(H=H[0].match(T),!H){L.logger.warn("No matches on slow regex match for level playlist!");continue}for($=1;$<H.length&&!(typeof H[$]<"u");$++);var V=(" "+H[$]).slice(1),Y=(" "+H[$+1]).slice(1),z=H[$+2]?(" "+H[$+2]).slice(1):"";switch(V){case"PLAYLIST-TYPE":P.type=Y.toUpperCase();break;case"MEDIA-SEQUENCE":N=P.startSN=parseInt(Y);break;case"SKIP":{var Q=new R.AttrList(Y),Z=Q.decimalInteger("SKIPPED-SEGMENTS");if(Object(D.isFiniteNumber)(Z)){P.skippedSegments=Z;for(var J=Z;J--;)M.unshift(null);N+=Z}var ee=Q.enumeratedString("RECENTLY-REMOVED-DATERANGES");ee&&(P.recentlyRemovedDateranges=ee.split("	"));break}case"TARGETDURATION":P.targetduration=parseFloat(Y);break;case"VERSION":P.version=parseInt(Y);break;case"EXTM3U":break;case"ENDLIST":P.live=!1;break;case"#":(Y||z)&&G.tagList.push(z?[Y,z]:[Y]);break;case"DISCONTINUITY":W++,G.tagList.push(["DIS"]);break;case"GAP":G.tagList.push([V]);break;case"BITRATE":G.tagList.push([V,Y]);break;case"DATERANGE":{var X=new R.AttrList(Y),se=new E.DateRange(X,P.dateRanges[X.ID]);se.isValid||P.skippedSegments?P.dateRanges[se.id]=se:L.logger.warn('Ignoring invalid DATERANGE tag: "'+Y+'"'),G.tagList.push(["EXT-X-DATERANGE",Y]);break}case"DISCONTINUITY-SEQUENCE":W=parseInt(Y);break;case"KEY":{var re,ie=new R.AttrList(Y),ae=ie.enumeratedString("METHOD"),le=ie.URI,de=ie.hexadecimalInteger("IV"),ue=ie.enumeratedString("KEYFORMATVERSIONS"),he=ie.enumeratedString("KEYID"),Te=(re=ie.enumeratedString("KEYFORMAT"))!=null?re:"identity",Le=["com.apple.streamingkeydelivery","com.microsoft.playready","urn:uuid:edef8ba9-79d6-4ace-a3c8-27dcd51d21ed","com.widevine"];if(Le.indexOf(Te)>-1){L.logger.warn("Keyformat "+Te+" is not supported from the manifest");continue}else if(Te!=="identity")continue;ae&&(te=b.LevelKey.fromURL(v,le),le&&["AES-128","SAMPLE-AES","SAMPLE-AES-CENC"].indexOf(ae)>=0&&(te.method=ae,te.keyFormat=Te,he&&(te.keyID=he),ue&&(te.keyFormatVersions=ue),te.iv=de));break}case"START":{var we=new R.AttrList(Y),pe=we.decimalFloatingPoint("TIME-OFFSET");Object(D.isFiniteNumber)(pe)&&(P.startTimeOffset=pe);break}case"MAP":{var De=new R.AttrList(Y);if(G.duration){var Ee=new F.Fragment(d,v);i(Ee,De,c,te),B=Ee,G.initSegment=B,B.rawProgramDateTime&&!G.rawProgramDateTime&&(G.rawProgramDateTime=B.rawProgramDateTime)}else i(G,De,c,te),B=G,ne=!0;break}case"SERVER-CONTROL":{var ge=new R.AttrList(Y);P.canBlockReload=ge.bool("CAN-BLOCK-RELOAD"),P.canSkipUntil=ge.optionalFloat("CAN-SKIP-UNTIL",0),P.canSkipDateRanges=P.canSkipUntil>0&&ge.bool("CAN-SKIP-DATERANGES"),P.partHoldBack=ge.optionalFloat("PART-HOLD-BACK",0),P.holdBack=ge.optionalFloat("HOLD-BACK",0);break}case"PART-INF":{var Ae=new R.AttrList(Y);P.partTarget=Ae.decimalFloatingPoint("PART-TARGET");break}case"PART":{var Ue=P.partList;Ue||(Ue=P.partList=[]);var et=U>0?Ue[Ue.length-1]:void 0,ht=U++,Dt=new F.Part(new R.AttrList(Y),G,v,ht,et);Ue.push(Dt),G.duration+=Dt.duration;break}case"PRELOAD-HINT":{var $e=new R.AttrList(Y);P.preloadHint=$e;break}case"RENDITION-REPORT":{var Dr=new R.AttrList(Y);P.renditionReports=P.renditionReports||[],P.renditionReports.push(Dr);break}default:L.logger.warn("line parsed but not handled: "+H);break}}}j&&!j.relurl?(M.pop(),w-=j.duration,P.partList&&(P.fragmentHint=j)):P.partList&&(n(G,j),G.cc=W,P.fragmentHint=G);var vt=M.length,tt=M[0],At=M[vt-1];if(w+=P.skippedSegments*P.targetduration,w>0&&vt&&At){P.averagetargetduration=w/vt;var gt=At.sn;P.endSN=gt!=="initSegment"?gt:0,tt&&(P.startCC=tt.cc,tt.initSegment||P.fragments.every(function($t){return $t.relurl&&r($t.relurl)})&&(L.logger.warn("MP4 fragments found but no init segment (probably no MAP, incomplete M3U8), trying to fetch SIDX"),G=new F.Fragment(d,v),G.relurl=At.relurl,G.level=c,G.sn="initSegment",tt.initSegment=G,P.needSidxRanges=!0))}else P.endSN=0,P.startCC=0;return P.fragmentHint&&(w+=P.fragmentHint.duration),P.totalduration=w,P.endCC=W,q>0&&s(M,q),P},m}();function h(m,o){["video","audio","text"].forEach(function(f){var v=m.filter(function(d){return Object(I.isCodecType)(d,f)});if(v.length){var c=v.filter(function(d){return d.lastIndexOf("avc1",0)===0||d.lastIndexOf("mp4a",0)===0});o[f+"Codec"]=c.length>0?c[0]:v[0],m=m.filter(function(d){return v.indexOf(d)===-1})}}),o.unknownCodecs=m}function y(m,o,f){var v=o[f];v&&(m[f]=v)}function s(m,o){for(var f=m[o],v=o;v--;){var c=m[v];if(!c)return;c.programDateTime=f.programDateTime-c.duration*1e3,f=c}}function n(m,o){m.rawProgramDateTime?m.programDateTime=Date.parse(m.rawProgramDateTime):o!=null&&o.programDateTime&&(m.programDateTime=o.endProgramDateTime),Object(D.isFiniteNumber)(m.programDateTime)||(m.programDateTime=null,m.rawProgramDateTime=null)}function i(m,o,f,v){m.relurl=o.URI,o.BYTERANGE&&m.setByteRange(o.BYTERANGE),m.level=f,m.sn="initSegment",v&&(m.levelkey=v),m.initSegment=null}},"./src/loader/playlist-loader.ts":function(C,l,t){t.r(l);var D=t("./src/polyfills/number.ts"),g=t("./src/events.ts"),E=t("./src/errors.ts"),F=t("./src/utils/logger.ts"),_=t("./src/utils/mp4-tools.ts"),b=t("./src/loader/m3u8-parser.ts"),R=t("./src/types/loader.ts"),L=t("./src/utils/attr-list.ts");function I(S){var T=S.type;switch(T){case R.PlaylistContextType.AUDIO_TRACK:return R.PlaylistLevelType.AUDIO;case R.PlaylistContextType.SUBTITLE_TRACK:return R.PlaylistLevelType.SUBTITLE;default:return R.PlaylistLevelType.MAIN}}function A(S,T){var a=S.url;return(a===void 0||a.indexOf("data:")===0)&&(a=T.url),a}var O=function(){function S(a){this.hls=void 0,this.loaders=Object.create(null),this.hls=a,this.registerListeners()}var T=S.prototype;return T.startLoad=function(r){},T.stopLoad=function(){this.destroyInternalLoaders()},T.registerListeners=function(){var r=this.hls;r.on(g.Events.MANIFEST_LOADING,this.onManifestLoading,this),r.on(g.Events.LEVEL_LOADING,this.onLevelLoading,this),r.on(g.Events.AUDIO_TRACK_LOADING,this.onAudioTrackLoading,this),r.on(g.Events.SUBTITLE_TRACK_LOADING,this.onSubtitleTrackLoading,this)},T.unregisterListeners=function(){var r=this.hls;r.off(g.Events.MANIFEST_LOADING,this.onManifestLoading,this),r.off(g.Events.LEVEL_LOADING,this.onLevelLoading,this),r.off(g.Events.AUDIO_TRACK_LOADING,this.onAudioTrackLoading,this),r.off(g.Events.SUBTITLE_TRACK_LOADING,this.onSubtitleTrackLoading,this)},T.createInternalLoader=function(r){var u=this.hls.config,h=u.pLoader,y=u.loader,s=h||y,n=new s(u);return r.loader=n,this.loaders[r.type]=n,n},T.getInternalLoader=function(r){return this.loaders[r.type]},T.resetInternalLoader=function(r){this.loaders[r]&&delete this.loaders[r]},T.destroyInternalLoaders=function(){for(var r in this.loaders){var u=this.loaders[r];u&&u.destroy(),this.resetInternalLoader(r)}},T.destroy=function(){this.unregisterListeners(),this.destroyInternalLoaders()},T.onManifestLoading=function(r,u){var h=u.url;this.load({id:null,groupId:null,level:0,responseType:"text",type:R.PlaylistContextType.MANIFEST,url:h,deliveryDirectives:null})},T.onLevelLoading=function(r,u){var h=u.id,y=u.level,s=u.url,n=u.deliveryDirectives;this.load({id:h,groupId:null,level:y,responseType:"text",type:R.PlaylistContextType.LEVEL,url:s,deliveryDirectives:n})},T.onAudioTrackLoading=function(r,u){var h=u.id,y=u.groupId,s=u.url,n=u.deliveryDirectives;this.load({id:h,groupId:y,level:null,responseType:"text",type:R.PlaylistContextType.AUDIO_TRACK,url:s,deliveryDirectives:n})},T.onSubtitleTrackLoading=function(r,u){var h=u.id,y=u.groupId,s=u.url,n=u.deliveryDirectives;this.load({id:h,groupId:y,level:null,responseType:"text",type:R.PlaylistContextType.SUBTITLE_TRACK,url:s,deliveryDirectives:n})},T.load=function(r){var u,h=this.hls.config,y=this.getInternalLoader(r);if(y){var s=y.context;if(s&&s.url===r.url){F.logger.trace("[playlist-loader]: playlist request ongoing");return}F.logger.log("[playlist-loader]: aborting previous loader for type: "+r.type),y.abort()}var n,i,m,o;switch(r.type){case R.PlaylistContextType.MANIFEST:n=h.manifestLoadingMaxRetry,i=h.manifestLoadingTimeOut,m=h.manifestLoadingRetryDelay,o=h.manifestLoadingMaxRetryTimeout;break;case R.PlaylistContextType.LEVEL:case R.PlaylistContextType.AUDIO_TRACK:case R.PlaylistContextType.SUBTITLE_TRACK:n=0,i=h.levelLoadingTimeOut;break;default:n=h.levelLoadingMaxRetry,i=h.levelLoadingTimeOut,m=h.levelLoadingRetryDelay,o=h.levelLoadingMaxRetryTimeout;break}if(y=this.createInternalLoader(r),(u=r.deliveryDirectives)!==null&&u!==void 0&&u.part){var f;if(r.type===R.PlaylistContextType.LEVEL&&r.level!==null?f=this.hls.levels[r.level].details:r.type===R.PlaylistContextType.AUDIO_TRACK&&r.id!==null?f=this.hls.audioTracks[r.id].details:r.type===R.PlaylistContextType.SUBTITLE_TRACK&&r.id!==null&&(f=this.hls.subtitleTracks[r.id].details),f){var v=f.partTarget,c=f.targetduration;v&&c&&(i=Math.min(Math.max(v*3,c*.8)*1e3,i))}}var d={timeout:i,maxRetry:n,retryDelay:m,maxRetryDelay:o,highWaterMark:0},x={onSuccess:this.loadsuccess.bind(this),onError:this.loaderror.bind(this),onTimeout:this.loadtimeout.bind(this)};y.load(r,d,x)},T.loadsuccess=function(r,u,h,y){if(y===void 0&&(y=null),h.isSidxRequest){this.handleSidxRequest(r,h),this.handlePlaylistLoaded(r,u,h,y);return}this.resetInternalLoader(h.type);var s=r.data;if(s.indexOf("#EXTM3U")!==0){this.handleManifestParsingError(r,h,"no EXTM3U delimiter",y);return}u.parsing.start=performance.now(),s.indexOf("#EXTINF:")>0||s.indexOf("#EXT-X-TARGETDURATION:")>0?this.handleTrackOrLevelPlaylist(r,u,h,y):this.handleMasterPlaylist(r,u,h,y)},T.loaderror=function(r,u,h){h===void 0&&(h=null),this.handleNetworkError(u,h,!1,r)},T.loadtimeout=function(r,u,h){h===void 0&&(h=null),this.handleNetworkError(u,h,!0)},T.handleMasterPlaylist=function(r,u,h,y){var s=this.hls,n=r.data,i=A(r,h),m=b.default.parseMasterPlaylist(n,i),o=m.levels,f=m.sessionData;if(!o.length){this.handleManifestParsingError(r,h,"no level found in manifest",y);return}var v=o.map(function(B){return{id:B.attrs.AUDIO,audioCodec:B.audioCodec}}),c=o.map(function(B){return{id:B.attrs.SUBTITLES,textCodec:B.textCodec}}),d=b.default.parseMasterPlaylistMedia(n,i,"AUDIO",v),x=b.default.parseMasterPlaylistMedia(n,i,"SUBTITLES",c),P=b.default.parseMasterPlaylistMedia(n,i,"CLOSED-CAPTIONS");if(d.length){var M=d.some(function(B){return!B.url});!M&&o[0].audioCodec&&!o[0].attrs.AUDIO&&(F.logger.log("[playlist-loader]: audio codec signaled in quality level, but no embedded audio track signaled, create one"),d.unshift({type:"main",name:"main",default:!1,autoselect:!1,forced:!1,id:-1,attrs:new L.AttrList({}),bitrate:0,url:""}))}s.trigger(g.Events.MANIFEST_LOADED,{levels:o,audioTracks:d,subtitles:x,captions:P,url:i,stats:u,networkDetails:y,sessionData:f})},T.handleTrackOrLevelPlaylist=function(r,u,h,y){var s=this.hls,n=h.id,i=h.level,m=h.type,o=A(r,h),f=Object(D.isFiniteNumber)(n)?n:0,v=Object(D.isFiniteNumber)(i)?i:f,c=I(h),d=b.default.parseLevelPlaylist(r.data,o,v,c,f);if(!d.fragments.length){s.trigger(g.Events.ERROR,{type:E.ErrorTypes.NETWORK_ERROR,details:E.ErrorDetails.LEVEL_EMPTY_ERROR,fatal:!1,url:o,reason:"no fragments found in level",level:typeof h.level=="number"?h.level:void 0});return}if(m===R.PlaylistContextType.MANIFEST){var x={attrs:new L.AttrList({}),bitrate:0,details:d,name:"",url:o};s.trigger(g.Events.MANIFEST_LOADED,{levels:[x],audioTracks:[],url:o,stats:u,networkDetails:y,sessionData:null})}if(u.parsing.end=performance.now(),d.needSidxRanges){var P,M=(P=d.fragments[0].initSegment)===null||P===void 0?void 0:P.url;this.load({url:M,isSidxRequest:!0,type:m,level:i,levelDetails:d,id:n,groupId:null,rangeStart:0,rangeEnd:2048,responseType:"arraybuffer",deliveryDirectives:null});return}h.levelDetails=d,this.handlePlaylistLoaded(r,u,h,y)},T.handleSidxRequest=function(r,u){var h=new Uint8Array(r.data),y=Object(_.findBox)(h,["sidx"])[0];if(!!y){var s=Object(_.parseSegmentIndex)(y);if(!!s){var n=s.references,i=u.levelDetails;n.forEach(function(m,o){var f=m.info,v=i.fragments[o];if(v.byteRange.length===0&&v.setByteRange(String(1+f.end-f.start)+"@"+String(f.start)),v.initSegment){var c=Object(_.findBox)(h,["moov"])[0],d=c?c.length:null;v.initSegment.setByteRange(String(d)+"@0")}})}}},T.handleManifestParsingError=function(r,u,h,y){this.hls.trigger(g.Events.ERROR,{type:E.ErrorTypes.NETWORK_ERROR,details:E.ErrorDetails.MANIFEST_PARSING_ERROR,fatal:u.type===R.PlaylistContextType.MANIFEST,url:r.url,reason:h,response:r,context:u,networkDetails:y})},T.handleNetworkError=function(r,u,h,y){h===void 0&&(h=!1),F.logger.warn("[playlist-loader]: A network "+(h?"timeout":"error")+" occurred while loading "+r.type+" level: "+r.level+" id: "+r.id+' group-id: "'+r.groupId+'"');var s=E.ErrorDetails.UNKNOWN,n=!1,i=this.getInternalLoader(r);switch(r.type){case R.PlaylistContextType.MANIFEST:s=h?E.ErrorDetails.MANIFEST_LOAD_TIMEOUT:E.ErrorDetails.MANIFEST_LOAD_ERROR,n=!0;break;case R.PlaylistContextType.LEVEL:s=h?E.ErrorDetails.LEVEL_LOAD_TIMEOUT:E.ErrorDetails.LEVEL_LOAD_ERROR,n=!1;break;case R.PlaylistContextType.AUDIO_TRACK:s=h?E.ErrorDetails.AUDIO_TRACK_LOAD_TIMEOUT:E.ErrorDetails.AUDIO_TRACK_LOAD_ERROR,n=!1;break;case R.PlaylistContextType.SUBTITLE_TRACK:s=h?E.ErrorDetails.SUBTITLE_TRACK_LOAD_TIMEOUT:E.ErrorDetails.SUBTITLE_LOAD_ERROR,n=!1;break}i&&this.resetInternalLoader(r.type);var m={type:E.ErrorTypes.NETWORK_ERROR,details:s,fatal:n,url:r.url,loader:i,context:r,networkDetails:u};y&&(m.response=y),this.hls.trigger(g.Events.ERROR,m)},T.handlePlaylistLoaded=function(r,u,h,y){var s=h.type,n=h.level,i=h.id,m=h.groupId,o=h.loader,f=h.levelDetails,v=h.deliveryDirectives;if(!(f!=null&&f.targetduration)){this.handleManifestParsingError(r,h,"invalid target duration",y);return}if(!!o)switch(f.live&&(o.getCacheAge&&(f.ageHeader=o.getCacheAge()||0),(!o.getCacheAge||isNaN(f.ageHeader))&&(f.ageHeader=0)),s){case R.PlaylistContextType.MANIFEST:case R.PlaylistContextType.LEVEL:this.hls.trigger(g.Events.LEVEL_LOADED,{details:f,level:n||0,id:i||0,stats:u,networkDetails:y,deliveryDirectives:v});break;case R.PlaylistContextType.AUDIO_TRACK:this.hls.trigger(g.Events.AUDIO_TRACK_LOADED,{details:f,id:i||0,groupId:m||"",stats:u,networkDetails:y,deliveryDirectives:v});break;case R.PlaylistContextType.SUBTITLE_TRACK:this.hls.trigger(g.Events.SUBTITLE_TRACK_LOADED,{details:f,id:i||0,groupId:m||"",stats:u,networkDetails:y,deliveryDirectives:v});break}},S}();l.default=O},"./src/polyfills/number.ts":function(C,l,t){t.r(l),t.d(l,"isFiniteNumber",function(){return D}),t.d(l,"MAX_SAFE_INTEGER",function(){return g});var D=Number.isFinite||function(E){return typeof E=="number"&&isFinite(E)},g=Number.MAX_SAFE_INTEGER||9007199254740991},"./src/remux/aac-helper.ts":function(C,l,t){t.r(l);var D=function(){function g(){}return g.getSilentFrame=function(F,_){switch(F){case"mp4a.40.2":if(_===1)return new Uint8Array([0,200,0,128,35,128]);if(_===2)return new Uint8Array([33,0,73,144,2,25,0,35,128]);if(_===3)return new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,142]);if(_===4)return new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,128,44,128,8,2,56]);if(_===5)return new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,130,48,4,153,0,33,144,2,56]);if(_===6)return new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,130,48,4,153,0,33,144,2,0,178,0,32,8,224]);break;default:if(_===1)return new Uint8Array([1,64,34,128,163,78,230,128,186,8,0,0,0,28,6,241,193,10,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,94]);if(_===2)return new Uint8Array([1,64,34,128,163,94,230,128,186,8,0,0,0,0,149,0,6,241,161,10,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,94]);if(_===3)return new Uint8Array([1,64,34,128,163,94,230,128,186,8,0,0,0,0,149,0,6,241,161,10,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,94]);break}},g}();l.default=D},"./src/remux/mp4-generator.ts":function(C,l,t){t.r(l);var D=Math.pow(2,32)-1,g=function(){function E(){}return E.init=function(){E.types={avc1:[],avcC:[],btrt:[],dinf:[],dref:[],esds:[],ftyp:[],hdlr:[],mdat:[],mdhd:[],mdia:[],mfhd:[],minf:[],moof:[],moov:[],mp4a:[],".mp3":[],mvex:[],mvhd:[],pasp:[],sdtp:[],stbl:[],stco:[],stsc:[],stsd:[],stsz:[],stts:[],tfdt:[],tfhd:[],traf:[],trak:[],trun:[],trex:[],tkhd:[],vmhd:[],smhd:[]};var _;for(_ in E.types)E.types.hasOwnProperty(_)&&(E.types[_]=[_.charCodeAt(0),_.charCodeAt(1),_.charCodeAt(2),_.charCodeAt(3)]);var b=new Uint8Array([0,0,0,0,0,0,0,0,118,105,100,101,0,0,0,0,0,0,0,0,0,0,0,0,86,105,100,101,111,72,97,110,100,108,101,114,0]),R=new Uint8Array([0,0,0,0,0,0,0,0,115,111,117,110,0,0,0,0,0,0,0,0,0,0,0,0,83,111,117,110,100,72,97,110,100,108,101,114,0]);E.HDLR_TYPES={video:b,audio:R};var L=new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,12,117,114,108,32,0,0,0,1]),I=new Uint8Array([0,0,0,0,0,0,0,0]);E.STTS=E.STSC=E.STCO=I,E.STSZ=new Uint8Array([0,0,0,0,0,0,0,0,0,0,0,0]),E.VMHD=new Uint8Array([0,0,0,1,0,0,0,0,0,0,0,0]),E.SMHD=new Uint8Array([0,0,0,0,0,0,0,0]),E.STSD=new Uint8Array([0,0,0,0,0,0,0,1]);var A=new Uint8Array([105,115,111,109]),O=new Uint8Array([97,118,99,49]),S=new Uint8Array([0,0,0,1]);E.FTYP=E.box(E.types.ftyp,A,S,A,O),E.DINF=E.box(E.types.dinf,E.box(E.types.dref,L))},E.box=function(_){for(var b=8,R=arguments.length,L=new Array(R>1?R-1:0),I=1;I<R;I++)L[I-1]=arguments[I];for(var A=L.length,O=A;A--;)b+=L[A].byteLength;var S=new Uint8Array(b);for(S[0]=b>>24&255,S[1]=b>>16&255,S[2]=b>>8&255,S[3]=b&255,S.set(_,4),A=0,b=8;A<O;A++)S.set(L[A],b),b+=L[A].byteLength;return S},E.hdlr=function(_){return E.box(E.types.hdlr,E.HDLR_TYPES[_])},E.mdat=function(_){return E.box(E.types.mdat,_)},E.mdhd=function(_,b){b*=_;var R=Math.floor(b/(D+1)),L=Math.floor(b%(D+1));return E.box(E.types.mdhd,new Uint8Array([1,0,0,0,0,0,0,0,0,0,0,2,0,0,0,0,0,0,0,3,_>>24&255,_>>16&255,_>>8&255,_&255,R>>24,R>>16&255,R>>8&255,R&255,L>>24,L>>16&255,L>>8&255,L&255,85,196,0,0]))},E.mdia=function(_){return E.box(E.types.mdia,E.mdhd(_.timescale,_.duration),E.hdlr(_.type),E.minf(_))},E.mfhd=function(_){return E.box(E.types.mfhd,new Uint8Array([0,0,0,0,_>>24,_>>16&255,_>>8&255,_&255]))},E.minf=function(_){return _.type==="audio"?E.box(E.types.minf,E.box(E.types.smhd,E.SMHD),E.DINF,E.stbl(_)):E.box(E.types.minf,E.box(E.types.vmhd,E.VMHD),E.DINF,E.stbl(_))},E.moof=function(_,b,R){return E.box(E.types.moof,E.mfhd(_),E.traf(R,b))},E.moov=function(_){for(var b=_.length,R=[];b--;)R[b]=E.trak(_[b]);return E.box.apply(null,[E.types.moov,E.mvhd(_[0].timescale,_[0].duration)].concat(R).concat(E.mvex(_)))},E.mvex=function(_){for(var b=_.length,R=[];b--;)R[b]=E.trex(_[b]);return E.box.apply(null,[E.types.mvex].concat(R))},E.mvhd=function(_,b){b*=_;var R=Math.floor(b/(D+1)),L=Math.floor(b%(D+1)),I=new Uint8Array([1,0,0,0,0,0,0,0,0,0,0,2,0,0,0,0,0,0,0,3,_>>24&255,_>>16&255,_>>8&255,_&255,R>>24,R>>16&255,R>>8&255,R&255,L>>24,L>>16&255,L>>8&255,L&255,0,1,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,64,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,255,255,255,255]);return E.box(E.types.mvhd,I)},E.sdtp=function(_){var b=_.samples||[],R=new Uint8Array(4+b.length),L,I;for(L=0;L<b.length;L++)I=b[L].flags,R[L+4]=I.dependsOn<<4|I.isDependedOn<<2|I.hasRedundancy;return E.box(E.types.sdtp,R)},E.stbl=function(_){return E.box(E.types.stbl,E.stsd(_),E.box(E.types.stts,E.STTS),E.box(E.types.stsc,E.STSC),E.box(E.types.stsz,E.STSZ),E.box(E.types.stco,E.STCO))},E.avc1=function(_){var b=[],R=[],L,I,A;for(L=0;L<_.sps.length;L++)I=_.sps[L],A=I.byteLength,b.push(A>>>8&255),b.push(A&255),b=b.concat(Array.prototype.slice.call(I));for(L=0;L<_.pps.length;L++)I=_.pps[L],A=I.byteLength,R.push(A>>>8&255),R.push(A&255),R=R.concat(Array.prototype.slice.call(I));var O=E.box(E.types.avcC,new Uint8Array([1,b[3],b[4],b[5],255,224|_.sps.length].concat(b).concat([_.pps.length]).concat(R))),S=_.width,T=_.height,a=_.pixelRatio[0],r=_.pixelRatio[1];return E.box(E.types.avc1,new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,S>>8&255,S&255,T>>8&255,T&255,0,72,0,0,0,72,0,0,0,0,0,0,0,1,18,100,97,105,108,121,109,111,116,105,111,110,47,104,108,115,46,106,115,0,0,0,0,0,0,0,0,0,0,0,0,0,0,24,17,17]),O,E.box(E.types.btrt,new Uint8Array([0,28,156,128,0,45,198,192,0,45,198,192])),E.box(E.types.pasp,new Uint8Array([a>>24,a>>16&255,a>>8&255,a&255,r>>24,r>>16&255,r>>8&255,r&255])))},E.esds=function(_){var b=_.config.length;return new Uint8Array([0,0,0,0,3,23+b,0,1,0,4,15+b,64,21,0,0,0,0,0,0,0,0,0,0,0,5].concat([b]).concat(_.config).concat([6,1,2]))},E.mp4a=function(_){var b=_.samplerate;return E.box(E.types.mp4a,new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,_.channelCount,0,16,0,0,0,0,b>>8&255,b&255,0,0]),E.box(E.types.esds,E.esds(_)))},E.mp3=function(_){var b=_.samplerate;return E.box(E.types[".mp3"],new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,_.channelCount,0,16,0,0,0,0,b>>8&255,b&255,0,0]))},E.stsd=function(_){return _.type==="audio"?_.segmentCodec==="mp3"&&_.codec==="mp3"?E.box(E.types.stsd,E.STSD,E.mp3(_)):E.box(E.types.stsd,E.STSD,E.mp4a(_)):E.box(E.types.stsd,E.STSD,E.avc1(_))},E.tkhd=function(_){var b=_.id,R=_.duration*_.timescale,L=_.width,I=_.height,A=Math.floor(R/(D+1)),O=Math.floor(R%(D+1));return E.box(E.types.tkhd,new Uint8Array([1,0,0,7,0,0,0,0,0,0,0,2,0,0,0,0,0,0,0,3,b>>24&255,b>>16&255,b>>8&255,b&255,0,0,0,0,A>>24,A>>16&255,A>>8&255,A&255,O>>24,O>>16&255,O>>8&255,O&255,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,64,0,0,0,L>>8&255,L&255,0,0,I>>8&255,I&255,0,0]))},E.traf=function(_,b){var R=E.sdtp(_),L=_.id,I=Math.floor(b/(D+1)),A=Math.floor(b%(D+1));return E.box(E.types.traf,E.box(E.types.tfhd,new Uint8Array([0,0,0,0,L>>24,L>>16&255,L>>8&255,L&255])),E.box(E.types.tfdt,new Uint8Array([1,0,0,0,I>>24,I>>16&255,I>>8&255,I&255,A>>24,A>>16&255,A>>8&255,A&255])),E.trun(_,R.length+16+20+8+16+8+8),R)},E.trak=function(_){return _.duration=_.duration||4294967295,E.box(E.types.trak,E.tkhd(_),E.mdia(_))},E.trex=function(_){var b=_.id;return E.box(E.types.trex,new Uint8Array([0,0,0,0,b>>24,b>>16&255,b>>8&255,b&255,0,0,0,1,0,0,0,0,0,0,0,0,0,1,0,1]))},E.trun=function(_,b){var R=_.samples||[],L=R.length,I=12+16*L,A=new Uint8Array(I),O,S,T,a,r,u;for(b+=8+I,A.set([_.type==="video"?1:0,0,15,1,L>>>24&255,L>>>16&255,L>>>8&255,L&255,b>>>24&255,b>>>16&255,b>>>8&255,b&255],0),O=0;O<L;O++)S=R[O],T=S.duration,a=S.size,r=S.flags,u=S.cts,A.set([T>>>24&255,T>>>16&255,T>>>8&255,T&255,a>>>24&255,a>>>16&255,a>>>8&255,a&255,r.isLeading<<2|r.dependsOn,r.isDependedOn<<6|r.hasRedundancy<<4|r.paddingValue<<1|r.isNonSync,r.degradPrio&240<<8,r.degradPrio&15,u>>>24&255,u>>>16&255,u>>>8&255,u&255],12+16*O);return E.box(E.types.trun,A)},E.initSegment=function(_){E.types||E.init();var b=E.moov(_),R=new Uint8Array(E.FTYP.byteLength+b.byteLength);return R.set(E.FTYP),R.set(b,E.FTYP.byteLength),R},E}();g.types=void 0,g.HDLR_TYPES=void 0,g.STTS=void 0,g.STSC=void 0,g.STCO=void 0,g.STSZ=void 0,g.VMHD=void 0,g.SMHD=void 0,g.STSD=void 0,g.FTYP=void 0,g.DINF=void 0,l.default=g},"./src/remux/mp4-remuxer.ts":function(C,l,t){t.r(l),t.d(l,"default",function(){return r}),t.d(l,"normalizePts",function(){return u}),t.d(l,"flushTextTrackMetadataCueSamples",function(){return y}),t.d(l,"flushTextTrackUserdataCueSamples",function(){return s});var D=t("./src/polyfills/number.ts"),g=t("./src/remux/aac-helper.ts"),E=t("./src/remux/mp4-generator.ts"),F=t("./src/events.ts"),_=t("./src/errors.ts"),b=t("./src/utils/logger.ts"),R=t("./src/types/loader.ts"),L=t("./src/utils/timescale-conversion.ts");function I(){return I=Object.assign?Object.assign.bind():function(m){for(var o=1;o<arguments.length;o++){var f=arguments[o];for(var v in f)Object.prototype.hasOwnProperty.call(f,v)&&(m[v]=f[v])}return m},I.apply(this,arguments)}var A=10*1e3,O=1024,S=1152,T=null,a=null,r=function(){function m(f,v,c,d){if(this.observer=void 0,this.config=void 0,this.typeSupported=void 0,this.ISGenerated=!1,this._initPTS=void 0,this._initDTS=void 0,this.nextAvcDts=null,this.nextAudioPts=null,this.videoSampleDuration=null,this.isAudioContiguous=!1,this.isVideoContiguous=!1,this.observer=f,this.config=v,this.typeSupported=c,this.ISGenerated=!1,T===null){var x=navigator.userAgent||"",P=x.match(/Chrome\/(\d+)/i);T=P?parseInt(P[1]):0}if(a===null){var M=navigator.userAgent.match(/Safari\/(\d+)/i);a=M?parseInt(M[1]):0}}var o=m.prototype;return o.destroy=function(){},o.resetTimeStamp=function(v){b.logger.log("[mp4-remuxer]: initPTS & initDTS reset"),this._initPTS=this._initDTS=v},o.resetNextTimestamp=function(){b.logger.log("[mp4-remuxer]: reset next timestamp"),this.isVideoContiguous=!1,this.isAudioContiguous=!1},o.resetInitSegment=function(){b.logger.log("[mp4-remuxer]: ISGenerated flag reset"),this.ISGenerated=!1},o.getVideoStartPts=function(v){var c=!1,d=v.reduce(function(x,P){var M=P.pts-x;return M<-4294967296?(c=!0,u(x,P.pts)):M>0?x:P.pts},v[0].pts);return c&&b.logger.debug("PTS rollover detected"),d},o.remux=function(v,c,d,x,P,M,B,N){var U,w,W,j,G,H,$=P,te=P,q=v.pid>-1,ne=c.pid>-1,oe=c.samples.length,k=v.samples.length>0,K=B&&oe>0||oe>1,V=(!q||k)&&(!ne||K)||this.ISGenerated||B;if(V){this.ISGenerated||(W=this.generateIS(v,c,P));var Y=this.isVideoContiguous,z=-1,Q;if(K&&(z=h(c.samples),!Y&&this.config.forceKeyFrameOnDiscontinuity))if(H=!0,z>0){b.logger.warn("[mp4-remuxer]: Dropped "+z+" out of "+oe+" video samples due to a missing keyframe");var Z=this.getVideoStartPts(c.samples);c.samples=c.samples.slice(z),c.dropped+=z,te+=(c.samples[0].pts-Z)/c.inputTimeScale,Q=te}else z===-1&&(b.logger.warn("[mp4-remuxer]: No keyframe found out of "+oe+" video samples"),H=!1);if(this.ISGenerated){if(k&&K){var J=this.getVideoStartPts(c.samples),ee=u(v.samples[0].pts,J)-J,X=ee/c.inputTimeScale;$+=Math.max(0,X),te+=Math.max(0,-X)}if(k){if(v.samplerate||(b.logger.warn("[mp4-remuxer]: regenerate InitSegment as audio detected"),W=this.generateIS(v,c,P)),w=this.remuxAudio(v,$,this.isAudioContiguous,M,ne||K||N===R.PlaylistLevelType.AUDIO?te:void 0),K){var se=w?w.endPTS-w.startPTS:0;c.inputTimeScale||(b.logger.warn("[mp4-remuxer]: regenerate InitSegment as video detected"),W=this.generateIS(v,c,P)),U=this.remuxVideo(c,te,Y,se)}}else K&&(U=this.remuxVideo(c,te,Y,0));U&&(U.firstKeyFrame=z,U.independent=z!==-1,U.firstKeyFramePTS=Q)}}return this.ISGenerated&&(d.samples.length&&(G=y(d,P,this._initPTS,this._initDTS)),x.samples.length&&(j=s(x,P,this._initPTS))),{audio:w,video:U,initSegment:W,independent:H,text:j,id3:G}},o.generateIS=function(v,c,d){var x=v.samples,P=c.samples,M=this.typeSupported,B={},N=!Object(D.isFiniteNumber)(this._initPTS),U="audio/mp4",w,W,j;if(N&&(w=W=1/0),v.config&&x.length){switch(v.timescale=v.samplerate,v.segmentCodec){case"mp3":M.mpeg?(U="audio/mpeg",v.codec=""):M.mp3&&(v.codec="mp3");break}B.audio={id:"audio",container:U,codec:v.codec,initSegment:v.segmentCodec==="mp3"&&M.mpeg?new Uint8Array(0):E.default.initSegment([v]),metadata:{channelCount:v.channelCount}},N&&(j=v.inputTimeScale,w=W=x[0].pts-Math.round(j*d))}if(c.sps&&c.pps&&P.length&&(c.timescale=c.inputTimeScale,B.video={id:"main",container:"video/mp4",codec:c.codec,initSegment:E.default.initSegment([c]),metadata:{width:c.width,height:c.height}},N)){j=c.inputTimeScale;var G=this.getVideoStartPts(P),H=Math.round(j*d);W=Math.min(W,u(P[0].dts,G)-H),w=Math.min(w,G-H)}if(Object.keys(B).length)return this.ISGenerated=!0,N&&(this._initPTS=w,this._initDTS=W),{tracks:B,initPTS:w,timescale:j}},o.remuxVideo=function(v,c,d,x){var P=v.inputTimeScale,M=v.samples,B=[],N=M.length,U=this._initPTS,w=this.nextAvcDts,W=8,j=this.videoSampleDuration,G,H,$=Number.POSITIVE_INFINITY,te=Number.NEGATIVE_INFINITY,q=!1;if(!d||w===null){var ne=c*P,oe=M[0].pts-u(M[0].dts,M[0].pts);w=ne-oe}for(var k=0;k<N;k++){var K=M[k];K.pts=u(K.pts-U,w),K.dts=u(K.dts-U,w),K.dts<M[k>0?k-1:k].dts&&(q=!0)}q&&M.sort(function(Ir,In){var ps=Ir.dts-In.dts,Es=Ir.pts-In.pts;return ps||Es}),G=M[0].dts,H=M[M.length-1].dts;var V=H-G,Y=V?Math.round(V/(N-1)):j||v.inputTimeScale/30;if(d){var z=G-w,Q=z>Y,Z=z<-1;if(Q||Z){Q?b.logger.warn("AVC: "+Object(L.toMsFromMpegTsClock)(z,!0)+" ms ("+z+"dts) hole between fragments detected, filling it"):b.logger.warn("AVC: "+Object(L.toMsFromMpegTsClock)(-z,!0)+" ms ("+z+"dts) overlapping between fragments detected"),G=w;var J=M[0].pts-z;M[0].dts=G,M[0].pts=J,b.logger.log("Video: First PTS/DTS adjusted: "+Object(L.toMsFromMpegTsClock)(J,!0)+"/"+Object(L.toMsFromMpegTsClock)(G,!0)+", delta: "+Object(L.toMsFromMpegTsClock)(z,!0)+" ms")}}G=Math.max(0,G);for(var ee=0,X=0,se=0;se<N;se++){for(var re=M[se],ie=re.units,ae=ie.length,le=0,de=0;de<ae;de++)le+=ie[de].data.length;X+=le,ee+=ae,re.length=le,re.dts=Math.max(re.dts,G),$=Math.min(re.pts,$),te=Math.max(re.pts,te)}H=M[N-1].dts;var ue=X+4*ee+8,he;try{he=new Uint8Array(ue)}catch{this.observer.emit(F.Events.ERROR,F.Events.ERROR,{type:_.ErrorTypes.MUX_ERROR,details:_.ErrorDetails.REMUX_ALLOC_ERROR,fatal:!1,bytes:ue,reason:"fail allocating video mdat "+ue});return}var Te=new DataView(he.buffer);Te.setUint32(0,ue),he.set(E.default.types.mdat,4);for(var Le=!1,we=Number.POSITIVE_INFINITY,pe=Number.POSITIVE_INFINITY,De=Number.NEGATIVE_INFINITY,Ee=Number.NEGATIVE_INFINITY,ge=0;ge<N;ge++){for(var Ae=M[ge],Ue=Ae.units,et=0,ht=0,Dt=Ue.length;ht<Dt;ht++){var $e=Ue[ht],Dr=$e.data,vt=$e.data.byteLength;Te.setUint32(W,vt),W+=4,he.set(Dr,W),W+=vt,et+=4+vt}var tt=void 0;if(ge<N-1)j=M[ge+1].dts-Ae.dts,tt=M[ge+1].pts-Ae.pts;else{var At=this.config,gt=ge>0?Ae.dts-M[ge-1].dts:Y;if(tt=ge>0?Ae.pts-M[ge-1].pts:Y,At.stretchShortVideoTrack&&this.nextAudioPts!==null){var $t=Math.floor(At.maxBufferHole*P),Ar=(x?$+x*P:this.nextAudioPts)-Ae.pts;Ar>$t?(j=Ar-gt,j<0?j=gt:Le=!0,b.logger.log("[mp4-remuxer]: It is approximately "+Ar/90+" ms to the next segment; using duration "+j/90+" ms for the last video frame.")):j=gt}else j=gt}var ds=Math.round(Ae.pts-Ae.dts);we=Math.min(we,j),De=Math.max(De,j),pe=Math.min(pe,tt),Ee=Math.max(Ee,tt),B.push(new n(Ae.key,j,et,ds))}if(B.length){if(T){if(T<70){var Dn=B[0].flags;Dn.dependsOn=2,Dn.isNonSync=0}}else if(a&&Ee-pe<De-we&&Y/De<.025&&B[0].cts===0){b.logger.warn("Found irregular gaps in sample duration. Using PTS instead of DTS to determine MP4 sample duration.");for(var Or=G,je=0,An=B.length;je<An;je++){var On=Or+B[je].duration,cs=Or+B[je].cts;if(je<An-1){var hs=On+B[je+1].cts;B[je].duration=hs-cs}else B[je].duration=je?B[je-1].duration:Y;B[je].cts=0,Or=On}}}console.assert(j!==null,"mp4SampleDuration must be computed"),j=Le||!j?Y:j,this.nextAvcDts=w=H+j,this.videoSampleDuration=j,this.isVideoContiguous=!0;var vs=E.default.moof(v.sequenceNumber++,G,I({},v,{samples:B})),gs="video",ms={data1:vs,data2:he,startPTS:$/P,endPTS:(te+j)/P,startDTS:G/P,endDTS:w/P,type:gs,hasAudio:!1,hasVideo:!0,nb:B.length,dropped:v.dropped};return v.samples=[],v.dropped=0,console.assert(he.length,"MDAT length must not be zero"),ms},o.remuxAudio=function(v,c,d,x,P){var M=v.inputTimeScale,B=v.samplerate?v.samplerate:M,N=M/B,U=v.segmentCodec==="aac"?O:S,w=U*N,W=this._initPTS,j=v.segmentCodec==="mp3"&&this.typeSupported.mpeg,G=[],H=P!==void 0,$=v.samples,te=j?0:8,q=this.nextAudioPts||-1,ne=c*M;if(this.isAudioContiguous=d=d||$.length&&q>0&&(x&&Math.abs(ne-q)<9e3||Math.abs(u($[0].pts-W,ne)-q)<20*w),$.forEach(function($e){$e.pts=u($e.pts-W,ne)}),!d||q<0){if($=$.filter(function($e){return $e.pts>=0}),!$.length)return;P===0?q=0:x&&!H?q=Math.max(0,ne):q=$[0].pts}if(v.segmentCodec==="aac")for(var oe=this.config.maxAudioFramesDrift,k=0,K=q;k<$.length;k++){var V=$[k],Y=V.pts,z=Y-K,Q=Math.abs(1e3*z/M);if(z<=-oe*w&&H)k===0&&(b.logger.warn("Audio frame @ "+(Y/M).toFixed(3)+"s overlaps nextAudioPts by "+Math.round(1e3*z/M)+" ms."),this.nextAudioPts=q=K=Y);else if(z>=oe*w&&Q<A&&H){var Z=Math.round(z/w);K=Y-Z*w,K<0&&(Z--,K+=w),k===0&&(this.nextAudioPts=q=K),b.logger.warn("[mp4-remuxer]: Injecting "+Z+" audio frame @ "+(K/M).toFixed(3)+"s due to "+Math.round(1e3*z/M)+" ms gap.");for(var J=0;J<Z;J++){var ee=Math.max(K,0),X=g.default.getSilentFrame(v.manifestCodec||v.codec,v.channelCount);X||(b.logger.log("[mp4-remuxer]: Unable to get silent frame for given audio codec; duplicating last frame instead."),X=V.unit.subarray()),$.splice(k,0,{unit:X,pts:ee}),K+=w,k++}}V.pts=K,K+=w}for(var se=null,re=null,ie,ae=0,le=$.length;le--;)ae+=$[le].unit.byteLength;for(var de=0,ue=$.length;de<ue;de++){var he=$[de],Te=he.unit,Le=he.pts;if(re!==null){var we=G[de-1];we.duration=Math.round((Le-re)/N)}else if(d&&v.segmentCodec==="aac"&&(Le=q),se=Le,ae>0){ae+=te;try{ie=new Uint8Array(ae)}catch{this.observer.emit(F.Events.ERROR,F.Events.ERROR,{type:_.ErrorTypes.MUX_ERROR,details:_.ErrorDetails.REMUX_ALLOC_ERROR,fatal:!1,bytes:ae,reason:"fail allocating audio mdat "+ae});return}if(!j){var pe=new DataView(ie.buffer);pe.setUint32(0,ae),ie.set(E.default.types.mdat,4)}}else return;ie.set(Te,te);var De=Te.byteLength;te+=De,G.push(new n(!0,U,De,0)),re=Le}var Ee=G.length;if(!!Ee){var ge=G[G.length-1];this.nextAudioPts=q=re+N*ge.duration;var Ae=j?new Uint8Array(0):E.default.moof(v.sequenceNumber++,se/N,I({},v,{samples:G}));v.samples=[];var Ue=se/M,et=q/M,ht="audio",Dt={data1:Ae,data2:ie,startPTS:Ue,endPTS:et,startDTS:Ue,endDTS:et,type:ht,hasAudio:!0,hasVideo:!1,nb:Ee};return this.isAudioContiguous=!0,console.assert(ie.length,"MDAT length must not be zero"),Dt}},o.remuxEmptyAudio=function(v,c,d,x){var P=v.inputTimeScale,M=v.samplerate?v.samplerate:P,B=P/M,N=this.nextAudioPts,U=(N!==null?N:x.startDTS*P)+this._initDTS,w=x.endDTS*P+this._initDTS,W=B*O,j=Math.ceil((w-U)/W),G=g.default.getSilentFrame(v.manifestCodec||v.codec,v.channelCount);if(b.logger.warn("[mp4-remuxer]: remux empty Audio"),!G){b.logger.trace("[mp4-remuxer]: Unable to remuxEmptyAudio since we were unable to get a silent frame for given audio codec");return}for(var H=[],$=0;$<j;$++){var te=U+$*W;H.push({unit:G,pts:te,dts:te})}return v.samples=H,this.remuxAudio(v,c,d,!1)},m}();function u(m,o){var f;if(o===null)return m;for(o<m?f=-8589934592:f=8589934592;Math.abs(m-o)>4294967296;)m+=f;return m}function h(m){for(var o=0;o<m.length;o++)if(m[o].key)return o;return-1}function y(m,o,f,v){var c=m.samples.length;if(!!c){for(var d=m.inputTimeScale,x=0;x<c;x++){var P=m.samples[x];P.pts=u(P.pts-f,o*d)/d,P.dts=u(P.dts-v,o*d)/d}var M=m.samples;return m.samples=[],{samples:M}}}function s(m,o,f){var v=m.samples.length;if(!!v){for(var c=m.inputTimeScale,d=0;d<v;d++){var x=m.samples[d];x.pts=u(x.pts-f,o*c)/c}m.samples.sort(function(M,B){return M.pts-B.pts});var P=m.samples;return m.samples=[],{samples:P}}}var n=function(o,f,v,c){this.size=void 0,this.duration=void 0,this.cts=void 0,this.flags=void 0,this.duration=f,this.size=v,this.cts=c,this.flags=new i(o)},i=function(o){this.isLeading=0,this.isDependedOn=0,this.hasRedundancy=0,this.degradPrio=0,this.dependsOn=1,this.isNonSync=1,this.dependsOn=o?2:1,this.isNonSync=o?0:1}},"./src/remux/passthrough-remuxer.ts":function(C,l,t){t.r(l);var D=t("./src/polyfills/number.ts"),g=t("./src/remux/mp4-remuxer.ts"),E=t("./src/utils/mp4-tools.ts"),F=t("./src/loader/fragment.ts"),_=t("./src/utils/logger.ts"),b=function(){function L(){this.emitInitSegment=!1,this.audioCodec=void 0,this.videoCodec=void 0,this.initData=void 0,this.initPTS=void 0,this.initTracks=void 0,this.lastEndTime=null}var I=L.prototype;return I.destroy=function(){},I.resetTimeStamp=function(O){this.initPTS=O,this.lastEndTime=null},I.resetNextTimestamp=function(){this.lastEndTime=null},I.resetInitSegment=function(O,S,T){this.audioCodec=S,this.videoCodec=T,this.generateInitSegment(O),this.emitInitSegment=!0},I.generateInitSegment=function(O){var S=this.audioCodec,T=this.videoCodec;if(!O||!O.byteLength){this.initTracks=void 0,this.initData=void 0;return}var a=this.initData=Object(E.parseInitSegment)(O);S||(S=R(a.audio,F.ElementaryStreamTypes.AUDIO)),T||(T=R(a.video,F.ElementaryStreamTypes.VIDEO));var r={};a.audio&&a.video?r.audiovideo={container:"video/mp4",codec:S+","+T,initSegment:O,id:"main"}:a.audio?r.audio={container:"audio/mp4",codec:S,initSegment:O,id:"audio"}:a.video?r.video={container:"video/mp4",codec:T,initSegment:O,id:"main"}:_.logger.warn("[passthrough-remuxer.ts]: initSegment does not contain moov or trak boxes."),this.initTracks=r},I.remux=function(O,S,T,a,r){var u,h=this.initPTS,y=this.lastEndTime,s={audio:void 0,video:void 0,text:a,id3:T,initSegment:void 0};Object(D.isFiniteNumber)(y)||(y=this.lastEndTime=r||0);var n=S.samples;if(!n||!n.length)return s;var i={initPTS:void 0,timescale:1},m=this.initData;if((!m||!m.length)&&(this.generateInitSegment(n),m=this.initData),!m||!m.length)return _.logger.warn("[passthrough-remuxer.ts]: Failed to generate initSegment."),s;this.emitInitSegment&&(i.tracks=this.initTracks,this.emitInitSegment=!1);var o=Object(E.getStartDTS)(m,n);Object(D.isFiniteNumber)(h)||(this.initPTS=i.initPTS=h=o-r);var f=Object(E.getDuration)(n,m),v=O?o-h:y,c=v+f;Object(E.offsetStartDTS)(m,n,h),f>0?this.lastEndTime=c:(_.logger.warn("Duration parsed from mp4 should be greater than zero"),this.resetNextTimestamp());var d=!!m.audio,x=!!m.video,P="";d&&(P+="audio"),x&&(P+="video");var M={data1:n,startPTS:v,startDTS:v,endPTS:c,endDTS:c,type:P,hasAudio:d,hasVideo:x,nb:1,dropped:0};s.audio=M.type==="audio"?M:void 0,s.video=M.type!=="audio"?M:void 0,s.initSegment=i;var B=(u=this.initPTS)!=null?u:0;return s.id3=Object(g.flushTextTrackMetadataCueSamples)(T,r,B,B),a.samples.length&&(s.text=Object(g.flushTextTrackUserdataCueSamples)(a,r,B)),s},L}();function R(L,I){var A=L==null?void 0:L.codec;return A&&A.length>4?A:A==="hvc1"||A==="hev1"?"hvc1.1.c.L120.90":A==="av01"?"av01.0.04M.08":A==="avc1"||I===F.ElementaryStreamTypes.VIDEO?"avc1.42e01e":"mp4a.40.5"}l.default=b},"./src/task-loop.ts":function(C,l,t){t.r(l),t.d(l,"default",function(){return D});var D=function(){function g(){this._boundTick=void 0,this._tickTimer=null,this._tickInterval=null,this._tickCallCount=0,this._boundTick=this.tick.bind(this)}var E=g.prototype;return E.destroy=function(){this.onHandlerDestroying(),this.onHandlerDestroyed()},E.onHandlerDestroying=function(){this.clearNextTick(),this.clearInterval()},E.onHandlerDestroyed=function(){},E.hasInterval=function(){return!!this._tickInterval},E.hasNextTick=function(){return!!this._tickTimer},E.setInterval=function(_){return this._tickInterval?!1:(this._tickInterval=self.setInterval(this._boundTick,_),!0)},E.clearInterval=function(){return this._tickInterval?(self.clearInterval(this._tickInterval),this._tickInterval=null,!0):!1},E.clearNextTick=function(){return this._tickTimer?(self.clearTimeout(this._tickTimer),this._tickTimer=null,!0):!1},E.tick=function(){this._tickCallCount++,this._tickCallCount===1&&(this.doTick(),this._tickCallCount>1&&this.tickImmediate(),this._tickCallCount=0)},E.tickImmediate=function(){this.clearNextTick(),this._tickTimer=self.setTimeout(this._boundTick,0)},E.doTick=function(){},g}()},"./src/types/cmcd.ts":function(C,l,t){t.r(l),t.d(l,"CMCDVersion",function(){return D}),t.d(l,"CMCDObjectType",function(){return g}),t.d(l,"CMCDStreamingFormat",function(){return E}),t.d(l,"CMCDStreamType",function(){return F});var D=1,g;(function(_){_.MANIFEST="m",_.AUDIO="a",_.VIDEO="v",_.MUXED="av",_.INIT="i",_.CAPTION="c",_.TIMED_TEXT="tt",_.KEY="k",_.OTHER="o"})(g||(g={}));var E;(function(_){_.DASH="d",_.HLS="h",_.SMOOTH="s",_.OTHER="o"})(E||(E={}));var F;(function(_){_.VOD="v",_.LIVE="l"})(F||(F={}))},"./src/types/demuxer.ts":function(C,l,t){t.r(l),t.d(l,"MetadataSchema",function(){return D});var D;(function(g){g.audioId3="org.id3",g.dateRange="com.apple.quicktime.HLS",g.emsg="https://aomedia.org/emsg/ID3"})(D||(D={}))},"./src/types/level.ts":function(C,l,t){t.r(l),t.d(l,"HlsSkip",function(){return E}),t.d(l,"getSkipValue",function(){return F}),t.d(l,"HlsUrlParameters",function(){return _}),t.d(l,"Level",function(){return b});function D(R,L){for(var I=0;I<L.length;I++){var A=L[I];A.enumerable=A.enumerable||!1,A.configurable=!0,"value"in A&&(A.writable=!0),Object.defineProperty(R,A.key,A)}}function g(R,L,I){return L&&D(R.prototype,L),I&&D(R,I),Object.defineProperty(R,"prototype",{writable:!1}),R}var E;(function(R){R.No="",R.Yes="YES",R.v2="v2"})(E||(E={}));function F(R,L){var I=R.canSkipUntil,A=R.canSkipDateRanges,O=R.endSN,S=L!==void 0?L-O:0;return I&&S<I?A?E.v2:E.Yes:E.No}var _=function(){function R(I,A,O){this.msn=void 0,this.part=void 0,this.skip=void 0,this.msn=I,this.part=A,this.skip=O}var L=R.prototype;return L.addDirectives=function(A){var O=new self.URL(A);return this.msn!==void 0&&O.searchParams.set("_HLS_msn",this.msn.toString()),this.part!==void 0&&O.searchParams.set("_HLS_part",this.part.toString()),this.skip&&O.searchParams.set("_HLS_skip",this.skip),O.toString()},R}(),b=function(){function R(L){this.attrs=void 0,this.audioCodec=void 0,this.bitrate=void 0,this.codecSet=void 0,this.height=void 0,this.id=void 0,this.name=void 0,this.videoCodec=void 0,this.width=void 0,this.unknownCodecs=void 0,this.audioGroupIds=void 0,this.details=void 0,this.fragmentError=0,this.loadError=0,this.loaded=void 0,this.realBitrate=0,this.textGroupIds=void 0,this.url=void 0,this._urlId=0,this.url=[L.url],this.attrs=L.attrs,this.bitrate=L.bitrate,L.details&&(this.details=L.details),this.id=L.id||0,this.name=L.name,this.width=L.width||0,this.height=L.height||0,this.audioCodec=L.audioCodec,this.videoCodec=L.videoCodec,this.unknownCodecs=L.unknownCodecs,this.codecSet=[L.videoCodec,L.audioCodec].filter(function(I){return I}).join(",").replace(/\.[^.,]+/g,"")}return g(R,[{key:"maxBitrate",get:function(){return Math.max(this.realBitrate,this.bitrate)}},{key:"uri",get:function(){return this.url[this._urlId]||""}},{key:"urlId",get:function(){return this._urlId},set:function(I){var A=I%this.url.length;this._urlId!==A&&(this.details=void 0,this._urlId=A)}}]),R}()},"./src/types/loader.ts":function(C,l,t){t.r(l),t.d(l,"PlaylistContextType",function(){return D}),t.d(l,"PlaylistLevelType",function(){return g});var D;(function(E){E.MANIFEST="manifest",E.LEVEL="level",E.AUDIO_TRACK="audioTrack",E.SUBTITLE_TRACK="subtitleTrack"})(D||(D={}));var g;(function(E){E.MAIN="main",E.AUDIO="audio",E.SUBTITLE="subtitle"})(g||(g={}))},"./src/types/transmuxer.ts":function(C,l,t){t.r(l),t.d(l,"ChunkMetadata",function(){return D});var D=function(F,_,b,R,L,I){R===void 0&&(R=0),L===void 0&&(L=-1),I===void 0&&(I=!1),this.level=void 0,this.sn=void 0,this.part=void 0,this.id=void 0,this.size=void 0,this.partial=void 0,this.transmuxing=g(),this.buffering={audio:g(),video:g(),audiovideo:g()},this.level=F,this.sn=_,this.id=b,this.size=R,this.part=L,this.partial=I};function g(){return{start:0,executeStart:0,executeEnd:0,end:0}}},"./src/utils/attr-list.ts":function(C,l,t){t.r(l),t.d(l,"AttrList",function(){return E});var D=/^(\d+)x(\d+)$/,g=/\s*(.+?)\s*=((?:\".*?\")|.*?)(?:,|$)/g,E=function(){function F(b){typeof b=="string"&&(b=F.parseAttrList(b));for(var R in b)b.hasOwnProperty(R)&&(this[R]=b[R])}var _=F.prototype;return _.decimalInteger=function(R){var L=parseInt(this[R],10);return L>Number.MAX_SAFE_INTEGER?1/0:L},_.hexadecimalInteger=function(R){if(this[R]){var L=(this[R]||"0x").slice(2);L=(L.length&1?"0":"")+L;for(var I=new Uint8Array(L.length/2),A=0;A<L.length/2;A++)I[A]=parseInt(L.slice(A*2,A*2+2),16);return I}else return null},_.hexadecimalIntegerAsNumber=function(R){var L=parseInt(this[R],16);return L>Number.MAX_SAFE_INTEGER?1/0:L},_.decimalFloatingPoint=function(R){return parseFloat(this[R])},_.optionalFloat=function(R,L){var I=this[R];return I?parseFloat(I):L},_.enumeratedString=function(R){return this[R]},_.bool=function(R){return this[R]==="YES"},_.decimalResolution=function(R){var L=D.exec(this[R]);if(L!==null)return{width:parseInt(L[1],10),height:parseInt(L[2],10)}},F.parseAttrList=function(R){var L,I={},A='"';for(g.lastIndex=0;(L=g.exec(R))!==null;){var O=L[2];O.indexOf(A)===0&&O.lastIndexOf(A)===O.length-1&&(O=O.slice(1,-1)),I[L[1]]=O}return I},F}()},"./src/utils/binary-search.ts":function(C,l,t){t.r(l);var D={search:function(E,F){for(var _=0,b=E.length-1,R=null,L=null;_<=b;){R=(_+b)/2|0,L=E[R];var I=F(L);if(I>0)_=R+1;else if(I<0)b=R-1;else return L}return null}};l.default=D},"./src/utils/buffer-helper.ts":function(C,l,t){t.r(l),t.d(l,"BufferHelper",function(){return E});var D=t("./src/utils/logger.ts"),g={length:0,start:function(){return 0},end:function(){return 0}},E=function(){function F(){}return F.isBuffered=function(b,R){try{if(b){for(var L=F.getBuffered(b),I=0;I<L.length;I++)if(R>=L.start(I)&&R<=L.end(I))return!0}}catch{}return!1},F.bufferInfo=function(b,R,L){try{if(b){var I=F.getBuffered(b),A=[],O;for(O=0;O<I.length;O++)A.push({start:I.start(O),end:I.end(O)});return this.bufferedInfo(A,R,L)}}catch{}return{len:0,start:R,end:R,nextStart:void 0}},F.bufferedInfo=function(b,R,L){R=Math.max(0,R),b.sort(function(n,i){var m=n.start-i.start;return m||i.end-n.end});var I=[];if(L)for(var A=0;A<b.length;A++){var O=I.length;if(O){var S=I[O-1].end;b[A].start-S<L?b[A].end>S&&(I[O-1].end=b[A].end):I.push(b[A])}else I.push(b[A])}else I=b;for(var T=0,a,r=R,u=R,h=0;h<I.length;h++){var y=I[h].start,s=I[h].end;if(R+L>=y&&R<s)r=y,u=s,T=u-R;else if(R+L<y){a=y;break}}return{len:T,start:r||0,end:u||0,nextStart:a}},F.getBuffered=function(b){try{return b.buffered}catch(R){return D.logger.log("failed to get media.buffered",R),g}},F}()},"./src/utils/cea-608-parser.ts":function(C,l,t){t.r(l),t.d(l,"Row",function(){return u}),t.d(l,"CaptionScreen",function(){return h});var D=t("./src/utils/logger.ts"),g={42:225,92:233,94:237,95:243,96:250,123:231,124:247,125:209,126:241,127:9608,128:174,129:176,130:189,131:191,132:8482,133:162,134:163,135:9834,136:224,137:32,138:232,139:226,140:234,141:238,142:244,143:251,144:193,145:201,146:211,147:218,148:220,149:252,150:8216,151:161,152:42,153:8217,154:9473,155:169,156:8480,157:8226,158:8220,159:8221,160:192,161:194,162:199,163:200,164:202,165:203,166:235,167:206,168:207,169:239,170:212,171:217,172:249,173:219,174:171,175:187,176:195,177:227,178:205,179:204,180:236,181:210,182:242,183:213,184:245,185:123,186:125,187:92,188:94,189:95,190:124,191:8764,192:196,193:228,194:214,195:246,196:223,197:165,198:164,199:9475,200:197,201:229,202:216,203:248,204:9487,205:9491,206:9495,207:9499},E=function(f){var v=f;return g.hasOwnProperty(f)&&(v=g[f]),String.fromCharCode(v)},F=15,_=100,b={17:1,18:3,21:5,22:7,23:9,16:11,19:12,20:14},R={17:2,18:4,21:6,22:8,23:10,19:13,20:15},L={25:1,26:3,29:5,30:7,31:9,24:11,27:12,28:14},I={25:2,26:4,29:6,30:8,31:10,27:13,28:15},A=["white","green","blue","cyan","red","yellow","magenta","black","transparent"],O;(function(o){o[o.ERROR=0]="ERROR",o[o.TEXT=1]="TEXT",o[o.WARNING=2]="WARNING",o[o.INFO=2]="INFO",o[o.DEBUG=3]="DEBUG",o[o.DATA=3]="DATA"})(O||(O={}));var S=function(){function o(){this.time=null,this.verboseLevel=O.ERROR}var f=o.prototype;return f.log=function(c,d){this.verboseLevel>=c&&D.logger.log(this.time+" ["+c+"] "+d)},o}(),T=function(f){for(var v=[],c=0;c<f.length;c++)v.push(f[c].toString(16));return v},a=function(){function o(v,c,d,x,P){this.foreground=void 0,this.underline=void 0,this.italics=void 0,this.background=void 0,this.flash=void 0,this.foreground=v||"white",this.underline=c||!1,this.italics=d||!1,this.background=x||"black",this.flash=P||!1}var f=o.prototype;return f.reset=function(){this.foreground="white",this.underline=!1,this.italics=!1,this.background="black",this.flash=!1},f.setStyles=function(c){for(var d=["foreground","underline","italics","background","flash"],x=0;x<d.length;x++){var P=d[x];c.hasOwnProperty(P)&&(this[P]=c[P])}},f.isDefault=function(){return this.foreground==="white"&&!this.underline&&!this.italics&&this.background==="black"&&!this.flash},f.equals=function(c){return this.foreground===c.foreground&&this.underline===c.underline&&this.italics===c.italics&&this.background===c.background&&this.flash===c.flash},f.copy=function(c){this.foreground=c.foreground,this.underline=c.underline,this.italics=c.italics,this.background=c.background,this.flash=c.flash},f.toString=function(){return"color="+this.foreground+", underline="+this.underline+", italics="+this.italics+", background="+this.background+", flash="+this.flash},o}(),r=function(){function o(v,c,d,x,P,M){this.uchar=void 0,this.penState=void 0,this.uchar=v||" ",this.penState=new a(c,d,x,P,M)}var f=o.prototype;return f.reset=function(){this.uchar=" ",this.penState.reset()},f.setChar=function(c,d){this.uchar=c,this.penState.copy(d)},f.setPenState=function(c){this.penState.copy(c)},f.equals=function(c){return this.uchar===c.uchar&&this.penState.equals(c.penState)},f.copy=function(c){this.uchar=c.uchar,this.penState.copy(c.penState)},f.isEmpty=function(){return this.uchar===" "&&this.penState.isDefault()},o}(),u=function(){function o(v){this.chars=void 0,this.pos=void 0,this.currPenState=void 0,this.cueStartTime=void 0,this.logger=void 0,this.chars=[];for(var c=0;c<_;c++)this.chars.push(new r);this.logger=v,this.pos=0,this.currPenState=new a}var f=o.prototype;return f.equals=function(c){for(var d=!0,x=0;x<_;x++)if(!this.chars[x].equals(c.chars[x])){d=!1;break}return d},f.copy=function(c){for(var d=0;d<_;d++)this.chars[d].copy(c.chars[d])},f.isEmpty=function(){for(var c=!0,d=0;d<_;d++)if(!this.chars[d].isEmpty()){c=!1;break}return c},f.setCursor=function(c){this.pos!==c&&(this.pos=c),this.pos<0?(this.logger.log(O.DEBUG,"Negative cursor position "+this.pos),this.pos=0):this.pos>_&&(this.logger.log(O.DEBUG,"Too large cursor position "+this.pos),this.pos=_)},f.moveCursor=function(c){var d=this.pos+c;if(c>1)for(var x=this.pos+1;x<d+1;x++)this.chars[x].setPenState(this.currPenState);this.setCursor(d)},f.backSpace=function(){this.moveCursor(-1),this.chars[this.pos].setChar(" ",this.currPenState)},f.insertChar=function(c){c>=144&&this.backSpace();var d=E(c);if(this.pos>=_){this.logger.log(O.ERROR,"Cannot insert "+c.toString(16)+" ("+d+") at position "+this.pos+". Skipping it!");return}this.chars[this.pos].setChar(d,this.currPenState),this.moveCursor(1)},f.clearFromPos=function(c){var d;for(d=c;d<_;d++)this.chars[d].reset()},f.clear=function(){this.clearFromPos(0),this.pos=0,this.currPenState.reset()},f.clearToEndOfRow=function(){this.clearFromPos(this.pos)},f.getTextString=function(){for(var c=[],d=!0,x=0;x<_;x++){var P=this.chars[x].uchar;P!==" "&&(d=!1),c.push(P)}return d?"":c.join("")},f.setPenStyles=function(c){this.currPenState.setStyles(c);var d=this.chars[this.pos];d.setPenState(this.currPenState)},o}(),h=function(){function o(v){this.rows=void 0,this.currRow=void 0,this.nrRollUpRows=void 0,this.lastOutputScreen=void 0,this.logger=void 0,this.rows=[];for(var c=0;c<F;c++)this.rows.push(new u(v));this.logger=v,this.currRow=F-1,this.nrRollUpRows=null,this.lastOutputScreen=null,this.reset()}var f=o.prototype;return f.reset=function(){for(var c=0;c<F;c++)this.rows[c].clear();this.currRow=F-1},f.equals=function(c){for(var d=!0,x=0;x<F;x++)if(!this.rows[x].equals(c.rows[x])){d=!1;break}return d},f.copy=function(c){for(var d=0;d<F;d++)this.rows[d].copy(c.rows[d])},f.isEmpty=function(){for(var c=!0,d=0;d<F;d++)if(!this.rows[d].isEmpty()){c=!1;break}return c},f.backSpace=function(){var c=this.rows[this.currRow];c.backSpace()},f.clearToEndOfRow=function(){var c=this.rows[this.currRow];c.clearToEndOfRow()},f.insertChar=function(c){var d=this.rows[this.currRow];d.insertChar(c)},f.setPen=function(c){var d=this.rows[this.currRow];d.setPenStyles(c)},f.moveCursor=function(c){var d=this.rows[this.currRow];d.moveCursor(c)},f.setCursor=function(c){this.logger.log(O.INFO,"setCursor: "+c);var d=this.rows[this.currRow];d.setCursor(c)},f.setPAC=function(c){this.logger.log(O.INFO,"pacData = "+JSON.stringify(c));var d=c.row-1;if(this.nrRollUpRows&&d<this.nrRollUpRows-1&&(d=this.nrRollUpRows-1),this.nrRollUpRows&&this.currRow!==d){for(var x=0;x<F;x++)this.rows[x].clear();var P=this.currRow+1-this.nrRollUpRows,M=this.lastOutputScreen;if(M){var B=M.rows[P].cueStartTime,N=this.logger.time;if(B&&N!==null&&B<N)for(var U=0;U<this.nrRollUpRows;U++)this.rows[d-this.nrRollUpRows+U+1].copy(M.rows[P+U])}}this.currRow=d;var w=this.rows[this.currRow];if(c.indent!==null){var W=c.indent,j=Math.max(W-1,0);w.setCursor(c.indent),c.color=w.chars[j].penState.foreground}var G={foreground:c.color,underline:c.underline,italics:c.italics,background:"black",flash:!1};this.setPen(G)},f.setBkgData=function(c){this.logger.log(O.INFO,"bkgData = "+JSON.stringify(c)),this.backSpace(),this.setPen(c),this.insertChar(32)},f.setRollUpRows=function(c){this.nrRollUpRows=c},f.rollUp=function(){if(this.nrRollUpRows===null){this.logger.log(O.DEBUG,"roll_up but nrRollUpRows not set yet");return}this.logger.log(O.TEXT,this.getDisplayText());var c=this.currRow+1-this.nrRollUpRows,d=this.rows.splice(c,1)[0];d.clear(),this.rows.splice(this.currRow,0,d),this.logger.log(O.INFO,"Rolling up")},f.getDisplayText=function(c){c=c||!1;for(var d=[],x="",P=-1,M=0;M<F;M++){var B=this.rows[M].getTextString();B&&(P=M+1,c?d.push("Row "+P+": '"+B+"'"):d.push(B.trim()))}return d.length>0&&(c?x="["+d.join(" | ")+"]":x=d.join(`
`)),x},f.getTextAndFormat=function(){return this.rows},o}(),y=function(){function o(v,c,d){this.chNr=void 0,this.outputFilter=void 0,this.mode=void 0,this.verbose=void 0,this.displayedMemory=void 0,this.nonDisplayedMemory=void 0,this.lastOutputScreen=void 0,this.currRollUpRow=void 0,this.writeScreen=void 0,this.cueStartTime=void 0,this.logger=void 0,this.chNr=v,this.outputFilter=c,this.mode=null,this.verbose=0,this.displayedMemory=new h(d),this.nonDisplayedMemory=new h(d),this.lastOutputScreen=new h(d),this.currRollUpRow=this.displayedMemory.rows[F-1],this.writeScreen=this.displayedMemory,this.mode=null,this.cueStartTime=null,this.logger=d}var f=o.prototype;return f.reset=function(){this.mode=null,this.displayedMemory.reset(),this.nonDisplayedMemory.reset(),this.lastOutputScreen.reset(),this.outputFilter.reset(),this.currRollUpRow=this.displayedMemory.rows[F-1],this.writeScreen=this.displayedMemory,this.mode=null,this.cueStartTime=null},f.getHandler=function(){return this.outputFilter},f.setHandler=function(c){this.outputFilter=c},f.setPAC=function(c){this.writeScreen.setPAC(c)},f.setBkgData=function(c){this.writeScreen.setBkgData(c)},f.setMode=function(c){c!==this.mode&&(this.mode=c,this.logger.log(O.INFO,"MODE="+c),this.mode==="MODE_POP-ON"?this.writeScreen=this.nonDisplayedMemory:(this.writeScreen=this.displayedMemory,this.writeScreen.reset()),this.mode!=="MODE_ROLL-UP"&&(this.displayedMemory.nrRollUpRows=null,this.nonDisplayedMemory.nrRollUpRows=null),this.mode=c)},f.insertChars=function(c){for(var d=0;d<c.length;d++)this.writeScreen.insertChar(c[d]);var x=this.writeScreen===this.displayedMemory?"DISP":"NON_DISP";this.logger.log(O.INFO,x+": "+this.writeScreen.getDisplayText(!0)),(this.mode==="MODE_PAINT-ON"||this.mode==="MODE_ROLL-UP")&&(this.logger.log(O.TEXT,"DISPLAYED: "+this.displayedMemory.getDisplayText(!0)),this.outputDataUpdate())},f.ccRCL=function(){this.logger.log(O.INFO,"RCL - Resume Caption Loading"),this.setMode("MODE_POP-ON")},f.ccBS=function(){this.logger.log(O.INFO,"BS - BackSpace"),this.mode!=="MODE_TEXT"&&(this.writeScreen.backSpace(),this.writeScreen===this.displayedMemory&&this.outputDataUpdate())},f.ccAOF=function(){},f.ccAON=function(){},f.ccDER=function(){this.logger.log(O.INFO,"DER- Delete to End of Row"),this.writeScreen.clearToEndOfRow(),this.outputDataUpdate()},f.ccRU=function(c){this.logger.log(O.INFO,"RU("+c+") - Roll Up"),this.writeScreen=this.displayedMemory,this.setMode("MODE_ROLL-UP"),this.writeScreen.setRollUpRows(c)},f.ccFON=function(){this.logger.log(O.INFO,"FON - Flash On"),this.writeScreen.setPen({flash:!0})},f.ccRDC=function(){this.logger.log(O.INFO,"RDC - Resume Direct Captioning"),this.setMode("MODE_PAINT-ON")},f.ccTR=function(){this.logger.log(O.INFO,"TR"),this.setMode("MODE_TEXT")},f.ccRTD=function(){this.logger.log(O.INFO,"RTD"),this.setMode("MODE_TEXT")},f.ccEDM=function(){this.logger.log(O.INFO,"EDM - Erase Displayed Memory"),this.displayedMemory.reset(),this.outputDataUpdate(!0)},f.ccCR=function(){this.logger.log(O.INFO,"CR - Carriage Return"),this.writeScreen.rollUp(),this.outputDataUpdate(!0)},f.ccENM=function(){this.logger.log(O.INFO,"ENM - Erase Non-displayed Memory"),this.nonDisplayedMemory.reset()},f.ccEOC=function(){if(this.logger.log(O.INFO,"EOC - End Of Caption"),this.mode==="MODE_POP-ON"){var c=this.displayedMemory;this.displayedMemory=this.nonDisplayedMemory,this.nonDisplayedMemory=c,this.writeScreen=this.nonDisplayedMemory,this.logger.log(O.TEXT,"DISP: "+this.displayedMemory.getDisplayText())}this.outputDataUpdate(!0)},f.ccTO=function(c){this.logger.log(O.INFO,"TO("+c+") - Tab Offset"),this.writeScreen.moveCursor(c)},f.ccMIDROW=function(c){var d={flash:!1};if(d.underline=c%2===1,d.italics=c>=46,d.italics)d.foreground="white";else{var x=Math.floor(c/2)-16,P=["white","green","blue","cyan","red","yellow","magenta"];d.foreground=P[x]}this.logger.log(O.INFO,"MIDROW: "+JSON.stringify(d)),this.writeScreen.setPen(d)},f.outputDataUpdate=function(c){c===void 0&&(c=!1);var d=this.logger.time;d!==null&&this.outputFilter&&(this.cueStartTime===null&&!this.displayedMemory.isEmpty()?this.cueStartTime=d:this.displayedMemory.equals(this.lastOutputScreen)||(this.outputFilter.newCue(this.cueStartTime,d,this.lastOutputScreen),c&&this.outputFilter.dispatchCue&&this.outputFilter.dispatchCue(),this.cueStartTime=this.displayedMemory.isEmpty()?null:d),this.lastOutputScreen.copy(this.displayedMemory))},f.cueSplitAtTime=function(c){this.outputFilter&&(this.displayedMemory.isEmpty()||(this.outputFilter.newCue&&this.outputFilter.newCue(this.cueStartTime,c,this.displayedMemory),this.cueStartTime=c))},o}(),s=function(){function o(v,c,d){this.channels=void 0,this.currentChannel=0,this.cmdHistory=void 0,this.logger=void 0;var x=new S;this.channels=[null,new y(v,c,x),new y(v+1,d,x)],this.cmdHistory=m(),this.logger=x}var f=o.prototype;return f.getHandler=function(c){return this.channels[c].getHandler()},f.setHandler=function(c,d){this.channels[c].setHandler(d)},f.addData=function(c,d){var x,P,M,B=!1;this.logger.time=c;for(var N=0;N<d.length;N+=2)if(P=d[N]&127,M=d[N+1]&127,!(P===0&&M===0)){if(this.logger.log(O.DATA,"["+T([d[N],d[N+1]])+"] -> ("+T([P,M])+")"),x=this.parseCmd(P,M),x||(x=this.parseMidrow(P,M)),x||(x=this.parsePAC(P,M)),x||(x=this.parseBackgroundAttributes(P,M)),!x&&(B=this.parseChars(P,M),B)){var U=this.currentChannel;if(U&&U>0){var w=this.channels[U];w.insertChars(B)}else this.logger.log(O.WARNING,"No channel found yet. TEXT-MODE?")}!x&&!B&&this.logger.log(O.WARNING,"Couldn't parse cleaned data "+T([P,M])+" orig: "+T([d[N],d[N+1]]))}},f.parseCmd=function(c,d){var x=this.cmdHistory,P=(c===20||c===28||c===21||c===29)&&d>=32&&d<=47,M=(c===23||c===31)&&d>=33&&d<=35;if(!(P||M))return!1;if(i(c,d,x))return n(null,null,x),this.logger.log(O.DEBUG,"Repeated command ("+T([c,d])+") is dropped"),!0;var B=c===20||c===21||c===23?1:2,N=this.channels[B];return c===20||c===21||c===28||c===29?d===32?N.ccRCL():d===33?N.ccBS():d===34?N.ccAOF():d===35?N.ccAON():d===36?N.ccDER():d===37?N.ccRU(2):d===38?N.ccRU(3):d===39?N.ccRU(4):d===40?N.ccFON():d===41?N.ccRDC():d===42?N.ccTR():d===43?N.ccRTD():d===44?N.ccEDM():d===45?N.ccCR():d===46?N.ccENM():d===47&&N.ccEOC():N.ccTO(d-32),n(c,d,x),this.currentChannel=B,!0},f.parseMidrow=function(c,d){var x=0;if((c===17||c===25)&&d>=32&&d<=47){if(c===17?x=1:x=2,x!==this.currentChannel)return this.logger.log(O.ERROR,"Mismatch channel in midrow parsing"),!1;var P=this.channels[x];return P?(P.ccMIDROW(d),this.logger.log(O.DEBUG,"MIDROW ("+T([c,d])+")"),!0):!1}return!1},f.parsePAC=function(c,d){var x,P=this.cmdHistory,M=(c>=17&&c<=23||c>=25&&c<=31)&&d>=64&&d<=127,B=(c===16||c===24)&&d>=64&&d<=95;if(!(M||B))return!1;if(i(c,d,P))return n(null,null,P),!0;var N=c<=23?1:2;d>=64&&d<=95?x=N===1?b[c]:L[c]:x=N===1?R[c]:I[c];var U=this.channels[N];return U?(U.setPAC(this.interpretPAC(x,d)),n(c,d,P),this.currentChannel=N,!0):!1},f.interpretPAC=function(c,d){var x,P={color:null,italics:!1,indent:null,underline:!1,row:c};return d>95?x=d-96:x=d-64,P.underline=(x&1)===1,x<=13?P.color=["white","green","blue","cyan","red","yellow","magenta","white"][Math.floor(x/2)]:x<=15?(P.italics=!0,P.color="white"):P.indent=Math.floor((x-16)/2)*4,P},f.parseChars=function(c,d){var x,P=null,M=null;if(c>=25?(x=2,M=c-8):(x=1,M=c),M>=17&&M<=19){var B;M===17?B=d+80:M===18?B=d+112:B=d+144,this.logger.log(O.INFO,"Special char '"+E(B)+"' in channel "+x),P=[B]}else c>=32&&c<=127&&(P=d===0?[c]:[c,d]);if(P){var N=T(P);this.logger.log(O.DEBUG,"Char codes =  "+N.join(",")),n(c,d,this.cmdHistory)}return P},f.parseBackgroundAttributes=function(c,d){var x=(c===16||c===24)&&d>=32&&d<=47,P=(c===23||c===31)&&d>=45&&d<=47;if(!(x||P))return!1;var M,B={};c===16||c===24?(M=Math.floor((d-32)/2),B.background=A[M],d%2===1&&(B.background=B.background+"_semi")):d===45?B.background="transparent":(B.foreground="black",d===47&&(B.underline=!0));var N=c<=23?1:2,U=this.channels[N];return U.setBkgData(B),n(c,d,this.cmdHistory),!0},f.reset=function(){for(var c=0;c<Object.keys(this.channels).length;c++){var d=this.channels[c];d&&d.reset()}this.cmdHistory=m()},f.cueSplitAtTime=function(c){for(var d=0;d<this.channels.length;d++){var x=this.channels[d];x&&x.cueSplitAtTime(c)}},o}();function n(o,f,v){v.a=o,v.b=f}function i(o,f,v){return v.a===o&&v.b===f}function m(){return{a:null,b:null}}l.default=s},"./src/utils/codecs.ts":function(C,l,t){t.r(l),t.d(l,"isCodecType",function(){return g}),t.d(l,"isCodecSupportedInMp4",function(){return E});var D={audio:{a3ds:!0,"ac-3":!0,"ac-4":!0,alac:!0,alaw:!0,dra1:!0,"dts+":!0,"dts-":!0,dtsc:!0,dtse:!0,dtsh:!0,"ec-3":!0,enca:!0,g719:!0,g726:!0,m4ae:!0,mha1:!0,mha2:!0,mhm1:!0,mhm2:!0,mlpa:!0,mp4a:!0,"raw ":!0,Opus:!0,samr:!0,sawb:!0,sawp:!0,sevc:!0,sqcp:!0,ssmv:!0,twos:!0,ulaw:!0},video:{avc1:!0,avc2:!0,avc3:!0,avc4:!0,avcp:!0,av01:!0,drac:!0,dva1:!0,dvav:!0,dvh1:!0,dvhe:!0,encv:!0,hev1:!0,hvc1:!0,mjp2:!0,mp4v:!0,mvc1:!0,mvc2:!0,mvc3:!0,mvc4:!0,resv:!0,rv60:!0,s263:!0,svc1:!0,svc2:!0,"vc-1":!0,vp08:!0,vp09:!0},text:{stpp:!0,wvtt:!0}};function g(F,_){var b=D[_];return!!b&&b[F.slice(0,4)]===!0}function E(F,_){return MediaSource.isTypeSupported((_||"video")+'/mp4;codecs="'+F+'"')}},"./src/utils/cues.ts":function(C,l,t){t.r(l);var D=t("./src/utils/vttparser.ts"),g=t("./src/utils/webvtt-parser.ts"),E=t("./src/utils/texttrack-utils.ts"),F=/\s/,_={newCue:function(R,L,I,A){for(var O=[],S,T,a,r,u,h=self.VTTCue||self.TextTrackCue,y=0;y<A.rows.length;y++)if(S=A.rows[y],a=!0,r=0,u="",!S.isEmpty()){for(var s=0;s<S.chars.length;s++)F.test(S.chars[s].uchar)&&a?r++:(u+=S.chars[s].uchar,a=!1);S.cueStartTime=L,L===I&&(I+=1e-4),r>=16?r--:r++;var n=Object(D.fixLineBreaks)(u.trim()),i=Object(g.generateCueId)(L,I,n);(!R||!R.cues||!R.cues.getCueById(i))&&(T=new h(L,I,n),T.id=i,T.line=y+1,T.align="left",T.position=10+Math.min(80,Math.floor(r*8/32)*10),O.push(T))}return R&&O.length&&(O.sort(function(m,o){return m.line==="auto"||o.line==="auto"?0:m.line>8&&o.line>8?o.line-m.line:m.line-o.line}),O.forEach(function(m){return Object(E.addCueToTrack)(R,m)})),O}};l.default=_},"./src/utils/discontinuities.ts":function(C,l,t){t.r(l),t.d(l,"findFirstFragWithCC",function(){return F}),t.d(l,"shouldAlignOnDiscontinuities",function(){return _}),t.d(l,"findDiscontinuousReferenceFrag",function(){return b}),t.d(l,"adjustSlidingStart",function(){return L}),t.d(l,"alignStream",function(){return I}),t.d(l,"alignPDT",function(){return O}),t.d(l,"alignFragmentByPDTDelta",function(){return S}),t.d(l,"alignMediaPlaylistByPDT",function(){return T});var D=t("./src/polyfills/number.ts"),g=t("./src/utils/logger.ts"),E=t("./src/controller/level-helper.ts");function F(a,r){for(var u=null,h=0,y=a.length;h<y;h++){var s=a[h];if(s&&s.cc===r){u=s;break}}return u}function _(a,r,u){return!!(r.details&&(u.endCC>u.startCC||a&&a.cc<u.startCC))}function b(a,r){var u=a.fragments,h=r.fragments;if(!h.length||!u.length){g.logger.log("No fragments to align");return}var y=F(u,h[0].cc);if(!y||y&&!y.startPTS){g.logger.log("No frag in previous level to align on");return}return y}function R(a,r){if(a){var u=a.start+r;a.start=a.startPTS=u,a.endPTS=u+a.duration}}function L(a,r){for(var u=r.fragments,h=0,y=u.length;h<y;h++)R(u[h],a);r.fragmentHint&&R(r.fragmentHint,a),r.alignedSliding=!0}function I(a,r,u){!r||(A(a,u,r),!u.alignedSliding&&r.details&&O(u,r.details),!u.alignedSliding&&r.details&&!u.skippedSegments&&Object(E.adjustSliding)(r.details,u))}function A(a,r,u){if(_(a,u,r)){var h=b(u.details,r);h&&Object(D.isFiniteNumber)(h.start)&&(g.logger.log("Adjusting PTS using last level due to CC increase within current level "+r.url),L(h.start,r))}}function O(a,r){if(!(!r.fragments.length||!a.hasProgramDateTime||!r.hasProgramDateTime)){var u=r.fragments[0].programDateTime,h=a.fragments[0].programDateTime,y=(h-u)/1e3+r.fragments[0].start;y&&Object(D.isFiniteNumber)(y)&&(g.logger.log("Adjusting PTS using programDateTime delta "+(h-u)+"ms, sliding:"+y.toFixed(3)+" "+a.url+" "),L(y,a))}}function S(a,r){var u=a.programDateTime;if(!!u){var h=(u-r)/1e3;a.start=a.startPTS=h,a.endPTS=h+a.duration}}function T(a,r){if(!(!r.fragments.length||!a.hasProgramDateTime||!r.hasProgramDateTime)){var u=r.fragments[0].programDateTime,h=r.fragments[0].start,y=u-h*1e3;a.fragments.forEach(function(s){S(s,y)}),a.fragmentHint&&S(a.fragmentHint,y),a.alignedSliding=!0}}},"./src/utils/ewma-bandwidth-estimator.ts":function(C,l,t){t.r(l);var D=t("./src/utils/ewma.ts"),g=function(){function E(_,b,R){this.defaultEstimate_=void 0,this.minWeight_=void 0,this.minDelayMs_=void 0,this.slow_=void 0,this.fast_=void 0,this.defaultEstimate_=R,this.minWeight_=.001,this.minDelayMs_=50,this.slow_=new D.default(_),this.fast_=new D.default(b)}var F=E.prototype;return F.update=function(b,R){var L=this.slow_,I=this.fast_;this.slow_.halfLife!==b&&(this.slow_=new D.default(b,L.getEstimate(),L.getTotalWeight())),this.fast_.halfLife!==R&&(this.fast_=new D.default(R,I.getEstimate(),I.getTotalWeight()))},F.sample=function(b,R){b=Math.max(b,this.minDelayMs_);var L=8*R,I=b/1e3,A=L/I;this.fast_.sample(I,A),this.slow_.sample(I,A)},F.canEstimate=function(){var b=this.fast_;return b&&b.getTotalWeight()>=this.minWeight_},F.getEstimate=function(){return this.canEstimate()?Math.min(this.fast_.getEstimate(),this.slow_.getEstimate()):this.defaultEstimate_},F.destroy=function(){},E}();l.default=g},"./src/utils/ewma.ts":function(C,l,t){t.r(l);var D=function(){function g(F,_,b){_===void 0&&(_=0),b===void 0&&(b=0),this.halfLife=void 0,this.alpha_=void 0,this.estimate_=void 0,this.totalWeight_=void 0,this.halfLife=F,this.alpha_=F?Math.exp(Math.log(.5)/F):0,this.estimate_=_,this.totalWeight_=b}var E=g.prototype;return E.sample=function(_,b){var R=Math.pow(this.alpha_,_);this.estimate_=b*(1-R)+R*this.estimate_,this.totalWeight_+=_},E.getTotalWeight=function(){return this.totalWeight_},E.getEstimate=function(){if(this.alpha_){var _=1-Math.pow(this.alpha_,this.totalWeight_);if(_)return this.estimate_/_}return this.estimate_},g}();l.default=D},"./src/utils/fetch-loader.ts":function(C,l,t){t.r(l),t.d(l,"fetchSupported",function(){return S});var D=t("./src/polyfills/number.ts"),g=t("./src/loader/load-stats.ts"),E=t("./src/demux/chunk-cache.ts");function F(h,y){h.prototype=Object.create(y.prototype),h.prototype.constructor=h,I(h,y)}function _(h){var y=typeof Map=="function"?new Map:void 0;return _=function(n){if(n===null||!L(n))return n;if(typeof n!="function")throw new TypeError("Super expression must either be null or a function");if(typeof y<"u"){if(y.has(n))return y.get(n);y.set(n,i)}function i(){return b(n,arguments,A(this).constructor)}return i.prototype=Object.create(n.prototype,{constructor:{value:i,enumerable:!1,writable:!0,configurable:!0}}),I(i,n)},_(h)}function b(h,y,s){return R()?b=Reflect.construct.bind():b=function(i,m,o){var f=[null];f.push.apply(f,m);var v=Function.bind.apply(i,f),c=new v;return o&&I(c,o.prototype),c},b.apply(null,arguments)}function R(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}function L(h){return Function.toString.call(h).indexOf("[native code]")!==-1}function I(h,y){return I=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(n,i){return n.__proto__=i,n},I(h,y)}function A(h){return A=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(s){return s.__proto__||Object.getPrototypeOf(s)},A(h)}function O(){return O=Object.assign?Object.assign.bind():function(h){for(var y=1;y<arguments.length;y++){var s=arguments[y];for(var n in s)Object.prototype.hasOwnProperty.call(s,n)&&(h[n]=s[n])}return h},O.apply(this,arguments)}function S(){if(self.fetch&&self.AbortController&&self.ReadableStream&&self.Request)try{return new self.ReadableStream({}),!0}catch{}return!1}var T=function(){function h(s){this.fetchSetup=void 0,this.requestTimeout=void 0,this.request=void 0,this.response=void 0,this.controller=void 0,this.context=void 0,this.config=null,this.callbacks=null,this.stats=void 0,this.loader=null,this.fetchSetup=s.fetchSetup||r,this.controller=new self.AbortController,this.stats=new g.LoadStats}var y=h.prototype;return y.destroy=function(){this.loader=this.callbacks=null,this.abortInternal()},y.abortInternal=function(){var n=this.response;(!n||!n.ok)&&(this.stats.aborted=!0,this.controller.abort())},y.abort=function(){var n;this.abortInternal(),(n=this.callbacks)!==null&&n!==void 0&&n.onAbort&&this.callbacks.onAbort(this.stats,this.context,this.response)},y.load=function(n,i,m){var o=this,f=this.stats;if(f.loading.start)throw new Error("Loader can only be used once.");f.loading.start=self.performance.now();var v=a(n,this.controller.signal),c=m.onProgress,d=n.responseType==="arraybuffer",x=d?"byteLength":"length";this.context=n,this.config=i,this.callbacks=m,this.request=this.fetchSetup(n,v),self.clearTimeout(this.requestTimeout),this.requestTimeout=self.setTimeout(function(){o.abortInternal(),m.onTimeout(f,n,o.response)},i.timeout),self.fetch(this.request).then(function(P){if(o.response=o.loader=P,!P.ok){var M=P.status,B=P.statusText;throw new u(B||"fetch, bad network response",M,P)}return f.loading.first=Math.max(self.performance.now(),f.loading.start),f.total=parseInt(P.headers.get("Content-Length")||"0"),c&&Object(D.isFiniteNumber)(i.highWaterMark)?o.loadProgressively(P,f,n,i.highWaterMark,c):d?P.arrayBuffer():P.text()}).then(function(P){var M=o.response;self.clearTimeout(o.requestTimeout),f.loading.end=Math.max(self.performance.now(),f.loading.first),f.loaded=f.total=P[x];var B={url:M.url,data:P};c&&!Object(D.isFiniteNumber)(i.highWaterMark)&&c(f,n,P,M),m.onSuccess(B,f,n,M)}).catch(function(P){if(self.clearTimeout(o.requestTimeout),!f.aborted){var M=P&&P.code||0,B=P?P.message:null;m.onError({code:M,text:B},n,P?P.details:null)}})},y.getCacheAge=function(){var n=null;if(this.response){var i=this.response.headers.get("age");n=i?parseFloat(i):null}return n},y.loadProgressively=function(n,i,m,o,f){o===void 0&&(o=0);var v=new E.default,c=n.body.getReader(),d=function x(){return c.read().then(function(P){if(P.done)return v.dataLength&&f(i,m,v.flush(),n),Promise.resolve(new ArrayBuffer(0));var M=P.value,B=M.length;return i.loaded+=B,B<o||v.dataLength?(v.push(M),v.dataLength>=o&&f(i,m,v.flush(),n)):f(i,m,M,n),x()}).catch(function(){return Promise.reject()})};return d()},h}();function a(h,y){var s={method:"GET",mode:"cors",credentials:"same-origin",signal:y,headers:new self.Headers(O({},h.headers))};return h.rangeEnd&&s.headers.set("Range","bytes="+h.rangeStart+"-"+String(h.rangeEnd-1)),s}function r(h,y){return new self.Request(h.url,y)}var u=function(h){F(y,h);function y(s,n,i){var m;return m=h.call(this,s)||this,m.code=void 0,m.details=void 0,m.code=n,m.details=i,m}return y}(_(Error));l.default=T},"./src/utils/imsc1-ttml-parser.ts":function(C,l,t){t.r(l),t.d(l,"IMSC1_CODEC",function(){return L}),t.d(l,"parseIMSC1",function(){return S});var D=t("./src/utils/mp4-tools.ts"),g=t("./src/utils/vttparser.ts"),E=t("./src/utils/vttcue.ts"),F=t("./src/demux/id3.ts"),_=t("./src/utils/timescale-conversion.ts"),b=t("./src/utils/webvtt-parser.ts");function R(){return R=Object.assign?Object.assign.bind():function(o){for(var f=1;f<arguments.length;f++){var v=arguments[f];for(var c in v)Object.prototype.hasOwnProperty.call(v,c)&&(o[c]=v[c])}return o},R.apply(this,arguments)}var L="stpp.ttml.im1t",I=/^(\d{2,}):(\d{2}):(\d{2}):(\d{2})\.?(\d+)?$/,A=/^(\d*(?:\.\d*)?)(h|m|s|ms|f|t)$/,O={left:"start",center:"center",right:"end",start:"start",end:"end"};function S(o,f,v,c,d){var x=Object(D.findBox)(new Uint8Array(o),["mdat"]);if(x.length===0){d(new Error("Could not parse IMSC1 mdat"));return}var P=x.map(function(B){return Object(F.utf8ArrayToStr)(B)}),M=Object(_.toTimescaleFromScale)(f,1,v);try{P.forEach(function(B){return c(T(B,M))})}catch(B){d(B)}}function T(o,f){var v=new DOMParser,c=v.parseFromString(o,"text/xml"),d=c.getElementsByTagName("tt")[0];if(!d)throw new Error("Invalid ttml");var x={frameRate:30,subFrameRate:1,frameRateMultiplier:0,tickRate:0},P=Object.keys(x).reduce(function(w,W){return w[W]=d.getAttribute("ttp:"+W)||x[W],w},{}),M=d.getAttribute("xml:space")!=="preserve",B=r(a(d,"styling","style")),N=r(a(d,"layout","region")),U=a(d,"body","[begin]");return[].map.call(U,function(w){var W=u(w,M);if(!W||!w.hasAttribute("begin"))return null;var j=n(w.getAttribute("begin"),P),G=n(w.getAttribute("dur"),P),H=n(w.getAttribute("end"),P);if(j===null)throw s(w);if(H===null){if(G===null)throw s(w);H=j+G}var $=new E.default(j-f,H-f,W);$.id=Object(b.generateCueId)($.startTime,$.endTime,$.text);var te=N[w.getAttribute("region")],q=B[w.getAttribute("style")];$.position=10,$.size=80;var ne=h(te,q,B),oe=ne.textAlign;if(oe){var k=O[oe];k&&($.lineAlign=k),$.align=oe}return R($,ne),$}).filter(function(w){return w!==null})}function a(o,f,v){var c=o.getElementsByTagName(f)[0];return c?[].slice.call(c.querySelectorAll(v)):[]}function r(o){return o.reduce(function(f,v){var c=v.getAttribute("xml:id");return c&&(f[c]=v),f},{})}function u(o,f){return[].slice.call(o.childNodes).reduce(function(v,c,d){var x;return c.nodeName==="br"&&d?v+`
`:(x=c.childNodes)!==null&&x!==void 0&&x.length?u(c,f):f?v+c.textContent.trim().replace(/\s+/g," "):v+c.textContent},"")}function h(o,f,v){var c="http://www.w3.org/ns/ttml#styling",d=null,x=["displayAlign","textAlign","color","backgroundColor","fontSize","fontFamily"],P=o!=null&&o.hasAttribute("style")?o.getAttribute("style"):null;return P&&v.hasOwnProperty(P)&&(d=v[P]),x.reduce(function(M,B){var N=y(f,c,B)||y(o,c,B)||y(d,c,B);return N&&(M[B]=N),M},{})}function y(o,f,v){return o&&o.hasAttributeNS(f,v)?o.getAttributeNS(f,v):null}function s(o){return new Error("Could not parse ttml timestamp "+o)}function n(o,f){if(!o)return null;var v=Object(g.parseTimeStamp)(o);return v===null&&(I.test(o)?v=i(o,f):A.test(o)&&(v=m(o,f))),v}function i(o,f){var v=I.exec(o),c=(v[4]|0)+(v[5]|0)/f.subFrameRate;return(v[1]|0)*3600+(v[2]|0)*60+(v[3]|0)+c/f.frameRate}function m(o,f){var v=A.exec(o),c=Number(v[1]),d=v[2];switch(d){case"h":return c*3600;case"m":return c*60;case"ms":return c*1e3;case"f":return c/f.frameRate;case"t":return c/f.tickRate}return c}},"./src/utils/logger.ts":function(C,l,t){t.r(l),t.d(l,"enableLogs",function(){return b}),t.d(l,"logger",function(){return R});var D=function(){},g={trace:D,debug:D,log:D,warn:D,info:D,error:D},E=g;function F(L){var I=self.console[L];return I?I.bind(self.console,"["+L+"] >"):D}function _(L){for(var I=arguments.length,A=new Array(I>1?I-1:0),O=1;O<I;O++)A[O-1]=arguments[O];A.forEach(function(S){E[S]=L[S]?L[S].bind(L):F(S)})}function b(L){if(self.console&&L===!0||typeof L=="object"){_(L,"debug","log","info","warn","error");try{E.log()}catch{E=g}}else E=g}var R=E},"./src/utils/mediakeys-helper.ts":function(C,l,t){t.r(l),t.d(l,"KeySystems",function(){return D}),t.d(l,"requestMediaKeySystemAccess",function(){return g});var D;(function(E){E.WIDEVINE="com.widevine.alpha",E.PLAYREADY="com.microsoft.playready"})(D||(D={}));var g=function(){return typeof self<"u"&&self.navigator&&self.navigator.requestMediaKeySystemAccess?self.navigator.requestMediaKeySystemAccess.bind(self.navigator):null}()},"./src/utils/mediasource-helper.ts":function(C,l,t){t.r(l),t.d(l,"getMediaSource",function(){return D});function D(){return self.MediaSource||self.WebKitMediaSource}},"./src/utils/mp4-tools.ts":function(C,l,t){t.r(l),t.d(l,"RemuxerTrackIdConfig",function(){return b}),t.d(l,"bin2str",function(){return R}),t.d(l,"readUint16",function(){return L}),t.d(l,"readUint32",function(){return I}),t.d(l,"readSint32",function(){return A}),t.d(l,"writeUint32",function(){return O}),t.d(l,"findBox",function(){return S}),t.d(l,"parseSegmentIndex",function(){return T}),t.d(l,"parseInitSegment",function(){return a}),t.d(l,"getStartDTS",function(){return r}),t.d(l,"getDuration",function(){return u}),t.d(l,"computeRawDurationFromSamples",function(){return h}),t.d(l,"offsetStartDTS",function(){return y}),t.d(l,"segmentValidRange",function(){return s}),t.d(l,"appendUint8Array",function(){return n}),t.d(l,"parseSamples",function(){return i}),t.d(l,"parseSEIMessageFromNALu",function(){return f}),t.d(l,"parseEmsg",function(){return c});var D=t("./src/utils/typed-array.ts"),g=t("./src/loader/fragment.ts"),E=t("./src/demux/id3.ts"),F=Math.pow(2,32)-1,_=[].push,b={video:1,audio:2,id3:3,text:4};function R(d){return String.fromCharCode.apply(null,d)}function L(d,x){var P=d[x]<<8|d[x+1];return P<0?65536+P:P}function I(d,x){var P=A(d,x);return P<0?4294967296+P:P}function A(d,x){return d[x]<<24|d[x+1]<<16|d[x+2]<<8|d[x+3]}function O(d,x,P){d[x]=P>>24,d[x+1]=P>>16&255,d[x+2]=P>>8&255,d[x+3]=P&255}function S(d,x){var P=[];if(!x.length)return P;for(var M=d.byteLength,B=0;B<M;){var N=I(d,B),U=R(d.subarray(B+4,B+8)),w=N>1?B+N:M;if(U===x[0])if(x.length===1)P.push(d.subarray(B+8,w));else{var W=S(d.subarray(B+8,w),x.slice(1));W.length&&_.apply(P,W)}B=w}return P}function T(d){var x=[],P=d[0],M=8,B=I(d,M);M+=4;var N=0,U=0;P===0?M+=8:M+=16,M+=2;var w=d.length+U,W=L(d,M);M+=2;for(var j=0;j<W;j++){var G=M,H=I(d,G);G+=4;var $=H&2147483647,te=(H&2147483648)>>>31;if(te===1)return console.warn("SIDX has hierarchical references (not supported)"),null;var q=I(d,G);G+=4,x.push({referenceSize:$,subsegmentDuration:q,info:{duration:q/B,start:w,end:w+$-1}}),w+=$,G+=4,M=G}return{earliestPresentationTime:N,timescale:B,version:P,referencesCount:W,references:x}}function a(d){for(var x=[],P=S(d,["moov","trak"]),M=0;M<P.length;M++){var B=P[M],N=S(B,["tkhd"])[0];if(N){var U=N[0],w=U===0?12:20,W=I(N,w),j=S(B,["mdia","mdhd"])[0];if(j){U=j[0],w=U===0?12:20;var G=I(j,w),H=S(B,["mdia","hdlr"])[0];if(H){var $=R(H.subarray(8,12)),te={soun:g.ElementaryStreamTypes.AUDIO,vide:g.ElementaryStreamTypes.VIDEO}[$];if(te){var q=S(B,["mdia","minf","stbl","stsd"])[0],ne=void 0;q&&(ne=R(q.subarray(12,16))),x[W]={timescale:G,type:te},x[te]={timescale:G,id:W,codec:ne}}}}}}var oe=S(d,["moov","mvex","trex"]);return oe.forEach(function(k){var K=I(k,4),V=x[K];V&&(V.default={duration:I(k,12),flags:I(k,20)})}),x}function r(d,x){return S(x,["moof","traf"]).reduce(function(P,M){var B=S(M,["tfdt"])[0],N=B[0],U=S(M,["tfhd"]).reduce(function(w,W){var j=I(W,4),G=d[j];if(G){var H=I(B,4);N===1&&(H*=Math.pow(2,32),H+=I(B,8));var $=G.timescale||9e4,te=H/$;if(isFinite(te)&&(w===null||te<w))return te}return w},null);return U!==null&&isFinite(U)&&(P===null||U<P)?U:P},null)||0}function u(d,x){for(var P=0,M=0,B=0,N=S(d,["moof","traf"]),U=0;U<N.length;U++){var w=N[U],W=S(w,["tfhd"])[0],j=I(W,4),G=x[j];if(!!G){var H=G.default,$=I(W,0)|(H==null?void 0:H.flags),te=H==null?void 0:H.duration;$&8&&($&2?te=I(W,12):te=I(W,8));for(var q=G.timescale||9e4,ne=S(w,["trun"]),oe=0;oe<ne.length;oe++){if(P=h(ne[oe]),!P&&te){var k=I(ne[oe],4);P=te*k}G.type===g.ElementaryStreamTypes.VIDEO?M+=P/q:G.type===g.ElementaryStreamTypes.AUDIO&&(B+=P/q)}}}if(M===0&&B===0){for(var K=0,V=S(d,["sidx"]),Y=0;Y<V.length;Y++){var z=T(V[Y]);z!=null&&z.references&&(K+=z.references.reduce(function(Q,Z){return Q+Z.info.duration||0},0))}return K}return M||B}function h(d){var x=I(d,0),P=8;x&1&&(P+=4),x&4&&(P+=4);for(var M=0,B=I(d,4),N=0;N<B;N++){if(x&256){var U=I(d,P);M+=U,P+=4}x&512&&(P+=4),x&1024&&(P+=4),x&2048&&(P+=4)}return M}function y(d,x,P){S(x,["moof","traf"]).forEach(function(M){S(M,["tfhd"]).forEach(function(B){var N=I(B,4),U=d[N];if(!!U){var w=U.timescale||9e4;S(M,["tfdt"]).forEach(function(W){var j=W[0],G=I(W,4);if(j===0)G-=P*w,G=Math.max(G,0),O(W,4,G);else{G*=Math.pow(2,32),G+=I(W,8),G-=P*w,G=Math.max(G,0);var H=Math.floor(G/(F+1)),$=Math.floor(G%(F+1));O(W,4,H),O(W,8,$)}})}})})}function s(d){var x={valid:null,remainder:null},P=S(d,["moof"]);if(P){if(P.length<2)return x.remainder=d,x}else return x;var M=P[P.length-1];return x.valid=Object(D.sliceUint8)(d,0,M.byteOffset-8),x.remainder=Object(D.sliceUint8)(d,M.byteOffset-8),x}function n(d,x){var P=new Uint8Array(d.length+x.length);return P.set(d),P.set(x,d.length),P}function i(d,x){var P=[],M=x.samples,B=x.timescale,N=x.id,U=!1,w=S(M,["moof"]);return w.map(function(W){var j=W.byteOffset-8,G=S(W,["traf"]);G.map(function(H){var $=S(H,["tfdt"]).map(function(te){var q=te[0],ne=I(te,4);return q===1&&(ne*=Math.pow(2,32),ne+=I(te,8)),ne/B})[0];return $!==void 0&&(d=$),S(H,["tfhd"]).map(function(te){var q=I(te,4),ne=I(te,0)&16777215,oe=(ne&1)!==0,k=(ne&2)!==0,K=(ne&8)!==0,V=0,Y=(ne&16)!==0,z=0,Q=(ne&32)!==0,Z=8;q===N&&(oe&&(Z+=8),k&&(Z+=4),K&&(V=I(te,Z),Z+=4),Y&&(z=I(te,Z),Z+=4),Q&&(Z+=4),x.type==="video"&&(U=m(x.codec)),S(H,["trun"]).map(function(J){var ee=J[0],X=I(J,0)&16777215,se=(X&1)!==0,re=0,ie=(X&4)!==0,ae=(X&256)!==0,le=0,de=(X&512)!==0,ue=0,he=(X&1024)!==0,Te=(X&2048)!==0,Le=0,we=I(J,4),pe=8;se&&(re=I(J,pe),pe+=4),ie&&(pe+=4);for(var De=re+j,Ee=0;Ee<we;Ee++){if(ae?(le=I(J,pe),pe+=4):le=V,de?(ue=I(J,pe),pe+=4):ue=z,he&&(pe+=4),Te&&(ee===0?Le=I(J,pe):Le=A(J,pe),pe+=4),x.type===g.ElementaryStreamTypes.VIDEO)for(var ge=0;ge<ue;){var Ae=I(M,De);De+=4;var Ue=M[De]&31;if(o(U,Ue)){var et=M.subarray(De,De+Ae);f(et,d+Le/B,P)}De+=Ae,ge+=Ae+4}d+=le/B}}))})})}),P}function m(d){if(!d)return!1;var x=d.indexOf("."),P=x<0?d:d.substring(0,x);return P==="hvc1"||P==="hev1"||P==="dvh1"||P==="dvhe"}function o(d,x){return d?x===39||x===40:x===6}function f(d,x,P){var M=v(d),B=0;B++;for(var N=0,U=0,w=!1,W=0;B<M.length;){N=0;do{if(B>=M.length)break;W=M[B++],N+=W}while(W===255);U=0;do{if(B>=M.length)break;W=M[B++],U+=W}while(W===255);var j=M.length-B;if(!w&&N===4&&B<M.length){w=!0;var G=M[B++];if(G===181){var H=L(M,B);if(B+=2,H===49){var $=I(M,B);if(B+=4,$===1195456820){var te=M[B++];if(te===3){var q=M[B++],ne=31&q,oe=64&q,k=oe?2+ne*3:0,K=new Uint8Array(k);if(oe){K[0]=q;for(var V=1;V<k;V++)K[V]=M[B++]}P.push({type:te,payloadType:N,pts:x,bytes:K})}}}}}else if(N===5&&U<j){if(w=!0,U>16){for(var Y=[],z=0;z<16;z++){var Q=M[B++].toString(16);Y.push(Q.length==1?"0"+Q:Q),(z===3||z===5||z===7||z===9)&&Y.push("-")}for(var Z=U-16,J=new Uint8Array(Z),ee=0;ee<Z;ee++)J[ee]=M[B++];P.push({payloadType:N,pts:x,uuid:Y.join(""),userData:Object(E.utf8ArrayToStr)(J),userDataBytes:J})}}else if(U<j)B+=U;else if(U>j)break}}function v(d){for(var x=d.byteLength,P=[],M=1;M<x-2;)d[M]===0&&d[M+1]===0&&d[M+2]===3?(P.push(M+2),M+=2):M++;if(P.length===0)return d;var B=x-P.length,N=new Uint8Array(B),U=0;for(M=0;M<B;U++,M++)U===P[0]&&(U++,P.shift()),N[M]=d[U];return N}function c(d){var x=d[0],P="",M="",B=0,N=0,U=0,w=0,W=0,j=0;if(x===0){for(;R(d.subarray(j,j+1))!=="\0";)P+=R(d.subarray(j,j+1)),j+=1;for(P+=R(d.subarray(j,j+1)),j+=1;R(d.subarray(j,j+1))!=="\0";)M+=R(d.subarray(j,j+1)),j+=1;M+=R(d.subarray(j,j+1)),j+=1,B=I(d,12),N=I(d,16),w=I(d,20),W=I(d,24),j=28}else if(x===1){j+=4,B=I(d,j),j+=4;var G=I(d,j);j+=4;var H=I(d,j);for(j+=4,U=Math.pow(2,32)*G+H,Number.isSafeInteger(U)||(U=Number.MAX_SAFE_INTEGER,console.warn("Presentation time exceeds safe integer limit and wrapped to max safe integer in parsing emsg box")),w=I(d,j),j+=4,W=I(d,j),j+=4;R(d.subarray(j,j+1))!=="\0";)P+=R(d.subarray(j,j+1)),j+=1;for(P+=R(d.subarray(j,j+1)),j+=1;R(d.subarray(j,j+1))!=="\0";)M+=R(d.subarray(j,j+1)),j+=1;M+=R(d.subarray(j,j+1)),j+=1}var $=d.subarray(j,d.byteLength);return{schemeIdUri:P,value:M,timeScale:B,presentationTime:U,presentationTimeDelta:N,eventDuration:w,id:W,payload:$}}},"./src/utils/output-filter.ts":function(C,l,t){t.r(l),t.d(l,"default",function(){return D});var D=function(){function g(F,_){this.timelineController=void 0,this.cueRanges=[],this.trackName=void 0,this.startTime=null,this.endTime=null,this.screen=null,this.timelineController=F,this.trackName=_}var E=g.prototype;return E.dispatchCue=function(){this.startTime!==null&&(this.timelineController.addCues(this.trackName,this.startTime,this.endTime,this.screen,this.cueRanges),this.startTime=null)},E.newCue=function(_,b,R){(this.startTime===null||this.startTime>_)&&(this.startTime=_),this.endTime=b,this.screen=R,this.timelineController.createCaptionsTrack(this.trackName)},E.reset=function(){this.cueRanges=[],this.startTime=null},g}()},"./src/utils/texttrack-utils.ts":function(C,l,t){t.r(l),t.d(l,"sendAddTrackEvent",function(){return g}),t.d(l,"addCueToTrack",function(){return E}),t.d(l,"clearCurrentCues",function(){return F}),t.d(l,"removeCuesInRange",function(){return _}),t.d(l,"getCuesInRange",function(){return R});var D=t("./src/utils/logger.ts");function g(L,I){var A;try{A=new Event("addtrack")}catch{A=document.createEvent("Event"),A.initEvent("addtrack",!1,!1)}A.track=L,I.dispatchEvent(A)}function E(L,I){var A=L.mode;if(A==="disabled"&&(L.mode="hidden"),L.cues&&!L.cues.getCueById(I.id))try{if(L.addCue(I),!L.cues.getCueById(I.id))throw new Error("addCue is failed for: "+I)}catch(S){D.logger.debug("[texttrack-utils]: "+S);var O=new self.TextTrackCue(I.startTime,I.endTime,I.text);O.id=I.id,L.addCue(O)}A==="disabled"&&(L.mode=A)}function F(L){var I=L.mode;if(I==="disabled"&&(L.mode="hidden"),L.cues)for(var A=L.cues.length;A--;)L.removeCue(L.cues[A]);I==="disabled"&&(L.mode=I)}function _(L,I,A,O){var S=L.mode;if(S==="disabled"&&(L.mode="hidden"),L.cues&&L.cues.length>0)for(var T=R(L.cues,I,A),a=0;a<T.length;a++)(!O||O(T[a]))&&L.removeCue(T[a]);S==="disabled"&&(L.mode=S)}function b(L,I){if(I<L[0].startTime)return 0;var A=L.length-1;if(I>L[A].endTime)return-1;for(var O=0,S=A;O<=S;){var T=Math.floor((S+O)/2);if(I<L[T].startTime)S=T-1;else if(I>L[T].startTime&&O<A)O=T+1;else return T}return L[O].startTime-I<I-L[S].startTime?O:S}function R(L,I,A){var O=[],S=b(L,I);if(S>-1)for(var T=S,a=L.length;T<a;T++){var r=L[T];if(r.startTime>=I&&r.endTime<=A)O.push(r);else if(r.startTime>A)return O}return O}},"./src/utils/time-ranges.ts":function(C,l,t){t.r(l);var D={toString:function(E){for(var F="",_=E.length,b=0;b<_;b++)F+="["+E.start(b).toFixed(3)+","+E.end(b).toFixed(3)+"]";return F}};l.default=D},"./src/utils/timescale-conversion.ts":function(C,l,t){t.r(l),t.d(l,"toTimescaleFromBase",function(){return g}),t.d(l,"toTimescaleFromScale",function(){return E}),t.d(l,"toMsFromMpegTsClock",function(){return F}),t.d(l,"toMpegTsClockFromTimescale",function(){return _});var D=9e4;function g(b,R,L,I){L===void 0&&(L=1),I===void 0&&(I=!1);var A=b*R*L;return I?Math.round(A):A}function E(b,R,L,I){return L===void 0&&(L=1),I===void 0&&(I=!1),g(b,R,1/L,I)}function F(b,R){return R===void 0&&(R=!1),g(b,1e3,1/D,R)}function _(b,R){return R===void 0&&(R=1),g(b,D,1/R)}},"./src/utils/typed-array.ts":function(C,l,t){t.r(l),t.d(l,"sliceUint8",function(){return D});function D(g,E,F){return Uint8Array.prototype.slice?g.slice(E,F):new Uint8Array(Array.prototype.slice.call(g,E,F))}},"./src/utils/vttcue.ts":function(C,l,t){t.r(l),l.default=function(){if(typeof self<"u"&&self.VTTCue)return self.VTTCue;var D=["","lr","rl"],g=["start","middle","end","left","right"];function E(L,I){if(typeof I!="string"||!Array.isArray(L))return!1;var A=I.toLowerCase();return~L.indexOf(A)?A:!1}function F(L){return E(D,L)}function _(L){return E(g,L)}function b(L){for(var I=arguments.length,A=new Array(I>1?I-1:0),O=1;O<I;O++)A[O-1]=arguments[O];for(var S=1;S<arguments.length;S++){var T=arguments[S];for(var a in T)L[a]=T[a]}return L}function R(L,I,A){var O=this,S={enumerable:!0};O.hasBeenReset=!1;var T="",a=!1,r=L,u=I,h=A,y=null,s="",n=!0,i="auto",m="start",o=50,f="middle",v=50,c="middle";Object.defineProperty(O,"id",b({},S,{get:function(){return T},set:function(x){T=""+x}})),Object.defineProperty(O,"pauseOnExit",b({},S,{get:function(){return a},set:function(x){a=!!x}})),Object.defineProperty(O,"startTime",b({},S,{get:function(){return r},set:function(x){if(typeof x!="number")throw new TypeError("Start time must be set to a number.");r=x,this.hasBeenReset=!0}})),Object.defineProperty(O,"endTime",b({},S,{get:function(){return u},set:function(x){if(typeof x!="number")throw new TypeError("End time must be set to a number.");u=x,this.hasBeenReset=!0}})),Object.defineProperty(O,"text",b({},S,{get:function(){return h},set:function(x){h=""+x,this.hasBeenReset=!0}})),Object.defineProperty(O,"region",b({},S,{get:function(){return y},set:function(x){y=x,this.hasBeenReset=!0}})),Object.defineProperty(O,"vertical",b({},S,{get:function(){return s},set:function(x){var P=F(x);if(P===!1)throw new SyntaxError("An invalid or illegal string was specified.");s=P,this.hasBeenReset=!0}})),Object.defineProperty(O,"snapToLines",b({},S,{get:function(){return n},set:function(x){n=!!x,this.hasBeenReset=!0}})),Object.defineProperty(O,"line",b({},S,{get:function(){return i},set:function(x){if(typeof x!="number"&&x!=="auto")throw new SyntaxError("An invalid number or illegal string was specified.");i=x,this.hasBeenReset=!0}})),Object.defineProperty(O,"lineAlign",b({},S,{get:function(){return m},set:function(x){var P=_(x);if(!P)throw new SyntaxError("An invalid or illegal string was specified.");m=P,this.hasBeenReset=!0}})),Object.defineProperty(O,"position",b({},S,{get:function(){return o},set:function(x){if(x<0||x>100)throw new Error("Position must be between 0 and 100.");o=x,this.hasBeenReset=!0}})),Object.defineProperty(O,"positionAlign",b({},S,{get:function(){return f},set:function(x){var P=_(x);if(!P)throw new SyntaxError("An invalid or illegal string was specified.");f=P,this.hasBeenReset=!0}})),Object.defineProperty(O,"size",b({},S,{get:function(){return v},set:function(x){if(x<0||x>100)throw new Error("Size must be between 0 and 100.");v=x,this.hasBeenReset=!0}})),Object.defineProperty(O,"align",b({},S,{get:function(){return c},set:function(x){var P=_(x);if(!P)throw new SyntaxError("An invalid or illegal string was specified.");c=P,this.hasBeenReset=!0}})),O.displayState=void 0}return R.prototype.getCueAsHTML=function(){var L=self.WebVTT;return L.convertCueToDOMTree(self,this.text)},R}()},"./src/utils/vttparser.ts":function(C,l,t){t.r(l),t.d(l,"parseTimeStamp",function(){return E}),t.d(l,"fixLineBreaks",function(){return I}),t.d(l,"VTTParser",function(){return A});var D=t("./src/utils/vttcue.ts"),g=function(){function O(){}var S=O.prototype;return S.decode=function(a,r){if(!a)return"";if(typeof a!="string")throw new Error("Error - expected string data.");return decodeURIComponent(encodeURIComponent(a))},O}();function E(O){function S(a,r,u,h){return(a|0)*3600+(r|0)*60+(u|0)+parseFloat(h||0)}var T=O.match(/^(?:(\d+):)?(\d{2}):(\d{2})(\.\d+)?/);return T?parseFloat(T[2])>59?S(T[2],T[3],0,T[4]):S(T[1],T[2],T[3],T[4]):null}var F=function(){function O(){this.values=Object.create(null)}var S=O.prototype;return S.set=function(a,r){!this.get(a)&&r!==""&&(this.values[a]=r)},S.get=function(a,r,u){return u?this.has(a)?this.values[a]:r[u]:this.has(a)?this.values[a]:r},S.has=function(a){return a in this.values},S.alt=function(a,r,u){for(var h=0;h<u.length;++h)if(r===u[h]){this.set(a,r);break}},S.integer=function(a,r){/^-?\d+$/.test(r)&&this.set(a,parseInt(r,10))},S.percent=function(a,r){if(/^([\d]{1,3})(\.[\d]*)?%$/.test(r)){var u=parseFloat(r);if(u>=0&&u<=100)return this.set(a,u),!0}return!1},O}();function _(O,S,T,a){var r=a?O.split(a):[O];for(var u in r)if(typeof r[u]=="string"){var h=r[u].split(T);if(h.length===2){var y=h[0],s=h[1];S(y,s)}}}var b=new D.default(0,0,""),R=b.align==="middle"?"middle":"center";function L(O,S,T){var a=O;function r(){var y=E(O);if(y===null)throw new Error("Malformed timestamp: "+a);return O=O.replace(/^[^\sa-zA-Z-]+/,""),y}function u(y,s){var n=new F;_(y,function(o,f){var v;switch(o){case"region":for(var c=T.length-1;c>=0;c--)if(T[c].id===f){n.set(o,T[c].region);break}break;case"vertical":n.alt(o,f,["rl","lr"]);break;case"line":v=f.split(","),n.integer(o,v[0]),n.percent(o,v[0])&&n.set("snapToLines",!1),n.alt(o,v[0],["auto"]),v.length===2&&n.alt("lineAlign",v[1],["start",R,"end"]);break;case"position":v=f.split(","),n.percent(o,v[0]),v.length===2&&n.alt("positionAlign",v[1],["start",R,"end","line-left","line-right","auto"]);break;case"size":n.percent(o,f);break;case"align":n.alt(o,f,["start",R,"end","left","right"]);break}},/:/,/\s/),s.region=n.get("region",null),s.vertical=n.get("vertical","");var i=n.get("line","auto");i==="auto"&&b.line===-1&&(i=-1),s.line=i,s.lineAlign=n.get("lineAlign","start"),s.snapToLines=n.get("snapToLines",!0),s.size=n.get("size",100),s.align=n.get("align",R);var m=n.get("position","auto");m==="auto"&&b.position===50&&(m=s.align==="start"||s.align==="left"?0:s.align==="end"||s.align==="right"?100:50),s.position=m}function h(){O=O.replace(/^\s+/,"")}if(h(),S.startTime=r(),h(),O.slice(0,3)!=="-->")throw new Error("Malformed time stamp (time stamps must be separated by '-->'): "+a);O=O.slice(3),h(),S.endTime=r(),h(),u(O,S)}function I(O){return O.replace(/<br(?: \/)?>/gi,`
`)}var A=function(){function O(){this.state="INITIAL",this.buffer="",this.decoder=new g,this.regionList=[],this.cue=null,this.oncue=void 0,this.onparsingerror=void 0,this.onflush=void 0}var S=O.prototype;return S.parse=function(a){var r=this;a&&(r.buffer+=r.decoder.decode(a,{stream:!0}));function u(){var m=r.buffer,o=0;for(m=I(m);o<m.length&&m[o]!=="\r"&&m[o]!==`
`;)++o;var f=m.slice(0,o);return m[o]==="\r"&&++o,m[o]===`
`&&++o,r.buffer=m.slice(o),f}function h(m){_(m,function(o,f){},/:/)}try{var y="";if(r.state==="INITIAL"){if(!/\r\n|\n/.test(r.buffer))return this;y=u();var s=y.match(/^()?WEBVTT([ \t].*)?$/);if(!s||!s[0])throw new Error("Malformed WebVTT signature.");r.state="HEADER"}for(var n=!1;r.buffer;){if(!/\r\n|\n/.test(r.buffer))return this;switch(n?n=!1:y=u(),r.state){case"HEADER":/:/.test(y)?h(y):y||(r.state="ID");continue;case"NOTE":y||(r.state="ID");continue;case"ID":if(/^NOTE($|[ \t])/.test(y)){r.state="NOTE";break}if(!y)continue;if(r.cue=new D.default(0,0,""),r.state="CUE",y.indexOf("-->")===-1){r.cue.id=y;continue}case"CUE":if(!r.cue){r.state="BADCUE";continue}try{L(y,r.cue,r.regionList)}catch{r.cue=null,r.state="BADCUE";continue}r.state="CUETEXT";continue;case"CUETEXT":{var i=y.indexOf("-->")!==-1;if(!y||i&&(n=!0)){r.oncue&&r.cue&&r.oncue(r.cue),r.cue=null,r.state="ID";continue}if(r.cue===null)continue;r.cue.text&&(r.cue.text+=`
`),r.cue.text+=y}continue;case"BADCUE":y||(r.state="ID")}}}catch{r.state==="CUETEXT"&&r.cue&&r.oncue&&r.oncue(r.cue),r.cue=null,r.state=r.state==="INITIAL"?"BADWEBVTT":"BADCUE"}return this},S.flush=function(){var a=this;try{if((a.cue||a.state==="HEADER")&&(a.buffer+=`

`,a.parse()),a.state==="INITIAL"||a.state==="BADWEBVTT")throw new Error("Malformed WebVTT signature.")}catch(r){a.onparsingerror&&a.onparsingerror(r)}return a.onflush&&a.onflush(),this},O}()},"./src/utils/webvtt-parser.ts":function(C,l,t){t.r(l),t.d(l,"generateCueId",function(){return A}),t.d(l,"parseWebVTT",function(){return S});var D=t("./src/polyfills/number.ts"),g=t("./src/utils/vttparser.ts"),E=t("./src/demux/id3.ts"),F=t("./src/utils/timescale-conversion.ts"),_=t("./src/remux/mp4-remuxer.ts"),b=/\r\n|\n\r|\n|\r/g,R=function(a,r,u){return u===void 0&&(u=0),a.slice(u,u+r.length)===r},L=function(a){var r=parseInt(a.slice(-3)),u=parseInt(a.slice(-6,-4)),h=parseInt(a.slice(-9,-7)),y=a.length>9?parseInt(a.substring(0,a.indexOf(":"))):0;if(!Object(D.isFiniteNumber)(r)||!Object(D.isFiniteNumber)(u)||!Object(D.isFiniteNumber)(h)||!Object(D.isFiniteNumber)(y))throw Error("Malformed X-TIMESTAMP-MAP: Local:"+a);return r+=1e3*u,r+=60*1e3*h,r+=60*60*1e3*y,r},I=function(a){for(var r=5381,u=a.length;u;)r=r*33^a.charCodeAt(--u);return(r>>>0).toString()};function A(T,a,r){return I(T.toString())+I(a.toString())+I(r)}var O=function(a,r,u){var h=a[r],y=a[h.prevCC];if(!y||!y.new&&h.new){a.ccOffset=a.presentationOffset=h.start,h.new=!1;return}for(;(s=y)!==null&&s!==void 0&&s.new;){var s;a.ccOffset+=h.start-y.start,h.new=!1,h=y,y=a[h.prevCC]}a.presentationOffset=u};function S(T,a,r,u,h,y,s,n){var i=new g.VTTParser,m=Object(E.utf8ArrayToStr)(new Uint8Array(T)).trim().replace(b,`
`).split(`
`),o=[],f=Object(F.toMpegTsClockFromTimescale)(a,r),v="00:00.000",c=0,d=0,x,P=!0;i.oncue=function(M){var B=u[h],N=u.ccOffset,U=(c-f)/9e4;B!=null&&B.new&&(d!==void 0?N=u.ccOffset=B.start:O(u,h,U)),U&&(N=U-u.presentationOffset);var w=M.endTime-M.startTime,W=Object(_.normalizePts)((M.startTime+N-d)*9e4,y*9e4)/9e4;M.startTime=Math.max(W,0),M.endTime=Math.max(W+w,0);var j=M.text.trim();M.text=decodeURIComponent(encodeURIComponent(j)),M.id||(M.id=A(M.startTime,M.endTime,j)),M.endTime>0&&o.push(M)},i.onparsingerror=function(M){x=M},i.onflush=function(){if(x){n(x);return}s(o)},m.forEach(function(M){if(P)if(R(M,"X-TIMESTAMP-MAP=")){P=!1,M.slice(16).split(",").forEach(function(B){R(B,"LOCAL:")?v=B.slice(6):R(B,"MPEGTS:")&&(c=parseInt(B.slice(7)))});try{d=L(v)/1e3}catch(B){x=B}return}else M===""&&(P=!1);i.parse(M+`
`)}),i.flush()}},"./src/utils/xhr-loader.ts":function(C,l,t){t.r(l);var D=t("./src/utils/logger.ts"),g=t("./src/loader/load-stats.ts"),E=/^age:\s*[\d.]+\s*$/m,F=function(){function _(R){this.xhrSetup=void 0,this.requestTimeout=void 0,this.retryTimeout=void 0,this.retryDelay=void 0,this.config=null,this.callbacks=null,this.context=void 0,this.loader=null,this.stats=void 0,this.xhrSetup=R?R.xhrSetup:null,this.stats=new g.LoadStats,this.retryDelay=0}var b=_.prototype;return b.destroy=function(){this.callbacks=null,this.abortInternal(),this.loader=null,this.config=null},b.abortInternal=function(){var L=this.loader;self.clearTimeout(this.requestTimeout),self.clearTimeout(this.retryTimeout),L&&(L.onreadystatechange=null,L.onprogress=null,L.readyState!==4&&(this.stats.aborted=!0,L.abort()))},b.abort=function(){var L;this.abortInternal(),(L=this.callbacks)!==null&&L!==void 0&&L.onAbort&&this.callbacks.onAbort(this.stats,this.context,this.loader)},b.load=function(L,I,A){if(this.stats.loading.start)throw new Error("Loader can only be used once.");this.stats.loading.start=self.performance.now(),this.context=L,this.config=I,this.callbacks=A,this.retryDelay=I.retryDelay,this.loadInternal()},b.loadInternal=function(){var L=this.config,I=this.context;if(!!L){var A=this.loader=new self.XMLHttpRequest,O=this.stats;O.loading.first=0,O.loaded=0;var S=this.xhrSetup;try{if(S)try{S(A,I.url)}catch{A.open("GET",I.url,!0),S(A,I.url)}A.readyState||A.open("GET",I.url,!0);var T=this.context.headers;if(T)for(var a in T)A.setRequestHeader(a,T[a])}catch(r){this.callbacks.onError({code:A.status,text:r.message},I,A);return}I.rangeEnd&&A.setRequestHeader("Range","bytes="+I.rangeStart+"-"+(I.rangeEnd-1)),A.onreadystatechange=this.readystatechange.bind(this),A.onprogress=this.loadprogress.bind(this),A.responseType=I.responseType,self.clearTimeout(this.requestTimeout),this.requestTimeout=self.setTimeout(this.loadtimeout.bind(this),L.timeout),A.send()}},b.readystatechange=function(){var L=this.context,I=this.loader,A=this.stats;if(!(!L||!I)){var O=I.readyState,S=this.config;if(!A.aborted&&O>=2)if(self.clearTimeout(this.requestTimeout),A.loading.first===0&&(A.loading.first=Math.max(self.performance.now(),A.loading.start)),O===4){I.onreadystatechange=null,I.onprogress=null;var T=I.status;if(T>=200&&T<300){A.loading.end=Math.max(self.performance.now(),A.loading.first);var a,r;if(L.responseType==="arraybuffer"?(a=I.response,r=a.byteLength):(a=I.responseText,r=a.length),A.loaded=A.total=r,!this.callbacks)return;var u=this.callbacks.onProgress;if(u&&u(A,L,a,I),!this.callbacks)return;var h={url:I.responseURL,data:a};this.callbacks.onSuccess(h,A,L,I)}else A.retry>=S.maxRetry||T>=400&&T<499?(D.logger.error(T+" while loading "+L.url),this.callbacks.onError({code:T,text:I.statusText},L,I)):(D.logger.warn(T+" while loading "+L.url+", retrying in "+this.retryDelay+"..."),this.abortInternal(),this.loader=null,self.clearTimeout(this.retryTimeout),this.retryTimeout=self.setTimeout(this.loadInternal.bind(this),this.retryDelay),this.retryDelay=Math.min(2*this.retryDelay,S.maxRetryDelay),A.retry++)}else self.clearTimeout(this.requestTimeout),this.requestTimeout=self.setTimeout(this.loadtimeout.bind(this),S.timeout)}},b.loadtimeout=function(){D.logger.warn("timeout while loading "+this.context.url);var L=this.callbacks;L&&(this.abortInternal(),L.onTimeout(this.stats,this.context,this.loader))},b.loadprogress=function(L){var I=this.stats;I.loaded=L.loaded,L.lengthComputable&&(I.total=L.total)},b.getCacheAge=function(){var L=null;if(this.loader&&E.test(this.loader.getAllResponseHeaders())){var I=this.loader.getResponseHeader("age");L=I?parseFloat(I):null}return L},_}();l.default=F}}).default})})(us);const cl=dl(us.exports);const hl={},vl={class:"button"},gl={class:"button__content"};function ml(e,p){return Be(),Ye("div",vl,[ze("div",gl,[Ya(e.$slots,"default",{},void 0,!0)])])}const Br=Lr(hl,[["render",ml],["__scopeId","data-v-215764e2"]]),pl={xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24","fill-rule":"evenodd","clip-rule":"evenodd"},El=ze("path",{d:"M23 12 1 24V0l22 12zM2 22.315 20.912 12 2 1.685v20.63z"},null,-1),yl=[El];function Tl(e,p){return Be(),Ye("svg",pl,yl)}const xl={render:Tl},Sl={xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24"},Ll=ze("path",{d:"M10 24H4V0h6v24zm10 0h-6V0h6v24zM9 1H5v22h4V1zm10 0h-4v22h4V1z"},null,-1),Dl=[Ll];function Al(e,p){return Be(),Ye("svg",Sl,Dl)}const Ol={render:Al},Il={xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24"},Rl=ze("path",{d:"M21 2v20H1V2h20zm1-1H-2v22h24V-1z"},null,-1),Pl=[Rl];function Cl(e,p){return Be(),Ye("svg",Il,Pl)}const Ml={render:Cl};const bl=e=>(Sa("data-v-d6c4aea0"),e=e(),La(),e),_l=bl(()=>ze("video",{id:"video",width:"360",height:"240"},null,-1)),Fl={class:"controls"},Bl={__name:"VideoPlayer",setup(e){let p=hn();const C=()=>{p.value.pause(),p.value.currentTime=0};return Tr(()=>{let l=new cl,t="https://test-streams.mux.dev/x36xhzz/x36xhzz.m3u8";p.value=document.getElementById("video"),l.loadSource(t),l.attachMedia(p.value)}),(l,t)=>(Be(),Ye(_e,null,[_l,ze("div",Fl,[Oe(Br,{onClick:t[0]||(t[0]=D=>Ze(p).play())},{default:tr(()=>[Oe(Ze(xl))]),_:1}),Oe(Br,{onClick:t[1]||(t[1]=D=>Ze(p).pause())},{default:tr(()=>[Oe(Ze(Ol))]),_:1}),Oe(Br,{onClick:C},{default:tr(()=>[Oe(Ze(Ml))]),_:1})])],64))}},Ul=Lr(Bl,[["__scopeId","data-v-d6c4aea0"]]);const Nl={key:0,class:"wrapper"},wl={class:"popup"},kl={class:"popup__main"},Kl={key:0,class:"popup__video"},Wl={key:1,class:"popup__id"},jl={__name:"Popup",setup(e){const p=ls(),C=()=>{p.popup.show=!1};return(l,t)=>Ze(p).popup.show?(Be(),Ye("div",Nl,[ze("div",wl,[Oe(Ze(ul),{class:"popup__close",onClick:C}),ze("div",kl,[Ze(p).popup.has_video?(Be(),Ye("div",Kl,[Oe(Ul)])):(Be(),Ye("div",Wl,"ID: "+Os(Ze(p).popup.id),1))])])])):go("",!0)}},Gl=Lr(jl,[["__scopeId","data-v-c7ea8cff"]]),Hl={__name:"MapView",setup(e){return(p,C)=>(Be(),Ye(_e,null,[Oe(il),Oe(Gl)],64))}},Vl={__name:"App",setup(e){return(p,C)=>(Be(),Tn(Hl))}};ii(()=>Promise.resolve({}),["maplibre.fe227fe9.css"],import.meta.url);const fs=Yo(Vl);fs.use(Xo());fs.mount("#app");export{fl as c};
